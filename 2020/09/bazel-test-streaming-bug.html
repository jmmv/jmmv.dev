<!doctype html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://ogp.me/ns/fb#">
  <head>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-63557333-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-63557333-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, shrink-to-fit=no">
  

  <meta property="og:site_name" content="Julio Merino (jmmv.dev)">

  <title>Bazel output streaming, Ctrl&#43;C, and test flakiness - Julio Merino (jmmv.dev)</title>
  <meta property="og:title" content="Bazel output streaming, Ctrl&#43;C, and test flakiness - Julio Merino (jmmv.dev)">

  

  <meta name="description" content="About two weeks ago, I found a very interesting bug in Bazel&amp;rsquo;s test output streaming functionality while writing tests for a new feature related to Ctrl&#43;C interrupts. I fixed the bug, wrote a test for it, and&amp;hellip; the test itself came back as flaky, which made me find another very subtle bug in the test that needed a one-line fix. This is the story of both.
 Bazel has a feature known as test output streaming: by default, Bazel captures the outputs (stdout and stderr) of the tests it runs, saves those in local log files, and tells the user where they are when a test fails.">
  <meta property="og:description" content="About two weeks ago, I found a very interesting bug in Bazel&amp;rsquo;s test output streaming functionality while writing tests for a new feature related to Ctrl&#43;C interrupts. I fixed the bug, wrote a test for it, and&amp;hellip; the test itself came back as flaky, which made me find another very subtle bug in the test that needed a one-line fix. This is the story of both.
 Bazel has a feature known as test output streaming: by default, Bazel captures the outputs (stdout and stderr) of the tests it runs, saves those in local log files, and tells the user where they are when a test fails.">
  <meta name="author" content="Julio Merino">
  <meta name="generator" content="Hugo 0.68.3" />

  <meta property="og:url" content="https://jmmv.dev/2020/09/bazel-test-streaming-bug.html">

  <meta property="og:type" content="blog">

  <link rel="canonical" href="https://jmmv.dev/2020/09/bazel-test-streaming-bug.html">
  <link rel="alternate" type="application/rss+xml"
        title="Julio Merino (jmmv.dev)" href="/feed.xml" />

  <link rel="stylesheet" href="/sass/main.min.78695dae53f0bbf4009ec7f71b76fcb2931a284eda02683d419e6a095f0d3b54.css">
  <link rel="stylesheet" href="/css/chroma.css">

  <meta property="og:image" content="/images/favicons/favicon-1200x1200.png" />
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">

  
  <!--[if lt IE 9]>
    <script src="/js/html5shiv-3.7.2.min.js"></script>
    <script src="/js/respond-1.4.2.min.js"></script>
  <![endif]-->
</head>


  <body>
    <header class="site-header">

<nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary">
  <a class="navbar-brand" href="/">
    <img src="/images/favicons/favicon-30x30.png" width="30" height="30" class="d-inline-block align-top" alt="">
    &nbsp;Julio Merino
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse"
          data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false"
          aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      
        
          <li class="nav-item">
            <a class="nav-link" href="/about.html" >About</a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="/essays.html" >Essays</a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="/resume.html" >Resume</a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="/software.html" >Software</a>
          </li>
        
      
    </ul>

    <ul class="navbar-nav mr-4">
      
        
          <li class="nav-item">
            <a class="nav-link" href="/archive.html" >Archive</a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="/series.html" >Series</a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="/tags.html" >Tags</a>
          </li>
        
      
    </ul>

    <form class="form-inline" method="get" role="search"
          action="https://www.google.com/search">
      <div class="input-group">
        <input type="search" name="query" class="form-control"
                placeholder="Search" aria-label="Search">
        <div class="input-group-append">
          <button type="submit" value="Search" class="btn btn-light">
            <img src="/octicons/search.svg">
          </button>
        </div>
      </div>
      <input type="hidden" name="sitesearch" value="https://jmmv.dev/">
    </form>
  </div>
</nav>

</header>


    <div class="page-header">
      <div class="container">
        <h1>Bazel output streaming, Ctrl&#43;C, and test flakiness</h1>

        <p>September 18, 2020 &middot;
        About 9 minutes
        &middot;
        Tags:
        <a class="text-reset" href="/tags/bazel">bazel</a>, <a class="text-reset" href="/tags/bug">bug</a></p>

        
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-md-9">
          <div class="row">
            <div class="col">
              
              <article><p>About two weeks ago, I found a very interesting bug in Bazel&rsquo;s test output streaming functionality while writing tests for a new feature related to Ctrl+C interrupts. I fixed the bug, wrote a test for it, and&hellip; the test itself came back as flaky, which made me find another very subtle bug in the test that needed a one-line fix. This is the story of both.</p>
<!-- more -->
<hr>
<p>Bazel has a feature known as <strong>test output streaming</strong>: by default, Bazel captures the outputs (stdout and stderr) of the tests it runs, saves those in local log files, and tells the user where they are when a test fails. This is not very ergonomic when you are iterating on a test, so you can make Bazel print the output of the test as it runs by passing <code>--test_output=streamed</code> to the invocation.</p>
<p>Test output <em>streaming</em> sounds fancy: when I first encountered this, I envisioned Bazel truly streaming the output from a remote server as it was generated. But things are not like that: enabling test output streaming has the side-effect of running the tests locally. And if you look at the internals, all the magic vanishes: there is a class called <a href="https://cs.opensource.google/bazel/bazel/+/master:src/main/java/com/google/devtools/build/lib/util/io/FileWatcher.java;l=1;drc=f88f4d81acead9ef3e2f73d9a44afd76c2c239c1"><code>FileWatcher</code></a> that uses a thread to monitor for log file changes every 100ms. Sad face.</p>
<h1 id="bazels-clientserver-architecture">Bazel&rsquo;s client/server architecture</h1>
<p>To further understand this story, we need to look at how Bazel prints messages to the console. &ldquo;It&rsquo;s just a command-line tool, duh, so it can print to stdout as it wishes!&rdquo; I hear you saying. Yeeees&hellip; but no. Things are more complex than that.</p>
<p><a href="https://docs.bazel.build/versions/3.5.0/guide.html#clientserver-implementation">Bazel has a client/server architecture</a> where both processes always running on the same machine. The server is the long-lived Java process that keeps state in memory and processes the commands, which means it&rsquo;s the component that executes the tests. The ephemeral C++ client connects to this server to invoke a command and waits for the server to terminate execution of that command before returning control to the user.</p>
<p>See where am I going? The server is a daemon process: it has no access to the console. The client is the process that is attached to the console. While the client is actively running a command on the server, the client fetches stdout/stderr data from the server and prints it to the console. This communication all happens over gRPC (via <a href="https://grpc.io/docs/what-is-grpc/core-concepts/">a true stream</a>). And once the client is gone, the server cannot print anything else.</p>
<h1 id="the-ctrlc-bug-during-output-streaming">The Ctrl+C bug during output streaming</h1>
<p>So here is the bug: if you happened to be streaming the output of a test and you hit Ctrl+C, the following Bazel command you ran would detect that the server wasn&rsquo;t there and start a new one.</p>
<p>This is unexpected. The server is intended to be long-lived and reused across different commands. Given that I had not changed any startup flags between the two invocations, the only possible explanation for this behavior was that the server had died while handling Ctrl+C. But this is <em>very</em> subtle behavior: there were no visible error messages. The only thing you could notice was the server starting a second time and thus the second command taking longer than it should have. But if you didn&rsquo;t pay attention, it was super-easy to miss that something was wrong.</p>
<p>But I did notice because I was writing a test precisely for <a href="https://github.com/bazelbuild/bazel/commit/2bb3b73d5739fd9cae152a3626b4a6c203d8cef6">a new feature involved in Ctrl+C interrupt handling</a>. And in this test, I saw things not behaving as expected, so I rolled up my sleeves and dug down a little.</p>
<p>Given that iterating on Bazel integration tests is painful due to how slow they can be, I tried to reproduce the problem by hand, which was easy. But I had to look into the server&rsquo;s <code>java.log</code> to actually an indication of misbehavior:</p>
<pre><code>java.lang.IllegalStateException: Stream is already completed, no further calls are allowed
        at com.google.common.base.Preconditions.checkState(Preconditions.java:508)
        at io.grpc.stub.ServerCalls$ServerCallStreamObserverImpl.onNext(ServerCalls.java:340)
        at com.google.devtools.build.lib.server.GrpcServerImpl$BlockingStreamObserver.onNext(GrpcServerImpl.java:192)
        at com.google.devtools.build.lib.server.GrpcServerImpl$RpcOutputStream.write(GrpcServerImpl.java:258)
        at com.google.devtools.build.lib.util.io.DelegatingOutErr$DelegatingOutputStream.write(DelegatingOutErr.java:117)
        at java.base/java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:81)
        at java.base/java.io.BufferedOutputStream.flush(BufferedOutputStream.java:142)
        at com.google.devtools.build.lib.runtime.UiEventHandler$FullyBufferedOutputStreamMaybeWithCounting.flush(UiEventHandler.java:218)
        at com.google.devtools.build.lib.runtime.UiEventHandler.handleIfCapacityPermits(UiEventHandler.java:402)
        at com.google.devtools.build.lib.runtime.UiEventHandler.handleInternal(UiEventHandler.java:502)
        at com.google.devtools.build.lib.runtime.UiEventHandler.handle(UiEventHandler.java:521)
        at com.google.devtools.build.lib.events.Reporter.handle(Reporter.java:142)
        at com.google.devtools.build.lib.events.ReporterStream.write(ReporterStream.java:55)
        at com.google.devtools.build.lib.exec.TestLogHelper$FilterTestHeaderOutputStream.write(TestLogHelper.java:123)
        at com.google.devtools.build.lib.util.io.FileWatcher.run(FileWatcher.java:96)
</code></pre><p>Yikes. <a href="/2020/09/bazel-ui-locking.html">The UI again?</a> Please no. Spoiler alert: it wasn&rsquo;t.</p>
<p>I won&rsquo;t get into a lot of detail here, but if we trace through the classes involved, what we find is that Bazel is writing into the gRPC stream used to feed stdout from the server to the client, but it does so <em>after</em> the client has terminated. In other words: we have a resource leak (the gRPC stream) that outlives the client and, thanks to some <a href="/2013/07/readability-abuse-assertions.html">paranoid coding</a>, we detect an invalid state later on.</p>
<p>This didn&rsquo;t surprise me. Handling interrupts correctly is very difficult no matter the programming model: signal handlers, Go channels, Java interrupts&hellip; all of them are hard. Furthermore, interrupts are rare, so their handlers often see little testing. What surprised me, though, was: if this is such an obvious bug, how come nobody had ever noticed it before? Bazel has a long history and tons of invocations per day, so surely somebody must have hit Ctrl+C and triggered this?</p>
<p>Well, apparently I might have been the first one to notice and pause to think that something was off. The reason is that the misbehavior we observe here depends on the strategy used to run the tests. As we <a href="/2019/12/bazel-strategies.html">saw in the past</a>, the strategy is the component in charge of running subprocesses and dealing with their outputs, and thus the strategy is the component that is interrupted when you hit Ctrl+C. It was possible that the strategy was leaking resources in some way and making them outlive the client.</p>
<p>And indeed that was the case. Months earlier, I had spent some time ensuring the local strategy <a href="/2019/11/wait-for-process-group.html">handled process interrupts correctly</a>&hellip; but I had not touched the sandboxed strategy at all. And, guess what, I was seeing problems because the sandboxed strategy was in use. Which explains why this hasn&rsquo;t seen a ton of exposure before: within Google, for example, we default to remote test execution so cancellations happen in very different ways.</p>
<p>Having diagnosed the problem, <a href="https://github.com/bazelbuild/bazel/commit/397f172139169410abf672c6ff95dfb9e2f56fe6">fixing it was relatively straightforward</a> but required a code audit. I encountered the obvious issue: the sandboxed strategy was killing the subprocess but failed to wait for its completion (sending a signal is an asynchronous action), but I also found other possible leaks. Writing the integration test for the fix wasn&rsquo;t that simple though.</p>
<h1 id="the-new-integration-test">The new integration test</h1>
<p>Here is how the test for this bug fix works:</p>
<ol>
<li>
<p>Make Bazel run a test program that prints a &ldquo;cookie&rdquo; message and then simply sleeps for a long time, waiting for it to be interrupted.</p>
</li>
<li>
<p>Run the test with <code>--test_output=streamed</code> in a background invocation of Bazel, redirecting all stdout/stderr to a log file.</p>
</li>
<li>
<p>Periodically grep the log file until the &ldquo;cookie&rdquo; message shows up, which indicates that Bazel has reached the point in which we want to send the interrupt.</p>
</li>
<li>
<p>Send an interrupt signal to Bazel (the client).</p>
</li>
<li>
<p>Wait until the background process (the client) finishes to ensure the command has completed.</p>
</li>
<li>
<p>Check the Bazel server logs to verify that there isn&rsquo;t a crash (whitebox testing).</p>
</li>
<li>
<p>Repeat all steps from above  to run the test a second time, <em>without explicitly shutting down the Bazel server</em>.</p>
</li>
<li>
<p>Verify that the output of the second run doesn&rsquo;t say that the Bazel server had to start again (blackbox testing).</p>
</li>
</ol>
<p>It took me a while to get all the details right, possibly because of the very subtle bug in the test I will discuss below. But, eventually I got the test to pass on all the platforms BazelCI supports, which is always&hellip; involved, so I submitted it and finished the work in the original Ctrl+C feature that brought me here.</p>
<h1 id="flakiness-in-the-new-test">Flakiness in the new test</h1>
<p>A few days later, the dreaded report came: &ldquo;your new test is flaky&rdquo;. Yikes, I hate bugs like these. Debugging Bazel integration tests and looking for flakiness is a task that can easily suck a full day, if not more. Luckily, Bazel&rsquo;s <code>--runs_per_test=100</code> combined with remote execution is super-handy here, as you can expose any kind of flakiness in minutes.</p>
<p>I&rsquo;m not exactly sure how I went about troubleshooting the problem, but it wasn&rsquo;t trivial. I researched a bunch of loose ends and at some point I added timestamps to the various steps the test was taking. This was the key to uncover the bug: somehow, the second iteration of the test was running almost immediately after the first one. Which wasn&rsquo;t normal because the test does some pretty slow polling (1-second steps) to wait for Bazel to reach the interrupt point. I was expecting to see, at least, a 1-second delay between the first and the second test. But it wasn&rsquo;t there.</p>
<p>And then it hit me. Here is the simplified version of how I ran Bazel in the background and waited for it to show the &ldquo;cookie&rdquo; message:</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">bazel <span class="s2">&#34;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&#34;</span> &gt;<span class="s2">&#34;</span><span class="si">${</span><span class="nv">TEST_log</span><span class="si">}</span><span class="s2">&#34;</span> 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">&amp;</span>
<span class="k">while</span> ! grep -q <span class="s2">&#34;Ready for interrupt&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">TEST_log</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span> <span class="k">do</span>
  sleep <span class="m">1</span>
<span class="k">done</span>
</code></pre></div><p>I had implemented this same logic a bunch of times in different tests and never had problems, so I didn&rsquo;t give it a second thought. But this test is slightly different because it runs the above code snippet <em>twice in a loop</em>, without the test framework&rsquo;s cleanup intervening.</p>
<p>The most plausible explanation for the lack of any delay in the second run meant that maybe we were picking up the log of the previous invocation by mistake during the second test run. And, that was precisely the problem. But why? How?</p>
<p>The reason is simple: the code above works reliably when <code>TEST_log</code> <em>doesn&rsquo;t</em> exist, but it is racy when it does. You see: the first line in the snippet above, the one that runs <code>bazel</code> in the background, is problematic. That line makes the shell redirect the output to <code>TEST_log</code>&hellip; but the key observation is that <strong>the redirection is configured in the subprocess</strong>: when that statement completes, there is no guarantee that <code>TEST_log</code> has been truncated and set up as the output of the <code>bazel</code> command yet. &ldquo;Obviously&rdquo; you might say, and it <em>is</em> obvious if you think about it&hellip; but you need to know quite a bit about how the shell works to reason about this&mdash;and it&rsquo;s hard to notice after you&rsquo;ve written this same pattern successfully countless times.</p>
<p>With this in mind, <a href="https://github.com/bazelbuild/bazel/commit/368708495912814db46893a9d891989c0b5793a1">the fix for the test&rsquo;s flakiness was trivial</a>: ensure we start without a <code>TEST_log</code> (or with an empty log) to remove the possibility of the race condition.</p>
</article>
            </div>
          </div>

          
          <div class="container post-links action-highlight">
            <div class="row">
              <div class="col-md-12 text-center">
                <p><b>Want more posts like this one? Take a moment to subscribe.</b></p>
              </div>
            </div>
            <div class="row">
              <div class="col-md-10">
                <form action="https://api.follow.it/subscription-form/WWZwVlFmTks4enBrYytaNHorbE4zSnpRTTBoTy9PcXNsZjdQbVpmWDJDemwyVW9rc2llZHNxQW9iUGdXNG83dm11SWZDM0NKSlQ5Qm1LTUpJZnF2b0Z5WDE3UUtvaEgzTWRWUFBQWEo4RUxyNUt5UW4xN3VZaW9paEd1UUFCL1J8YStTYmVCc3VoVGhCeENNSVZHSmEyUk1hejZWaEZkT1M1WTVkSXdBY1Q5cz0=/8" method="post">
                  <div class="form-group row px-md-4">
                    <input type="text" name="email"
                          placeholder="Enter your email"
                          class="form-control input-sm col-md-9 text-center"/>
                    <button type="submit" class="btn btn-primary col-md-3">Subscribe</button>
                  </div>
                </form>
              </div>
              <div class="col-md-1 text-center">
                <p>
                  <a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&amp;screen_name=jmmv">
                    <img src="/images/badges/Twitter_logo_blue_32.png" alt="Follow @jmmv on Twitter">
                  </a>
                </p>
              </div>
              <div class="col-md-1 text-center">
                <p><a href="/feed.xml"><img
                  src="/images/badges/feed-icon-28x28.png" alt="RSS feed"></a></p>
              </div>
            </div>
          </div>

          <div class="container post-links">
            <div class="row">
              <div class="col-md-12 text-center">
                <p><b>Enjoyed this article? Spread the word or join the ongoing discussion.</b></p>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4 text-center"><a href="https://www.reddit.com/submit?title=Bazel&#43;output&#43;streaming%2C&#43;Ctrl%2BC%2C&#43;and&#43;test&#43;flakiness&amp;url=https%3A%2F%2Fjmmv.dev%2F2020%2F09%2Fbazel-test-streaming-bug.html">
                  <img src="/images/badges/reddit.png"
                       alt="Reddit logo"
                       width="64" height="64">
                  <br>
                  <strong>Share on Reddit</strong>
                </a>
              </div>
              <div class="col-md-4 text-center"><a href="https://news.ycombinator.com/submitlink?t=Bazel&#43;output&#43;streaming%2C&#43;Ctrl%2BC%2C&#43;and&#43;test&#43;flakiness&amp;u=https%3A%2F%2Fjmmv.dev%2F2020%2F09%2Fbazel-test-streaming-bug.html">
                  <img src="/images/badges/ycombinator.png"
                       alt="Hacker News logo"
                       width="64" height="64">
                  <br>
                  <strong>Share on Hacker News</strong>
                </a>
              </div>
              <div class="col-md-4 text-center"><a href="https://twitter.com/intent/tweet?status=Bazel&#43;output&#43;streaming%2C&#43;Ctrl%2BC%2C&#43;and&#43;test&#43;flakiness&#43;%E2%80%94&#43;https%3A%2F%2Fjmmv.dev%2F2020%2F09%2Fbazel-test-streaming-bug.html&#43;%E2%80%94&#43;cc&#43;%40jmmv">
                  <img src="/images/badges/Twitter_Social_Icon_Circle_Color.png"
                       alt="Twitter logo"
                       width="64" height="64">
                  <br>
                  <strong>Share on Twitter</strong>
                </a>
              </div>
            </div>
          </div>

          <div class="container post-links">
            <div class="row">
              <div class="col-md mr-auto text-left">
                
                <span><a href="https://jmmv.dev/2020/09/bazel-ui-locking.html">&laquo; Previous post</a></span>
                
              </div>

              <div class="col-md text-center">
                <span><a href="/archive.html">All posts</a></span>
              </div>

              <div class="col-md ml-auto text-right">
                
                <span><a href="https://jmmv.dev/2020/10/bazel-jni.html">Next post &raquo;</a></span>
                
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-3 sidebar">
          <div class="row action-highlight">
  <div class="col">
    <h2>Follow me!</h2>

    <div class="row">
      <div class="col-sm-6 text-center">
        <p>
          <a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&amp;screen_name=jmmv">
            <img src="/images/badges/Twitter_logo_blue_32.png" alt="Follow @jmmv on Twitter">
          </a>
        </p>
      </div>
      <div class="col-sm-6 text-center">
        <p><a href="/feed.xml"><img
          src="/images/badges/feed-icon-28x28.png" alt="RSS feed"></a></p>
      </div>
    </div>

    <form action="https://api.follow.it/subscription-form/WWZwVlFmTks4enBrYytaNHorbE4zSnpRTTBoTy9PcXNsZjdQbVpmWDJDemwyVW9rc2llZHNxQW9iUGdXNG83dm11SWZDM0NKSlQ5Qm1LTUpJZnF2b0Z5WDE3UUtvaEgzTWRWUFBQWEo4RUxyNUt5UW4xN3VZaW9paEd1UUFCL1J8YStTYmVCc3VoVGhCeENNSVZHSmEyUk1hejZWaEZkT1M1WTVkSXdBY1Q5cz0=/8" method="post">
      <div class="form-group">
        <input type="text" name="email"
          placeholder="Enter your email"
          class="form-control input-sm text-center"/>
        <button type="submit" class="btn btn-primary btn-block">Subscribe</button>
      </div>
    </form>
  </div>
</div>

<div class="row">
  <div class="col">
    <h2>Featured posts</h2>

    <ul>
      
        <li><a href="/2021/07/endbasic-0.7.html">EndBASIC 0.7: Hello, cloud!</a></li>
      
        <li><a href="/2021/04/always-be-quitting.html">Always be quitting</a></li>
      
        <li><a href="/2021/02/google-monorepos-and-caching.html">How does Google keep build times low?</a></li>
      
        <li><a href="/2020/12/google-no-clean-builds.html">How does Google avoid clean builds?</a></li>
      
        <li><a href="/2020/12/unit-testing-a-console-app.html">Unit-testing a console app (a text editor)</a></li>
      
      <li><a href="/essays.html#featured">More...</a></li>
    </ul>
  </div>
</div>

<div class="row">
  <div class="col">
    <h2>Archive</h2>

    <ul>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2021">2021</a> (15)
        <ul id="archive-year-2021" class="collapse">
        
          
          <li><a href="/archive.html#2021-07">July 2021</a> (2)</li>
        
          
          <li><a href="/archive.html#2021-06">June 2021</a> (1)</li>
        
          
          <li><a href="/archive.html#2021-04">April 2021</a> (2)</li>
        
          
          <li><a href="/archive.html#2021-03">March 2021</a> (2)</li>
        
          
          <li><a href="/archive.html#2021-02">February 2021</a> (3)</li>
        
          
          <li><a href="/archive.html#2021-01">January 2021</a> (5)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2020">2020</a> (36)
        <ul id="archive-year-2020" class="collapse">
        
          
          <li><a href="/archive.html#2020-12">December 2020</a> (4)</li>
        
          
          <li><a href="/archive.html#2020-11">November 2020</a> (5)</li>
        
          
          <li><a href="/archive.html#2020-10">October 2020</a> (5)</li>
        
          
          <li><a href="/archive.html#2020-09">September 2020</a> (2)</li>
        
          
          <li><a href="/archive.html#2020-08">August 2020</a> (6)</li>
        
          
          <li><a href="/archive.html#2020-07">July 2020</a> (2)</li>
        
          
          <li><a href="/archive.html#2020-06">June 2020</a> (2)</li>
        
          
          <li><a href="/archive.html#2020-05">May 2020</a> (3)</li>
        
          
          <li><a href="/archive.html#2020-04">April 2020</a> (2)</li>
        
          
          <li><a href="/archive.html#2020-03">March 2020</a> (2)</li>
        
          
          <li><a href="/archive.html#2020-02">February 2020</a> (1)</li>
        
          
          <li><a href="/archive.html#2020-01">January 2020</a> (2)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2019">2019</a> (24)
        <ul id="archive-year-2019" class="collapse">
        
          
          <li><a href="/archive.html#2019-12">December 2019</a> (8)</li>
        
          
          <li><a href="/archive.html#2019-11">November 2019</a> (6)</li>
        
          
          <li><a href="/archive.html#2019-10">October 2019</a> (1)</li>
        
          
          <li><a href="/archive.html#2019-09">September 2019</a> (2)</li>
        
          
          <li><a href="/archive.html#2019-03">March 2019</a> (2)</li>
        
          
          <li><a href="/archive.html#2019-02">February 2019</a> (3)</li>
        
          
          <li><a href="/archive.html#2019-01">January 2019</a> (2)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2018">2018</a> (25)
        <ul id="archive-year-2018" class="collapse">
        
          
          <li><a href="/archive.html#2018-07">July 2018</a> (3)</li>
        
          
          <li><a href="/archive.html#2018-06">June 2018</a> (7)</li>
        
          
          <li><a href="/archive.html#2018-05">May 2018</a> (2)</li>
        
          
          <li><a href="/archive.html#2018-04">April 2018</a> (2)</li>
        
          
          <li><a href="/archive.html#2018-03">March 2018</a> (8)</li>
        
          
          <li><a href="/archive.html#2018-02">February 2018</a> (3)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2017">2017</a> (6)
        <ul id="archive-year-2017" class="collapse">
        
          
          <li><a href="/archive.html#2017-10">October 2017</a> (1)</li>
        
          
          <li><a href="/archive.html#2017-08">August 2017</a> (1)</li>
        
          
          <li><a href="/archive.html#2017-07">July 2017</a> (1)</li>
        
          
          <li><a href="/archive.html#2017-02">February 2017</a> (3)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2016">2016</a> (8)
        <ul id="archive-year-2016" class="collapse">
        
          
          <li><a href="/archive.html#2016-09">September 2016</a> (1)</li>
        
          
          <li><a href="/archive.html#2016-05">May 2016</a> (1)</li>
        
          
          <li><a href="/archive.html#2016-04">April 2016</a> (1)</li>
        
          
          <li><a href="/archive.html#2016-03">March 2016</a> (2)</li>
        
          
          <li><a href="/archive.html#2016-02">February 2016</a> (1)</li>
        
          
          <li><a href="/archive.html#2016-01">January 2016</a> (2)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2015">2015</a> (17)
        <ul id="archive-year-2015" class="collapse">
        
          
          <li><a href="/archive.html#2015-12">December 2015</a> (2)</li>
        
          
          <li><a href="/archive.html#2015-10">October 2015</a> (2)</li>
        
          
          <li><a href="/archive.html#2015-09">September 2015</a> (3)</li>
        
          
          <li><a href="/archive.html#2015-06">June 2015</a> (2)</li>
        
          
          <li><a href="/archive.html#2015-05">May 2015</a> (3)</li>
        
          
          <li><a href="/archive.html#2015-04">April 2015</a> (1)</li>
        
          
          <li><a href="/archive.html#2015-03">March 2015</a> (1)</li>
        
          
          <li><a href="/archive.html#2015-02">February 2015</a> (3)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2014">2014</a> (12)
        <ul id="archive-year-2014" class="collapse">
        
          
          <li><a href="/archive.html#2014-11">November 2014</a> (2)</li>
        
          
          <li><a href="/archive.html#2014-05">May 2014</a> (3)</li>
        
          
          <li><a href="/archive.html#2014-03">March 2014</a> (1)</li>
        
          
          <li><a href="/archive.html#2014-02">February 2014</a> (3)</li>
        
          
          <li><a href="/archive.html#2014-01">January 2014</a> (3)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2013">2013</a> (62)
        <ul id="archive-year-2013" class="collapse">
        
          
          <li><a href="/archive.html#2013-12">December 2013</a> (7)</li>
        
          
          <li><a href="/archive.html#2013-11">November 2013</a> (7)</li>
        
          
          <li><a href="/archive.html#2013-10">October 2013</a> (7)</li>
        
          
          <li><a href="/archive.html#2013-09">September 2013</a> (13)</li>
        
          
          <li><a href="/archive.html#2013-08">August 2013</a> (9)</li>
        
          
          <li><a href="/archive.html#2013-07">July 2013</a> (10)</li>
        
          
          <li><a href="/archive.html#2013-06">June 2013</a> (9)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2012">2012</a> (29)
        <ul id="archive-year-2012" class="collapse">
        
          
          <li><a href="/archive.html#2012-10">October 2012</a> (1)</li>
        
          
          <li><a href="/archive.html#2012-09">September 2012</a> (1)</li>
        
          
          <li><a href="/archive.html#2012-08">August 2012</a> (3)</li>
        
          
          <li><a href="/archive.html#2012-07">July 2012</a> (2)</li>
        
          
          <li><a href="/archive.html#2012-06">June 2012</a> (2)</li>
        
          
          <li><a href="/archive.html#2012-05">May 2012</a> (3)</li>
        
          
          <li><a href="/archive.html#2012-04">April 2012</a> (1)</li>
        
          
          <li><a href="/archive.html#2012-03">March 2012</a> (1)</li>
        
          
          <li><a href="/archive.html#2012-02">February 2012</a> (10)</li>
        
          
          <li><a href="/archive.html#2012-01">January 2012</a> (5)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2011">2011</a> (60)
        <ul id="archive-year-2011" class="collapse">
        
          
          <li><a href="/archive.html#2011-12">December 2011</a> (4)</li>
        
          
          <li><a href="/archive.html#2011-11">November 2011</a> (4)</li>
        
          
          <li><a href="/archive.html#2011-10">October 2011</a> (5)</li>
        
          
          <li><a href="/archive.html#2011-09">September 2011</a> (11)</li>
        
          
          <li><a href="/archive.html#2011-08">August 2011</a> (6)</li>
        
          
          <li><a href="/archive.html#2011-07">July 2011</a> (4)</li>
        
          
          <li><a href="/archive.html#2011-06">June 2011</a> (6)</li>
        
          
          <li><a href="/archive.html#2011-05">May 2011</a> (6)</li>
        
          
          <li><a href="/archive.html#2011-04">April 2011</a> (5)</li>
        
          
          <li><a href="/archive.html#2011-03">March 2011</a> (2)</li>
        
          
          <li><a href="/archive.html#2011-01">January 2011</a> (7)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2010">2010</a> (26)
        <ul id="archive-year-2010" class="collapse">
        
          
          <li><a href="/archive.html#2010-12">December 2010</a> (7)</li>
        
          
          <li><a href="/archive.html#2010-09">September 2010</a> (1)</li>
        
          
          <li><a href="/archive.html#2010-07">July 2010</a> (1)</li>
        
          
          <li><a href="/archive.html#2010-06">June 2010</a> (2)</li>
        
          
          <li><a href="/archive.html#2010-05">May 2010</a> (5)</li>
        
          
          <li><a href="/archive.html#2010-04">April 2010</a> (5)</li>
        
          
          <li><a href="/archive.html#2010-03">March 2010</a> (3)</li>
        
          
          <li><a href="/archive.html#2010-01">January 2010</a> (2)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2009">2009</a> (31)
        <ul id="archive-year-2009" class="collapse">
        
          
          <li><a href="/archive.html#2009-10">October 2009</a> (1)</li>
        
          
          <li><a href="/archive.html#2009-09">September 2009</a> (1)</li>
        
          
          <li><a href="/archive.html#2009-08">August 2009</a> (3)</li>
        
          
          <li><a href="/archive.html#2009-07">July 2009</a> (2)</li>
        
          
          <li><a href="/archive.html#2009-06">June 2009</a> (4)</li>
        
          
          <li><a href="/archive.html#2009-05">May 2009</a> (6)</li>
        
          
          <li><a href="/archive.html#2009-04">April 2009</a> (2)</li>
        
          
          <li><a href="/archive.html#2009-03">March 2009</a> (4)</li>
        
          
          <li><a href="/archive.html#2009-01">January 2009</a> (8)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2008">2008</a> (61)
        <ul id="archive-year-2008" class="collapse">
        
          
          <li><a href="/archive.html#2008-12">December 2008</a> (1)</li>
        
          
          <li><a href="/archive.html#2008-11">November 2008</a> (4)</li>
        
          
          <li><a href="/archive.html#2008-10">October 2008</a> (6)</li>
        
          
          <li><a href="/archive.html#2008-09">September 2008</a> (1)</li>
        
          
          <li><a href="/archive.html#2008-08">August 2008</a> (6)</li>
        
          
          <li><a href="/archive.html#2008-07">July 2008</a> (14)</li>
        
          
          <li><a href="/archive.html#2008-06">June 2008</a> (3)</li>
        
          
          <li><a href="/archive.html#2008-05">May 2008</a> (1)</li>
        
          
          <li><a href="/archive.html#2008-04">April 2008</a> (3)</li>
        
          
          <li><a href="/archive.html#2008-03">March 2008</a> (3)</li>
        
          
          <li><a href="/archive.html#2008-02">February 2008</a> (9)</li>
        
          
          <li><a href="/archive.html#2008-01">January 2008</a> (10)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2007">2007</a> (86)
        <ul id="archive-year-2007" class="collapse">
        
          
          <li><a href="/archive.html#2007-12">December 2007</a> (4)</li>
        
          
          <li><a href="/archive.html#2007-11">November 2007</a> (7)</li>
        
          
          <li><a href="/archive.html#2007-10">October 2007</a> (2)</li>
        
          
          <li><a href="/archive.html#2007-09">September 2007</a> (8)</li>
        
          
          <li><a href="/archive.html#2007-08">August 2007</a> (6)</li>
        
          
          <li><a href="/archive.html#2007-07">July 2007</a> (15)</li>
        
          
          <li><a href="/archive.html#2007-06">June 2007</a> (15)</li>
        
          
          <li><a href="/archive.html#2007-05">May 2007</a> (4)</li>
        
          
          <li><a href="/archive.html#2007-04">April 2007</a> (10)</li>
        
          
          <li><a href="/archive.html#2007-03">March 2007</a> (8)</li>
        
          
          <li><a href="/archive.html#2007-02">February 2007</a> (1)</li>
        
          
          <li><a href="/archive.html#2007-01">January 2007</a> (6)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2006">2006</a> (103)
        <ul id="archive-year-2006" class="collapse">
        
          
          <li><a href="/archive.html#2006-12">December 2006</a> (4)</li>
        
          
          <li><a href="/archive.html#2006-11">November 2006</a> (3)</li>
        
          
          <li><a href="/archive.html#2006-10">October 2006</a> (7)</li>
        
          
          <li><a href="/archive.html#2006-09">September 2006</a> (6)</li>
        
          
          <li><a href="/archive.html#2006-08">August 2006</a> (13)</li>
        
          
          <li><a href="/archive.html#2006-07">July 2006</a> (4)</li>
        
          
          <li><a href="/archive.html#2006-06">June 2006</a> (13)</li>
        
          
          <li><a href="/archive.html#2006-05">May 2006</a> (7)</li>
        
          
          <li><a href="/archive.html#2006-04">April 2006</a> (9)</li>
        
          
          <li><a href="/archive.html#2006-03">March 2006</a> (6)</li>
        
          
          <li><a href="/archive.html#2006-02">February 2006</a> (13)</li>
        
          
          <li><a href="/archive.html#2006-01">January 2006</a> (18)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2005">2005</a> (129)
        <ul id="archive-year-2005" class="collapse">
        
          
          <li><a href="/archive.html#2005-12">December 2005</a> (9)</li>
        
          
          <li><a href="/archive.html#2005-11">November 2005</a> (7)</li>
        
          
          <li><a href="/archive.html#2005-10">October 2005</a> (23)</li>
        
          
          <li><a href="/archive.html#2005-09">September 2005</a> (10)</li>
        
          
          <li><a href="/archive.html#2005-08">August 2005</a> (14)</li>
        
          
          <li><a href="/archive.html#2005-07">July 2005</a> (5)</li>
        
          
          <li><a href="/archive.html#2005-06">June 2005</a> (12)</li>
        
          
          <li><a href="/archive.html#2005-05">May 2005</a> (6)</li>
        
          
          <li><a href="/archive.html#2005-04">April 2005</a> (6)</li>
        
          
          <li><a href="/archive.html#2005-03">March 2005</a> (13)</li>
        
          
          <li><a href="/archive.html#2005-02">February 2005</a> (11)</li>
        
          
          <li><a href="/archive.html#2005-01">January 2005</a> (13)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2004">2004</a> (84)
        <ul id="archive-year-2004" class="collapse">
        
          
          <li><a href="/archive.html#2004-12">December 2004</a> (9)</li>
        
          
          <li><a href="/archive.html#2004-11">November 2004</a> (6)</li>
        
          
          <li><a href="/archive.html#2004-10">October 2004</a> (11)</li>
        
          
          <li><a href="/archive.html#2004-09">September 2004</a> (19)</li>
        
          
          <li><a href="/archive.html#2004-07">July 2004</a> (29)</li>
        
          
          <li><a href="/archive.html#2004-06">June 2004</a> (10)</li>
        
        </ul>
      </li>
    
    </ul>
  </div>
</div>

        </div>
      </div>
    </div>

    <footer class="container">
  <div class="row">
    <div class="col order-2 texr-right">
      <p class="float-right"><a href="#">Back to top</a></p>
    </div>
    <div class="col order-1 mr-auto">
      <p>Copyright 2004&ndash;2021 Julio Merino</p>
    </div>
  </div>
</footer>

<script src="/js/jquery-1.11.2.min.js"></script>
<script src="/bootstrap-4.3.1/dist/js/bootstrap.min.js"></script>

<script>
$('article :header').each(function() {
  var attr = $(this).attr('id');
  if (typeof attr !== typeof undefined && attr !== false) {
    $(this).append('<a class="anchor" href="#' + $(this).context.id + '">' +
      '<img src="/octicons/link.svg" aria-hidden="true">' +
      '</a>')
  }
})
</script>

<script>
$("blockquote").addClass("blockquote");
$("pre.chroma").addClass("pre-scrollable");

$("p:contains('NOTE: ')").addClass("callout callout-info");
$("p:contains('IMPORTANT: ')").addClass("callout callout-info");
$("p:contains('WARNING: ')").addClass("callout callout-warning");
$("p:contains('UPDATE (')").addClass("callout callout-warning");
$("p:contains('DANGER: ')").addClass("callout callout-danger");
$("p:contains('DISCLAIMER: ')").addClass("callout callout-danger");
</script>

  </body>
</html>
