<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml xmlns:fb=http://ogp.me/ns/fb#><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta property="og:site_name" content="Julio Merino (jmmv.dev)"><meta property="twitter:site" content="@jmmv"><title>BazelCon 2023 et al. trip report - Julio Merino (jmmv.dev)</title><meta property="og:title" content="BazelCon 2023 et al. trip report - Julio Merino (jmmv.dev)"><meta property="twitter:title" content="BazelCon 2023 et al. trip report - Julio Merino (jmmv.dev)"><meta name=description content="I&amp;rsquo;m exhausted. I just came back to Seattle from a 10-day trip in which I attended three different Bazel events: the Build Meetup in Reykjavik, the Bazel Community Day in Munich, and BazelCon 2023 in Munich too. Oh, and because I was on the other side of the world, I also paid a visit to my family in Spain.
Attending these events has been incredibly useful and productive: I got exposure to many ideas and discussions that would just not happen online, I got to build connections with very interesting people and, of course, it has also been super fun too to reconnect with old coworkers and friends.
This article contains the summary of the things I learned and the things I want to follow up on. These are just a bunch of cleaned-up notes which I took and are in the context of my work with Bazel at Snowflake and my interests on build tools, so this is not endorsed by Snowflake.
"><meta property="og:description" content="I&amp;rsquo;m exhausted. I just came back to Seattle from a 10-day trip in which I attended three different Bazel events: the Build Meetup in Reykjavik, the Bazel Community Day in Munich, and BazelCon 2023 in Munich too. Oh, and because I was on the other side of the world, I also paid a visit to my family in Spain.
Attending these events has been incredibly useful and productive: I got exposure to many ideas and discussions that would just not happen online, I got to build connections with very interesting people and, of course, it has also been super fun too to reconnect with old coworkers and friends.
This article contains the summary of the things I learned and the things I want to follow up on. These are just a bunch of cleaned-up notes which I took and are in the context of my work with Bazel at Snowflake and my interests on build tools, so this is not endorsed by Snowflake.
"><meta property="twitter:description" content="I&amp;rsquo;m exhausted. I just came back to Seattle from a 10-day trip in which I attended three different Bazel events: the Build Meetup in Reykjavik, the Bazel Community Day in Munich, and BazelCon ‚Ä¶"><meta name=author content="Julio Merino"><meta property="twitter:creator" content="@jmmv"><meta name=generator content="Hugo 0.111.3"><meta property="og:url" content="https://jmmv.dev/2023/10/bazelcon-2023-et-al-trip-report.html"><meta property="og:type" content="blog"><meta property="twitter:card" content="summary"><link rel=canonical href=https://jmmv.dev/2023/10/bazelcon-2023-et-al-trip-report.html><link rel=alternate type=application/rss+xml title="Julio Merino (jmmv.dev)" href=/feed.xml><link rel=stylesheet href=/sass/main.min.cb91349cd93211a37e7d5dc131c35a170fc795721c03373cd05571327eea206b.css><link rel=stylesheet href=/css/chroma.css><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicons/favicon-96x96.png sizes=96x96><meta property="og:image" content="/images/2023-10-30-bazelcon.jpg"><meta property="twitter:image" content="https://jmmv.dev/images/2023-10-30-bazelcon.jpg"><script>const SITE_ID="e8da9f62-b7ac-4fe9-bf20-7c527199a376",BASE_URL="https://jmmv.dev/"</script></head><body><header class=site-header><nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary"><a class=navbar-brand href=/><img src=/images/favicons/favicon-30x30.png width=30 height=30 class="d-inline-block align-top" alt>
&nbsp;jmmv.dev</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/about.html>About</a></li><li class=nav-item><a class=nav-link href=/blog.html>Blog</a></li><li class=nav-item><a class=nav-link href=/resume.html>Resume</a></li><li class=nav-item><a class=nav-link href=/software.html>Software</a></li></ul><ul class="navbar-nav mr-4"><li class=nav-item><a class=nav-link href=/archive.html>Archive</a></li><li class=nav-item><a class=nav-link href=/series.html>Series</a></li><li class=nav-item><a class=nav-link href=/tags.html>Tags</a></li></ul><form class=form-inline method=get role=search action=https://www.google.com/search><div class=input-group><input type=search name=query class=form-control placeholder=Search aria-label=Search><div class=input-group-append><button type=submit value=Search class="btn btn-light">
<img src=/octicons/search.svg></button></div></div><input type=hidden name=sitesearch value=https://jmmv.dev/></form></div></nav></header><div class=page-header><div class=container><h1>BazelCon 2023 et al. trip report</h1><p>October 30, 2023 &#183;
About 15 minutes
&#183;
Tags:
<a href=/tags/bazel>bazel</a>, <a href=/tags/blogsystem5>blogsystem5</a>, <a href=/tags/snowflake>snowflake</a></p><p class=post-meta-p>This article was
<a href=https://blogsystem5.substack.com/p/bazelcon-2023-et-al-trip-report>originally published
on Substack</a>
in the <a href=https://blogsystem5.substack.com/>Blog System/5 newsletter</a>
and is replicated here for archival purposes.</p><figure class=cover-image><img src=/images/2023-10-30-bazelcon.jpg width=100%></figure></div></div><div class="container post-body"><div class=row><div class=col-md-9><div class=row><div class=col><article><p>I&rsquo;m exhausted. I just came back to Seattle from a 10-day trip in which I attended three different Bazel events: the Build Meetup in Reykjavik, the Bazel Community Day in Munich, and BazelCon 2023 in Munich too. Oh, and because I was on the other side of the world, I also paid a visit to my family in Spain.</p><p>Attending these events has been incredibly useful and productive: I got exposure to many ideas and discussions that would just not happen online, I got to build connections with very interesting people and, of course, it has also been super fun too to reconnect with old coworkers and friends.</p><p>This article contains the summary of the things I learned and the things I want to follow up on. These are just a bunch of cleaned-up notes which I took and are in the context of <em>my</em> work with <a href=https://bazel.build/>Bazel</a> at <a href=https://www.snowflake.com/>Snowflake</a> and <em>my</em> interests on build tools, so this is not endorsed by Snowflake.</p><h1 id=schedule>Schedule</h1><p>Here is the general timeline of the events:</p><ul><li><strong>2023-10-20 (Fri)</strong>: Build Meetup in Reykjavik hosted at the Reykjavik University and organized by Unnar from EngFlow.</li><li><strong>2023-10-21 (Sat)</strong>: A 1-day tour of the Reykjanes peninsula with the Build Meetup crew which, while not an official conference, also led to many interesting <del>hallway</del> lagoon conversations.</li><li><strong>2023-10-23 (Mon)</strong>: Bazel Community Day hosted by Salesforce in Munich, followed by an evening of food and drinks hosted by Gradle.</li><li><strong>2023-10-24 (Tue)</strong>: BazelCon 2023 day 1 hosted by Google Munich, which included an evening of drinks and games hosted by JetBrains.</li><li><strong>2023-10-25 (Wed)</strong>: BazelCon 2023 day 2 hosted by Google Munich, which included another by BuildBuddy that I could not attend because I departed early.</li></ul><h1 id=bazel-7>Bazel 7</h1><p>In our Bazel migration at Snowflake, we currently rely on the Bazel 6.x series&mdash;still the stable version at the time of this writing. <a href=https://bazel.build/about/roadmap#bazel_70_release>Bazel 7 is around the corner</a> and it brings many improvements that will, in theory, improve the developer experience significantly. Here are my highlights:</p><ul><li><p><strong>Build without the Bytes (BwtB):</strong> We tried using this feature before but it did not work well with dynamic execution, another feature that we must use for performance reasons. Bazel 7 should fix all issues we saw because BwtB is known to not carry bug fixes that are in Bazel 7 due to backporting difficulties. Google is confident that this feature works fine now because they are using it on their corp Mac laptops instead of FUSE, because the latter has become increasingly more cumbersome to use on Macs.</p></li><li><p><strong>Path mapping and cache key scrubbing:</strong> New features in Bazel 7 allow Bazel to reuse the cache between different configurations. For example, Java targets only need to be built once irrespective of the target platform (arm64/x86), and Bazel 7 makes this &ldquo;just one build&rdquo; possible. This helps increase shared cache hits, reduces CI costs, reduces Bazel configuration and Git branch switch costs, and reduces local disk usage space. These features need to be enabled via flags and rules have to opt into this behavior if it&rsquo;s useful for them (the Java rules do by default).</p></li><li><p><strong>Skymeld:</strong> <a href=https://github.com/bazelbuild/bazel/issues/14057>This feature</a> interleaves the analysis and execution phases during a build and should be functional in Bazel 7. Using this feature should reduce end-to-end (E2E) build and test times, particularly for builds where the analysis phase takes a long time.</p></li><li><p><strong>bzlmod:</strong> We <em>all</em> will be required to replace our intractable <code>WORKSPACE</code> files with bzlmod by Bazel 8, and bzlmod is already the default in Bazel 7. The benefits for the <em>users</em> of the build system are subtle, but they are palpable for anyone managing external dependencies or third-party package managers like pip or Maven. It&rsquo;s possible to migrate incrementally by moving individual rules into using modules. Difficulties often arise when there are repo aliases in place though.</p></li></ul><h1 id=ide-improvements>IDE improvements</h1><p>The two news that seemed exciting to me were:</p><ul><li><p><strong>IntelliJ BSP plugin:</strong> <a href=https://www.jetbrains.com/>JetBrains</a> has been working on a new <a href=https://build-server-protocol.github.io/>Build Server Protocol (BSP)</a> to fix the M:N problem for build tools and IDEs&mdash;just like <a href=https://microsoft.github.io/language-server-protocol/>Language Server Protocol (LSP)</a> did for language integrations. JetBrains has created a new version of the Bazel plugin that relies on a BSP server, and this new plugin better integrates with IntelliJ&rsquo;s internal project modeling and with Remote IntelliJ. The plugin launched in beta during BazelCon and does not yet work with CLion, but they are targeting Spring 2024 to get both out. It&rsquo;s still early to adopt this new plugin, but the future is bright: if VSCode adopts the BSP, we&rsquo;ll finally get Bazel support throughout developer tools. Microsoft, your move. (And Emacs pretty please?)</p></li><li><p><strong>IntellIj 2023.3.3:</strong> This new release of IntelliJ should make the Bazel plugin work well for remote development. Up until now, it was possible to <em>open</em> existing projects, but not <em>import</em> them using the Remote IntelliJ interface, which was suboptimal for desktop-less remote VMs.</p></li></ul><h1 id=remote-build>Remote build</h1><p>Many presenters and attendees report that their companies use remote builds&mdash;unsurprisingly, because that&rsquo;s the primary promise of using Bazel&mdash;and it turns out there are more companies than I thought supplying remote build and telemetry visualization services. Here are some of the interesting details I gathered:</p><ul><li><p><strong>Regional clusters:</strong> The remote build protocol is sensitive to latency, particularly for builds with low parallelism. In talking to <a href=https://www.engflow.com/>EngFlow</a>, they&rsquo;ve measured a 10-20% build performance improvement by deploying separate clusters in different regions for a single customer. Multiple clusters are harder to operate than just one cluster&mldr; but if you accept that you need N+1 deployments <em>anyway</em> for reliability, you might as well colocate them with your primary offices.</p></li><li><p><strong>Build Barn customizations:</strong> This open source remote build implementation supports having a bidirectional replicated cache (ideal for the regional clusters mentioned above), and even having small worker pools close to the users while sharing the same central cache. <a href=https://meroton.com/>Meroton</a>, who does Build Barn consulting, have set up small caches/worker pools in-office for customers, while maintaining a larger &ldquo;central cache&rdquo;, and gotten good results.</p></li><li><p><strong>Build viewers:</strong> There are many different implementations of tools to visualize builds via the <a href=https://bazel.build/remote/bep>Build Event Protocol (BEP)</a>. EngFlow, <a href=https://www.buildbuddy.io/>BuildBuddy</a>, <del>Gradle Enterprise</del> <a href=https://gradle.com/>Develocity</a>&mldr; all were there. As an interesting data point: Develocity can ingest data from various build systems, not just BEP, and allows computing metrics from them all in aggregate. This is not be desirable in the &ldquo;end state&rdquo; of a build system migration, but it&rsquo;s an attractive proposition while the migration is ongoing.</p></li><li><p><strong>RE v3:</strong> There are ongoing discussions about whether <a href=https://docs.google.com/document/d/1FxpdOzOhzOCTjjn2loppMlBzjqjU9WpYF4E1K6opxVI/edit>a new version of the protocol</a> should be designed or not. There is the thought that some features cannot be retrofitted into the previous protocol, but that&rsquo;s not completely clear. Ed Schouten is requesting feedback in the document that he put together.</p></li><li><p><strong>In-transit compression:</strong> gRPC has support for <a href=https://grpc.io/docs/guides/compression/>transparent in-transit compression</a> (not at rest). We have thought of hacking it into Build Barn because we think this would improve E2E build times for users with less-than-optimal Internet pipes, but both EngFlow (Java) and Bloomberg (Python) report that they saw worse behavior with compression enabled. They suspect gRPC may be serializing compression operations or doing something similarly-unscalable at very low levels of the stack. Build Barn is written in Go though, so the outcome of this experiment might be different. Worth a try.</p></li><li><p><strong>Jobs configuration:</strong> The RE protocol is latency sensitive. Ulf Adams from EngFlow recommended limiting the number of jobs per user on the server side and then configuring the local jobs number to a higher level to minimize the delays that Bazel itself imposes. George Gensure also brought up that there seems to be an unnecessary semaphore in the code that computes Merkle trees, which limits throughput, and that it should be removed from Bazel.</p></li><li><p><strong>Dynamic scheduling tweaks:</strong> <a href=https://buck2.build/>Buck2</a>&rsquo;s <a href=https://bazel.build/remote/dynamic>&ldquo;dynamic scheduler&rdquo;</a> seems smarter than Bazel&rsquo;s because it avoids running anything locally when the parallelism of the build graph is wide. Then, it enables parallel local execution (which they call hybrid execution) when the parallelism is narrow, as this is the common case towards the end of builds and in most incremental builds. It might be nice to try this in Bazel too because it would help reduce unnecessary network bandwidth (and also help remove the <code>--dynamic_local_execution_delay</code> hack), but it may increase E2E build time for clean builds if the network is slow&mldr; unless BwtB is at play, in which case this might be a win-win.</p></li></ul><h1 id=things-to-try-out>Things to try out</h1><p>My TODO list after speaking to people is&mldr; long. Here are a bunch of things I want to try:</p><ul><li><p><strong>Visualize the build graph of our product:</strong> Bazel has flags to dump the in-memory build graph as a <a href=https://graphviz.org/>Graphviz</a> file, and <a href=https://github.com/tweag/skyscope/>SkyScope</a> by <a href=https://www.tweag.io/>Tweag</a> allows interactively inspecting large graphs. It&rsquo;d be nice to try this out and see what happens, because <a href=https://medium.com/snowflake/build-farm-visualizations-5a079477502d>visualizations often help uncover issues</a> that are hard to imagine otherwise.</p></li><li><p><strong>Buck2&rsquo;s LSP for Starlark:</strong> Meta has done a lot of work in Buck2 to make Starlark easy to write. They have things like an LSP server for Starlark, static typing, static analysis, a profiler, a debugger&mldr; While we cannot use features like static typing because Bazel doesn&rsquo;t support them (yet?), it should be possible to leverage the LSP server for use with VSCode. It apparently has a Bazel mode.</p></li><li><p><strong>Expendable CI jobs:</strong> Some CI jobs are not critical: for example, consider a job that exists purely to keep the Bazel remote cache warm for IntelliJ project syncs. Someone brought up the interesting idea of making these jobs monitor the build farm load and skip their execution if the farm is above a certain threshold (to preserve resources and minimize the chances of exhausting them).</p></li><li><p><strong>Analyze breakdown of rules by type:</strong> Google reports that 30% of their rules are of the <a href=https://bazel.build/reference/be/general><code>genrule</code></a> kind, which prevents certain kinds of optimizations&mdash;e.g. they are very expensive memory-wise because they do not benefit from Bazel&rsquo;s depset internal representation. It&rsquo;d be nice to see what our breakdown looks like in case we have to plan some refactoring.</p></li><li><p><strong>Jenkins persistent runners:</strong> We currently tear down Jenkins runners quickly, but this discards all Git and Bazel state. For Bazel-only jobs, using persistent runners could help reduce E2E run times. <a href=https://www.thoughtspot.com/>ThoughtSpot</a> reports a 40% reduction in average build/test time. <a href=https://www.aspect.dev/>Aspect</a> also claims that this is an anti-pattern. BuildBuddy has done work to clone runners with hot Bazel in-memory state and claims an 8x improvement in build times.</p></li><li><p><strong>Using actions for downloads:</strong> Even if this is unorthodox, several people use <em>actions</em> to download toolchains and the like to minimize the cost of downloads during pre-analysis, to keep those downloads in the remote build farm when the client doesn&rsquo;t need them at all, and to minimize local disk space. I had thought about doing this too, but I was hesitant because it feels &ldquo;ugly&rdquo;. It&rsquo;s good to hear others have thought and tested the same idea too. Note that doing this results in <a href=https://reproducible-builds.org/>reproducible builds</a> only if downloads are subject to checksum verification.</p></li><li><p><strong>Validation actions:</strong> There are new features in Bazel to define &ldquo;validation actions&rdquo; to run things like linters in parallel with the build (without dependency hacks as were used before). Google is using this to run Android Lint internally, which sounds similar to other tools like the popular <a href=https://spotbugs.github.io/>SpotBugs</a>. These actions can also produce diffs to apply to the source tree to fix the issues they identify.</p></li></ul><h1 id=upstream-contributions>Upstream contributions</h1><p>These are some long-running changes I&rsquo;d like to get into upstream Bazel and that need follow up:</p><ul><li><p><strong>C++ linker memory model:</strong> The C++ linker memory estimation in Bazel is <a href=https://github.com/bazelbuild/bazel/issues/17368>way off reality</a>, and I previously upstreamed the foundations to fix the issue by exposing input sizes to the estimation logic. We still have to carry a local patch to tune the model based on our observations, but the patch is really small now. But given the diversity in the C++ ecosystem, it&rsquo;d be awesome if we could parameterize the memory computation in the C++ toolchain definition somehow and avoid a local patch: imagine having a lambda that returns a CPU/RAM resource set based on the number of inputs, their size, and the compilation model. I need to engage in GitHub Discussions.</p></li><li><p><strong>BEP sanitization changes:</strong> I brought up that the BEP is incredibly prone to leaking secrets stored in the environment and while folks knew this happens&mdash;after all, tools like BuildBuddy and EngFlow have logic to scrub secrets&mdash;they were not really aware of the extent of the problem. I have a prototype patch to scrub all environment variables from the BEP (except for a limited allowed list useful for debugging) and I think we agreed that this feature would be good to upstream. So now I need to write a proper bug report and share my audits of the protocol and the proposal for a fix. Stay tuned.</p></li><li><p><strong>bb-clientd patch:</strong> The current implementation of <a href=https://github.com/bazelbuild/bazel/pull/12823>the patch to support a FUSE-based output tree</a> is going nowhere because of the upcoming Remote Output Service formalization of this same idea. Until that&rsquo;s available, I don&rsquo;t think it&rsquo;s worth trying to maintain this on top of Bazel 6 any longer, particularly due to the BwtB improvements that are coming in Bazel 7. It seems wiser to just wait.</p></li></ul><h1 id=other-thoughts>Other thoughts</h1><p>And to conclude, a bunch of disconnected notes about things that were interesting to me:</p><ul><li><p><strong>Buck2:</strong> This new build system from Meta looks really cool to me. On the plus side, it fixes some long-standing issues in Bazel, like having a truly language-agnostic core, being built from the ground up with BwtB and FUSE in mind, and super-quick startup time because it&rsquo;s not Java; hindsight is 20/20 after all. But it also has its drawbacks, like no support for external dependencies yet or no local sandboxing (both of which are fixable). They also have nice features like limited dynamic dependency discovery, which makes tools like Gazelle less necessary. And&mldr; they are considering writing a shim to support Bazel rules in Buck2, which would make experimentation on existing projects super-exciting.</p></li><li><p><strong>Bazel jobs scalability:</strong> There are two problems with making Bazel scale to thousands of concurrent jobs: the &ldquo;1 job = 1 thread&rdquo; execution model, and memory usage due to Merkle tree computation. Ulf Adams reports that he could run Bazel with hundreds of thousands of jobs back at Google when he implemented async execution by hand&mdash;the Google-internal RE protocol doesn&rsquo;t use Merkle trees, so memory pressure was not an issue&mdash;but unfortunately the changes were never productionized and have been backed out of Bazel due to their complexity. Java 21 brings <a href=https://docs.oracle.com/en/java/javase/20/core/virtual-threads.html>virtual threads</a> and paves the way to fix this in a nicer, non-hacky way.</p></li><li><p><strong>bb-clientd improvements:</strong> Meroton has significant experience with deploying bb-clientd for customers and are interested in the issues we face because they are the main pushers for the Remote Output Service feature. In particular, dynamic execution doesn&rsquo;t play well with bb-clientd because it causes bb-clientd to backlog downloads when local actions are frequently cancelled. It should be possible to tell bb-clientd to stop downloads and resolve these issues because the FUSE protocol supports it, but it&rsquo;s not plumbed through. Also, implementing chunked downloads to support debugging of large binaries with minimal network latency sounds awesome, but we&rsquo;d need to quantify the benefit first: I suspect you need just a tiny portion of multi-GB C++ debug binary to produce a stacktrace.</p></li><li><p><strong>Virtual file systems on macOS:</strong> Both Ed Schouten from Build Barn and Neil Mitchell from Buck2 report that NFSv4 has been pretty decent on macOS when compared to FUSE to implement virtual file systems, and that it should be the primary mechanism for writing virtual file systems on macOS now. FUSE is unfortunately doomed due to Apple&rsquo;s desire to kill kernel extensions, which makes it really hard to install FUSE.</p></li><li><p><strong>Avoiding BUILD files:</strong> <a href=https://www.salesforce.com/>Salesforce</a> has undergone a Bazel migration with 4000 engineers and claims that 70% have trouble writing BUILD files. Anything that can be done to hide them / automate edits is worthwhile. <a href=https://investors.luminartech.com/>Luminar</a> has developed a C++ plugin for <a href=https://github.com/bazelbuild/bazel-gazelle>Gazelle</a> and they use <a href=https://github.com/NixOS/nixpkgs>Nix packages</a> to pull in third-party dependencies.</p></li><li><p><strong>Coverage-guided test selection:</strong> It&rsquo;s a common problem to have integration tests that depend on pretty much all of the codebase, which in turn causes test runs to take too long and nullifies Bazel&rsquo;s test caching features. Coverage metrics can be useful in implementing a heuristic to identify which subset of the integration tests to run on a given change at the expense of occasional false negatives.</p></li><li><p><strong>Classes in Starlark:</strong> Aspect has come up with an idiom to represent classes in Starlark, and they claim it has simplified maintenance of their JavaScript rules significantly. Worth a look.</p></li><li><p><strong>Monorepos and Git:</strong> VMware claims that Perforce is much faster than Git at syncing GBs of source code (1min vs. 12min). Meroton has developed a &ldquo;monorepo emulation&rdquo; mode on top of many small Git repos leveraging Gerrit&rsquo;s cross-repo atomic commits. AOSP (Android) has done something similar.</p></li><li><p><strong>Abusing &ldquo;exec requirements&rdquo; to tune remote workers:</strong> <a href=https://stripe.com/>Stripe</a> has implemented lots of custom features to tune the behavior of remote workers via &ldquo;exec requirement&rdquo; tags at the action/target level. They can do things like mock time on the remote containers to exercise timing conditions (e.g. leap year switches) or to request access to certain internal-only network endpoints. They can also emit trace data from actions (by configuring a &ldquo;listener&rdquo; that propagates those details) and then merge such traces into the Bazel <a href=https://bazel.build/advanced/performance/json-trace-profile>JSON trace profile</a> to show what exactly the long-running actions are doing. Think visualizing what a nested <code>make -j8</code> is doing.</p></li><li><p><strong>Building without the Internet:</strong> Salesforce mirrors all external dependencies internally and denies all downloads by default from untrusted sources. They do allow the build farm to talk to internal sources to fetch artifacts though, because their tests need to do that. The &ldquo;resolved file&rdquo; feature in Bazel can help create a catalog of dependencies, and the &ldquo;download config&rdquo; to deny external access.</p></li><li><p><strong>RE for arbitrary builds:</strong> EngFlow is doing a lot of work to support arbitrary builds using remote execution, not just Bazel builds. They have &ldquo;revived&rdquo; <a href=https://github.com/bazelbuild/reclient>Google&rsquo;s reclient</a>&mdash;a compiler wrapper that uses RE&mdash;and offer support for CMake. The idea in CMake is to use reclient where possible (compiling and linking) and to run CMake itself on a remote worker to paper over the limitations of actions not supported by reclient.</p></li><li><p><strong>Memory consumption is a widespread problem:</strong> Everybody dislikes how Bazel consumes memory. Google is doing work on this and we should continue to see improvements. One that sounded promising is the addition of support to discard partial parts of the build graph (e.g. for things not in the critical path).</p></li><li><p><strong>Blogging is cool:</strong> Many people opened with &ldquo;I read your blog!&rdquo; upon meeting them which was&mldr; flattering, I must confess. I need to write more. Subscribe to this blog if you haven&rsquo;t yet!</p></li></ul><h1 id=reference-material>Reference material</h1><p>A bunch of papers mentioned during the many discussions that happened:</p><ul><li><a href=https://www.inf.u-szeged.hu/~gertom/Kutatas/BGS12.pdf>Code Coverage-Based Regression Test Selection and Prioritization in WebKit</a></li><li><a href=https://research.google/pubs/pub48413/>Code Coverage at Google</a></li><li><a href=https://github.com/facebook/sapling>Sapling from Facebook (git-compatible highly-scalable SCM)</a></li><li><a href=https://www.microsoft.com/en-us/research/uploads/prod/2018/03/build-systems.pdf>Build systems √† la carte</a></li><li><a href=https://github.com/microsoft/scalar>Scalar (Microsoft extensions for very large git repos)</a></li></ul></article></div></div><div class="container post-links"><div class=row><div class="col mr-auto text-left"><span><a href=https://jmmv.dev/2023/10/hello-blog-system5.html>&#171; Previous</a></span></div><div class="col text-center"><span><a href=/archive.html>All posts</a></span></div><div class="col ml-auto text-right"><span></span></div></div></div><div class="container post-votes"><div class=row><div class="col-lg-4 my-2"><div class=row><div class=col><a onclick=voteThumbsUp() class="btn btn-block btn-outline-success" id=thumbs-up-btn>üëç
(<span id=thumbs-up-count>0</span>)</a></div><div class=col><a onclick=voteThumbsDown() class="btn btn-block btn-outline-danger" id=thumbs-down-btn>üëé
(<span id=thumbs-down-count>0</span>)</a></div></div></div><div class="col-lg-8 my-2 d-none d-sm-block"><div class=row><div class="col-md-4 text-center"><a href="https://www.reddit.com/submit?title=BazelCon+2023+et+al.+trip+report&amp;url=https%3A%2F%2Fjmmv.dev%2F2023%2F10%2Fbazelcon-2023-et-al-trip-report.html" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/reddit.png alt=Reddit width=24 height=24></a></div><div class="col-md-4 text-center"><a href="https://news.ycombinator.com/submitlink?t=BazelCon+2023+et+al.+trip+report&amp;u=https%3A%2F%2Fjmmv.dev%2F2023%2F10%2Fbazelcon-2023-et-al-trip-report.html" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/ycombinator.png alt="Hacker News" width=24 height=24></a></div><div class="col-md-4 text-center"><a href="https://twitter.com/intent/tweet?status=BazelCon+2023+et+al.+trip+report+%E2%80%94+https%3A%2F%2Fjmmv.dev%2F2023%2F10%2Fbazelcon-2023-et-al-trip-report.html+%E2%80%94+cc+%40jmmv" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/Twitter_Social_Icon_Circle_Color.png alt=Twitter width=24 height=24></a></div></div></div></div><div class="row my-4" id=postCommentRow><div class=col><div class=media><img class=mr-3 src=/octicons/pencil.svg width=32px height=32px><div class="media-body container"><form method=post id=newPost><div class=row><div class="col my-1"><textarea class=form-control rows=1 id=postCommentContent onclick=showPostComment() placeholder="Leave a comment"></textarea></div></div><div class="row newPostControls" style=display:none><div class="col my-1 form-group"><label for=postCommentAuthor>Your name (optional):</label>
<input type=text class=form-control id=postCommentAuthor></div></div><div class="row newPostControls" style=display:none><div class="col my-1 form-group"><label for=postCommentEmail>Your email (optional):</label>
<input type=text class=form-control type=email id=postCommentEmail>
<small class="form-text text-muted">Invisible to all readers; if provided, you will receive notifications when replied to (not implemented yet)</small></div></div><div class=row id=postCommentError style=display:none><div class="col mt-1 alert-danger"><p></p></div></div><div class="row newPostControls" style=display:none><button class="col-md-3 my-1 btn btn-primary" type=submit id=submitCommentButton>Post</button>
<small class="col-md-9 my-1 text-muted">Comments are subject to moderation. This feature is experimental and is powered by <a href=/software/endtracker.html>EndTRACKER</a>. If you experience any issues, please <a href=/about.html#contact>contact me off-band</a>.</small></div></form></div></div></div></div><script>function hidePostComment(){var t,e=document.getElementById("postCommentContent");e.rows=1,e.value="",t=document.getElementsByClassName("newPostControls"),Array.prototype.forEach.call(t,function(e){e.style.display="none"})}function showPostComment(){var e,t=document.getElementById("postCommentContent");t.rows=5,e=document.getElementsByClassName("newPostControls"),Array.prototype.forEach.call(e,function(e){e.style.display=""})}const form=document.querySelector("#newPost");form.onsubmit=function(e){e.preventDefault();let t=document.getElementById("postCommentAuthor").value,n=document.getElementById("postCommentEmail").value,s=document.getElementById("postCommentContent").value;postComment(t,n,s,hidePostComment)}</script></div></div><div class="col-md-3 sidebar d-none d-md-block"><div class=row><div class="col text-center p-2"><p><a href=/about.html class=clear-link><img src=/images/avatars/20181124-snow.jpg class="rounded-circle shadow my-2" style=width:100px><br><b>Julio Merino</b><br>A blog on operating systems, programming languages, testing, build systems, my own software
projects and even personal productivity. Specifics include FreeBSD, Linux, Rust, Bazel and
EndBASIC.</a></p><div class=row><div class=col><div class=form-group><form action=https://endtracker.azurewebsites.net/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/subscribers/add method=post><input type=text name=email placeholder="Enter your email" class="form-control input-sm text-center my-1">
<button type=submit class="btn btn-primary btn-block my-1">Subscribe</button></form></div></div></div><div class="row px-2"><div class="col-sm-5 text-left"><small><span class=subscriber-count>0</span> subscribers</small></div><div class="col-sm-7 text-right"><p><a rel=me href=https://mastodon.online/@jmmv><img src=/images/badges/mastodon-logo.svg width=32px height=32px alt="Follow @jmmv on Mastodon"></a>
<a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&amp;screen_name=jmmv"><img src=/images/badges/Twitter_logo_blue.svg width=32px height=32px alt="Follow @jmmv on Twitter"></a>
<a href=/feed.xml><img src=/images/badges/feed-icon-28x28.png alt="RSS feed"></a></p></div></div></div></div><div class=row><div class=col><h2>Featured software</h2><ul><li class=overflow-ellipsis><a href=https://www.endbasic.dev/ target=_blank>EndBASIC: Online BASIC+DOS env</a></li><li class=overflow-ellipsis><a href=https://endtracker.azurewebsites.net/ target=_blank>EndTRACKER: Services for static sites</a></li></ul></div></div><div class=row><div class=col><h2>Featured posts</h2><ul><li class=overflow-ellipsis><a href=/2023/06/fast-machines-slow-machines.html>Fast machines, slow machines</a></li><li class=overflow-ellipsis><a href=/2022/12/endbasic-0.10.html>EndBASIC 0.10: Core language, evolved</a></li><li class=overflow-ellipsis><a href=/2022/10/bye-microsoft-hi-snowflake.html>Farewell, Microsoft; hello, Snowflake!</a></li><li class=overflow-ellipsis><a href=/2022/05/rust-is-hard-but-does-it-matter.html>Rust is hard, yes, but does it matter?</a></li><li class=overflow-ellipsis><a href=/2022/04/rust-traits-and-dependency-injection.html>Rust traits and dependency injection</a></li><li class=overflow-ellipsis><a href=/2022/03/a-year-on-windows-intro.html>A year on Windows: Introduction</a></li><li class=overflow-ellipsis><a href=/2021/04/always-be-quitting.html>Always be quitting</a></li><li class=overflow-ellipsis><a href=/2021/02/google-monorepos-and-caching.html>How does Google keep build times low?</a></li><li class=overflow-ellipsis><a href=/2020/12/google-no-clean-builds.html>How does Google avoid clean builds?</a></li><li class=overflow-ellipsis><a href=/2020/12/unit-testing-a-console-app.html>Unit-testing a console app (a text editor)</a></li><li class=overflow-ellipsis><a href=/essays.html#featured>More...</a></li></ul></div></div></div></div></div><footer class=container-fluid><div class=row><div class="col-4 order-2 text-right"><p class=float-right><a href=#>Back to top</a></p></div><div class="col-8 order-1 mr-auto"><p>Copyright 2004&ndash;2023 Julio Merino</p></div></div></footer><script type=module>
  import { addAnchorsToHeaders, addElementClasses, BatchClient } from "\/js\/main.d30f168b11d80082408f4a983af9a626c6e57d58f7846b2174bac40d43be33e3.js";

  var batchClient = new BatchClient(SITE_ID);
  batchClient.doAll({
    put_request: true, get_comments: true, get_subscriber_count: true, get_votes: true });

  window.voteThumbsUp = function() { batchClient.voteThumbsUp(); }
  window.voteThumbsDown = function() { batchClient.voteThumbsDown(); }

  window.postComment = function(...args) {
    batchClient.postComment(...args);
  };

  addAnchorsToHeaders();
  addElementClasses();
</script><noscript><img src="https://hugo-dynamic.jmmv.dev/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/pages/aHR0cHM6Ly9qbW12LmRldi8yMDIzLzEwL2JhemVsY29uLTIwMjMtZXQtYWwtdHJpcC1yZXBvcnQuaHRtbA==/stamp.gif" style=display:none></noscript></body></html>