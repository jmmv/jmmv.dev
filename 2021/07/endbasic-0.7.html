<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml xmlns:fb=http://ogp.me/ns/fb#><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta property="og:site_name" content="Julio Merino (jmmv.dev)"><meta property="twitter:site" content="@jmmv"><title>EndBASIC 0.7: Hello, cloud! - Julio Merino (jmmv.dev)</title>
<meta property="og:title" content="EndBASIC 0.7: Hello, cloud! - Julio Merino (jmmv.dev)"><meta property="twitter:title" content="EndBASIC 0.7: Hello, cloud! - Julio Merino (jmmv.dev)"><meta name=description content="Several months have passed since the last EndBASIC release and, since then, you might have seen me talk nonstop about an &ldquo;EndBASIC service&rdquo; in social media&mldr; which has sounded like vaporware. That changes today.
After about four months of work, I am ecstatic to announce that EndBASIC 0.7 is here. And these haven&rsquo;t been four months of idle time. No, no, no. It has taken four months of my scarce free time to deliver this because 0.7 is a humongous release on various fronts.
"><meta property="og:description" content="Several months have passed since the last EndBASIC release and, since then, you might have seen me talk nonstop about an &ldquo;EndBASIC service&rdquo; in social media&mldr; which has sounded like vaporware. That changes today.
After about four months of work, I am ecstatic to announce that EndBASIC 0.7 is here. And these haven&rsquo;t been four months of idle time. No, no, no. It has taken four months of my scarce free time to deliver this because 0.7 is a humongous release on various fronts.
"><meta property="twitter:description" content="Several months have passed since the last EndBASIC release and, since then, you might have seen me talk nonstop about an &ldquo;EndBASIC service&rdquo; in social media&mldr; which has sounded like ‚Ä¶"><meta name=author content="Julio Merino"><meta property="twitter:creator" content="@jmmv"><meta name=generator content="Hugo 0.136.5"><meta property="og:url" content="https://jmmv.dev/2021/07/endbasic-0.7.html"><meta property="og:type" content="blog"><meta property="twitter:card" content="summary"><link rel=canonical href=https://jmmv.dev/2021/07/endbasic-0.7.html><link rel=alternate type=application/rss+xml title="Julio Merino (jmmv.dev)" href=/feed.xml><link rel=stylesheet href=/sass/main.min.cb91349cd93211a37e7d5dc131c35a170fc795721c03373cd05571327eea206b.css><link rel=stylesheet href=/css/chroma.css><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicons/favicon-96x96.png sizes=96x96><meta property="og:image" content="/images/favicons/favicon-1200x1200.png"><meta property="twitter:image" content="https://jmmv.dev/images/favicons/favicon-1200x1200.png"><script>const SITE_ID="e8da9f62-b7ac-4fe9-bf20-7c527199a376",BASE_URL="https://jmmv.dev/"</script></head><body><header class=site-header><nav class="navbar navbar-expand-md fixed-top navbar-dark bg-primary"><a class=navbar-brand href=/><img src=/images/favicons/favicon-30x30.png width=30 height=30 class="d-inline-block align-top" alt>
&nbsp;jmmv.dev
</a><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/about.html>About</a></li><li class=nav-item><a class=nav-link href=/blog.html>Blog</a></li><li class=nav-item><a class=nav-link href=/resume.html>Resume</a></li><li class=nav-item><a class=nav-link href=/software.html>Software</a></li></ul><ul class="navbar-nav mr-4"><li class=nav-item><a class=nav-link href=/archive.html>Archive</a></li><li class=nav-item><a class=nav-link href=/series.html>Series</a></li><li class=nav-item><a class=nav-link href=/tags.html>Tags</a></li></ul><form class=form-inline method=get role=search action=https://www.google.com/search><div class=input-group><input type=search name=query class=form-control placeholder=Search aria-label=Search><div class=input-group-append><button type=submit value=Search class="btn btn-light">
<img src=/octicons/search.svg></button></div></div><input type=hidden name=sitesearch value=https://jmmv.dev/></form></div></nav></header><div class=page-header><div class=container><h1>EndBASIC 0.7: Hello, cloud!</h1><p>July 3, 2021 &#183;
About 9 minutes
&#183;
Tags:
<a href=/tags/endbasic>endbasic</a></p></div></div><div class="container post-body"><div class=row><div class=col-md-9><div class=row><div class=col><article><p>Several months have passed since the last EndBASIC release and, since then, you might have seen me talk nonstop about an &ldquo;EndBASIC service&rdquo; in social media&mldr; which has sounded like vaporware. That changes today.</p><p>After about four months of work, I am ecstatic to announce that EndBASIC 0.7 is here. And these haven&rsquo;t been four months of idle time. No, no, no. It has taken four months of my scarce free time to deliver this because 0.7 is a humongous release on various fronts.</p><p>Here are the highlights:</p><ul><li><p>üìÄ <strong>Hello, drives.</strong> The file system exposed by EndBASIC now supports drives. This feature has an MS-DOS feeling to it, which is intentional in keeping with the retro looks. And the reason I built support for drives is because of&mldr;</p></li><li><p>‚õÖÔ∏è <strong>Hello, cloud.</strong> The largest chunk of work in this release has gone into the making of a cloud service to support file sharing. From within EndBASIC, you can now type <code>LOGIN</code> to log into your account and access your own <code>CLOUD:/</code> drive. From there you can <code>SHARE</code> your own files or access files shared by other people with commands like <code>MOUNT "X", "cloud://cool-user"</code>.</p></li><li><p>üï∏ <strong>Hello, website.</strong> Every time I&rsquo;ve had to quote EndBASIC in random conversations, I&rsquo;ve missed having a good landing page. The <code>README.md</code> on GitHub has more-or-less done the trick until now, but it has become insufficient. So with this release, I&rsquo;ve built a website. The website is an important piece of the cloud puzzle to guide you through the features and the account creation process.</p></li></ul><p>Keep reading if you want the insider view of this release. Otherwise, if you just want to play with it, head to the new shiny landing page and enjoy as much as I have building this:</p><blockquote><p><a href=https://www.endbasic.dev/>https://www.endbasic.dev/</a></p></blockquote><p><strong>WARNING:</strong> Expect bugs though, both in the client and in the service. This is the first cloud service I ship built on Azure so there are known and unknown rough edges. Do not hesitate to file bugs, and please contact me with any feedback!</p><hr><p><strong>Now, the insiders story.</strong></p><h1 id=why-the-cloud>Why &ldquo;the cloud&rdquo;?</h1><p>The idea behind the EndBASIC cloud service started boiling after someone posted an innocent reply to one of my previous announcements asking &ldquo;how can we share our creations with others?&rdquo; Being EndBASIC an app that runs on the web, my instant thought was &ldquo;well, those files should <em>just</em> be shareable from there instead of being stuck on your browser&rsquo;s local storage, shouldn&rsquo;t they?&rdquo;</p><p>I procrastinated on that thought because it seemed hard. The funny this is that, even though I work for a cloud provider now and have worked for another one in the past, I had never written a cloud-based app myself. With a lot of unknowns, I was quite hesitant to embark on this quest. This was, however, the perfect opportunity to fight those demons and, as you may recall from the <a href=/2021/01/why-endbasic.html>Why am I building EndBASIC?</a> post, a personal goal behind this project is to learn new stuff. So here we are.</p><p>That said, I have to confess that building the service has been exciting but also a lengthy and frustrating process. Figuring out OAuth and how to leverage Azure Active Directory for my needs took a couple of weekends of dedicated time. After that, I had a prototype of the service running in just a few hours. But turning that prototype into a piece of code I was proud enough to ship has taken&mldr; all those months.</p><h1 id=service-design>Service design</h1><p>My goals behind the design of the cloud service were simple:</p><ul><li><p><strong>Azure.</strong> I <a href=/2020/10/bye-google-hi-microsoft.html>work for Azure</a> so I wanted to learn about our product from the client side. Working on this project has taught me a few things that have already helped at work.</p></li><li><p><strong>Rust only.</strong> EndBASIC is written in Rust and I wanted to do the same for the cloud service. From past experience writing <a href=/2019/09/rest-api-rust-go.html>a trivial REST server</a>, it seemed like a good fit&mdash;and I really wanted to play with a real service written in Rust. Of course, this made things more complicated than they could have been because Azure does not have a first-party Rust SDK and the unofficial one is still very rudimentary.</p></li><li><p><strong>Minimal cost.</strong> This is a personal project and I want to keep my costs as close to zero as possible because I do not want to have the looming thought of &ldquo;this isn&rsquo;t working; I have to turn it down to not waste money&rdquo;.</p></li><li><p><strong>Minimal lock-in.</strong> The cloud offers tons of features, and while I wanted to leverage some (such as Azure Functions to not deal with provisioning servers manually), I did not want to have hard dependencies on the cloud. I want the ability to move out.</p></li></ul><h1 id=database-difficulties>Database difficulties</h1><p>A huge time sink in the building of the cloud service went into interacting with the backing database.</p><p>You see, when I started looking at hosted database options in Azure, my first thought was to go with PostgreSQL. But the provisioning tool claimed that I&rsquo;d be spending over $200 a month for the service&mdash;which is just insane for my rudimentary needs. I knew there was a serverless option that only charged for usage but that option is only available for Microsoft SQL Server (MSSQL) as far as I can tell.</p><p>&ldquo;OK, fine, a database is a database, and I need no fancy features from them, so MSSQL can work as well as PostgreSQL.&rdquo; I thought. Well, yes, except for client-side issues. For my server, I chose to use the sqlx crate as it had good reviews and an MSSQL connector. But, at first, I couldn&rsquo;t even get a trivial connection to work. Soon enough, I found out that the MSSQL serverless option requires TLS and that sqlx did not implement TLS for MSSQL.</p><p>Bummer. But how hard could it be to fix this? The sqlx code to handle TLS in the PostgreSQL and MySQL connectors looked very simple, so replicating it for MSSQL seemed easy too. Ha, ha, ha. It was indeed much harder to build and explains why it hadn&rsquo;t been done yet. I wasted a couple of weeks reading TDS and TLS protocol documentation, fighting with Wireguard, and doing tons of tests for this patch to sqlx to work&mdash;until the stars aligned and I got a successful connection with <a href=https://github.com/launchbadge/sqlx/pull/1200>PR 1200</a> and <a href=https://github.com/launchbadge/sqlx/pull/1203>PR 1203</a>. I think I need to come back to this in a separate post&mldr;</p><p>Anyhow, all good, right? Well&mldr; not so fast. The more I kept building my service, the more deficiencies I kept encountering in the sqlx MSSQL client. Missing data types and incorrect handling of large query payloads turned out to be very crippling, and the last straw was finding out that I had to limit EndBASIC file sizes to less than 1KB for the sqlx connection to remain stable. Unacceptable, so I had to abandon this connector. (By the way: this connector is also going proprietary in the next sqlx release. I suspect that the proprietary version will be much better, but that was one more reason to avoid it.)</p><p>This made me go back to the database creation tool in Azure and look at PostgreSQL again. And by massively reducing the hardware requirements of the server (an option that was hidden and somehow discouraged), I could bring down the monthly costs to $15-20. Much more reasonable. After all, this basic server <em>still</em> has 2 CPUs and loads of RAM, and those hardware requirements can go a long way. Which makes me wonder: how much money are people paying by choosing the defaults and ending up with overprovisioned servers they may never benefit from? We used to build highly performing services with machines as powerful as this in the past!</p><p>With that cleared, I moved to PostgreSQL, a choice that better aligns with the &ldquo;minimal lock-in&rdquo; principle. Luckily, I had already built a database abstraction in my code so that I could run all tests against SQLite instead of MSSQL, so rewriting the production variant to talk to PostgreSQL instead of MSSQL was trivial.</p><h1 id=security-and-privacy-difficulties>Security and privacy difficulties</h1><p>Security is hard. You would hope that using cloud solutions would make dealing with security simple and safe. And that&rsquo;s partially true: if you follow the tutorials to the letter, you&rsquo;ll probably get authentication working correctly and safely. But there are lots of knobs and little details in the process that, if implemented incorrectly, could lead to security problems. Furthermore, and because there is no good SDK for Azure for Rust yet, I ended up having to deal with hand-crafted API calls&mldr; so that&rsquo;s one more place where things can go wrong.</p><p>What about authorization, though? The EndBASIC cloud service is all about file sharing, so the authorization checks belong in my service&rsquo;s logic. That&rsquo;s another fragile part where subtle bugs can result in disasters. Hopefully the service is pretty simple, but still, it&rsquo;s an area that&rsquo;s uncomfortable to deal with.</p><p>And what about unintentional information disclosure? This is where things get very subtle. For example, people shouldn&rsquo;t be allowed to discover whether someone has an account by looking at different error messages in API calls. But it&rsquo;s very easy to leak these details if you haven&rsquo;t thought about them. Many of these scenarios crossed my mind, and I think I have done a reasonable job in these areas, but again, these are subtle issues and I&rsquo;m quite positive I&rsquo;ve missed some.</p><p>And, lastly, abuse. What could possibly go wrong with offering a free storage cloud service? Uh&mldr; a lot, and remember that I want to keep costs minimal. Thankfully, the files you might create from EndBASIC are going to be very small, so I ended up building per-user disk quotas and setting those to extremely low values by default. You&rsquo;ll get a whopping 64KB of disk space on your cloud drive, very in line with the retro feeling! But this was yet another delay in shipping this project.</p><h1 id=parting-words>Parting words</h1><p>During these few months, I have learned quite a few new things that have unblocked long-standing mental blocks around cloud services. As mentioned earlier, OAuth has been one of them. And while I still have a lot of unknowns in that specific area, the knowledge I&rsquo;ve gained has <em>already</em> helped me at work to diagnose real customer issues.</p><p>I have also built a bunch of components that will be useful in the future. For example, I spent much more time than I should have building a database abstraction that supports SQLite for unit testing instead of the production PostgreSQL, and I also spent a lot of time building a logger implementation that records messages into the database (instead of stderr). You can say that these were unnecessary for an MVP, but these components and patterns will come in handy for any other service I want to build in the future&mdash;so I had an incentive (and no time pressure) to do the right thing.</p><p>In the end, this was all about gaining experience points and having fun along the way&mdash;and so far, I think it paid off. There is a lot more to say, but I&rsquo;ll save those topics for other posts.</p><blockquote><p><strong>Now it&rsquo;s <a href=https://www.endbasic.dev/>your turn to play</a>. Hope you enjoy EndBASIC 0.7.0! üéâ</strong></p></blockquote></article></div></div><div class="container post-links"><div class=row><div class="col mr-auto text-left"><span><a href=https://jmmv.dev/2021/07/feedburner-to-follow-it-migration.html>&#171; Previous</a></span></div><div class="col text-center"><span><a href=/archive.html>All posts</a></span></div><div class="col ml-auto text-right"><span><a href=https://jmmv.dev/2021/07/macos-ahk.html>Next &#187;</a></span></div></div></div><div class="container post-votes"><div class=row><div class="col-lg-4 my-2"><div class=row><div class=col><a onclick=voteThumbsUp() class="btn btn-block btn-outline-success" id=thumbs-up-btn>üëç
(<span id=thumbs-up-count>0</span>)</a></div><div class=col><a onclick=voteThumbsDown() class="btn btn-block btn-outline-danger" id=thumbs-down-btn>üëé
(<span id=thumbs-down-count>0</span>)</a></div></div></div><div class="col-lg-8 my-2 d-none d-sm-block"><div class=row><div class="col-md-4 text-center"><a href="https://www.reddit.com/submit?title=EndBASIC+0.7%3A+Hello%2C+cloud%21&amp;url=https%3A%2F%2Fjmmv.dev%2F2021%2F07%2Fendbasic-0.7.html" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/reddit.png alt=Reddit width=24 height=24></a></div><div class="col-md-4 text-center"><a href="https://news.ycombinator.com/submitlink?t=EndBASIC+0.7%3A+Hello%2C+cloud%21&amp;u=https%3A%2F%2Fjmmv.dev%2F2021%2F07%2Fendbasic-0.7.html" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/ycombinator.png alt="Hacker News" width=24 height=24></a></div><div class="col-md-4 text-center"><a href="https://twitter.com/intent/tweet?status=EndBASIC+0.7%3A+Hello%2C+cloud%21+%E2%80%94+https%3A%2F%2Fjmmv.dev%2F2021%2F07%2Fendbasic-0.7.html+%E2%80%94+cc+%40jmmv" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/Twitter_Social_Icon_Circle_Color.png alt=Twitter width=24 height=24></a></div></div></div></div><div class="row my-4" id=postCommentRow><div class=col><div class=media><img class=mr-3 src=/octicons/pencil.svg width=32px height=32px><div class="media-body container"><form method=post id=newPost><div class=row><div class="col my-1"><textarea class=form-control rows=1 id=postCommentContent onclick=showPostComment() placeholder="Leave a comment"></textarea></div></div><div class="row newPostControls" style=display:none><div class="col my-1 form-group"><label for=postCommentAuthor>Your name (optional):</label>
<input type=text class=form-control id=postCommentAuthor></div></div><div class="row newPostControls" style=display:none><div class="col my-1 form-group"><label for=postCommentEmail>Your email (optional):</label>
<input type=text class=form-control type=email id=postCommentEmail>
<small class="form-text text-muted">Invisible to all readers; if provided, you will receive notifications when replied to (not implemented yet)</small></div></div><div class=row id=postCommentError style=display:none><div class="col mt-1 alert-danger"><p></p></div></div><div class="row newPostControls" style=display:none><button class="col-md-3 my-1 btn btn-primary" type=submit id=submitCommentButton>Post</button>
<small class="col-md-9 my-1 text-muted">Comments are subject to moderation. This feature is experimental and is powered by <a href=/software/endtracker.html>EndTRACKER</a>. If you experience any issues, please <a href=/about.html#contact>contact me off-band</a>.</small></div></form></div></div></div></div><script>function hidePostComment(){var t,e=document.getElementById("postCommentContent");e.rows=1,e.value="",t=document.getElementsByClassName("newPostControls"),Array.prototype.forEach.call(t,function(e){e.style.display="none"})}function showPostComment(){var e,t=document.getElementById("postCommentContent");t.rows=5,e=document.getElementsByClassName("newPostControls"),Array.prototype.forEach.call(e,function(e){e.style.display=""})}const form=document.querySelector("#newPost");form.onsubmit=function(e){e.preventDefault();let t=document.getElementById("postCommentAuthor").value,n=document.getElementById("postCommentEmail").value,s=document.getElementById("postCommentContent").value;postComment(t,n,s,hidePostComment)}</script></div></div><div class="col-md-3 sidebar d-none d-md-block"><div class=row><div class="col text-center p-2"><p><a href=/about.html class=clear-link><img src=/images/avatars/20181124-snow.jpg class="rounded-circle shadow my-2" style=width:100px><br><b>Julio Merino</b><br>A blog on operating systems, programming languages, testing, build systems, my own software
projects and even personal productivity. Specifics include FreeBSD, Linux, Rust, Bazel and
EndBASIC.</a></p><div class=row><div class=col><div class=form-group><form action=https://endtracker.azurewebsites.net/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/subscribers/add method=post><input type=text name=email placeholder="Enter your email" class="form-control input-sm text-center my-1">
<button type=submit class="btn btn-primary btn-block my-1">Subscribe</button></form></div></div></div><div class="row px-2"><div class="col-sm-5 text-left"><small><span class=subscriber-count>0</span> subscribers</small></div><div class="col-sm-7 text-right"><p><a rel=me href=https://mastodon.online/@jmmv><img src=/images/badges/mastodon-logo.svg width=32px height=32px alt="Follow @jmmv on Mastodon">
</a><a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&amp;screen_name=jmmv"><img src=/images/badges/Twitter_logo_blue.svg width=32px height=32px alt="Follow @jmmv on Twitter">
</a><a href=/feed.xml><img src=/images/badges/feed-icon-28x28.png alt="RSS feed"></a></p></div></div></div></div><div class=row><div class=col><h2>Featured software</h2><ul><li class=overflow-ellipsis><a href=https://www.endbasic.dev/ target=_blank>EndBASIC: Online BASIC+DOS env</a></li><li class=overflow-ellipsis><a href=https://endtracker.azurewebsites.net/ target=_blank>EndTRACKER: Services for static sites</a></li></ul></div></div><div class=row><div class=col><h2>Featured posts</h2><ul><li class=overflow-ellipsis><a href=/2023/06/fast-machines-slow-machines.html>Fast machines, slow machines</a></li><li class=overflow-ellipsis><a href=/2022/12/endbasic-0.10.html>EndBASIC 0.10: Core language, evolved</a></li><li class=overflow-ellipsis><a href=/2022/10/bye-microsoft-hi-snowflake.html>Farewell, Microsoft; hello, Snowflake!</a></li><li class=overflow-ellipsis><a href=/2022/05/rust-is-hard-but-does-it-matter.html>Rust is hard, yes, but does it matter?</a></li><li class=overflow-ellipsis><a href=/2022/04/rust-traits-and-dependency-injection.html>Rust traits and dependency injection</a></li><li class=overflow-ellipsis><a href=/2022/03/a-year-on-windows-intro.html>A year on Windows: Introduction</a></li><li class=overflow-ellipsis><a href=/2021/04/always-be-quitting.html>Always be quitting</a></li><li class=overflow-ellipsis><a href=/2021/02/google-monorepos-and-caching.html>How does Google keep build times low?</a></li><li class=overflow-ellipsis><a href=/2020/12/google-no-clean-builds.html>How does Google avoid clean builds?</a></li><li class=overflow-ellipsis><a href=/2020/12/unit-testing-a-console-app.html>Unit-testing a console app (a text editor)</a></li><li class=overflow-ellipsis><a href=/essays.html#featured>More...</a></li></ul></div></div></div></div></div><footer class=container-fluid><div class=row><div class="col-4 order-2 text-right"><p class=float-right><a href=#>Back to top</a></p></div><div class="col-8 order-1 mr-auto"><p>Copyright 2004&ndash;2024
Julio Merino</p></div></div></footer><script type=module>
  import { addAnchorsToHeaders, addElementClasses, BatchClient } from "\/js\/main.0de73782e9e0fbcb4184fb5793949b3b0d0ada16455df89320415b4dcc052f88.js";

  var batchClient = new BatchClient(SITE_ID);
  batchClient.doAll({
    put_request: true, get_comments: true, get_subscriber_count: true, get_votes: true });

  window.voteThumbsUp = function() { batchClient.voteThumbsUp(); }
  window.voteThumbsDown = function() { batchClient.voteThumbsDown(); }

  window.postComment = function(...args) {
    batchClient.postComment(...args);
  };

  addAnchorsToHeaders();
  addElementClasses();
</script><noscript><img src=https://hugo-dynamic.jmmv.dev/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/pages/aHR0cHM6Ly9qbW12LmRldi8yMDIxLzA3L2VuZGJhc2ljLTAuNy5odG1s/stamp.gif style=display:none></noscript></body></html>