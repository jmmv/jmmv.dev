<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml xmlns:fb=http://ogp.me/ns/fb#><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta property="og:site_name" content="Julio Merino (jmmv.dev)"><meta property="twitter:site" content="@jmmv"><title>Constructors and evil initializers in C++ - Julio Merino (jmmv.dev)</title>
<meta property="og:title" content="Constructors and evil initializers in C++ - Julio Merino (jmmv.dev)"><meta property="twitter:title" content="Constructors and evil initializers in C++ - Julio Merino (jmmv.dev)"><meta name=description content="One of the three key tenets of Object Oriented Programming (OOP) is encapsulation: objects contain a state that, when observed from the outside, is always internally-consistent. Unfortunately, C++ codebases where exceptions are forbidden often violate this rule when they separate object initialization from construction. Let&rsquo;s see why that&rsquo;s a problem and how to address it."><meta property="og:description" content="One of the three key tenets of Object Oriented Programming (OOP) is encapsulation: objects contain a state that, when observed from the outside, is always internally-consistent. Unfortunately, C++ codebases where exceptions are forbidden often violate this rule when they separate object initialization from construction. Let&rsquo;s see why that&rsquo;s a problem and how to address it."><meta property="twitter:description" content="One of the three key tenets of Object Oriented Programming (OOP) is encapsulation: objects contain a state that, when observed from the outside, is always internally-consistent. Unfortunately, C++ ‚Ä¶"><meta name=author content="Julio Merino"><meta property="twitter:creator" content="@jmmv"><meta name=generator content="Hugo 0.136.5"><meta property="og:url" content="https://jmmv.dev/2021/11/cpp-ctors-vs-init.html"><meta property="og:type" content="blog"><meta property="twitter:card" content="summary"><link rel=canonical href=https://jmmv.dev/2021/11/cpp-ctors-vs-init.html><link rel=alternate type=application/rss+xml title="Julio Merino (jmmv.dev)" href=/feed.xml><link rel=stylesheet href=/sass/main.min.cb91349cd93211a37e7d5dc131c35a170fc795721c03373cd05571327eea206b.css><link rel=stylesheet href=/css/chroma.css><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicons/favicon-96x96.png sizes=96x96><meta property="og:image" content="/images/favicons/favicon-1200x1200.png"><meta property="twitter:image" content="https://jmmv.dev/images/favicons/favicon-1200x1200.png"><script>const SITE_ID="e8da9f62-b7ac-4fe9-bf20-7c527199a376",BASE_URL="https://jmmv.dev/"</script></head><body><header class=site-header><nav class="navbar navbar-expand-md fixed-top navbar-dark bg-primary"><a class=navbar-brand href=/><img src=/images/favicons/favicon-30x30.png width=30 height=30 class="d-inline-block align-top" alt>
&nbsp;jmmv.dev
</a><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/about.html>About</a></li><li class=nav-item><a class=nav-link href=/blog.html>Blog</a></li><li class=nav-item><a class=nav-link href=/resume.html>Resume</a></li><li class=nav-item><a class=nav-link href=/software.html>Software</a></li></ul><ul class="navbar-nav mr-4"><li class=nav-item><a class=nav-link href=/archive.html>Archive</a></li><li class=nav-item><a class=nav-link href=/series.html>Series</a></li><li class=nav-item><a class=nav-link href=/tags.html>Tags</a></li></ul><form class=form-inline method=get role=search action=https://www.google.com/search><div class=input-group><input type=search name=query class=form-control placeholder=Search aria-label=Search><div class=input-group-append><button type=submit value=Search class="btn btn-light">
<img src=/octicons/search.svg></button></div></div><input type=hidden name=sitesearch value=https://jmmv.dev/></form></div></nav></header><div class=page-header><div class=container><h1>Constructors and evil initializers in C++</h1><p>November 24, 2021 &#183;
About 8 minutes
&#183;
Tags:
<a href=/tags/c++>c++</a>, <a href=/tags/readability>readability</a></p></div></div><div class="container post-body"><div class=row><div class=col-md-9><div class=row><div class=col><article><p>One of the three key tenets of Object Oriented Programming (OOP) is <strong>encapsulation</strong>: objects contain a state that, when observed from the outside, is always internally-consistent. To illustrate this, suppose you have a class to represent a rectangle<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, and that this class tracks the rectangle&rsquo;s dimensions as well as its area:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Rectangle</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=p>,</span> <span class=n>area</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Rectangle</span><span class=p>(</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span> <span class=kt>int</span> <span class=n>h</span><span class=p>)</span> <span class=o>:</span> <span class=n>width</span><span class=p>(</span><span class=n>w</span><span class=p>),</span> <span class=n>height</span><span class=p>(</span><span class=n>h</span><span class=p>),</span> <span class=n>area</span><span class=p>(</span><span class=n>w</span> <span class=o>*</span> <span class=n>h</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span> <span class=n>dimensions</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>make_pair</span><span class=p>(</span><span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>area</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>area</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>resize</span><span class=p>(</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span> <span class=kt>int</span> <span class=n>h</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>width</span> <span class=o>=</span> <span class=n>w</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>height</span> <span class=o>=</span> <span class=n>h</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>area</span> <span class=o>=</span> <span class=n>w</span> <span class=o>*</span> <span class=n>h</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>The <code>Rectangle</code> class above has two fields to represent its dimensions (<code>width</code> and <code>height</code>) and a derived field to represent its <code>area</code>, which we store in the object itself because it happens to be very expensive to compute (narrator: it really is not).</p><p>If we use this class via its public interface shown above (in a non-threaded environment), we can guarantee that <code>area</code> is always up-to-date with <code>width</code> and <code>height</code>. When the object is first constructed, all fields are in a consistent state, and if we call <code>resize()</code> at a later stage, we know that all fields are also consistent right before and right after the method call.</p><p>But note that this is <em>not</em> true within the class implementation: there is a point in time in the constructor and in the <code>resize()</code> method where the precomputed value of <code>area</code> is stale. And that&rsquo;s OK from an encapsulation perspective: we only need to worry about internal consistency at the public boundaries of the class.</p><h1 id=lets-add-error-handling>Let&rsquo;s add error handling</h1><p>Suppose we want to update our <code>Rectangle</code> class to ensure that <code>width</code> and <code>height</code> are positive and not zero. Easy-peasy:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Rectangle</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Rectangle</span><span class=p>(</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span> <span class=kt>int</span> <span class=n>h</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>w</span> <span class=o>&lt;=</span> <span class=mi>0</span> <span class=o>||</span> <span class=n>h</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=n>std</span><span class=o>::</span><span class=n>runtime_error</span><span class=p>(</span><span class=s>&#34;Dimensions must be positive and non-zero&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>width</span> <span class=o>=</span> <span class=n>w</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>height</span> <span class=o>=</span> <span class=n>h</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>area</span> <span class=o>=</span> <span class=n>w</span> <span class=o>*</span> <span class=n>h</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><p>All good here from an encapsulation perspective. If we try to instantiate a <code>Rectangle</code> with invalid dimensions and use it, like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Rectangle</span> <span class=nf>r</span><span class=p>(</span><span class=n>some_width</span><span class=p>,</span> <span class=n>some_height</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;The area is: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>r</span><span class=p>.</span><span class=n>area</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=sc>&#39;\n&#39;</span><span class=p>;</span>
</span></span></code></pre></div><p>&mldr; the constructor will throw an exception, the object will never have existed, and no code after that line in the same scope will run. There isn&rsquo;t any possibility in which we have an invalid <code>r</code> that is accessible from the code.</p><h1 id=lets-ban-exceptions>Let&rsquo;s ban exceptions</h1><p>As it turns out, there are many codebases out there that ban the use of exceptions in C++ (<a href=https://google.github.io/styleguide/cppguide.html#Exceptions>Google&rsquo;s being a famous one</a>). And if we don&rsquo;t have exceptions, it&rsquo;s impossible to return errors from a constructor.</p><p>Which begs the question: how do we handle the situation above? How can we detect errors during construction and prevent invalid objects from ever being created? The common answer seems to be to add a separate initialization method (say <code>init</code>), like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Rectangle</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Rectangle</span><span class=p>()</span> <span class=o>:</span> <span class=n>width</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=n>height</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=n>area</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=nf>init</span><span class=p>(</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span> <span class=kt>int</span> <span class=n>h</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>w</span> <span class=o>&lt;=</span> <span class=mi>0</span> <span class=o>||</span> <span class=n>h</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>width</span> <span class=o>=</span> <span class=n>w</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>height</span> <span class=o>=</span> <span class=n>h</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>area</span> <span class=o>=</span> <span class=n>w</span> <span class=o>*</span> <span class=n>h</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><p>And, in turn, this means that the class now has to be used like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Rectangle</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>r</span><span class=p>.</span><span class=n>init</span><span class=p>(</span><span class=n>some_width</span><span class=p>,</span> <span class=n>some_height</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Invalid dimensions; handle error!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;The area is: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>r</span><span class=p>.</span><span class=n>area</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=sc>&#39;\n&#39;</span><span class=p>;</span>
</span></span></code></pre></div><p><strong>The horror.</strong> Note the abomination we have introduced here. The caller now must go through two separate steps to create the object: one is <code>Rectangle r</code>, which calls the constructor, and another is the call to <code>r.init()</code>. Critically, the internal state of the object is now invalid across these two steps, and this inconsistent state is observable through the public interface.</p><p>Oops, we have violated the encapsulation principle. Our program can now have instances of a <code>Rectangle</code> that are invalid (akin to null values), and code can reference them just fine. This is bad. Really, <em>really</em> bad. As I said a few months ago in reply to a tweet praising RAII:</p><div class="card m-3"><div class=card-body><h5 class=card-title>@jmmv on August 4th, 2021 &#183; Replying to @awesomekling</h5><p class=card-text><b>Making invalid states irrepresentable is probably the best thing one can do to improve reliability when designing a new piece of code. It's a difficult mentality shift though!</b></p>30 likes &#183; 5 retweets &#183; <a href=https://twitter.com/jmmv/status/1423040474974015494 class=card-link>Go to Twitter thread</a></div></div><p>Unfortunately, by separating construction from initialization like we did above, we have gone against this principle. Yes, we had to do it because of the constraints of our environment, but it&rsquo;d be best if we didn&rsquo;t have to violate a core tenet of OOP.</p><h1 id=a-possible-solution>A possible solution</h1><p>There are ways to mitigate, but not fully resolve, this problem. My preferred way is to use a static factory method to perform the object construction and initialization along with the required error handling. Consider the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Rectangle</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=n>Rectangle</span><span class=p>(</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span> <span class=kt>int</span> <span class=n>h</span><span class=p>)</span> <span class=o>:</span> <span class=n>width</span><span class=p>(</span><span class=n>w</span><span class=p>),</span> <span class=n>height</span><span class=p>(</span><span class=n>h</span><span class=p>),</span> <span class=n>area</span><span class=p>(</span><span class=n>w</span> <span class=o>*</span> <span class=n>h</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>assert</span><span class=p>(</span><span class=n>width</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>height</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>optional</span><span class=o>&lt;</span><span class=n>Rectangle</span><span class=o>&gt;</span> <span class=n>create</span><span class=p>(</span><span class=kt>int</span> <span class=n>w</span><span class=p>,</span> <span class=kt>int</span> <span class=n>h</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>w</span> <span class=o>&lt;=</span> <span class=mi>0</span> <span class=o>||</span> <span class=n>h</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>nullopt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nf>Rectangle</span><span class=p>(</span><span class=n>w</span><span class=p>,</span> <span class=n>h</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><p>In this version, we have restored the original constructor that does not perform validation. Objects are now always constructed in a complete state, but it&rsquo;s again possible for those objects to contain invalid state: the caller of the constructor could supply invalid values. However, the constructor is now private, so this is sound from an encapsulation perspective; remember that we only must maintain consistency and validity at public interface boundaries.</p><p>All great, but&mldr; with a private constructor, we cannot create instances of our class! To solve this, we can introduce a static factory method that either returns a new <code>Rectangle</code> if the parameters are valid, or an empty object if the inputs are invalid. With this approach, the public interface of <code>Rectangle</code> is now properly encapsulated again: all objects returned by <code>create()</code> are guaranteed to be valid, and if the parameters are invalid, no object is created at all. (We still have to deal with null-ness though&mldr;)</p><p>Unfortunately, this code is not equivalent to the version that used exceptions. Note that our factory method returns a different object type and is in full control of the object&rsquo;s creation. This has a problem when dealing with inheritance, because a subclass of <code>Rectangle</code> cannot use the factory method to perform partial initialization. But this is a minor issue that can be worked around.</p><p>Also note that the use of <code>std::optional</code> is just one possibility here. Alternatives that also work include <code>std::unique_ptr</code>, <code>boost::optional</code>, or <code>absl::StatusOr</code>, to name a few.</p><h1 id=takeaways>Takeaways</h1><p>Here are the key points I&rsquo;d like you to remember from this post:</p><ol><li><p>The single best thing you can do to increase the reliability of a program is to make invalid states impossible to represent.</p></li><li><p>Keep constructors &ldquo;dumb&rdquo;: all they should be doing is assign fields. This applies irrespectively of the use of exceptions.</p></li><li><p>Avoid <code>init</code>-like methods if at all possible. If you have actual logic during object construction, put that code in a static factory method (with the bonus of a better-named &ldquo;constructor&rdquo;), or use dependency injection to push that logic to the caller.</p></li><li><p>As a corollary to the above, <code>init</code>-like methods that return <code>void</code> are useless. Do not separate construction from initialization just because it&rsquo;s a widespread practice in your codebase. Keep all initialization in the constructor unless it&rsquo;s impossible to do so.</p></li><li><p>If you <em>must</em> provide an <code>init</code>-like method to handle errors, do the smallest possible amount of work within it. Any fields that can be initialized in the constructor should be initialized there (because this allows you to make them <code>const</code>, for example). Reserve the <code>init</code> method for the few fields that are subject to error checking.</p></li><li><p>Consider adding an <code>is_initialized</code> boolean to the class, and assert that it is true in all methods (except in <code>init</code>, where you would assert that it is false). This adds overhead, both to the code and runtime, but it will help you detect the cases where you end up using a partially-initialized object&mdash;which I guarantee will happen.</p></li></ol><p>One final thought to conclude: the reason I really enjoy writing in Rust is because the language forces you to care about these correctness properties (via the <code>Result&lt;T,E></code> type in the context of this post). If you don&rsquo;t know Rust but regularly code in C++, I&rsquo;d strongly recommend you to learn Rust as well: you&rsquo;ll change the way you think about structuring your data types and algorithms, and will spot problematic patterns in C++ with ease.</p><p><strong>Edit (2021-11-25):</strong> Updated the static factory method example to return <code>std::optional</code> instead of <code>std::unique_ptr</code> to avoid stack allocations. I had originally used the latter because that&rsquo;s what I most see in the current codebase I work in and rarely experience the former (in C++). Also added a note saying that the <code>Rectangle</code> example is, of course, trivial.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>The use of a trivial <code>Rectangle</code> class is for illustration purposes only. Of course this example is trivial and there are ways around it. In the real world, think about classes that perform &ldquo;real work&rdquo; and interact with external systems, such as a wrapper around a database connection.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article></div></div><div class="container post-links"><div class=row><div class="col mr-auto text-left"><span><a href=https://jmmv.dev/2021/11/endbasic-0.8.html>&#171; Previous</a></span></div><div class="col text-center"><span><a href=/archive.html>All posts</a></span></div><div class="col ml-auto text-right"><span><a href=https://jmmv.dev/2022/01/oncall-scheduling.html>Next &#187;</a></span></div></div></div><div class="container post-votes"><div class=row><div class="col-lg-4 my-2"><div class=row><div class=col><a onclick=voteThumbsUp() class="btn btn-block btn-outline-success" id=thumbs-up-btn>üëç
(<span id=thumbs-up-count>0</span>)</a></div><div class=col><a onclick=voteThumbsDown() class="btn btn-block btn-outline-danger" id=thumbs-down-btn>üëé
(<span id=thumbs-down-count>0</span>)</a></div></div></div><div class="col-lg-8 my-2 d-none d-sm-block"><div class=row><div class="col-md-4 text-center"><a href="https://www.reddit.com/submit?title=Constructors+and+evil+initializers+in+C%2B%2B&amp;url=https%3A%2F%2Fjmmv.dev%2F2021%2F11%2Fcpp-ctors-vs-init.html" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/reddit.png alt=Reddit width=24 height=24></a></div><div class="col-md-4 text-center"><a href="https://news.ycombinator.com/submitlink?t=Constructors+and+evil+initializers+in+C%2B%2B&amp;u=https%3A%2F%2Fjmmv.dev%2F2021%2F11%2Fcpp-ctors-vs-init.html" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/ycombinator.png alt="Hacker News" width=24 height=24></a></div><div class="col-md-4 text-center"><a href="https://twitter.com/intent/tweet?status=Constructors+and+evil+initializers+in+C%2B%2B+%E2%80%94+https%3A%2F%2Fjmmv.dev%2F2021%2F11%2Fcpp-ctors-vs-init.html+%E2%80%94+cc+%40jmmv" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/Twitter_Social_Icon_Circle_Color.png alt=Twitter width=24 height=24></a></div></div></div></div><div class="row my-4" id=postCommentRow><div class=col><div class=media><img class=mr-3 src=/octicons/pencil.svg width=32px height=32px><div class="media-body container"><form method=post id=newPost><div class=row><div class="col my-1"><textarea class=form-control rows=1 id=postCommentContent onclick=showPostComment() placeholder="Leave a comment"></textarea></div></div><div class="row newPostControls" style=display:none><div class="col my-1 form-group"><label for=postCommentAuthor>Your name (optional):</label>
<input type=text class=form-control id=postCommentAuthor></div></div><div class="row newPostControls" style=display:none><div class="col my-1 form-group"><label for=postCommentEmail>Your email (optional):</label>
<input type=text class=form-control type=email id=postCommentEmail>
<small class="form-text text-muted">Invisible to all readers; if provided, you will receive notifications when replied to (not implemented yet)</small></div></div><div class=row id=postCommentError style=display:none><div class="col mt-1 alert-danger"><p></p></div></div><div class="row newPostControls" style=display:none><button class="col-md-3 my-1 btn btn-primary" type=submit id=submitCommentButton>Post</button>
<small class="col-md-9 my-1 text-muted">Comments are subject to moderation. This feature is experimental and is powered by <a href=/software/endtracker.html>EndTRACKER</a>. If you experience any issues, please <a href=/about.html#contact>contact me off-band</a>.</small></div></form></div></div></div></div><script>function hidePostComment(){var t,e=document.getElementById("postCommentContent");e.rows=1,e.value="",t=document.getElementsByClassName("newPostControls"),Array.prototype.forEach.call(t,function(e){e.style.display="none"})}function showPostComment(){var e,t=document.getElementById("postCommentContent");t.rows=5,e=document.getElementsByClassName("newPostControls"),Array.prototype.forEach.call(e,function(e){e.style.display=""})}const form=document.querySelector("#newPost");form.onsubmit=function(e){e.preventDefault();let t=document.getElementById("postCommentAuthor").value,n=document.getElementById("postCommentEmail").value,s=document.getElementById("postCommentContent").value;postComment(t,n,s,hidePostComment)}</script></div></div><div class="col-md-3 sidebar d-none d-md-block"><div class=row><div class="col text-center p-2"><p><a href=/about.html class=clear-link><img src=/images/avatars/20181124-snow.jpg class="rounded-circle shadow my-2" style=width:100px><br><b>Julio Merino</b><br>A blog on operating systems, programming languages, testing, build systems, my own software
projects and even personal productivity. Specifics include FreeBSD, Linux, Rust, Bazel and
EndBASIC.</a></p><div class=row><div class=col><div class=form-group><form action=https://endtracker.azurewebsites.net/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/subscribers/add method=post><input type=text name=email placeholder="Enter your email" class="form-control input-sm text-center my-1">
<button type=submit class="btn btn-primary btn-block my-1">Subscribe</button></form></div></div></div><div class="row px-2"><div class="col-sm-5 text-left"><small><span class=subscriber-count>0</span> subscribers</small></div><div class="col-sm-7 text-right"><p><a rel=me href=https://mastodon.online/@jmmv><img src=/images/badges/mastodon-logo.svg width=32px height=32px alt="Follow @jmmv on Mastodon">
</a><a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&amp;screen_name=jmmv"><img src=/images/badges/Twitter_logo_blue.svg width=32px height=32px alt="Follow @jmmv on Twitter">
</a><a href=/feed.xml><img src=/images/badges/feed-icon-28x28.png alt="RSS feed"></a></p></div></div></div></div><div class=row><div class=col><h2>Featured software</h2><ul><li class=overflow-ellipsis><a href=https://www.endbasic.dev/ target=_blank>EndBASIC: Online BASIC+DOS env</a></li><li class=overflow-ellipsis><a href=https://endtracker.azurewebsites.net/ target=_blank>EndTRACKER: Services for static sites</a></li></ul></div></div><div class=row><div class=col><h2>Featured posts</h2><ul><li class=overflow-ellipsis><a href=/2023/06/fast-machines-slow-machines.html>Fast machines, slow machines</a></li><li class=overflow-ellipsis><a href=/2022/12/endbasic-0.10.html>EndBASIC 0.10: Core language, evolved</a></li><li class=overflow-ellipsis><a href=/2022/10/bye-microsoft-hi-snowflake.html>Farewell, Microsoft; hello, Snowflake!</a></li><li class=overflow-ellipsis><a href=/2022/05/rust-is-hard-but-does-it-matter.html>Rust is hard, yes, but does it matter?</a></li><li class=overflow-ellipsis><a href=/2022/04/rust-traits-and-dependency-injection.html>Rust traits and dependency injection</a></li><li class=overflow-ellipsis><a href=/2022/03/a-year-on-windows-intro.html>A year on Windows: Introduction</a></li><li class=overflow-ellipsis><a href=/2021/04/always-be-quitting.html>Always be quitting</a></li><li class=overflow-ellipsis><a href=/2021/02/google-monorepos-and-caching.html>How does Google keep build times low?</a></li><li class=overflow-ellipsis><a href=/2020/12/google-no-clean-builds.html>How does Google avoid clean builds?</a></li><li class=overflow-ellipsis><a href=/2020/12/unit-testing-a-console-app.html>Unit-testing a console app (a text editor)</a></li><li class=overflow-ellipsis><a href=/essays.html#featured>More...</a></li></ul></div></div></div></div></div><footer class=container-fluid><div class=row><div class="col-4 order-2 text-right"><p class=float-right><a href=#>Back to top</a></p></div><div class="col-8 order-1 mr-auto"><p>Copyright 2004&ndash;2024
Julio Merino</p></div></div></footer><script type=module>
  import { addAnchorsToHeaders, addElementClasses, BatchClient } from "\/js\/main.0de73782e9e0fbcb4184fb5793949b3b0d0ada16455df89320415b4dcc052f88.js";

  var batchClient = new BatchClient(SITE_ID);
  batchClient.doAll({
    put_request: true, get_comments: true, get_subscriber_count: true, get_votes: true });

  window.voteThumbsUp = function() { batchClient.voteThumbsUp(); }
  window.voteThumbsDown = function() { batchClient.voteThumbsDown(); }

  window.postComment = function(...args) {
    batchClient.postComment(...args);
  };

  addAnchorsToHeaders();
  addElementClasses();
</script><noscript><img src="https://hugo-dynamic.jmmv.dev/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/pages/aHR0cHM6Ly9qbW12LmRldi8yMDIxLzExL2NwcC1jdG9ycy12cy1pbml0Lmh0bWw=/stamp.gif" style=display:none></noscript></body></html>