<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml xmlns:fb=http://ogp.me/ns/fb#>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta property="og:site_name" content="Julio Merino (jmmv.dev)">
<meta property="twitter:site" content="@jmmv">
<title>Sample REST interface in Rust and Go - Julio Merino (jmmv.dev)</title>
<meta property="og:title" content="Sample REST interface in Rust and Go - Julio Merino (jmmv.dev)">
<meta property="twitter:title" content="Sample REST interface in Rust and Go - Julio Merino (jmmv.dev)">
<meta name=keywords content="rest api documentation,rest interface,restful web services">
<meta name=description content="Over the summer, I prototyped a bunch of web apps whose ideas had been floating in my mind for a long time. I spent some time reading through REST API documentation pages and, as part of these exercises, implemented sample RESTful web services in both Go and Rust. (Just for context, the last time I wrote a web app was in high school&amp;hellip; and it involved PHP, MySQL, and I think IE6?">
<meta property="og:description" content="Over the summer, I prototyped a bunch of web apps whose ideas had been floating in my mind for a long time. I spent some time reading through REST API documentation pages and, as part of these exercises, implemented sample RESTful web services in both Go and Rust. (Just for context, the last time I wrote a web app was in high school&amp;hellip; and it involved PHP, MySQL, and I think IE6?">
<meta property="twitter:description" content="Over the summer, I prototyped a bunch of web apps whose ideas had been floating in my mind for a long time. I spent some time reading through REST API documentation pages and, as part of these …">
<meta name=author content="Julio Merino">
<meta property="twitter:creator" content="@jmmv">
<meta name=generator content="Hugo 0.92.1">
<meta property="og:url" content="https://jmmv.dev/2019/09/rest-api-rust-go.html">
<meta property="og:type" content="blog">
<meta property="twitter:card" content="summary">
<link rel=canonical href=https://jmmv.dev/2019/09/rest-api-rust-go.html>
<link rel=alternate type=application/rss+xml title="Julio Merino (jmmv.dev)" href=/feed.xml>
<link rel=stylesheet href=/sass/main.min.e6bc80a1be92c773c7961a8e97099442cea2dd8ed61958e61cf1436928d991e2.css>
<link rel=stylesheet href=/css/chroma.css>
<meta property="og:image" content="/images/favicons/favicon-1200x1200.png">
<link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/images/favicons/favicon-96x96.png sizes=96x96>
<meta property="twitter:image" content="https://jmmv.dev/images/favicons/favicon-1200x1200.png">
<script>const SITE_ID='e8da9f62-b7ac-4fe9-bf20-7c527199a376',BASE_URL='https://jmmv.dev/'</script>
</head>
<body>
<header class=site-header>
<nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary">
<a class=navbar-brand href=/>
<img src=/images/favicons/favicon-30x30.png width=30 height=30 class="d-inline-block align-top" alt>
&nbsp;Julio Merino
</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav mr-auto">
<li class=nav-item>
<a class=nav-link href=/about.html>About</a>
</li>
<li class=nav-item>
<a class=nav-link href=/essays.html>Essays</a>
</li>
<li class=nav-item>
<a class=nav-link href=/resume.html>Resume</a>
</li>
<li class=nav-item>
<a class=nav-link href=/software.html>Software</a>
</li>
</ul>
<ul class="navbar-nav mr-4">
<li class=nav-item>
<a class=nav-link href=/archive.html>Archive</a>
</li>
<li class=nav-item>
<a class=nav-link href=/series.html>Series</a>
</li>
<li class=nav-item>
<a class=nav-link href=/tags.html>Tags</a>
</li>
</ul>
<form class=form-inline method=get role=search action=https://www.google.com/search>
<div class=input-group>
<input type=search name=query class=form-control placeholder=Search aria-label=Search>
<div class=input-group-append>
<button type=submit value=Search class="btn btn-light">
<img src=/octicons/search.svg>
</button>
</div>
</div>
<input type=hidden name=sitesearch value=https://jmmv.dev/>
</form>
</div>
</nav>
</header>
<div class=page-header>
<div class=container>
<h1>Sample REST interface in Rust and Go</h1>
<p>September 27, 2019 &#183;
About 13 minutes
&#183;
Tags:
<a class=text-reset href=/tags/featured>featured</a>, <a class=text-reset href=/tags/programming>programming</a>, <a class=text-reset href=/tags/rust>rust</a>, <a class=text-reset href=/tags/webapp>webapp</a></p>
</div>
</div>
<div class=container>
<div class=row>
<div class=col-md-9>
<div class=row>
<div class=col>
<article><p>Over the summer, I prototyped a bunch of web apps whose ideas had been floating in my mind for a long time. I spent some time reading through REST API documentation pages and, as part of these exercises, implemented sample RESTful web services in both Go and Rust. (Just for context, the last time I wrote a web app was in high school&mldr; and it involved PHP, MySQL, and I think IE6? Times have changed.)</p>
<p><strong>Why Go?</strong> Because the first app I wanted to build was to run on App Engine and Go was an easy choice after trying and giving up on Java.<br>
<strong>Why Rust?</strong> Because I enjoy it more and wanted to see how it would stack up to Go in this task.</p>
<p>The app prototypes have gone nowhere but I thought of sharing their skeletons to serve as templates for myself in future work. Thus, in this post, I will cover these skeleton RESTful web services and I will compare their implementation. Yes, I will dive a little bit more into <a href=/2018/07/rust-vs-go.html>Rust vs. Go</a>.</p>
<h1 id=guiding-principles>Guiding principles</h1>
<p>The basic constraints that led to these demos are:</p>
<ul>
<li>
<p>Decoupling the REST interface from the business logic. The web API is the interface with users and should not be tied to the internal business logic nor backend. I&rsquo;m new to REST, but clearly defining the boundary between the outside world and the server&rsquo;s internals is just good design practice in any paradigm, be it <a href=/2013/08/cli-design-cli-is-presentation-layer.html>command line tools</a> or protobuf-based web servers&mdash;of which I <em>do</em> have written a bunch as they are the daily bread at Google.</p>
</li>
<li>
<p>Using JSON for the requests and responses as the serialization format. You&rsquo;ll note that in some cases I&rsquo;m introducing data types that are not strictly needed for these toy demos, but the goal is to see how easy (or not) it is to define and integrate such types.</p>
</li>
<li>
<p>Storing state in-memory only. We don&rsquo;t need persistence for this demo code and keeping everything in memory is sufficient.</p>
</li>
<li>
<p>Staying away from high-level do-it-all frameworks. It may be convenient to use those, but I wanted to see how things work under the covers. I&rsquo;ll be using HTTP routing APIs but that&rsquo;s about it.</p>
</li>
<li>
<p>Error handling needn&rsquo;t be very accurate. It&rsquo;s a demo after all.</p>
</li>
</ul>
<p>WARNING: If you go looking for REST API documentation, it will be hard to find something concrete and authoritative. Remember that REST is not a standard: instead, it&rsquo;s a collection of practices on how to design an API, and the way you actually implement them is no different than the way you implement other web services. That said, start with <a href=https://en.wikipedia.org/wiki/Representational_state_transfer>the Wikipedia article</a> and maybe even <a href=https://cloud.google.com/apis/design/>Google&rsquo;s API Design Guide</a>.</p>
<h1 id=task-management-api>Task management API</h1>
<p>The sample RESTful web services in this post implement a To-Do manager, of course. (That&rsquo;s not what I built as a prototype but it works better as an example.) The REST interface we will implement will let us manipulate a collection of tasks where each task contains a textual description and a bit to indicate whether it is done or not.</p>
<p>We will expose these methods:</p>
<ul>
<li><code>GET /task</code>: Gets a list of all tasks.
<ul>
<li><strong>Input:</strong> empty.</li>
<li><strong>Output:</strong> a map of task resource locators to a map of task definitions. The task definition is the same as returned by the <code>GET /task/{id}</code> described below.</li>
</ul>
</li>
<li><code>POST /task</code>: Creates a new note and returns the path to the created note. Given that task IDs are assigned internally, there is no <code>PUT /task/{id}</code> to create a new task with a specific ID.
<ul>
<li><strong>Input:</strong> empty.</li>
<li><strong>Output:</strong> a string with the task resource locator on success, or an error message on failure.</li>
</ul>
</li>
<li><code>GET /task/{id}</code>: Gets the given task.
<ul>
<li><strong>Input:</strong> empty.</li>
<li><strong>Output:</strong> a map with the following keys on success: <code>text</code> containing the description of the task as a string, and <code>done</code> representing whether the task is completed as a boolean; or an error message on failure.</li>
</ul>
</li>
<li><code>UPDATE /task/{id}</code>: Modifies fields of the given task.
<ul>
<li><strong>Input:</strong> a map with the following optional keys to represent the fields that need updating: <code>text</code> with the new description of the task as a string, and <code>done</code> with the new representation of the task&rsquo;s completion as a boolean.</li>
<li><strong>Output:</strong> empty on success, or an error message on failure.</li>
</ul>
</li>
<li><code>DELETE /task/{id}</code>: Deletes the given note.
<ul>
<li><strong>Input:</strong> empty.</li>
<li><strong>Output:</strong> empty on success, or an error message on failure.</li>
</ul>
</li>
</ul>
<h1 id=rust-version>Rust version</h1>
<p>In the Rust version, we&rsquo;ll use the <a href=https://github.com/tomaka/rouille>Rouille web micro-framework</a>. This is not the most advanced framework nor the fastest, but its simplicity lets us see the inner workings of the system. We&rsquo;ll also use the popular <a href=https://serde.rs/>Serde framework</a> for JSON (de)serialization. Put in a package manifest:</p>
<div class=src>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=p>[</span><span class=n>package</span><span class=p>]</span><span class=w>
</span><span class=w></span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;rest-api-rust&#34;</span><span class=w>
</span><span class=w></span><span class=n>version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;0.1.0&#34;</span><span class=w>
</span><span class=w></span><span class=n>edition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;2018&#34;</span><span class=w>
</span><span class=w></span><span class=n>publish</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=p>[</span><span class=n>dependencies</span><span class=p>]</span><span class=w>
</span><span class=w></span><span class=n>rouille</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;3.0.0&#34;</span><span class=w>
</span><span class=w></span><span class=n>serde</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;1.0&#34;</span><span class=p>,</span><span class=w> </span><span class=n>features</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s>&#34;derive&#34;</span><span class=p>]</span><span class=w> </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=n>serde_json</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;1.0&#34;</span><span class=w>
</span></code></pre></div>
<div class=footer>
<div class=filename>
<a href=/src/rest-api-rust/Cargo.toml type=text/plain>Cargo.toml</a>
</div>
</div>
</div>
<p>First off, let&rsquo;s start by looking into the business logic and data store:</p>
<div class=src>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>collections</span>::<span class=n>HashMap</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>result</span>::<span class=nb>Result</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=sd>/// Definition of a single task.
</span><span class=sd></span><span class=k>pub</span><span class=w> </span><span class=k>struct</span> <span class=nc>Task</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=sd>/// The description of the task.
</span><span class=sd></span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>text</span>: <span class=nb>String</span><span class=p>,</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=sd>/// Whether the task is complete or not.
</span><span class=sd></span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>done</span>: <span class=kt>bool</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=sd>/// Container of tasks.
</span><span class=sd>/// 
</span><span class=sd>/// Tasks are identified by an integer and each points to a separate `Task`
</span><span class=sd>/// object that describes that individual task.
</span><span class=sd>/// 
</span><span class=sd>/// The task manager is not thread-safe.
</span><span class=sd></span><span class=k>pub</span><span class=w> </span><span class=k>struct</span> <span class=nc>TaskManager</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>tasks</span>: <span class=nc>HashMap</span><span class=o>&lt;</span><span class=kt>usize</span><span class=p>,</span><span class=w> </span><span class=n>Task</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>next_id</span>: <span class=kt>usize</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>TaskManager</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=sd>/// Creates a new task manager with no tasks.
</span><span class=sd></span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>new</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=bp>Self</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>tasks</span>: <span class=nc>HashMap</span>::<span class=n>new</span><span class=p>(),</span><span class=w> </span><span class=n>next_id</span>: <span class=mi>0</span><span class=w> </span><span class=p>}</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=sd>/// Returns all tasks.
</span><span class=sd></span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>all</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=nc>HashMap</span><span class=o>&lt;</span><span class=kt>usize</span><span class=p>,</span><span class=w> </span><span class=n>Task</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=o>&amp;</span><span class=bp>self</span><span class=p>.</span><span class=n>tasks</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=sd>/// Adds a new undone task based on its textual description and returns
</span><span class=sd></span><span class=w>    </span><span class=sd>/// the identifier assigned to it.
</span><span class=sd></span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>add</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>text</span>: <span class=nb>String</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>usize</span> <span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>next_id</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Task</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>text</span>: <span class=nc>text</span><span class=p>,</span><span class=w> </span><span class=n>done</span>: <span class=nc>false</span><span class=w> </span><span class=p>};</span><span class=w>
</span><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>tasks</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>task</span><span class=p>).</span><span class=n>is_some</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=fm>panic!</span><span class=p>(</span><span class=s>&#34;Overwrote task; did next_id wrap?&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>        </span><span class=p>}</span><span class=w>
</span><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>next_id</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=n>id</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=sd>/// Returns the task corresponding to the identifier `id` or an error
</span><span class=sd></span><span class=w>    </span><span class=sd>/// message if not found.
</span><span class=sd></span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>get</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>id</span>: <span class=kt>usize</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;&amp;</span><span class=n>Task</span><span class=p>,</span><span class=w> </span><span class=o>&amp;&#39;</span><span class=nb>static</span><span class=w> </span><span class=kt>str</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>tasks</span><span class=p>.</span><span class=n>get</span><span class=p>(</span><span class=o>&amp;</span><span class=n>id</span><span class=p>).</span><span class=n>ok_or</span><span class=p>(</span><span class=s>&#34;No such task&#34;</span><span class=p>)</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=sd>/// Updates the task corresponding to the identifier `id` with a new
</span><span class=sd></span><span class=w>    </span><span class=sd>/// text and status.  If any parameter is set to `None`, the corresponding
</span><span class=sd></span><span class=w>    </span><span class=sd>/// field in the task is left unmodified.  Returns an error message if the
</span><span class=sd></span><span class=w>    </span><span class=sd>/// task is not found.
</span><span class=sd></span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>set</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>id</span>: <span class=kt>usize</span><span class=p>,</span><span class=w> </span><span class=n>text</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>done</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>)</span><span class=w>
</span><span class=w>        </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=p>(),</span><span class=w> </span><span class=o>&amp;&#39;</span><span class=nb>static</span><span class=w> </span><span class=kt>str</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>
</span><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>tasks</span><span class=p>.</span><span class=n>get_mut</span><span class=p>(</span><span class=o>&amp;</span><span class=n>id</span><span class=p>).</span><span class=n>map_or</span><span class=p>(</span><span class=w>
</span><span class=w>            </span><span class=nb>Err</span><span class=p>(</span><span class=s>&#34;No such task&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=o>|</span><span class=n>v</span><span class=o>|</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=kd>let</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>text</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>text</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>                    </span><span class=n>v</span><span class=p>.</span><span class=n>text</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>text</span><span class=p>;</span><span class=w>
</span><span class=w>                </span><span class=p>}</span><span class=w>
</span><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=kd>let</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>done</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>done</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>                    </span><span class=n>v</span><span class=p>.</span><span class=n>done</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>done</span><span class=p>;</span><span class=w>
</span><span class=w>                </span><span class=p>}</span><span class=w>
</span><span class=w>                </span><span class=nb>Ok</span><span class=p>(())</span><span class=w>
</span><span class=w>            </span><span class=p>})</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=sd>/// Deletes the task corresponding to the identifier `id` or an error
</span><span class=sd></span><span class=w>    </span><span class=sd>/// message if not found.
</span><span class=sd></span><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>delete</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>id</span>: <span class=kt>usize</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=p>(),</span><span class=w> </span><span class=o>&amp;&#39;</span><span class=nb>static</span><span class=w> </span><span class=kt>str</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>tasks</span><span class=p>.</span><span class=n>remove</span><span class=p>(</span><span class=o>&amp;</span><span class=n>id</span><span class=p>).</span><span class=n>map_or</span><span class=p>(</span><span class=nb>Err</span><span class=p>(</span><span class=s>&#34;No such task&#34;</span><span class=p>),</span><span class=w> </span><span class=o>|</span><span class=n>_</span><span class=o>|</span><span class=w> </span><span class=nb>Ok</span><span class=p>(()))</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div>
<div class=footer>
<div class=filename>
<a href=/src/rest-api-rust/src/lib.rs type=text/plain>src/lib.rs</a>
</div>
</div>
</div>
<p>The <code>TaskManager</code> is the in-memory container for all the tasks we want to manage. Note that nothing in this type knows about our public-facing API: in particular, there is absolutely no (de)serialization code in here. All methods in this structure deal with primitive data types. This is intentional to ensure changes to the backend do not intentionally cause subtle differences in the publicly exposed API, and to enforce this restriction, the code lives in a separate file to tightly control the dependencies it pulls in.</p>
<p>Notably, the <code>Task</code> type is <em>not</em> serializable. It is extremely tempting to make it so because it would be very convenient later on, but past experience says that this is a bad idea. It&rsquo;s too easy for internal data types to evolve fields that are only necessary inside the server and should never be visible outside, but coupling them with the public data type makes this hard to enforce. And before you realize it, your public API is poisoned with fields that were never meant to exist and cleaning them up is a gargantuan effort. So. Refrain from this temptation unless you must give in due to justified performance reasons.</p>
<p>With the backend defined, let&rsquo;s look at the web server:</p>
<div class=src>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=k>extern</span><span class=w> </span><span class=k>crate</span><span class=w> </span><span class=n>rest_api_rust</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=k>extern</span><span class=w> </span><span class=k>crate</span><span class=w> </span><span class=n>serde</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=cp>#[macro_use]</span><span class=w> </span><span class=k>extern</span><span class=w> </span><span class=k>crate</span><span class=w> </span><span class=n>rouille</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>rest_api_rust</span>::<span class=p>{</span><span class=n>Task</span><span class=p>,</span><span class=w> </span><span class=n>TaskManager</span><span class=p>};</span><span class=w>
</span><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>serde</span>::<span class=p>{</span><span class=n>Deserialize</span><span class=p>,</span><span class=w> </span><span class=n>Serialize</span><span class=p>};</span><span class=w>
</span><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>collections</span>::<span class=n>HashMap</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>sync</span>::<span class=n>Mutex</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=sd>/// External representation of a single task.
</span><span class=sd></span><span class=cp>#[derive(Serialize)]</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>GetTaskResponse</span><span class=o>&lt;&#39;</span><span class=na>a</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>text</span>: <span class=kp>&amp;</span><span class=o>&#39;</span><span class=na>a</span> <span class=kt>str</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>done</span>: <span class=kt>bool</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>impl</span><span class=o>&lt;&#39;</span><span class=na>a</span><span class=o>&gt;</span><span class=w> </span><span class=n>GetTaskResponse</span><span class=o>&lt;&#39;</span><span class=na>a</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=sd>/// Constructs a new external version of a task given a task&#39;s definition.
</span><span class=sd></span><span class=w>    </span><span class=k>fn</span> <span class=nf>from</span><span class=p>(</span><span class=n>t</span>: <span class=kp>&amp;</span><span class=o>&#39;</span><span class=na>a</span> <span class=nc>Task</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=bp>Self</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>text</span>: <span class=kp>&amp;</span><span class=nc>t</span><span class=p>.</span><span class=n>text</span><span class=p>,</span><span class=w> </span><span class=n>done</span>: <span class=nc>t</span><span class=p>.</span><span class=n>done</span><span class=w> </span><span class=p>}</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=sd>/// Representation of a request to update zero or more fields of a task.
</span><span class=sd></span><span class=cp>#[derive(Deserialize)]</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>UpdateTaskRequest</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>text</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>done</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=sd>/// Processes REST requests for the task manager API and transforms them into
</span><span class=sd>/// operations against the given backing `task_manager`.
</span><span class=sd></span><span class=k>fn</span> <span class=nf>route_request</span><span class=p>(</span><span class=n>request</span>: <span class=kp>&amp;</span><span class=nc>rouille</span>::<span class=n>Request</span><span class=p>,</span><span class=w> </span><span class=n>task_manager</span>: <span class=kp>&amp;</span><span class=nc>Mutex</span><span class=o>&lt;</span><span class=n>TaskManager</span><span class=o>&gt;</span><span class=p>)</span><span class=w>
</span><span class=w>    </span>-&gt; <span class=nc>rouille</span>::<span class=n>Response</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>task_manager</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task_manager</span><span class=p>.</span><span class=n>lock</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>router</span><span class=o>!</span><span class=p>(</span><span class=n>request</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=p>(</span><span class=n>GET</span><span class=p>)</span><span class=w> </span><span class=p>[</span><span class=s>&#34;/task&#34;</span><span class=p>]</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HashMap</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>task</span><span class=p>)</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>task_manager</span><span class=p>.</span><span class=n>all</span><span class=p>().</span><span class=n>iter</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>                </span><span class=kd>let</span><span class=w> </span><span class=n>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=fm>format!</span><span class=p>(</span><span class=s>&#34;/task/{}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span><span class=w>                </span><span class=n>response</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=n>path</span><span class=p>,</span><span class=w> </span><span class=n>GetTaskResponse</span>::<span class=n>from</span><span class=p>(</span><span class=n>task</span><span class=p>));</span><span class=w>
</span><span class=w>            </span><span class=p>}</span><span class=w>
</span><span class=w>            </span><span class=n>rouille</span>::<span class=n>Response</span>::<span class=n>json</span><span class=p>(</span><span class=o>&amp;</span><span class=n>response</span><span class=p>)</span><span class=w>
</span><span class=w>        </span><span class=p>},</span><span class=w>
</span><span class=w>
</span><span class=w>        </span><span class=p>(</span><span class=n>POST</span><span class=p>)</span><span class=w> </span><span class=p>[</span><span class=s>&#34;/task&#34;</span><span class=p>]</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>body</span>: <span class=nb>String</span> <span class=o>=</span><span class=w>
</span><span class=w>                </span><span class=n>try_or_400</span><span class=o>!</span><span class=p>(</span><span class=n>rouille</span>::<span class=n>input</span>::<span class=n>json_input</span><span class=p>(</span><span class=n>request</span><span class=p>));</span><span class=w>
</span><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task_manager</span><span class=p>.</span><span class=n>add</span><span class=p>(</span><span class=n>body</span><span class=p>);</span><span class=w>
</span><span class=w>            </span><span class=n>rouille</span>::<span class=n>Response</span>::<span class=n>json</span><span class=p>(</span><span class=o>&amp;</span><span class=fm>format!</span><span class=p>(</span><span class=s>&#34;/task/{}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>))</span><span class=w>
</span><span class=w>        </span><span class=p>},</span><span class=w>
</span><span class=w>
</span><span class=w>        </span><span class=p>(</span><span class=n>GET</span><span class=p>)</span><span class=w> </span><span class=p>[</span><span class=s>&#34;/task/{id}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>id</span>: <span class=kt>usize</span><span class=p>]</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=k>match</span><span class=w> </span><span class=n>task_manager</span><span class=p>.</span><span class=n>get</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>                </span><span class=nb>Ok</span><span class=p>(</span><span class=n>task</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w>
</span><span class=w>                    </span><span class=n>rouille</span>::<span class=n>Response</span>::<span class=n>json</span><span class=p>(</span><span class=o>&amp;</span><span class=n>GetTaskResponse</span>::<span class=n>from</span><span class=p>(</span><span class=n>task</span><span class=p>)),</span><span class=w>
</span><span class=w>                </span><span class=nb>Err</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>rouille</span>::<span class=n>Response</span>::<span class=n>json</span><span class=p>(</span><span class=o>&amp;</span><span class=n>e</span><span class=p>).</span><span class=n>with_status_code</span><span class=p>(</span><span class=mi>404</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=p>}</span><span class=w>
</span><span class=w>        </span><span class=p>},</span><span class=w>
</span><span class=w>
</span><span class=w>        </span><span class=p>(</span><span class=n>UPDATE</span><span class=p>)</span><span class=w> </span><span class=p>[</span><span class=s>&#34;/task/{id}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>id</span>: <span class=kt>usize</span><span class=p>]</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>body</span>: <span class=nc>UpdateTaskRequest</span><span class=w> </span><span class=o>=</span><span class=w>
</span><span class=w>                </span><span class=n>try_or_400</span><span class=o>!</span><span class=p>(</span><span class=n>rouille</span>::<span class=n>input</span>::<span class=n>json_input</span><span class=p>(</span><span class=n>request</span><span class=p>));</span><span class=w>
</span><span class=w>            </span><span class=k>match</span><span class=w> </span><span class=n>task_manager</span><span class=p>.</span><span class=n>set</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>body</span><span class=p>.</span><span class=n>text</span><span class=p>,</span><span class=w> </span><span class=n>body</span><span class=p>.</span><span class=n>done</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>                </span><span class=nb>Ok</span><span class=p>(())</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>rouille</span>::<span class=n>Response</span>::<span class=n>empty_204</span><span class=p>(),</span><span class=w>
</span><span class=w>                </span><span class=nb>Err</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>rouille</span>::<span class=n>Response</span>::<span class=n>json</span><span class=p>(</span><span class=o>&amp;</span><span class=n>e</span><span class=p>).</span><span class=n>with_status_code</span><span class=p>(</span><span class=mi>404</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=p>}</span><span class=w>
</span><span class=w>        </span><span class=p>},</span><span class=w>
</span><span class=w>
</span><span class=w>        </span><span class=p>(</span><span class=n>DELETE</span><span class=p>)</span><span class=w> </span><span class=p>[</span><span class=s>&#34;/task/{id}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>id</span>: <span class=kt>usize</span><span class=p>]</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=k>match</span><span class=w> </span><span class=n>task_manager</span><span class=p>.</span><span class=n>delete</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>                </span><span class=nb>Ok</span><span class=p>(())</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>rouille</span>::<span class=n>Response</span>::<span class=n>empty_204</span><span class=p>(),</span><span class=w>
</span><span class=w>                </span><span class=nb>Err</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>rouille</span>::<span class=n>Response</span>::<span class=n>json</span><span class=p>(</span><span class=o>&amp;</span><span class=n>e</span><span class=p>).</span><span class=n>with_status_code</span><span class=p>(</span><span class=mi>404</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=p>}</span><span class=w>
</span><span class=w>        </span><span class=p>},</span><span class=w>
</span><span class=w>
</span><span class=w>        </span><span class=n>_</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>rouille</span>::<span class=n>Response</span>::<span class=n>empty_404</span><span class=p>()</span><span class=w>
</span><span class=w>    </span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>task_manager</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Mutex</span>::<span class=n>from</span><span class=p>(</span><span class=n>TaskManager</span>::<span class=n>new</span><span class=p>());</span><span class=w>
</span><span class=w>    </span><span class=n>rouille</span>::<span class=n>start_server</span><span class=p>(</span><span class=w>
</span><span class=w>        </span><span class=s>&#34;localhost:1234&#34;</span><span class=p>,</span><span class=w> </span><span class=k>move</span><span class=w> </span><span class=o>|</span><span class=n>request</span><span class=o>|</span><span class=w> </span><span class=n>route_request</span><span class=p>(</span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>task_manager</span><span class=p>))</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div>
<div class=footer>
<div class=filename>
<a href=/src/rest-api-rust/src/main.rs type=text/plain>src/main.rs</a>
</div>
</div>
</div>
<p>The web server layer is where we define exactly what URLs we expose to the world, what messages they accept, what messages they return, and what error conditions they react to. Here is where we map internal data structures to public JSON data structures. There is no business logic here.</p>
<h1 id=go-version>Go version</h1>
<p>In the Go version, we&rsquo;ll use the <a href=https://github.com/gorilla/mux>gorilla/mux</a> HTTP router and URL matcher for simplicity. We could roll our own URL method handling pretty easily, but the code is already verbose enough as it is, and doing this kind of parsing by hand is fragile and boring. So the modules definition:</p>
<div class=src>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=nx>module</span> <span class=nx>rest</span><span class=o>-</span><span class=nx>api</span><span class=o>-</span><span class=k>go</span>

<span class=k>go</span> <span class=mf>1.12</span>

<span class=nx>require</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>gorilla</span><span class=o>/</span><span class=nx>mux</span> <span class=nx>v1</span><span class=mf>.7.3</span>
</code></pre></div>
<div class=footer>
<div class=filename>
<a href=/src/rest-api-go/go.mod type=text/plain>go.mod</a>
</div>
</div>
</div>
<p>Similarly to the Rust version, the business logic lives in a separate module to ensure it remains completely agnostic to the external world. And in that same spirit, note that none of the code here contains JSON annotations:</p>
<div class=src>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=n>package</span><span class=w> </span><span class=n>tasks</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=n>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span><span class=w>	</span><span class=s>&#34;fmt&#34;</span><span class=w>
</span><span class=w></span><span class=p>)</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c1>// Task represents a single task.
</span><span class=c1></span><span class=k>type</span> <span class=nc>Task</span><span class=w> </span><span class=k>struct</span> <span class=p>{</span><span class=w>
</span><span class=w>	</span><span class=c1>// Text contains the description of the task.
</span><span class=c1></span><span class=w>	</span><span class=n>Text</span><span class=w> </span><span class=n>string</span><span class=w>
</span><span class=w>
</span><span class=w>	</span><span class=c1>// Done contains whether the task is complete or not.
</span><span class=c1></span><span class=w>	</span><span class=n>Done</span><span class=w> </span><span class=kt>bool</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c1>// TaskManager implements a container of tasks.
</span><span class=c1>//
</span><span class=c1>// Tasks are identified by an integer and each points to a separate Tas
</span><span class=c1>// object that describes the individual task.
</span><span class=c1></span><span class=k>type</span> <span class=nc>TaskManager</span><span class=w> </span><span class=k>struct</span> <span class=p>{</span><span class=w>
</span><span class=w>	</span><span class=n>nextID</span><span class=w> </span><span class=n>uint32</span><span class=w>
</span><span class=w>	</span><span class=n>tasks</span><span class=w>  </span><span class=n>map</span><span class=p>[</span><span class=n>uint32</span><span class=p>]</span><span class=n>Task</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c1>// NewTaskManager creates a new task manager with no tasks.
</span><span class=c1></span><span class=n>func</span><span class=w> </span><span class=n>NewTaskManager</span><span class=p>()</span><span class=w> </span><span class=n>TaskManager</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=n>TaskManager</span><span class=p>{</span><span class=n>nextID</span>: <span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>tasks</span>: <span class=nc>make</span><span class=p>(</span><span class=n>map</span><span class=p>[</span><span class=n>uint32</span><span class=p>]</span><span class=n>Task</span><span class=p>)}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c1>// All returns all tasks.
</span><span class=c1></span><span class=n>func</span><span class=w> </span><span class=p>(</span><span class=n>tm</span><span class=w> </span><span class=o>*</span><span class=n>TaskManager</span><span class=p>)</span><span class=w> </span><span class=n>All</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=n>map</span><span class=p>[</span><span class=n>uint32</span><span class=p>]</span><span class=n>Task</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=n>tm</span><span class=p>.</span><span class=n>tasks</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c1>// Add adds a new undone task based on its textual representation and returns
</span><span class=c1>// the identifier assigned to it.
</span><span class=c1></span><span class=n>func</span><span class=w> </span><span class=p>(</span><span class=n>tm</span><span class=w> </span><span class=o>*</span><span class=n>TaskManager</span><span class=p>)</span><span class=w> </span><span class=n>Add</span><span class=p>(</span><span class=n>text</span><span class=w> </span><span class=n>string</span><span class=p>)</span><span class=w> </span><span class=n>uint32</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>	</span><span class=n>id</span><span class=w> </span>:<span class=o>=</span><span class=w> </span><span class=n>tm</span><span class=p>.</span><span class=n>nextID</span><span class=w>
</span><span class=w>	</span><span class=n>tm</span><span class=p>.</span><span class=n>tasks</span><span class=p>[</span><span class=n>id</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Task</span><span class=p>{</span><span class=n>Text</span>: <span class=nc>text</span><span class=p>,</span><span class=w> </span><span class=n>Done</span>: <span class=nc>false</span><span class=p>}</span><span class=w>
</span><span class=w>	</span><span class=n>tm</span><span class=p>.</span><span class=n>nextID</span><span class=o>++</span><span class=w>
</span><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=n>id</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c1>// Get returns the task corresponding to the given identifier or an error
</span><span class=c1>// if not found.
</span><span class=c1></span><span class=n>func</span><span class=w> </span><span class=p>(</span><span class=n>tm</span><span class=w> </span><span class=o>*</span><span class=n>TaskManager</span><span class=p>)</span><span class=w> </span><span class=n>Get</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=n>uint32</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>Task</span><span class=p>,</span><span class=w> </span><span class=n>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>	</span><span class=n>task</span><span class=p>,</span><span class=w> </span><span class=n>ok</span><span class=w> </span>:<span class=o>=</span><span class=w> </span><span class=n>tm</span><span class=p>.</span><span class=n>tasks</span><span class=p>[</span><span class=n>id</span><span class=p>]</span><span class=w>
</span><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=o>!</span><span class=n>ok</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=n>Task</span><span class=p>{},</span><span class=w> </span><span class=n>fmt</span><span class=p>.</span><span class=n>Errorf</span><span class=p>(</span><span class=s>&#34;no such task&#34;</span><span class=p>)</span><span class=w>
</span><span class=w>	</span><span class=p>}</span><span class=w>
</span><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=n>task</span><span class=p>,</span><span class=w> </span><span class=n>nil</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c1>// Set updates the task corresponding to the given identifier with a new
</span><span class=c1>// text and status.  If any parameter is nil, the corresponding field in the
</span><span class=c1>// task is left unmodified.  Returns an error if the task is not found.
</span><span class=c1></span><span class=n>func</span><span class=w> </span><span class=p>(</span><span class=n>tm</span><span class=w> </span><span class=o>*</span><span class=n>TaskManager</span><span class=p>)</span><span class=w> </span><span class=n>Set</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=n>uint32</span><span class=p>,</span><span class=w> </span><span class=n>text</span><span class=w> </span><span class=o>*</span><span class=n>string</span><span class=p>,</span><span class=w> </span><span class=n>done</span><span class=w> </span><span class=o>*</span><span class=kt>bool</span><span class=p>)</span><span class=w> </span><span class=n>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>	</span><span class=n>task</span><span class=p>,</span><span class=w> </span><span class=n>ok</span><span class=w> </span>:<span class=o>=</span><span class=w> </span><span class=n>tm</span><span class=p>.</span><span class=n>tasks</span><span class=p>[</span><span class=n>id</span><span class=p>]</span><span class=w>
</span><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=o>!</span><span class=n>ok</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=n>fmt</span><span class=p>.</span><span class=n>Errorf</span><span class=p>(</span><span class=s>&#34;no such task&#34;</span><span class=p>)</span><span class=w>
</span><span class=w>	</span><span class=p>}</span><span class=w>
</span><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=n>text</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>		</span><span class=n>task</span><span class=p>.</span><span class=n>Text</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>*</span><span class=n>text</span><span class=w>
</span><span class=w>	</span><span class=p>}</span><span class=w>
</span><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=n>done</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>		</span><span class=n>task</span><span class=p>.</span><span class=n>Done</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>*</span><span class=n>done</span><span class=w>
</span><span class=w>	</span><span class=p>}</span><span class=w>
</span><span class=w>	</span><span class=n>tm</span><span class=p>.</span><span class=n>tasks</span><span class=p>[</span><span class=n>id</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task</span><span class=w>
</span><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=n>nil</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c1>// Delete deletes the task corresponding to the given identifier or an error
</span><span class=c1>// if not found.
</span><span class=c1></span><span class=n>func</span><span class=w> </span><span class=p>(</span><span class=n>tm</span><span class=w> </span><span class=o>*</span><span class=n>TaskManager</span><span class=p>)</span><span class=w> </span><span class=n>Delete</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=n>uint32</span><span class=p>)</span><span class=w> </span><span class=n>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>	</span><span class=n>_</span><span class=p>,</span><span class=w> </span><span class=n>ok</span><span class=w> </span>:<span class=o>=</span><span class=w> </span><span class=n>tm</span><span class=p>.</span><span class=n>tasks</span><span class=p>[</span><span class=n>id</span><span class=p>]</span><span class=w>
</span><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=o>!</span><span class=n>ok</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=n>fmt</span><span class=p>.</span><span class=n>Errorf</span><span class=p>(</span><span class=s>&#34;no such task&#34;</span><span class=p>)</span><span class=w>
</span><span class=w>	</span><span class=p>}</span><span class=w>
</span><span class=w>	</span><span class=n>delete</span><span class=p>(</span><span class=n>tm</span><span class=p>.</span><span class=n>tasks</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w>
</span><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=n>nil</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div>
<div class=footer>
<div class=filename>
<a href=/src/rest-api-go/tasks/tasks.go type=text/plain>tasks/tasks.go</a>
</div>
</div>
</div>
<p>With the backend defined, and with the same logic behind the Rust version, here comes the web server:</p>
<div class=src>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>main</span>

<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;encoding/json&#34;</span>
	<span class=s>&#34;fmt&#34;</span>
	<span class=s>&#34;log&#34;</span>
	<span class=s>&#34;net/http&#34;</span>
	<span class=s>&#34;strconv&#34;</span>
	<span class=s>&#34;sync&#34;</span>

	<span class=s>&#34;rest-api-go/tasks&#34;</span>

	<span class=s>&#34;github.com/gorilla/mux&#34;</span>
<span class=p>)</span>

<span class=c1>// getTaskResponse represents a task as a serializable JSON object.
</span><span class=c1></span><span class=kd>type</span> <span class=nx>getTaskResponse</span> <span class=kd>struct</span> <span class=p>{</span>
	<span class=nx>Text</span> <span class=kt>string</span> <span class=s>`json:&#34;text&#34;`</span>
	<span class=nx>Done</span> <span class=kt>bool</span>   <span class=s>`json:&#34;done&#34;`</span>
<span class=p>}</span>

<span class=c1>// newGetTaskResponse constructs a new external version of a task given a
</span><span class=c1>// task&#39;s definition.
</span><span class=c1></span><span class=kd>func</span> <span class=nf>newGetTaskResponse</span><span class=p>(</span><span class=nx>t</span> <span class=nx>tasks</span><span class=p>.</span><span class=nx>Task</span><span class=p>)</span> <span class=nx>getTaskResponse</span> <span class=p>{</span>
	<span class=k>return</span> <span class=nx>getTaskResponse</span><span class=p>{</span><span class=nx>Text</span><span class=p>:</span> <span class=nx>t</span><span class=p>.</span><span class=nx>Text</span><span class=p>,</span> <span class=nx>Done</span><span class=p>:</span> <span class=nx>t</span><span class=p>.</span><span class=nx>Done</span><span class=p>}</span>
<span class=p>}</span>

<span class=c1>// updateTaskRequest represents a request to update zero or more fields of
</span><span class=c1>// a task.
</span><span class=c1></span><span class=kd>type</span> <span class=nx>updateTaskRequest</span> <span class=kd>struct</span> <span class=p>{</span>
	<span class=nx>Text</span> <span class=o>*</span><span class=kt>string</span> <span class=s>`json:&#34;text,omitempty&#34;`</span>
	<span class=nx>Done</span> <span class=o>*</span><span class=kt>bool</span>   <span class=s>`json:&#34;done,omitempty&#34;`</span>
<span class=p>}</span>

<span class=c1>// getUint32 gets a variable from a request as an uint32 and returns an
</span><span class=c1>// error if the string value cannot be converted.
</span><span class=c1></span><span class=kd>func</span> <span class=nf>getUint32</span><span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>,</span> <span class=nx>field</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=kt>uint32</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>vars</span> <span class=o>:=</span> <span class=nx>mux</span><span class=p>.</span><span class=nf>Vars</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
	<span class=nx>value</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>vars</span><span class=p>[</span><span class=nx>field</span><span class=p>]</span>
	<span class=k>if</span> <span class=p>!</span><span class=nx>ok</span> <span class=p>{</span>
		<span class=nb>panic</span><span class=p>(</span><span class=s>&#34;Invalid variable identifier&#34;</span><span class=p>)</span>
	<span class=p>}</span>
	<span class=nx>value64</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>ParseUint</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>32</span><span class=p>)</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=k>return</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;invalid task identifier %s: %v&#34;</span><span class=p>,</span> <span class=nx>value</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
	<span class=p>}</span>
	<span class=k>return</span> <span class=nb>uint32</span><span class=p>(</span><span class=nx>value64</span><span class=p>),</span> <span class=kc>nil</span>
<span class=p>}</span>

<span class=c1>// handler is a convenience wrapper to implement the body of an HTTP handler.
</span><span class=c1>// Takes care of ensuring the backing task manager is locked via the mu mutex,
</span><span class=c1>// constructs a JSON decoder and encoder to handle the request and the response,
</span><span class=c1>// and if the handler returns an error, responds to the HTTP request with the
</span><span class=c1>// details.
</span><span class=c1></span><span class=kd>func</span> <span class=nf>handler</span><span class=p>(</span><span class=nx>mu</span> <span class=o>*</span><span class=nx>sync</span><span class=p>.</span><span class=nx>Mutex</span><span class=p>,</span> <span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>,</span>
	<span class=nx>f</span> <span class=kd>func</span><span class=p>(</span><span class=nx>encoder</span> <span class=o>*</span><span class=nx>json</span><span class=p>.</span><span class=nx>Encoder</span><span class=p>,</span> <span class=nx>decoder</span> <span class=o>*</span><span class=nx>json</span><span class=p>.</span><span class=nx>Decoder</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>error</span><span class=p>))</span> <span class=p>{</span>

	<span class=nx>mu</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
	<span class=k>defer</span> <span class=nx>mu</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
	<span class=nx>encoder</span> <span class=o>:=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>NewEncoder</span><span class=p>(</span><span class=nx>w</span><span class=p>)</span>
	<span class=nx>decoder</span> <span class=o>:=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>NewDecoder</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>Body</span><span class=p>)</span>
	<span class=nx>code</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>f</span><span class=p>(</span><span class=nx>encoder</span><span class=p>,</span> <span class=nx>decoder</span><span class=p>)</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=nx>code</span><span class=p>)</span>
		<span class=nx>encoder</span><span class=p>.</span><span class=nf>Encode</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
	<span class=p>}</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
	<span class=nx>mu</span> <span class=o>:=</span> <span class=nx>sync</span><span class=p>.</span><span class=nx>Mutex</span><span class=p>{}</span>
	<span class=nx>tm</span> <span class=o>:=</span> <span class=nx>tasks</span><span class=p>.</span><span class=nf>NewTaskManager</span><span class=p>()</span>

	<span class=nx>router</span> <span class=o>:=</span> <span class=nx>mux</span><span class=p>.</span><span class=nf>NewRouter</span><span class=p>()</span>

	<span class=nx>router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/task&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
		<span class=nf>handler</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>mu</span><span class=p>,</span> <span class=nx>w</span><span class=p>,</span> <span class=nx>r</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>encoder</span> <span class=o>*</span><span class=nx>json</span><span class=p>.</span><span class=nx>Encoder</span><span class=p>,</span> <span class=nx>decoder</span> <span class=o>*</span><span class=nx>json</span><span class=p>.</span><span class=nx>Decoder</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
			<span class=nx>response</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=nx>getTaskResponse</span><span class=p>)</span>
			<span class=k>for</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>task</span> <span class=o>:=</span> <span class=k>range</span> <span class=o>*</span><span class=nx>tm</span><span class=p>.</span><span class=nf>All</span><span class=p>()</span> <span class=p>{</span>
				<span class=nx>path</span> <span class=o>:=</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;/task/%d&#34;</span><span class=p>,</span> <span class=nx>id</span><span class=p>)</span>
				<span class=nx>response</span><span class=p>[</span><span class=nx>path</span><span class=p>]</span> <span class=p>=</span> <span class=nf>newGetTaskResponse</span><span class=p>(</span><span class=nx>task</span><span class=p>)</span>
			<span class=p>}</span>
			<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>encoder</span><span class=p>.</span><span class=nf>Encode</span><span class=p>(</span><span class=nx>response</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
				<span class=k>return</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span> <span class=nx>err</span>
			<span class=p>}</span>
			<span class=k>return</span> <span class=mi>0</span><span class=p>,</span> <span class=kc>nil</span>
		<span class=p>})</span>
	<span class=p>}).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;GET&#34;</span><span class=p>)</span>

	<span class=nx>router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/task&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
		<span class=nf>handler</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>mu</span><span class=p>,</span> <span class=nx>w</span><span class=p>,</span> <span class=nx>r</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>encoder</span> <span class=o>*</span><span class=nx>json</span><span class=p>.</span><span class=nx>Encoder</span><span class=p>,</span> <span class=nx>decoder</span> <span class=o>*</span><span class=nx>json</span><span class=p>.</span><span class=nx>Decoder</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
			<span class=nx>text</span> <span class=o>:=</span> <span class=s>&#34;&#34;</span>
			<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>decoder</span><span class=p>.</span><span class=nf>Decode</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>text</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
				<span class=k>return</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span> <span class=nx>err</span>
			<span class=p>}</span>
			<span class=nx>id</span> <span class=o>:=</span> <span class=nx>tm</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=nx>text</span><span class=p>)</span>
			<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>encoder</span><span class=p>.</span><span class=nf>Encode</span><span class=p>(</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;/task/%d&#34;</span><span class=p>,</span> <span class=nx>id</span><span class=p>));</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
				<span class=k>return</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span> <span class=nx>err</span>
			<span class=p>}</span>
			<span class=k>return</span> <span class=mi>0</span><span class=p>,</span> <span class=kc>nil</span>
		<span class=p>})</span>
	<span class=p>}).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;POST&#34;</span><span class=p>)</span>

	<span class=nx>router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/task/{id}&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
		<span class=nf>handler</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>mu</span><span class=p>,</span> <span class=nx>w</span><span class=p>,</span> <span class=nx>r</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>encoder</span> <span class=o>*</span><span class=nx>json</span><span class=p>.</span><span class=nx>Encoder</span><span class=p>,</span> <span class=nx>decoder</span> <span class=o>*</span><span class=nx>json</span><span class=p>.</span><span class=nx>Decoder</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
			<span class=nx>id</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>getUint32</span><span class=p>(</span><span class=nx>r</span><span class=p>,</span> <span class=s>&#34;id&#34;</span><span class=p>)</span>
			<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
				<span class=k>return</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>,</span> <span class=nx>err</span>
			<span class=p>}</span>
			<span class=nx>task</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>tm</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span>
			<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
				<span class=k>return</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusNotFound</span><span class=p>,</span> <span class=nx>err</span>
			<span class=p>}</span>
			<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>encoder</span><span class=p>.</span><span class=nf>Encode</span><span class=p>(</span><span class=nf>newGetTaskResponse</span><span class=p>(</span><span class=nx>task</span><span class=p>));</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
				<span class=k>return</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span> <span class=nx>err</span>
			<span class=p>}</span>
			<span class=k>return</span> <span class=mi>0</span><span class=p>,</span> <span class=kc>nil</span>
		<span class=p>})</span>
	<span class=p>}).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;GET&#34;</span><span class=p>)</span>

	<span class=nx>router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/task/{id}&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
		<span class=nf>handler</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>mu</span><span class=p>,</span> <span class=nx>w</span><span class=p>,</span> <span class=nx>r</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>encoder</span> <span class=o>*</span><span class=nx>json</span><span class=p>.</span><span class=nx>Encoder</span><span class=p>,</span> <span class=nx>decoder</span> <span class=o>*</span><span class=nx>json</span><span class=p>.</span><span class=nx>Decoder</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
			<span class=nx>id</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>getUint32</span><span class=p>(</span><span class=nx>r</span><span class=p>,</span> <span class=s>&#34;id&#34;</span><span class=p>)</span>
			<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
				<span class=k>return</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>,</span> <span class=nx>err</span>
			<span class=p>}</span>
			<span class=nx>update</span> <span class=o>:=</span> <span class=nx>updateTaskRequest</span><span class=p>{}</span>
			<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>decoder</span><span class=p>.</span><span class=nf>Decode</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>update</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
				<span class=k>return</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span> <span class=nx>err</span>
			<span class=p>}</span>
			<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>tm</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=nx>id</span><span class=p>,</span> <span class=nx>update</span><span class=p>.</span><span class=nx>Text</span><span class=p>,</span> <span class=nx>update</span><span class=p>.</span><span class=nx>Done</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
				<span class=k>return</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusNotFound</span><span class=p>,</span> <span class=nx>err</span>
			<span class=p>}</span>
			<span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusNoContent</span><span class=p>)</span>
			<span class=k>return</span> <span class=mi>0</span><span class=p>,</span> <span class=kc>nil</span>
		<span class=p>})</span>
	<span class=p>}).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;UPDATE&#34;</span><span class=p>)</span>

	<span class=nx>router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/task/{id}&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
		<span class=nf>handler</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>mu</span><span class=p>,</span> <span class=nx>w</span><span class=p>,</span> <span class=nx>r</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>encoder</span> <span class=o>*</span><span class=nx>json</span><span class=p>.</span><span class=nx>Encoder</span><span class=p>,</span> <span class=nx>decoder</span> <span class=o>*</span><span class=nx>json</span><span class=p>.</span><span class=nx>Decoder</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
			<span class=nx>id</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>getUint32</span><span class=p>(</span><span class=nx>r</span><span class=p>,</span> <span class=s>&#34;id&#34;</span><span class=p>)</span>
			<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
				<span class=k>return</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>,</span> <span class=nx>err</span>
			<span class=p>}</span>
			<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>tm</span><span class=p>.</span><span class=nf>Delete</span><span class=p>(</span><span class=nx>id</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
				<span class=k>return</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusNotFound</span><span class=p>,</span> <span class=nx>err</span>
			<span class=p>}</span>
			<span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusNoContent</span><span class=p>)</span>
			<span class=k>return</span> <span class=mi>0</span><span class=p>,</span> <span class=kc>nil</span>
		<span class=p>})</span>
	<span class=p>}).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;DELETE&#34;</span><span class=p>)</span>

	<span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>ListenAndServe</span><span class=p>(</span><span class=s>&#34;localhost:1234&#34;</span><span class=p>,</span> <span class=nx>router</span><span class=p>))</span>
<span class=p>}</span>
</code></pre></div>
<div class=footer>
<div class=filename>
<a href=/src/rest-api-go/server.go type=text/plain>server.go</a>
</div>
</div>
</div>
<h1 id=testing-the-apis>Testing the APIs</h1>
<p>All done. You can copy/paste the files above, build them, and test our shiny-new server using the <code>curl</code> command line tool. Because JSON is all text, it&rsquo;s easy to hand-craft the requests and to read the responses. You can also use some of these fancier clients that exist for Firefox or Chrome, but no need to.</p>
<p>Let&rsquo;s start by creating a bunch of tasks:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ curl -X POST -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;&#34;Publish REST post&#34;&#39;</span> http://localhost:1234/task
<span class=s2>&#34;/task/0&#34;</span>
$ curl -X POST -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;&#34;Pay rent&#34;&#39;</span> http://localhost:1234/task
<span class=s2>&#34;/task/1&#34;</span>
$ curl -X POST -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;&#34;Implement web interface&#34;&#39;</span> http://localhost:1234/task
<span class=s2>&#34;/task/2&#34;</span>
</code></pre></div><p>The server now knows about them, of course:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ curl -X GET http://localhost:1234/task
<span class=o>{</span><span class=s2>&#34;/task/0&#34;</span>:<span class=o>{</span><span class=s2>&#34;text&#34;</span>:<span class=s2>&#34;Publish REST post&#34;</span>,<span class=s2>&#34;done&#34;</span>:false<span class=o>}</span>,<span class=s2>&#34;/task/1&#34;</span>:<span class=o>{</span><span class=s2>&#34;text&#34;</span>:<span class=s2>&#34;Pay rent&#34;</span>,<span class=s2>&#34;done&#34;</span>:false<span class=o>}</span>,<span class=s2>&#34;/task/2&#34;</span>:<span class=o>{</span><span class=s2>&#34;text&#34;</span>:<span class=s2>&#34;Implement web interface&#34;</span>,<span class=s2>&#34;done&#34;</span>:false<span class=o>}}</span>
</code></pre></div><p>And as I&rsquo;m done with this post, let&rsquo;s mark its task as done:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ curl -X UPDATE -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;done&#34;: true}&#39;</span> http://localhost:1234/task/0
</code></pre></div><p>Which, as expected, will update the state of that note:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ curl -X GET http://localhost:1234/task
<span class=o>{</span><span class=s2>&#34;/task/0&#34;</span>:<span class=o>{</span><span class=s2>&#34;text&#34;</span>:<span class=s2>&#34;Publish REST post&#34;</span>,<span class=s2>&#34;done&#34;</span>:true<span class=o>}</span>,<span class=s2>&#34;/task/1&#34;</span>:<span class=o>{</span><span class=s2>&#34;text&#34;</span>:<span class=s2>&#34;Pay rent&#34;</span>,<span class=s2>&#34;done&#34;</span>:false<span class=o>}</span>,<span class=s2>&#34;/task/2&#34;</span>:<span class=o>{</span><span class=s2>&#34;text&#34;</span>:<span class=s2>&#34;Implement web interface&#34;</span>,<span class=s2>&#34;done&#34;</span>:false<span class=o>}}</span>
</code></pre></div><p>We can also query a single note:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ curl -X GET http://localhost:1234/task/1
<span class=o>{</span><span class=s2>&#34;text&#34;</span>:<span class=s2>&#34;Pay rent&#34;</span>,<span class=s2>&#34;done&#34;</span>:false<span class=o>}</span>
</code></pre></div><p>And say we don&rsquo;t want to do it any longer:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ curl -X DELETE http://localhost:1234/task/1
</code></pre></div><p>At which point it&rsquo;s gone:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ curl -X GET http://localhost:1234/task
<span class=o>{</span><span class=s2>&#34;/task/0&#34;</span>:<span class=o>{</span><span class=s2>&#34;text&#34;</span>:<span class=s2>&#34;Publish REST post&#34;</span>,<span class=s2>&#34;done&#34;</span>:true<span class=o>}</span>,<span class=s2>&#34;/task/2&#34;</span>:<span class=o>{</span><span class=s2>&#34;text&#34;</span>:<span class=s2>&#34;Implement web interface&#34;</span>,<span class=s2>&#34;done&#34;</span>:false<span class=o>}}</span>
</code></pre></div><h1 id=comparing-rust-vs-go>Comparing Rust vs. Go</h1>
<p>Now, let&rsquo;s get to what you were really looking for. How do Rust and Go compare to each other in this situation? As I have <a href=/2018/07/rust-vs-go.html>said in the past</a>, this comparison is often unfounded because languages should be chosen by use case, but in this situation I think we can reasonably do a light comparison.</p>
<p>Go shines in implementing network servers. If you think of the context in which it was invented, this is very much intentional. Rust, on the other hand, is a lower-level systems language, so I was somehow expecting more pain to implement this example. But nothing further from the truth: you can see that the two examples are very similar in content and line count.</p>
<p>The Go variant is slightly more verbose than the Rust one, which is expected given the intent of Go code to be easy to read. I find this very limiting though as I have mentioned in the past: it&rsquo;s impossible to encode certain constraints in the Go code without writing comments, whereas in Rust you have the tools to do so. This little detail brings more reliability and security to your code, which is something pretty important for a publicly-facing web server I&rsquo;d say&mldr;</p>
<p>Regarding performance, I&rsquo;m not going to touch much on it given that these are demo apps where I put no thought into performance. The comparison would be unfair as well because of the use of Rouille, which it itself acknowledges its own limitations in this area. That said, one little detail is that the Go code has to do some more memory copies than the Rust code. In Rust I was able to expose the internal <code>Task</code>s to the caller as references without fear that they&rsquo;d be modified, but in Go this is impossible to represent: exposing pointers allows the caller to modify the contents.</p>
<p>Anyway, not a very satisfying comparison, right? I agree. That&rsquo;s because both choices seem equally good to me, and I&rsquo;d be picking one or the other based on the specific use case at hand.</p>
<p>Enjoy and let me know if you found this useful!</p>
</article>
</div>
</div>
<div class="container post-links">
<div class=row>
<div class="col mr-auto text-left">
<span><a href=https://jmmv.dev/2019/09/safe-chdir-to-previous.html>&#171; Previous</a></span>
</div>
<div class="col text-center">
<span><a href=/archive.html>All posts</a></span>
</div>
<div class="col ml-auto text-right">
<span><a href=https://jmmv.dev/2019/10/onlamp-articles.html>Next &#187;</a></span>
</div>
</div>
</div>
<div class="container post-votes">
<div class=row>
<div class="col-lg-4 my-2">
<div class=row>
<div class=col>
<a onclick=voteThumbsUp() class="btn btn-block btn-outline-success" id=thumbs-up-btn>👍
(<span id=thumbs-up-count>0</span>)</a>
</div>
<div class=col>
<a onclick=voteThumbsDown() class="btn btn-block btn-outline-danger" id=thumbs-down-btn>👎
(<span id=thumbs-down-count>0</span>)</a>
</div>
</div>
</div>
<div class="col-lg-8 my-2 d-none d-sm-block">
<div class=row>
<div class="col-md-4 text-center"><a href="https://www.reddit.com/submit?title=Sample+REST+interface+in+Rust+and+Go&url=https%3A%2F%2Fjmmv.dev%2F2019%2F09%2Frest-api-rust-go.html" class="btn btn-block btn-outline-primary">
Share on
<img src=/images/badges/reddit.png alt=Reddit width=24 height=24>
</a>
</div>
<div class="col-md-4 text-center"><a href="https://news.ycombinator.com/submitlink?t=Sample+REST+interface+in+Rust+and+Go&u=https%3A%2F%2Fjmmv.dev%2F2019%2F09%2Frest-api-rust-go.html" class="btn btn-block btn-outline-primary">
Share on
<img src=/images/badges/ycombinator.png alt="Hacker News" width=24 height=24>
</a>
</div>
<div class="col-md-4 text-center"><a href="https://twitter.com/intent/tweet?status=Sample+REST+interface+in+Rust+and+Go+%E2%80%94+https%3A%2F%2Fjmmv.dev%2F2019%2F09%2Frest-api-rust-go.html+%E2%80%94+cc+%40jmmv" class="btn btn-block btn-outline-primary">
Share on
<img src=/images/badges/Twitter_Social_Icon_Circle_Color.png alt=Twitter width=24 height=24>
</a>
</div>
</div>
</div>
</div>
<div class="row my-4" id=postCommentRow>
<div class=col>
<div class=media>
<img class=mr-3 src=/octicons/pencil.svg width=32px height=32px>
<div class="media-body container">
<form method=post id=newPost>
<div class=row>
<div class="col my-1">
<textarea class=form-control rows=1 id=postCommentContent onclick=showPostComment() placeholder="Leave a comment"></textarea>
</div>
</div>
<div class="row newPostControls" style=display:none>
<div class="col my-1 form-group">
<label for=postCommentAuthor>Your name (optional):</label>
<input type=text class=form-control id=postCommentAuthor>
</div>
</div>
<div class="row newPostControls" style=display:none>
<div class="col my-1 form-group">
<label for=postCommentEmail>Your email (optional):</label>
<input type=text class=form-control type=email id=postCommentEmail>
<small class="form-text text-muted">Invisible to all readers; if provided, you will receive notifications when replied to (not implemented yet)</small>
</div>
</div>
<div class=row id=postCommentError style=display:none>
<div class="col mt-1 alert-danger">
<p></p>
</div>
</div>
<div class="row newPostControls" style=display:none>
<button class="col-md-3 my-1 btn btn-primary" type=submit id=submitCommentButton>Post</button>
<small class="col-md-9 my-1 text-muted">Comments are subject to moderation. This feature is experimental and is powered by <a href=/software/endtracker.html>EndTRACKER</a>. If you experience any issues, please <a href=/about.html#contact>contact me off-band</a>.</small>
</div>
</form>
</div>
</div>
</div>
</div>
<script>function hidePostComment(){var a=document.getElementById('postCommentContent'),b;a.rows=1,a.value='',b=document.getElementsByClassName('newPostControls'),Array.prototype.forEach.call(b,function(a){a.style.display='none'})}function showPostComment(){var a=document.getElementById('postCommentContent'),b;a.rows=5,b=document.getElementsByClassName('newPostControls'),Array.prototype.forEach.call(b,function(a){a.style.display=''})}const form=document.querySelector('#newPost');form.onsubmit=function(a){a.preventDefault();let b=document.getElementById('postCommentAuthor').value,c=document.getElementById('postCommentEmail').value,d=document.getElementById('postCommentContent').value;postComment(b,c,d,hidePostComment)}</script>
</div>
<div class="container post-subscribe">
<div class=row>
<div class=col-sm-9>
<form action="https://api.follow.it/subscription-form/WWZwVlFmTks4enBrYytaNHorbE4zSnpRTTBoTy9PcXNsZjdQbVpmWDJDemwyVW9rc2llZHNxQW9iUGdXNG83dm11SWZDM0NKSlQ5Qm1LTUpJZnF2b0Z5WDE3UUtvaEgzTWRWUFBQWEo4RUxyNUt5UW4xN3VZaW9paEd1UUFCL1J8YStTYmVCc3VoVGhCeENNSVZHSmEyUk1hejZWaEZkT1M1WTVkSXdBY1Q5cz0=/8" method=post>
<div class=form-group>
<div class=row>
<input type=text name=email placeholder="Enter your email" class="form-control input-sm col-8 text-center">
<button type=submit class="btn btn-primary col-4">Subscribe</button>
</div>
</div>
</form>
</div>
<div class=col-sm-3>
<div class=row>
<div class="col px-2 text-center">
<a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&screen_name=jmmv">
<img src=/images/badges/Twitter_logo_blue.svg width=32px height=32px alt="Follow @jmmv on Twitter">
</a>
</div>
<div class="col px-2 text-center">
<a href=/feed.xml><img src=/images/badges/feed-icon-28x28.png alt="RSS feed"></a>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="col-md-3 sidebar d-none d-md-block">
<div class=row>
<div class="col text-center p-2">
<p><a href=/about.html class=clear-link>
<img src=/images/avatars/20181124-snow.jpg class="rounded-circle shadow my-2" style=width:100px><br>
<b>Julio Merino</b><br>
Principal Software Engineer<br>
<small>#FreeBSD, #Unix, #Rust, #Bazel, #blogger</small><br>
<small>From Barcelona, living in Seattle</small>
</a></p>
<div class=row>
<div class="col-sm-6 text-center">
<p>
<a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&screen_name=jmmv">
<img src=/images/badges/Twitter_logo_blue.svg width=32px height=32px alt="Follow @jmmv on Twitter">
</a>
</p>
</div>
<div class="col-sm-6 text-center">
<p><a href=/feed.xml><img src=/images/badges/feed-icon-28x28.png alt="RSS feed"></a></p>
</div>
</div>
<form action="https://api.follow.it/subscription-form/WWZwVlFmTks4enBrYytaNHorbE4zSnpRTTBoTy9PcXNsZjdQbVpmWDJDemwyVW9rc2llZHNxQW9iUGdXNG83dm11SWZDM0NKSlQ5Qm1LTUpJZnF2b0Z5WDE3UUtvaEgzTWRWUFBQWEo4RUxyNUt5UW4xN3VZaW9paEd1UUFCL1J8YStTYmVCc3VoVGhCeENNSVZHSmEyUk1hejZWaEZkT1M1WTVkSXdBY1Q5cz0=/8" method=post>
<div class=form-group>
<input type=text name=email placeholder="Enter your email" class="form-control input-sm text-center">
<button type=submit class="btn btn-primary btn-block">Subscribe</button>
</div>
</form>
</div>
</div>
<div class=row>
<div class=col>
<h2>Featured posts</h2>
<ul>
<li class=indent-wrapped-lines><a href=/2022/06/endbasic-0.9.html>EndBASIC 0.9: Run shared demos easily</a></li>
<li class=indent-wrapped-lines><a href=/2022/05/rust-is-hard-but-does-it-matter.html>Rust is hard, yes, but does it matter?</a></li>
<li class=indent-wrapped-lines><a href=/2022/04/rust-traits-and-dependency-injection.html>Rust traits and dependency injection</a></li>
<li class=indent-wrapped-lines><a href=/2022/03/a-year-on-windows-intro.html>A year on Windows: Introduction</a></li>
<li class=indent-wrapped-lines><a href=/2021/11/endbasic-0.8.html>EndBASIC 0.8: Now, with graphics!</a></li>
<li class=indent-wrapped-lines><a href=/2021/07/endbasic-0.7.html>EndBASIC 0.7: Hello, cloud!</a></li>
<li class=indent-wrapped-lines><a href=/2021/04/always-be-quitting.html>Always be quitting</a></li>
<li class=indent-wrapped-lines><a href=/2021/02/google-monorepos-and-caching.html>How does Google keep build times low?</a></li>
<li class=indent-wrapped-lines><a href=/2020/12/google-no-clean-builds.html>How does Google avoid clean builds?</a></li>
<li class=indent-wrapped-lines><a href=/2020/12/unit-testing-a-console-app.html>Unit-testing a console app (a text editor)</a></li>
<li class=indent-wrapped-lines><a href=/essays.html#featured>More...</a></li>
</ul>
</div>
</div>
<div class=row>
<div class=col>
<h2>Archive</h2>
<ul>
<li>
<a data-toggle=collapse href=#archive-year-2022>2022</a> (28)
<ul id=archive-year-2022 class=collapse>
<li><a href=/archive.html#2022-06>June 2022</a> (2)</li>
<li><a href=/archive.html#2022-05>May 2022</a> (2)</li>
<li><a href=/archive.html#2022-04>April 2022</a> (4)</li>
<li><a href=/archive.html#2022-03>March 2022</a> (15)</li>
<li><a href=/archive.html#2022-02>February 2022</a> (4)</li>
<li><a href=/archive.html#2022-01>January 2022</a> (1)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2021>2021</a> (22)
<ul id=archive-year-2021 class=collapse>
<li><a href=/archive.html#2021-11>November 2021</a> (2)</li>
<li><a href=/archive.html#2021-08>August 2021</a> (2)</li>
<li><a href=/archive.html#2021-07>July 2021</a> (5)</li>
<li><a href=/archive.html#2021-06>June 2021</a> (1)</li>
<li><a href=/archive.html#2021-04>April 2021</a> (2)</li>
<li><a href=/archive.html#2021-03>March 2021</a> (2)</li>
<li><a href=/archive.html#2021-02>February 2021</a> (3)</li>
<li><a href=/archive.html#2021-01>January 2021</a> (5)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2020>2020</a> (36)
<ul id=archive-year-2020 class=collapse>
<li><a href=/archive.html#2020-12>December 2020</a> (4)</li>
<li><a href=/archive.html#2020-11>November 2020</a> (5)</li>
<li><a href=/archive.html#2020-10>October 2020</a> (5)</li>
<li><a href=/archive.html#2020-09>September 2020</a> (2)</li>
<li><a href=/archive.html#2020-08>August 2020</a> (6)</li>
<li><a href=/archive.html#2020-07>July 2020</a> (2)</li>
<li><a href=/archive.html#2020-06>June 2020</a> (2)</li>
<li><a href=/archive.html#2020-05>May 2020</a> (3)</li>
<li><a href=/archive.html#2020-04>April 2020</a> (2)</li>
<li><a href=/archive.html#2020-03>March 2020</a> (2)</li>
<li><a href=/archive.html#2020-02>February 2020</a> (1)</li>
<li><a href=/archive.html#2020-01>January 2020</a> (2)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2019>2019</a> (24)
<ul id=archive-year-2019 class=collapse>
<li><a href=/archive.html#2019-12>December 2019</a> (8)</li>
<li><a href=/archive.html#2019-11>November 2019</a> (6)</li>
<li><a href=/archive.html#2019-10>October 2019</a> (1)</li>
<li><a href=/archive.html#2019-09>September 2019</a> (2)</li>
<li><a href=/archive.html#2019-03>March 2019</a> (2)</li>
<li><a href=/archive.html#2019-02>February 2019</a> (3)</li>
<li><a href=/archive.html#2019-01>January 2019</a> (2)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2018>2018</a> (25)
<ul id=archive-year-2018 class=collapse>
<li><a href=/archive.html#2018-07>July 2018</a> (3)</li>
<li><a href=/archive.html#2018-06>June 2018</a> (7)</li>
<li><a href=/archive.html#2018-05>May 2018</a> (2)</li>
<li><a href=/archive.html#2018-04>April 2018</a> (2)</li>
<li><a href=/archive.html#2018-03>March 2018</a> (8)</li>
<li><a href=/archive.html#2018-02>February 2018</a> (3)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2017>2017</a> (6)
<ul id=archive-year-2017 class=collapse>
<li><a href=/archive.html#2017-10>October 2017</a> (1)</li>
<li><a href=/archive.html#2017-08>August 2017</a> (1)</li>
<li><a href=/archive.html#2017-07>July 2017</a> (1)</li>
<li><a href=/archive.html#2017-02>February 2017</a> (3)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2016>2016</a> (8)
<ul id=archive-year-2016 class=collapse>
<li><a href=/archive.html#2016-09>September 2016</a> (1)</li>
<li><a href=/archive.html#2016-05>May 2016</a> (1)</li>
<li><a href=/archive.html#2016-04>April 2016</a> (1)</li>
<li><a href=/archive.html#2016-03>March 2016</a> (2)</li>
<li><a href=/archive.html#2016-02>February 2016</a> (1)</li>
<li><a href=/archive.html#2016-01>January 2016</a> (2)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2015>2015</a> (17)
<ul id=archive-year-2015 class=collapse>
<li><a href=/archive.html#2015-12>December 2015</a> (2)</li>
<li><a href=/archive.html#2015-10>October 2015</a> (2)</li>
<li><a href=/archive.html#2015-09>September 2015</a> (3)</li>
<li><a href=/archive.html#2015-06>June 2015</a> (2)</li>
<li><a href=/archive.html#2015-05>May 2015</a> (3)</li>
<li><a href=/archive.html#2015-04>April 2015</a> (1)</li>
<li><a href=/archive.html#2015-03>March 2015</a> (1)</li>
<li><a href=/archive.html#2015-02>February 2015</a> (3)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2014>2014</a> (12)
<ul id=archive-year-2014 class=collapse>
<li><a href=/archive.html#2014-11>November 2014</a> (2)</li>
<li><a href=/archive.html#2014-05>May 2014</a> (3)</li>
<li><a href=/archive.html#2014-03>March 2014</a> (1)</li>
<li><a href=/archive.html#2014-02>February 2014</a> (3)</li>
<li><a href=/archive.html#2014-01>January 2014</a> (3)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2013>2013</a> (62)
<ul id=archive-year-2013 class=collapse>
<li><a href=/archive.html#2013-12>December 2013</a> (7)</li>
<li><a href=/archive.html#2013-11>November 2013</a> (7)</li>
<li><a href=/archive.html#2013-10>October 2013</a> (7)</li>
<li><a href=/archive.html#2013-09>September 2013</a> (13)</li>
<li><a href=/archive.html#2013-08>August 2013</a> (9)</li>
<li><a href=/archive.html#2013-07>July 2013</a> (10)</li>
<li><a href=/archive.html#2013-06>June 2013</a> (9)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2012>2012</a> (29)
<ul id=archive-year-2012 class=collapse>
<li><a href=/archive.html#2012-10>October 2012</a> (1)</li>
<li><a href=/archive.html#2012-09>September 2012</a> (1)</li>
<li><a href=/archive.html#2012-08>August 2012</a> (3)</li>
<li><a href=/archive.html#2012-07>July 2012</a> (2)</li>
<li><a href=/archive.html#2012-06>June 2012</a> (2)</li>
<li><a href=/archive.html#2012-05>May 2012</a> (3)</li>
<li><a href=/archive.html#2012-04>April 2012</a> (1)</li>
<li><a href=/archive.html#2012-03>March 2012</a> (1)</li>
<li><a href=/archive.html#2012-02>February 2012</a> (10)</li>
<li><a href=/archive.html#2012-01>January 2012</a> (5)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2011>2011</a> (60)
<ul id=archive-year-2011 class=collapse>
<li><a href=/archive.html#2011-12>December 2011</a> (4)</li>
<li><a href=/archive.html#2011-11>November 2011</a> (4)</li>
<li><a href=/archive.html#2011-10>October 2011</a> (5)</li>
<li><a href=/archive.html#2011-09>September 2011</a> (11)</li>
<li><a href=/archive.html#2011-08>August 2011</a> (6)</li>
<li><a href=/archive.html#2011-07>July 2011</a> (4)</li>
<li><a href=/archive.html#2011-06>June 2011</a> (6)</li>
<li><a href=/archive.html#2011-05>May 2011</a> (6)</li>
<li><a href=/archive.html#2011-04>April 2011</a> (5)</li>
<li><a href=/archive.html#2011-03>March 2011</a> (2)</li>
<li><a href=/archive.html#2011-01>January 2011</a> (7)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2010>2010</a> (26)
<ul id=archive-year-2010 class=collapse>
<li><a href=/archive.html#2010-12>December 2010</a> (7)</li>
<li><a href=/archive.html#2010-09>September 2010</a> (1)</li>
<li><a href=/archive.html#2010-07>July 2010</a> (1)</li>
<li><a href=/archive.html#2010-06>June 2010</a> (2)</li>
<li><a href=/archive.html#2010-05>May 2010</a> (5)</li>
<li><a href=/archive.html#2010-04>April 2010</a> (5)</li>
<li><a href=/archive.html#2010-03>March 2010</a> (3)</li>
<li><a href=/archive.html#2010-01>January 2010</a> (2)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2009>2009</a> (31)
<ul id=archive-year-2009 class=collapse>
<li><a href=/archive.html#2009-10>October 2009</a> (1)</li>
<li><a href=/archive.html#2009-09>September 2009</a> (1)</li>
<li><a href=/archive.html#2009-08>August 2009</a> (3)</li>
<li><a href=/archive.html#2009-07>July 2009</a> (2)</li>
<li><a href=/archive.html#2009-06>June 2009</a> (4)</li>
<li><a href=/archive.html#2009-05>May 2009</a> (6)</li>
<li><a href=/archive.html#2009-04>April 2009</a> (2)</li>
<li><a href=/archive.html#2009-03>March 2009</a> (4)</li>
<li><a href=/archive.html#2009-01>January 2009</a> (8)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2008>2008</a> (61)
<ul id=archive-year-2008 class=collapse>
<li><a href=/archive.html#2008-12>December 2008</a> (1)</li>
<li><a href=/archive.html#2008-11>November 2008</a> (4)</li>
<li><a href=/archive.html#2008-10>October 2008</a> (6)</li>
<li><a href=/archive.html#2008-09>September 2008</a> (1)</li>
<li><a href=/archive.html#2008-08>August 2008</a> (6)</li>
<li><a href=/archive.html#2008-07>July 2008</a> (14)</li>
<li><a href=/archive.html#2008-06>June 2008</a> (3)</li>
<li><a href=/archive.html#2008-05>May 2008</a> (1)</li>
<li><a href=/archive.html#2008-04>April 2008</a> (3)</li>
<li><a href=/archive.html#2008-03>March 2008</a> (3)</li>
<li><a href=/archive.html#2008-02>February 2008</a> (9)</li>
<li><a href=/archive.html#2008-01>January 2008</a> (10)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2007>2007</a> (86)
<ul id=archive-year-2007 class=collapse>
<li><a href=/archive.html#2007-12>December 2007</a> (4)</li>
<li><a href=/archive.html#2007-11>November 2007</a> (7)</li>
<li><a href=/archive.html#2007-10>October 2007</a> (2)</li>
<li><a href=/archive.html#2007-09>September 2007</a> (8)</li>
<li><a href=/archive.html#2007-08>August 2007</a> (6)</li>
<li><a href=/archive.html#2007-07>July 2007</a> (15)</li>
<li><a href=/archive.html#2007-06>June 2007</a> (15)</li>
<li><a href=/archive.html#2007-05>May 2007</a> (4)</li>
<li><a href=/archive.html#2007-04>April 2007</a> (10)</li>
<li><a href=/archive.html#2007-03>March 2007</a> (8)</li>
<li><a href=/archive.html#2007-02>February 2007</a> (1)</li>
<li><a href=/archive.html#2007-01>January 2007</a> (6)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2006>2006</a> (103)
<ul id=archive-year-2006 class=collapse>
<li><a href=/archive.html#2006-12>December 2006</a> (4)</li>
<li><a href=/archive.html#2006-11>November 2006</a> (3)</li>
<li><a href=/archive.html#2006-10>October 2006</a> (7)</li>
<li><a href=/archive.html#2006-09>September 2006</a> (6)</li>
<li><a href=/archive.html#2006-08>August 2006</a> (13)</li>
<li><a href=/archive.html#2006-07>July 2006</a> (4)</li>
<li><a href=/archive.html#2006-06>June 2006</a> (13)</li>
<li><a href=/archive.html#2006-05>May 2006</a> (7)</li>
<li><a href=/archive.html#2006-04>April 2006</a> (9)</li>
<li><a href=/archive.html#2006-03>March 2006</a> (6)</li>
<li><a href=/archive.html#2006-02>February 2006</a> (13)</li>
<li><a href=/archive.html#2006-01>January 2006</a> (18)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2005>2005</a> (129)
<ul id=archive-year-2005 class=collapse>
<li><a href=/archive.html#2005-12>December 2005</a> (9)</li>
<li><a href=/archive.html#2005-11>November 2005</a> (7)</li>
<li><a href=/archive.html#2005-10>October 2005</a> (23)</li>
<li><a href=/archive.html#2005-09>September 2005</a> (10)</li>
<li><a href=/archive.html#2005-08>August 2005</a> (14)</li>
<li><a href=/archive.html#2005-07>July 2005</a> (5)</li>
<li><a href=/archive.html#2005-06>June 2005</a> (12)</li>
<li><a href=/archive.html#2005-05>May 2005</a> (6)</li>
<li><a href=/archive.html#2005-04>April 2005</a> (6)</li>
<li><a href=/archive.html#2005-03>March 2005</a> (13)</li>
<li><a href=/archive.html#2005-02>February 2005</a> (11)</li>
<li><a href=/archive.html#2005-01>January 2005</a> (13)</li>
</ul>
</li>
<li>
<a data-toggle=collapse href=#archive-year-2004>2004</a> (84)
<ul id=archive-year-2004 class=collapse>
<li><a href=/archive.html#2004-12>December 2004</a> (9)</li>
<li><a href=/archive.html#2004-11>November 2004</a> (6)</li>
<li><a href=/archive.html#2004-10>October 2004</a> (11)</li>
<li><a href=/archive.html#2004-09>September 2004</a> (19)</li>
<li><a href=/archive.html#2004-07>July 2004</a> (29)</li>
<li><a href=/archive.html#2004-06>June 2004</a> (10)</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<footer class=container>
<div class=row>
<div class="col-4 order-2 texr-right">
<p class=float-right><a href=#>Back to top</a></p>
</div>
<div class="col-8 order-1 mr-auto">
<p>Copyright 2004&ndash;2022 Julio Merino</p>
</div>
</div>
</footer>
<script type=module>
  import {
    addAnchorsToHeaders, addElementClasses, CommentsClient, RequestsClient, VotingClient,
  } from "\/js\/main.d7e5495574f64e3c74600e1ded9c151f64da7504303fd1498c445b1457ae99dc.js";

  var requestsClient = new RequestsClient(SITE_ID);
  requestsClient.saveRequest();

  var votingClient = new VotingClient(SITE_ID);
  votingClient.loadVotes();
  window.voteThumbsUp = function() { votingClient.voteThumbsUp(); }
  window.voteThumbsDown = function() { votingClient.voteThumbsDown(); }

  var commentsClient = new CommentsClient(SITE_ID);
  commentsClient.loadComments();
  window.postComment = function(...args) {
    commentsClient.postComment(...args);
  };

  addAnchorsToHeaders();
  addElementClasses();
</script>
<noscript>
<img src="https://hugo-dynamic.jmmv.dev/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/pages/aHR0cHM6Ly9qbW12LmRldi8yMDE5LzA5L3Jlc3QtYXBpLXJ1c3QtZ28uaHRtbA==/stamp.gif" style=display:none>
</noscript>
</body>
</html>