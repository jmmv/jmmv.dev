<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, shrink-to-fit=no">
  

  <title>Waiting for process groups, macOS edition - jmmv.dev</title>
  <meta content="Waiting for process groups, macOS edition - jmmv.dev" property="og:title">

  

  
  <meta name="description" content="In the previous posts, we saw why waiting for a process group is complicated and we covered a specific, bullet-proof mechanism to accomplish this on Linux. Now is the time to investigate this same topic on macOS. Remember that the problem we are trying to solve (#10245) is the following: given a process group, wait for all of its processes to fully terminate.
macOS has a bunch of fancy features that other systems do not have, but process control is not among them.">
  <meta name="author" content="Julio Merino">
  <meta name="generator" content="Hugo 0.55.6" />

  <meta content="https://jmmv.dev/2019/11/wait-for-process-group-darwin.html" property="og:url">

  <link rel="canonical" href="https://jmmv.dev/2019/11/wait-for-process-group-darwin.html">
  <link rel="alternate" type="application/rss+xml"
        title="jmmv.dev" href="/feed.xml" />

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/chroma.css">

  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">

  
  <!--[if lt IE 9]>
    <script src="/js/html5shiv-3.7.2.min.js"></script>
    <script src="/js/respond-1.4.2.min.js"></script>
  <![endif]-->
</head>


  <body>
    <header class="site-header">

<nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary">
  <a class="navbar-brand" href="/">
    <img src="/images/favicons/favicon.svg" width="30" height="30" class="d-inline-block align-top" alt="">
    &nbsp;jmmv.dev
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse"
          data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false"
          aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      
        
          <li class="nav-item">
            <a class="nav-link" href="/about.html" >About</a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="/essays.html" >Essays</a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="/resume.html" >Resume</a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="/software.html" >Software</a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="/work.html" >Work</a>
          </li>
        
      
    </ul>

    <ul class="navbar-nav mr-4">
      
        
          <li class="nav-item">
            <a class="nav-link" href="/archive.html" >Archive</a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="/series.html" >Series</a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="/tags.html" >Tags</a>
          </li>
        
      
    </ul>

    <form class="form-inline" method="get" role="search"
          action="http://www.google.com/search">
      <div class="input-group">
        <input type="search" name="query" class="form-control"
                placeholder="Search" aria-label="Search">
        <div class="input-group-append">
          <button type="submit" value="Search" class="btn btn-light">
            <img src="/octicons/search.svg">
          </button>
        </div>
      </div>
      <input type="hidden" name="sitesearch" value="https://jmmv.dev/">
    </form>
  </div>
</nav>

</header>


    <div class="page-header">
      <div class="container">
        <h1>Waiting for process groups, macOS edition</h1>

        <p>November 15, 2019 &middot;
        About 8 minutes
        &middot;
        Tags:
        <a class="text-reset" href="/tags/bazel">bazel</a>, <a class="text-reset" href="/tags/darwin">darwin</a>, <a class="text-reset" href="/tags/macos">macos</a>, <a class="text-reset" href="/tags/unix">unix</a></p>

        
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-md-9">
          <div class="row">
            <div class="col">
              
              <article><p>In the previous posts, we saw why <a href="/2019/11/wait-for-process-group.html">waiting for a process group is complicated</a> and we covered a specific, bullet-proof mechanism to <a href="/2019/11/wait-for-process-group-linux.html">accomplish this on Linux</a>. Now is the time to investigate this same topic on macOS. Remember that the problem we are trying to solve (<a href="https://github.com/bazelbuild/bazel/issues/10245">#10245</a>) is the following: given a process group, wait for all of its processes to fully terminate.</p>

<p>macOS has a bunch of fancy features that <a href="/2019/03/macos-threads-qos-and-bazel.html">other systems do not have</a>, but process control is not among them. We do not have features like Linux&rsquo;s child subreaper or PID namespaces to keep track of process groups. Therefore, we&rsquo;ll have to roll our own. And the only way to do this is to scan the process table looking for processes with the desired process group identifier (PGID) and waiting until they are gone.</p>

<p>Unfortunately, there is no portable API to programmatically access the process table. Sure, you can imagine shelling out to <code>ps(1)</code> and parsing its output, but this would be very inefficient and error-prone. So we have no choice but to rely on Darwin-specific primitives for efficiency and reliability.</p>

<p>We can query the process table in Darwin by using <code>sysctl(3)</code> and looking under the <code>kern.proc.pgrp.&lt;PGID&gt;</code> name (MIB). (It&rsquo;s interesting to see that this is modeled after the BSD&rsquo;s <code>kvm_getprocs(2)</code> interface and I&rsquo;m not sure why Darwin had to merge it with <code>sysctl(3)</code>.) However: this MIB doesn&rsquo;t appear to be documented so things might break in the future. The way I found this is by looking at <a href="https://opensource.apple.com/source/adv_cmds/adv_cmds-172/ps/ps.c.auto.html">Apple&rsquo;s own <code>ps.c</code> source code</a>.</p>

<p>Let&rsquo;s coerce the <code>sysctl(3)</code> interface to give us what we want. The interface is not the easiest to use, but it&rsquo;s not that difficult either; we just have to account for the fact that its return value is of variable size:</p>

<div class="src">
  
  
  <div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/sysctl.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;errno.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="c1">// Waits for a process group to terminate.  Assumes that the process leader
</span><span class="c1">// still exists in the process table (though it may be a zombie), and allows
</span><span class="c1">// it to remain.
</span><span class="c1">//
</span><span class="c1">// May never converge if the processes in the group are still spawning their
</span><span class="c1">// own subprocesses.
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">wait_for_process_group</span><span class="p">(</span><span class="n">pid_t</span> <span class="n">pgid</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">name</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">CTL_KERN</span><span class="p">,</span> <span class="n">KERN_PROC</span><span class="p">,</span> <span class="n">KERN_PROC_PGRP</span><span class="p">,</span> <span class="n">pgid</span><span class="p">};</span>

    <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
        <span class="c1">// Query the list of processes in the group by using sysctl(3).
</span><span class="c1"></span>        <span class="c1">// This is &#34;hard&#34; because we don&#39;t know how big that list is, so we
</span><span class="c1"></span>        <span class="c1">// have to first query the size of the output data and then account for
</span><span class="c1"></span>        <span class="c1">// the fact that the size might change by the time we actually issue
</span><span class="c1"></span>        <span class="c1">// the query.
</span><span class="c1"></span>        <span class="k">struct</span> <span class="n">kinfo_proc</span> <span class="o">*</span><span class="n">procs</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">size_t</span> <span class="n">nprocs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="n">size_t</span> <span class="n">len</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sysctl</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">procs</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">kinfo_proc</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">len</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sysctl</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">procs</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">assert</span><span class="p">(</span><span class="n">errno</span> <span class="o">==</span> <span class="n">ENOMEM</span><span class="p">);</span>
                <span class="n">free</span><span class="p">(</span><span class="n">procs</span><span class="p">);</span>
                <span class="n">procs</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">nprocs</span> <span class="o">=</span> <span class="n">len</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">kinfo_proc</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">procs</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">);</span>
        <span class="n">assert</span><span class="p">(</span><span class="n">nprocs</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">);</span>  <span class="c1">// Must have found the group leader at least.
</span><span class="c1"></span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nprocs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Found only one process, which must be the leader because we have
</span><span class="c1"></span>            <span class="c1">// purposely expect it as a zombie.
</span><span class="c1"></span>            <span class="n">assert</span><span class="p">(</span><span class="n">procs</span><span class="o">-&gt;</span><span class="n">kp_proc</span><span class="p">.</span><span class="n">p_pid</span> <span class="o">==</span> <span class="n">pgid</span><span class="p">);</span>
            <span class="n">free</span><span class="p">(</span><span class="n">procs</span><span class="p">);</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// More than one process left in the process group.  Pause a little bit
</span><span class="c1"></span>        <span class="c1">// before retrying to avoid burning CPU.
</span><span class="c1"></span>        <span class="k">struct</span> <span class="n">timespec</span> <span class="n">ts</span><span class="p">;</span>
        <span class="n">ts</span><span class="p">.</span><span class="n">tv_sec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">ts</span><span class="p">.</span><span class="n">tv_nsec</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nanosleep</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ts</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
  <div class="footer">
      <div class="filename">
        <a href="/src/wait-for-process-group/wait-pgid-darwin.c" type="text/plain">wait-pgid-darwin.c</a>
      </div>
    </div>
  </div>


<p>The above code snippet gives us a <code>wait_for_process_group</code> function that ensures all processes in a process group are gone, except for the leader. With this, we could implement the following algorithm:</p>

<ol>
<li>Start process group.</li>
<li>Wait for the process group leader to terminate using <code>waitpid(2)</code>. Remember that we want to report the exit status of the leader, so we must do this.</li>
<li>Wait for all other processes in the group to exit by calling <code>wait_for_process_group</code>.</li>
</ol>

<p>This works&hellip; but there is a little problem. Once <code>waitpid(2)</code> returns, the kernel has cleared all knowledge of our process leader, which means all of its children became orphan and were reparented to <code>init(8)</code>. The PGID was thus reclaimed and could now be used by a racing process. (This is very unlikely because the kernel will try hard to not reallocate PIDs too quickly, but it&rsquo;s still a possibility and experience has shown me that, with scale, the unlikely is actually common.)</p>

<p>So how do we fix this? We need to introduce an extra step. We have to detect when the process group leader becomes a zombie <em>without actually reaping its status</em> so that the PGID remains assigned while we do our <code>wait_for_process_group</code> dance.</p>

<p>And to do this, we use another Darwin-specific primitive: <code>kqueue(2)</code>. With this functionality, we can wait for the child process to change its status. (We could possibly do this by monitoring <code>SIGCHLD</code> but I haven&rsquo;t found a way to make this not racy, and anything dealing with signals always makes me cringe.) The code looks like follows:</p>

<div class="src">
  
  
  <div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/event.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stddef.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="c1">// Waits for a process to terminate but does *not* collect its exit status,
</span><span class="c1">// thus leaving the process as a zombie.
</span><span class="c1">//
</span><span class="c1">// According to the kqueue(2) documentation (and I confirmed it experimentally),
</span><span class="c1">// registering for an event reports any pending such events, so this is not racy
</span><span class="c1">// if the process happened to exit before we got to installing the kevent.
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">wait_for_process</span><span class="p">(</span><span class="n">pid_t</span> <span class="n">pid</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">kq</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">kq</span> <span class="o">=</span> <span class="n">kqueue</span><span class="p">())</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">struct</span> <span class="n">kevent</span> <span class="n">kc</span><span class="p">;</span>
    <span class="n">EV_SET</span><span class="p">(</span><span class="o">&amp;</span><span class="n">kc</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">EVFILT_PROC</span><span class="p">,</span> <span class="n">EV_ADD</span> <span class="o">|</span> <span class="n">EV_ENABLE</span><span class="p">,</span> <span class="n">NOTE_EXIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">nev</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">kevent</span> <span class="n">ke</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">nev</span> <span class="o">=</span> <span class="n">kevent</span><span class="p">(</span><span class="n">kq</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">kc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ke</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">nev</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">ke</span><span class="p">.</span><span class="n">ident</span> <span class="o">==</span> <span class="n">pid</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">ke</span><span class="p">.</span><span class="n">fflags</span> <span class="o">&amp;</span> <span class="n">NOTE_EXIT</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">close</span><span class="p">(</span><span class="n">kq</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
  <div class="footer">
      <div class="filename">
        <a href="/src/wait-for-process-group/wait-pid-darwin.c" type="text/plain">wait-pid-darwin.c</a>
      </div>
    </div>
  </div>


<p>Alright. So now we have another function, called <code>wait_for_process</code>, that will wait until the given PID becomes a zombie. With this, our algorithm looks like:</p>

<ol>
<li>Start process group.</li>
<li>Wait for the process group leader to become a zombie with <code>wait_for_process</code>. At this point, the PGID is still assigned to us.</li>
<li>Wait for all other processes in the group to exit by calling <code>wait_for_process_group</code>.</li>
<li>Collect the leader&rsquo;s status by using <code>waitpid(2)</code>.</li>
</ol>

<p>Simple, right? It was all in the details&mdash;which is why I had to come up with the sample code in these posts.</p>

<p>Let&rsquo;s put it all into practice by updating our original test tool:</p>

<div class="src">
  
  
  <div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;err.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">wait_for_process</span><span class="p">(</span><span class="n">pid_t</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">wait_for_process_group</span><span class="p">(</span><span class="n">pid_t</span><span class="p">);</span>

<span class="c1">// Convenience macro to abort quickly if a syscall fails with -1.
</span><span class="c1">//
</span><span class="c1">// Not great error handling, but better have some than none given that you, the
</span><span class="c1">// reader, might be copy/pasting this into real production code.
</span><span class="c1"></span><span class="cp">#define CHECK_OK(call) if (call == -1) err(EXIT_FAILURE, #call);
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">errx</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">,</span> <span class="s">&#34;Must provide a program name and arguments&#34;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">fds</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="n">CHECK_OK</span><span class="p">(</span><span class="n">pipe</span><span class="p">(</span><span class="n">fds</span><span class="p">));</span>
    <span class="n">pid_t</span> <span class="n">pid</span><span class="p">;</span>
    <span class="n">CHECK_OK</span><span class="p">((</span><span class="n">pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">()));</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Enter a new process group for all of our descendents.
</span><span class="c1"></span>        <span class="n">CHECK_OK</span><span class="p">(</span><span class="n">setpgid</span><span class="p">(</span><span class="n">getpid</span><span class="p">(),</span> <span class="n">getpid</span><span class="p">()));</span>

        <span class="c1">// Tell the parent that we have successfully created the group.
</span><span class="c1"></span>        <span class="n">CHECK_OK</span><span class="p">(</span><span class="n">close</span><span class="p">(</span><span class="n">fds</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
        <span class="n">CHECK_OK</span><span class="p">(</span><span class="n">write</span><span class="p">(</span><span class="n">fds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#34;</span><span class="se">\0</span><span class="s">&#34;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)));</span>
        <span class="n">CHECK_OK</span><span class="p">(</span><span class="n">close</span><span class="p">(</span><span class="n">fds</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>

        <span class="c1">// Execute the given program now that the environment is ready.
</span><span class="c1"></span>        <span class="n">execv</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">argv</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">err</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">,</span> <span class="s">&#34;execv&#34;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Wait until the child has created its own process group.
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="c1">// This is a must to prevent a race between the parent waiting for the
</span><span class="c1"></span>    <span class="c1">// group and the group not existing yet, and is the only safe way to do so.
</span><span class="c1"></span>    <span class="n">CHECK_OK</span><span class="p">(</span><span class="n">close</span><span class="p">(</span><span class="n">fds</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
    <span class="kt">char</span> <span class="n">dummy</span><span class="p">;</span>
    <span class="n">CHECK_OK</span><span class="p">(</span><span class="n">read</span><span class="p">(</span><span class="n">fds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">dummy</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)));</span>
    <span class="n">CHECK_OK</span><span class="p">(</span><span class="n">close</span><span class="p">(</span><span class="n">fds</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>

    <span class="c1">// Now wait for the direct child to terminate and keep it around as a
</span><span class="c1"></span>    <span class="c1">// zombie.  This ensures that the process group is not reparented to init,
</span><span class="c1"></span>    <span class="c1">// which allows us to query it without racing other processes getting the
</span><span class="c1"></span>    <span class="c1">// same group identifier.
</span><span class="c1"></span>    <span class="n">wait_for_process</span><span class="p">(</span><span class="n">pid</span><span class="p">);</span>

    <span class="c1">// The direct child is dead and the kernel would reparent all processes of
</span><span class="c1"></span>    <span class="c1">// our group to init if we hadn&#39;t kept the child around as a zombie.  Wait
</span><span class="c1"></span>    <span class="c1">// for all of them to vanish.
</span><span class="c1"></span>    <span class="n">wait_for_process_group</span><span class="p">(</span><span class="n">pid</span><span class="p">);</span>

    <span class="c1">// And now reap the exit status of the direct child.
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
    <span class="n">CHECK_OK</span><span class="p">(</span><span class="n">waitpid</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">WIFEXITED</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="o">?</span> <span class="n">WEXITSTATUS</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="o">:</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
  <div class="footer">
      <div class="filename">
        <a href="/src/wait-for-process-group/wait-all-darwin.c" type="text/plain">wait-all-darwin.c</a>
      </div>
    </div>
  </div>


<p>And if we build and run it with the same same sample command as before:</p>

<pre><code>$ ./wait-all-darwin /bin/sh -c '/bin/sh -c &quot;sleep 5; echo 2&quot; &amp; echo 1'
1
2
$
</code></pre>

<p>you&rsquo;ll see that <code>wait-all-darwin</code> did not terminate until the nested subshell did, even though the outer shell exited quickly.</p>

<p>Great. <em>However</em>, be aware that this solution is <em>not</em> bullet-proof: if a subprocess creates a new process group, it will escape our algorithm and there is nothing we can do about it. (It looks like FreeBSD has a <code>NOTE_TRACK</code> event that could let us track those processes&hellip; but of course this doesn&rsquo;t exist on Darwin.) Anyway, in the context of <a href="/2019/11/bazel-process-wrapper.html">Bazel&rsquo;s process wrapper</a>, we are willing to live with this limitation.</p>

<p>Lastly note that this solution should be generalizable to other systems. In the worst case, you&rsquo;d need to use <code>ps(1)</code> to walk the process table, but you could still do it. The only issue is that you might race against other processes grabbing the PGID as described above, but it&rsquo;s a pretty unlikely scenario and maybe it can be fixed with some <code>SIGCHLD</code> magic.</p>
</article>
            </div>
          </div>

          <div class="container post-links">
            <div class="row">
              <div class="col-md-4 text-center"><a href="https://www.reddit.com/submit?title=Waiting&#43;for&#43;process&#43;groups%2C&#43;macOS&#43;edition&amp;url=https%3A%2F%2Fjmmv.dev%2F2019%2F11%2Fwait-for-process-group-darwin.html">
                  <img src="/images/badges/reddit.png"
                       alt="Reddit logo"
                       width="64" height="64">
                  <br>
                  <strong>Share on Reddit</strong>
                </a>
              </div>
              <div class="col-md-4 text-center"><a href="https://news.ycombinator.com/submitlink?t=Waiting&#43;for&#43;process&#43;groups%2C&#43;macOS&#43;edition&amp;u=https%3A%2F%2Fjmmv.dev%2F2019%2F11%2Fwait-for-process-group-darwin.html">
                  <img src="/images/badges/ycombinator.png"
                       alt="Hacker News logo"
                       width="64" height="64">
                  <br>
                  <strong>Share on Hacker News</strong>
                </a>
              </div>
              <div class="col-md-4 text-center"><a href="https://twitter.com/intent/tweet?status=Waiting&#43;for&#43;process&#43;groups%2C&#43;macOS&#43;edition&#43;%E2%80%94&#43;https%3A%2F%2Fjmmv.dev%2F2019%2F11%2Fwait-for-process-group-darwin.html&#43;%E2%80%94&#43;cc&#43;%40jmmv">
                  <img src="/images/badges/Twitter_Social_Icon_Circle_Color.png"
                       alt="Twitter logo"
                       width="64" height="64">
                  <br>
                  <strong>Share on Twitter</strong>
                </a>
              </div>
            </div>
          </div>

          <div class="container post-links">
            <div class="row">
              <div class="col-md mr-auto text-left">
                
                <span><a href="https://jmmv.dev/2019/11/wait-for-process-group-linux.html">&laquo; Previous post</a></span>
                
              </div>

              <div class="col-md text-center">
                <span><a href="/archive.html">All posts</a></span>
              </div>

              <div class="col-md ml-auto text-right">
                
                <span><a href="https://jmmv.dev/2019/11/macos-bash-baggage.html">Next post &raquo;</a></span>
                
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-3 sidebar">
          <div class="row">
  <div class="col">
    <h2>Subscribe</h2>

    <div class="row">
      <div class="col-sm-6 text-center">
        <p>
          <a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&amp;screen_name=jmmv">
            <img src="/images/badges/Twitter_logo_blue_32.png" alt="Follow @jmmv on Twitter">
          </a>
      </div>
      <div class="col-sm-6 text-center">
        <p><a href="/feed.xml"><img
          src="/images/badges/feed-icon-28x28.png" alt="RSS feed"></a></p>
      </div>
    </div>

    <script>
      function feedburnerSubmit() {
        window.open('https://feedburner.google.com/fb/a/mailverify?uri=jmmv', 'popupwindow', 'scrollbars=yes,width=550,height=520');
        gtag('event', 'sign_up', {'event_category': 'engagement', 'event_label': 'feedburner', 'value': 1 });
        return true;
      }
    </script>

    <form class="feedburner form-horizontal"
          action="https://feedburner.google.com/fb/a/mailverify"
          method="post"
          target="popupwindow"
          onsubmit="feedburnerSubmit()">
      <input type="text" name="email"
        placeholder="Type email, press enter"
        class="form-control input-sm"/>
      <input type="hidden" value="jmmv" name="uri"/>
      <input type="hidden" name="loc" value="en_US"/>
      <p>
        <small>Subscription by
        <a href="https://feedburner.google.com"
        target="_blank">FeedBurner</a></small>
      </p>
    </form>
  </div>
</div>

<div class="row">
  <div class="col">
    <h2>Featured posts</h2>

    <ul>
      
        <li><a href="/2020/05/bridging-the-web-gap-endbasic.html">Bridging the web gap in EndBASIC</a></li>
      
        <li><a href="/2020/04/hello-endbasic.html">Hello, EndBASIC!</a></li>
      
        <li><a href="/2020/01/system-rewrites-and-tuning.html">Ensuring system rewrites are truly necessary</a></li>
      
        <li><a href="/2019/09/rest-api-rust-go.html">Sample REST interface in Rust and Go</a></li>
      
        <li><a href="/2019/03/macos-threads-qos-and-bazel.html">Darwin&#39;s QoS service classes and performance</a></li>
      
      <li><a href="/essays.html#featured">More...</a></li>
    </ul>
  </div>
</div>

<div class="row">
  <div class="col">
    <h2>Archive</h2>

    <ul>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2020">2020</a> (17)
        <ul id="archive-year-2020" class="collapse">
        
          
          <li><a href="/archive.html#2020-08">August 2020</a> (3)</li>
        
          
          <li><a href="/archive.html#2020-07">July 2020</a> (2)</li>
        
          
          <li><a href="/archive.html#2020-06">June 2020</a> (2)</li>
        
          
          <li><a href="/archive.html#2020-05">May 2020</a> (3)</li>
        
          
          <li><a href="/archive.html#2020-04">April 2020</a> (2)</li>
        
          
          <li><a href="/archive.html#2020-03">March 2020</a> (2)</li>
        
          
          <li><a href="/archive.html#2020-02">February 2020</a> (1)</li>
        
          
          <li><a href="/archive.html#2020-01">January 2020</a> (2)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2019">2019</a> (24)
        <ul id="archive-year-2019" class="collapse">
        
          
          <li><a href="/archive.html#2019-12">December 2019</a> (8)</li>
        
          
          <li><a href="/archive.html#2019-11">November 2019</a> (6)</li>
        
          
          <li><a href="/archive.html#2019-10">October 2019</a> (1)</li>
        
          
          <li><a href="/archive.html#2019-09">September 2019</a> (2)</li>
        
          
          <li><a href="/archive.html#2019-03">March 2019</a> (2)</li>
        
          
          <li><a href="/archive.html#2019-02">February 2019</a> (3)</li>
        
          
          <li><a href="/archive.html#2019-01">January 2019</a> (2)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2018">2018</a> (25)
        <ul id="archive-year-2018" class="collapse">
        
          
          <li><a href="/archive.html#2018-07">July 2018</a> (3)</li>
        
          
          <li><a href="/archive.html#2018-06">June 2018</a> (7)</li>
        
          
          <li><a href="/archive.html#2018-05">May 2018</a> (2)</li>
        
          
          <li><a href="/archive.html#2018-04">April 2018</a> (2)</li>
        
          
          <li><a href="/archive.html#2018-03">March 2018</a> (8)</li>
        
          
          <li><a href="/archive.html#2018-02">February 2018</a> (3)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2017">2017</a> (6)
        <ul id="archive-year-2017" class="collapse">
        
          
          <li><a href="/archive.html#2017-10">October 2017</a> (1)</li>
        
          
          <li><a href="/archive.html#2017-08">August 2017</a> (1)</li>
        
          
          <li><a href="/archive.html#2017-07">July 2017</a> (1)</li>
        
          
          <li><a href="/archive.html#2017-02">February 2017</a> (3)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2016">2016</a> (8)
        <ul id="archive-year-2016" class="collapse">
        
          
          <li><a href="/archive.html#2016-09">September 2016</a> (1)</li>
        
          
          <li><a href="/archive.html#2016-05">May 2016</a> (1)</li>
        
          
          <li><a href="/archive.html#2016-04">April 2016</a> (1)</li>
        
          
          <li><a href="/archive.html#2016-03">March 2016</a> (2)</li>
        
          
          <li><a href="/archive.html#2016-02">February 2016</a> (1)</li>
        
          
          <li><a href="/archive.html#2016-01">January 2016</a> (2)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2015">2015</a> (17)
        <ul id="archive-year-2015" class="collapse">
        
          
          <li><a href="/archive.html#2015-12">December 2015</a> (2)</li>
        
          
          <li><a href="/archive.html#2015-10">October 2015</a> (2)</li>
        
          
          <li><a href="/archive.html#2015-09">September 2015</a> (3)</li>
        
          
          <li><a href="/archive.html#2015-06">June 2015</a> (2)</li>
        
          
          <li><a href="/archive.html#2015-05">May 2015</a> (3)</li>
        
          
          <li><a href="/archive.html#2015-04">April 2015</a> (1)</li>
        
          
          <li><a href="/archive.html#2015-03">March 2015</a> (1)</li>
        
          
          <li><a href="/archive.html#2015-02">February 2015</a> (3)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2014">2014</a> (12)
        <ul id="archive-year-2014" class="collapse">
        
          
          <li><a href="/archive.html#2014-11">November 2014</a> (2)</li>
        
          
          <li><a href="/archive.html#2014-05">May 2014</a> (3)</li>
        
          
          <li><a href="/archive.html#2014-03">March 2014</a> (1)</li>
        
          
          <li><a href="/archive.html#2014-02">February 2014</a> (3)</li>
        
          
          <li><a href="/archive.html#2014-01">January 2014</a> (3)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2013">2013</a> (62)
        <ul id="archive-year-2013" class="collapse">
        
          
          <li><a href="/archive.html#2013-12">December 2013</a> (7)</li>
        
          
          <li><a href="/archive.html#2013-11">November 2013</a> (7)</li>
        
          
          <li><a href="/archive.html#2013-10">October 2013</a> (7)</li>
        
          
          <li><a href="/archive.html#2013-09">September 2013</a> (13)</li>
        
          
          <li><a href="/archive.html#2013-08">August 2013</a> (9)</li>
        
          
          <li><a href="/archive.html#2013-07">July 2013</a> (10)</li>
        
          
          <li><a href="/archive.html#2013-06">June 2013</a> (9)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2012">2012</a> (29)
        <ul id="archive-year-2012" class="collapse">
        
          
          <li><a href="/archive.html#2012-10">October 2012</a> (1)</li>
        
          
          <li><a href="/archive.html#2012-09">September 2012</a> (1)</li>
        
          
          <li><a href="/archive.html#2012-08">August 2012</a> (3)</li>
        
          
          <li><a href="/archive.html#2012-07">July 2012</a> (2)</li>
        
          
          <li><a href="/archive.html#2012-06">June 2012</a> (2)</li>
        
          
          <li><a href="/archive.html#2012-05">May 2012</a> (3)</li>
        
          
          <li><a href="/archive.html#2012-04">April 2012</a> (1)</li>
        
          
          <li><a href="/archive.html#2012-03">March 2012</a> (1)</li>
        
          
          <li><a href="/archive.html#2012-02">February 2012</a> (10)</li>
        
          
          <li><a href="/archive.html#2012-01">January 2012</a> (5)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2011">2011</a> (60)
        <ul id="archive-year-2011" class="collapse">
        
          
          <li><a href="/archive.html#2011-12">December 2011</a> (4)</li>
        
          
          <li><a href="/archive.html#2011-11">November 2011</a> (4)</li>
        
          
          <li><a href="/archive.html#2011-10">October 2011</a> (5)</li>
        
          
          <li><a href="/archive.html#2011-09">September 2011</a> (11)</li>
        
          
          <li><a href="/archive.html#2011-08">August 2011</a> (6)</li>
        
          
          <li><a href="/archive.html#2011-07">July 2011</a> (4)</li>
        
          
          <li><a href="/archive.html#2011-06">June 2011</a> (6)</li>
        
          
          <li><a href="/archive.html#2011-05">May 2011</a> (6)</li>
        
          
          <li><a href="/archive.html#2011-04">April 2011</a> (5)</li>
        
          
          <li><a href="/archive.html#2011-03">March 2011</a> (2)</li>
        
          
          <li><a href="/archive.html#2011-01">January 2011</a> (7)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2010">2010</a> (26)
        <ul id="archive-year-2010" class="collapse">
        
          
          <li><a href="/archive.html#2010-12">December 2010</a> (7)</li>
        
          
          <li><a href="/archive.html#2010-09">September 2010</a> (1)</li>
        
          
          <li><a href="/archive.html#2010-07">July 2010</a> (1)</li>
        
          
          <li><a href="/archive.html#2010-06">June 2010</a> (2)</li>
        
          
          <li><a href="/archive.html#2010-05">May 2010</a> (5)</li>
        
          
          <li><a href="/archive.html#2010-04">April 2010</a> (5)</li>
        
          
          <li><a href="/archive.html#2010-03">March 2010</a> (3)</li>
        
          
          <li><a href="/archive.html#2010-01">January 2010</a> (2)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2009">2009</a> (31)
        <ul id="archive-year-2009" class="collapse">
        
          
          <li><a href="/archive.html#2009-10">October 2009</a> (1)</li>
        
          
          <li><a href="/archive.html#2009-09">September 2009</a> (1)</li>
        
          
          <li><a href="/archive.html#2009-08">August 2009</a> (3)</li>
        
          
          <li><a href="/archive.html#2009-07">July 2009</a> (2)</li>
        
          
          <li><a href="/archive.html#2009-06">June 2009</a> (4)</li>
        
          
          <li><a href="/archive.html#2009-05">May 2009</a> (6)</li>
        
          
          <li><a href="/archive.html#2009-04">April 2009</a> (2)</li>
        
          
          <li><a href="/archive.html#2009-03">March 2009</a> (4)</li>
        
          
          <li><a href="/archive.html#2009-01">January 2009</a> (8)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2008">2008</a> (61)
        <ul id="archive-year-2008" class="collapse">
        
          
          <li><a href="/archive.html#2008-12">December 2008</a> (1)</li>
        
          
          <li><a href="/archive.html#2008-11">November 2008</a> (4)</li>
        
          
          <li><a href="/archive.html#2008-10">October 2008</a> (6)</li>
        
          
          <li><a href="/archive.html#2008-09">September 2008</a> (1)</li>
        
          
          <li><a href="/archive.html#2008-08">August 2008</a> (6)</li>
        
          
          <li><a href="/archive.html#2008-07">July 2008</a> (14)</li>
        
          
          <li><a href="/archive.html#2008-06">June 2008</a> (3)</li>
        
          
          <li><a href="/archive.html#2008-05">May 2008</a> (1)</li>
        
          
          <li><a href="/archive.html#2008-04">April 2008</a> (3)</li>
        
          
          <li><a href="/archive.html#2008-03">March 2008</a> (3)</li>
        
          
          <li><a href="/archive.html#2008-02">February 2008</a> (9)</li>
        
          
          <li><a href="/archive.html#2008-01">January 2008</a> (10)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2007">2007</a> (86)
        <ul id="archive-year-2007" class="collapse">
        
          
          <li><a href="/archive.html#2007-12">December 2007</a> (4)</li>
        
          
          <li><a href="/archive.html#2007-11">November 2007</a> (7)</li>
        
          
          <li><a href="/archive.html#2007-10">October 2007</a> (2)</li>
        
          
          <li><a href="/archive.html#2007-09">September 2007</a> (8)</li>
        
          
          <li><a href="/archive.html#2007-08">August 2007</a> (6)</li>
        
          
          <li><a href="/archive.html#2007-07">July 2007</a> (15)</li>
        
          
          <li><a href="/archive.html#2007-06">June 2007</a> (15)</li>
        
          
          <li><a href="/archive.html#2007-05">May 2007</a> (4)</li>
        
          
          <li><a href="/archive.html#2007-04">April 2007</a> (10)</li>
        
          
          <li><a href="/archive.html#2007-03">March 2007</a> (8)</li>
        
          
          <li><a href="/archive.html#2007-02">February 2007</a> (1)</li>
        
          
          <li><a href="/archive.html#2007-01">January 2007</a> (6)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2006">2006</a> (103)
        <ul id="archive-year-2006" class="collapse">
        
          
          <li><a href="/archive.html#2006-12">December 2006</a> (4)</li>
        
          
          <li><a href="/archive.html#2006-11">November 2006</a> (3)</li>
        
          
          <li><a href="/archive.html#2006-10">October 2006</a> (7)</li>
        
          
          <li><a href="/archive.html#2006-09">September 2006</a> (6)</li>
        
          
          <li><a href="/archive.html#2006-08">August 2006</a> (13)</li>
        
          
          <li><a href="/archive.html#2006-07">July 2006</a> (4)</li>
        
          
          <li><a href="/archive.html#2006-06">June 2006</a> (13)</li>
        
          
          <li><a href="/archive.html#2006-05">May 2006</a> (7)</li>
        
          
          <li><a href="/archive.html#2006-04">April 2006</a> (9)</li>
        
          
          <li><a href="/archive.html#2006-03">March 2006</a> (6)</li>
        
          
          <li><a href="/archive.html#2006-02">February 2006</a> (13)</li>
        
          
          <li><a href="/archive.html#2006-01">January 2006</a> (18)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2005">2005</a> (129)
        <ul id="archive-year-2005" class="collapse">
        
          
          <li><a href="/archive.html#2005-12">December 2005</a> (9)</li>
        
          
          <li><a href="/archive.html#2005-11">November 2005</a> (7)</li>
        
          
          <li><a href="/archive.html#2005-10">October 2005</a> (23)</li>
        
          
          <li><a href="/archive.html#2005-09">September 2005</a> (10)</li>
        
          
          <li><a href="/archive.html#2005-08">August 2005</a> (14)</li>
        
          
          <li><a href="/archive.html#2005-07">July 2005</a> (5)</li>
        
          
          <li><a href="/archive.html#2005-06">June 2005</a> (12)</li>
        
          
          <li><a href="/archive.html#2005-05">May 2005</a> (6)</li>
        
          
          <li><a href="/archive.html#2005-04">April 2005</a> (6)</li>
        
          
          <li><a href="/archive.html#2005-03">March 2005</a> (13)</li>
        
          
          <li><a href="/archive.html#2005-02">February 2005</a> (11)</li>
        
          
          <li><a href="/archive.html#2005-01">January 2005</a> (13)</li>
        
        </ul>
      </li>
    
      <li>
        
        <a data-toggle="collapse" href="#archive-year-2004">2004</a> (84)
        <ul id="archive-year-2004" class="collapse">
        
          
          <li><a href="/archive.html#2004-12">December 2004</a> (9)</li>
        
          
          <li><a href="/archive.html#2004-11">November 2004</a> (6)</li>
        
          
          <li><a href="/archive.html#2004-10">October 2004</a> (11)</li>
        
          
          <li><a href="/archive.html#2004-09">September 2004</a> (19)</li>
        
          
          <li><a href="/archive.html#2004-07">July 2004</a> (29)</li>
        
          
          <li><a href="/archive.html#2004-06">June 2004</a> (10)</li>
        
        </ul>
      </li>
    
    </ul>
  </div>
</div>

        </div>
      </div>
    </div>

    <footer class="container">
  <div class="row">
    <div class="col order-2 texr-right">
      <p class="float-right"><a href="#">Back to top</a></p>
    </div>
    <div class="col order-1 mr-auto">
      <p>Copyright 2004&ndash;2020 Julio Merino</p>
    </div>
  </div>
</footer>

<script src="/js/jquery-1.11.2.min.js"></script>
<script src="/js/bootstrap.min.js"></script>

<script>
$('article :header').each(function() {
  var attr = $(this).attr('id');
  if (typeof attr !== typeof undefined && attr !== false) {
    $(this).append('<a class="anchor" href="#' + $(this).context.id + '">' +
      '<img src="/octicons/link.svg" aria-hidden="true">' +
      '</a>')
  }
})
</script>

<script>
$("blockquote").addClass("blockquote");
$("pre.chroma").addClass("pre-scrollable");

$("p:contains('NOTE: ')").addClass("callout callout-info");
$("p:contains('IMPORTANT: ')").addClass("callout callout-info");
$("p:contains('WARNING: ')").addClass("callout callout-warning");
$("p:contains('DANGER: ')").addClass("callout callout-danger");
</script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-63557333-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-63557333-1');
</script>

  </body>
</html>
