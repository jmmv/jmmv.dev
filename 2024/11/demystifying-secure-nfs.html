<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml xmlns:fb=http://ogp.me/ns/fb#><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta property="og:site_name" content="Julio Merino (jmmv.dev)"><meta property="twitter:site" content="@jmmv"><title>Demystifying secure NFS - Julio Merino (jmmv.dev)</title>
<meta property="og:title" content="Demystifying secure NFS - Julio Merino (jmmv.dev)"><meta property="twitter:title" content="Demystifying secure NFS - Julio Merino (jmmv.dev)"><meta name=description content="I recently got a Synology DS923+ for evaluation purposes which led me to setting up NFSv4 with Kerberos. I had done this about a year ago with FreeBSD as the host, and going through this process once again reminded me of how painful it is to secure an NFS connection.
You see, Samba is much easier to set up, but because NFS is the native file sharing protocol of Unix systems, I felt compelled to use it instead. However, if you opt for NFSv3 (the &ldquo;easy default&rdquo;), you are left with a system that has zero security: traffic travels unencrypted and unsigned, and the server trusts the client when the client asserts who is who. Madness for today&rsquo;s standards. Yet, when you look around, people say &ldquo;oh, but NFSv3 is fine if you trust the network!&rdquo; But seriously, who trusts the network in this day and age?
You have to turn to NFSv4 and combine it with Kerberos for a secure file sharing option. And let me tell you: the experience of setting these up and getting things to work is horrible, and the documentation out there is terrible. Most documents are operating-system specific so they only tell you what works when a specific server and a specific client talk to each other. Other documents just assume, and thus omit, various important details of the configuration.
So. This article is my recollection of &ldquo;lab notes&rdquo; on how to set this whole thing up along with the necessary background to understand NFSv4 and Kerberos. My specific setup involes the Synology DS923+ as the NFSv4 server; Fedora, Debian, and FreeBSD clients; and the supporting KDC on a pfSense (or FreeBSD) box.
"><meta property="og:description" content="I recently got a Synology DS923+ for evaluation purposes which led me to setting up NFSv4 with Kerberos. I had done this about a year ago with FreeBSD as the host, and going through this process once again reminded me of how painful it is to secure an NFS connection.
You see, Samba is much easier to set up, but because NFS is the native file sharing protocol of Unix systems, I felt compelled to use it instead. However, if you opt for NFSv3 (the &ldquo;easy default&rdquo;), you are left with a system that has zero security: traffic travels unencrypted and unsigned, and the server trusts the client when the client asserts who is who. Madness for today&rsquo;s standards. Yet, when you look around, people say &ldquo;oh, but NFSv3 is fine if you trust the network!&rdquo; But seriously, who trusts the network in this day and age?
You have to turn to NFSv4 and combine it with Kerberos for a secure file sharing option. And let me tell you: the experience of setting these up and getting things to work is horrible, and the documentation out there is terrible. Most documents are operating-system specific so they only tell you what works when a specific server and a specific client talk to each other. Other documents just assume, and thus omit, various important details of the configuration.
So. This article is my recollection of &ldquo;lab notes&rdquo; on how to set this whole thing up along with the necessary background to understand NFSv4 and Kerberos. My specific setup involes the Synology DS923+ as the NFSv4 server; Fedora, Debian, and FreeBSD clients; and the supporting KDC on a pfSense (or FreeBSD) box.
"><meta property="twitter:description" content="I recently got a Synology DS923+ for evaluation purposes which led me to setting up NFSv4 with Kerberos. I had done this about a year ago with FreeBSD as the host, and going through this process once …"><meta name=author content="Julio Merino"><meta property="twitter:creator" content="@jmmv"><meta name=generator content="Hugo 0.136.5"><meta property="og:url" content="https://jmmv.dev/2024/11/demystifying-secure-nfs.html"><meta property="og:type" content="blog"><meta property="twitter:card" content="summary"><link rel=canonical href=https://jmmv.dev/2024/11/demystifying-secure-nfs.html><link rel=alternate type=application/rss+xml title="Julio Merino (jmmv.dev)" href=/feed.xml><link rel=stylesheet href=/sass/main.min.cb91349cd93211a37e7d5dc131c35a170fc795721c03373cd05571327eea206b.css><link rel=stylesheet href=/css/chroma.css><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicons/favicon-96x96.png sizes=96x96><meta property="og:image" content="/images/2024-11-03-synology-ds923plus-nas.jpg"><meta property="twitter:image" content="https://jmmv.dev/images/2024-11-03-synology-ds923plus-nas.jpg"><script>const SITE_ID="e8da9f62-b7ac-4fe9-bf20-7c527199a376",BASE_URL="https://jmmv.dev/"</script></head><body><img src="https://hugo-dynamic.jmmv.dev/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/pages/aHR0cHM6Ly9qbW12LmRldi8yMDI0LzExL2RlbXlzdGlmeWluZy1zZWN1cmUtbmZzLmh0bWw=/stamp.gif" style=display:none>
<script>window.location.replace("https://blogsystem5.substack.com/p/demystifying-secure-nfs")</script><header class=site-header><nav class="navbar navbar-expand-md fixed-top navbar-dark bg-primary"><a class=navbar-brand href=/><img src=/images/favicons/favicon-30x30.png width=30 height=30 class="d-inline-block align-top" alt>
&nbsp;jmmv.dev
</a><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/about.html>About</a></li><li class=nav-item><a class=nav-link href=/blog.html>Blog</a></li><li class=nav-item><a class=nav-link href=/resume.html>Resume</a></li><li class=nav-item><a class=nav-link href=/software.html>Software</a></li></ul><ul class="navbar-nav mr-4"><li class=nav-item><a class=nav-link href=/archive.html>Archive</a></li><li class=nav-item><a class=nav-link href=/series.html>Series</a></li><li class=nav-item><a class=nav-link href=/tags.html>Tags</a></li></ul><form class=form-inline method=get role=search action=https://www.google.com/search><div class=input-group><input type=search name=query class=form-control placeholder=Search aria-label=Search><div class=input-group-append><button type=submit value=Search class="btn btn-light">
<img src=/octicons/search.svg></button></div></div><input type=hidden name=sitesearch value=https://jmmv.dev/></form></div></nav></header><div class=page-header><div class=container><h1>Demystifying secure NFS</h1><p>November 3, 2024 &#183;
About 24 minutes
&#183;
Tags:
<a href=/tags/blogsystem5>blogsystem5</a>, <a href=/tags/unix>unix</a></p><p class=post-meta-p>This article was
<a href=https://blogsystem5.substack.com/p/demystifying-secure-nfs>originally published
on Substack</a>
in the <a href=https://blogsystem5.substack.com/>Blog System/5 newsletter</a>
and is replicated here for archival purposes.</p><figure class=cover-image><img src=/images/2024-11-03-synology-ds923plus-nas.jpg style=max-width:100%></figure></div></div><div class="container post-body"><div class=row><div class=col-md-9><div class=row><div class=col><article><p>I recently got a <a href=https://sy.to/hekgh>Synology DS923+</a> for evaluation purposes which led me to setting up NFSv4 with Kerberos. I had done this about a year ago with FreeBSD as the host, and going through this process once again reminded me of how painful it is to secure an NFS connection.</p><p>You see, Samba is much easier to set up, but because NFS is the native file sharing protocol of Unix systems, I felt compelled to use it instead. However, if you opt for NFSv3 (the &ldquo;easy default&rdquo;), you are left with a system that has zero security: traffic travels unencrypted and unsigned, and the server trusts the client when the client asserts who is who. Madness for today&rsquo;s standards. Yet, when you look around, people say &ldquo;oh, but NFSv3 is fine if you trust the network!&rdquo; But seriously, who trusts the network in this day and age?</p><p>You have to turn to NFSv4 <em>and</em> combine it with Kerberos for a secure file sharing option. And let me tell you: the experience of setting these up and getting things to work is horrible, and the documentation out there is terrible. Most documents are operating-system specific so they only tell you what works when a specific server and a specific client talk to each other. Other documents just <em>assume</em>, and thus omit, various important details of the configuration.</p><p>So. This article is my recollection of &ldquo;lab notes&rdquo; on how to set this whole thing up along with the necessary background to understand NFSv4 and Kerberos. My specific setup involes the Synology DS923+ as the NFSv4 server; Fedora, Debian, and FreeBSD clients; and the supporting KDC on a pfSense (or FreeBSD) box.</p><div class="container action-highlight p-4 my-4 d-md-none"><div class="row text-center"><p>A blog on operating systems, programming languages, testing, build systems, my own software
projects and even personal productivity. Specifics include FreeBSD, Linux, Rust, Bazel and
EndBASIC.</p></div><div class=row><div class=col><div class=form-group><form action=https://endtracker.azurewebsites.net/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/subscribers/add method=post><input type=text name=email placeholder="Enter your email" class="form-control input-sm text-center my-1">
<button type=submit class="btn btn-primary btn-block my-1">Subscribe</button></form></div></div></div><div class="row px-2"><div class="col col-sm-5 text-left"><small><span class=subscriber-count>0</span> subscribers</small></div><div class="col col-sm-7 text-right"><p><a rel=me href=https://mastodon.online/@jmmv><img src=/images/badges/mastodon-logo.svg width=32px height=32px alt="Follow @jmmv on Mastodon">
</a><a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&amp;screen_name=jmmv"><img src=/images/badges/Twitter_logo_blue.svg width=32px height=32px alt="Follow @jmmv on Twitter">
</a><a href=/feed.xml><img src=/images/badges/feed-icon-28x28.png alt="RSS feed"></a></p></div></div></div><h1 id=nfsv3s-insecurity>NFSv3&rsquo;s insecurity</h1><p>NFSv3, or usually just NFS, is a protocol from the 1980s&mdash;and it shows. In broad terms, NFSv3 exposes the <em>inodes</em> of the underlying file system to the network. This became clear to me when I implemented <a href=/software/tmpfs.html>tmpfs for NetBSD</a> in 2005 and realized that a subset of the APIs I had to support were in service of NFS. This was&mldr; a mind-blowing realization. <em>&ldquo;Why would tmpfs, a memory file system, need NFS-specific glue?&rdquo;</em>, I thought, and then I learned the bad stuff.</p><p>Anyhow. Now that you know that NFSv3 exposes inodes, you may understand why sharing a directory over NFSv3 is an all-or-nothing option for <em>the whole file system</em>. Even if you can configure <code>mountd</code> to export a single directory via <code>/etc/exports</code>, malicious clients can craft NFS RPCs that reference inodes outside of the shared directory. Which means&mldr; they get free access to the whole file system and explains why system administrators used to put NFS-exported shares in separate partitions, mounted under <code>/export/</code>, in an attempt to isolate access to subsets of data.</p><p>To make things worse, NFSv3 has no concept of security. A client can simply assert that a request comes from UID 1000 and the server will <em>trust</em> that the client is really operating on behalf of the server&rsquo;s UID 1000. Which means: a malicious client can pretend to be <em>any</em> user that exists on the server and gain access to <em>any</em> file in the exported file system. Which then explains why the <code>maproot</code> option exists as an attempt to avoid impersonating root&mldr; but only root. Crazy talk.</p><p>All in all, NFSv3 may still be OK if you really trust the network, if you compartmentalize the exported file system, and if you are sharing inconsequential stuff. But can <em>you</em> trust the network? Maybe you can if you are using a P2P link, but otherwise&mldr; it is really, really risky and I do not want to do that.</p><h1 id=how-is-nfsv4-better>How is NFSv4 better?</h1><p>NFSv4, despite having the same NFS name as NFSv3, is a completely different protocol. Here are two main differences:</p><ul><li><p><strong>NFSv4 operates on the basis of usernames, not UIDs.</strong> Each request to the server contains a username and the server is responsible for translating that username to a local UID while verifying access permissions.</p></li><li><p><strong>NFSv4 operates at the path level, not the inode level.</strong> Each request to the server contains the path of the file to operate on and thus the server can apply access control based on those.</p></li></ul><p>Take these two differences together and NFSv4 can implement secure access to file systems. Because the server sees usernames and paths, the server can first verify that a user is who they claim to be. And because the server can authenticate users, it can then authorize accesses at the path level.</p><p>That said, if all you have is NFSv4, you only get the <code>AUTH_SYS</code> security level, which is&mldr; the same as having no security at all. In this mode, the server trusts the client and assumes that user X on the client maps exactly to user X on the server, which is almost the same as NFSv3 did.</p><p>The real security features of NFSv4 come into play when it&rsquo;s paired with Kerberos. When Kerberos is in the picture, you get to choose from the following security levels for each network share:</p><ul><li><p><code>krb5</code>: Requires requests to be authenticated by Kerberos, which is good to ensure only trusted users access what they should but offers zero &ldquo;on-the-wire&rdquo; security. Traffic flows unsigned and unencrypted, so an attacker could tamper with the data and slurp it before it reaches the client.</p></li><li><p><code>krb5i</code>: Builds on <code>krb5</code> to offer integrity checks on all data. Basically, all packets on the network are signed but not encrypted. This prevents spoofing packets but does not secure the data against prying eyes.</p></li><li><p><code>krb5p</code>: Builds on <code>krb5</code> to offer encrypted data on the wire. This prevents tampering with the network traffic and also avoids anyone from seeing what&rsquo;s being transferred.</p></li></ul><p>Sounds good? Yeah, but unfortunately, Kerberos and its ecosystem are&mldr; complicated.</p><h1 id=kerberos-101>Kerberos 101</h1><p>Kerberos is an authentication broker. Its goal is to detach authentication decisions between a client machine and a service running on a second machine, and move that responsibility to a third machine&mdash;the Kerberos Domain Controller (KDC). Consequently, the KDC is a trusted entity between the two machines that try to communicate with each other.</p><p>All the machines that interact with the KDC form a <em>realm</em> (AKA a <em>domain</em>, but not a DNS domain). Each machine needs an <code>/etc/krb5.conf</code> file that describes which realms the machine belongs to and who the KDC for each realm is.</p><p>The actors that exist within the realm are the <em>principals</em>. The KDC maintains the authoritative list of principals and their authentication keys (passwords). These principals represent:</p><ul><li><p><strong>Users</strong>, which have names of the form <code>&lt;username>@REALM</code>. There has to be one of these principals for every person (or role) that interacts with the system.</p></li><li><p><strong>Machines</strong>, which have names of the form <code>host/&lt;machine>.&lt;domain>@REALM</code>. There has to be one of these principals for every server, and, depending on the service, the clients may need one too as is the case for NFSv4.</p></li><li><p><strong>Services</strong>, which have names of the form <code>&lt;service>/&lt;machine>.&lt;domain>@REALM</code>. Some services like NFSv4 require one of these, in which case <code>&lt;service></code> is <code>nfs</code>, but others like SSH do not.</p></li></ul><p>Let&rsquo;s say Alice wants to log into the Kerberos-protected SSH service running on SshServer from a client called LinuxLaptop, all within the <code>EXAMPLE.ORG</code> Kerberos realm.</p><p><em>(Beware that the description below is not 100% accurate. My goal is for you to understand the main concepts so that you can operate a Kerberos realm.)</em></p><p>First, Alice needs to obtain a Ticket-Granting-Ticket (TGT) if she doesn&rsquo;t have a valid one yet. This ticket is issued by the KDC after authenticating Alice with her password, and allows Alice to later obtain service-specific tickets without having to provide her password again. For this flow:</p><figure><img src=/images/2024-11-03-demystifying-secure-nfs-kerberos-tgt-exchange.png class=with-border><figcaption>Steps involved in obtaining a TGT from the KDC for a user on a client machine.</figcaption></figure><ol><li><p>Alice issues a login request to the KDC from the client LinuxLaptop by typing <code>kinit</code> (or using other tools such as a PAM module). This request carries Alice&rsquo;s password.</p></li><li><p>The KDC validates Alice&rsquo;s authenticity by checking her password against the KDC&rsquo;s database and issues a TGT. The TGT is encrypted with the KDC&rsquo;s key and includes an assertion of who Alice is and how long the ticket is valid for.</p></li><li><p>The client LinuxLaptop stores the TGT on disk. Alice can issue <code>klist</code> to see the ticket:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>linux-laptop$ klist
</span></span><span class=line><span class=cl>Credentials cache: FILE:/tmp/krb5cc_1001
</span></span><span class=line><span class=cl>        Principal: alice@EXAMPLE.ORG
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Issued                Expires               Principal
</span></span><span class=line><span class=cl>Oct 26 09:04:57 2024  Oct 26 19:05:01 2024  krbtgt/EXAMPLE.ORG@EXAMPLE.ORG
</span></span><span class=line><span class=cl>linux-laptop$ █
</span></span></code></pre></div></li></ol><p>The TGT, however, is not sufficient to access a service. When Alice wants to access the Kerberos-protected SSH service running on the SshServer machine, Alice needs a ticket that&rsquo;s specific to that service. For this flow:</p><figure><img src=/images/2024-11-03-demystifying-secure-nfs-kerberos-tgs-exchange.png class=with-border><figcaption>Steps involved in obtaining a service-specific ticket from the KDC for a user on a client machine.</figcaption></figure><ol><li><p>Alice sends a request to the Ticket-Granting-Service (KDS) and asks for a ticket to SshServer. This request carries the TGT.</p></li><li><p>The TGS (which lives in the KDC) verifies who the TGT belongs to and verifies that it&rsquo;s still valid. If so, the TGS generates a ticket for the service. This ticket is encrypted with the service&rsquo;s secret key and includes details on who Alice is and how long the ticket is valid for.</p></li><li><p>The client LinuxLaptop stores the service ticket on disk. As before, Alice can issue <code>klist</code> to see the ticket:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>linux-laptop$ klist
</span></span><span class=line><span class=cl>Credentials cache: FILE:/tmp/krb5cc_1001
</span></span><span class=line><span class=cl>        Principal: alice@EXAMPLE.ORG
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Issued                Expires               Principal
</span></span><span class=line><span class=cl>Oct 26 09:04:57 2024  Oct 26 19:05:01 2024  krbtgt/EXAMPLE.ORG@EXAMPLE.ORG
</span></span><span class=line><span class=cl>Oct 26 09:05:11 2024  Oct 26 19:05:01 2024  host/ssh-server.example.org@EXAMPLE.ORG
</span></span><span class=line><span class=cl>linux-laptop$ █
</span></span></code></pre></div></li></ol><p>At this point, all prerequisite Kerberos flows have taken place. Alice can now initiate the connection to the SSH service:</p><figure><img src=/images/2024-11-03-demystifying-secure-nfs-kerberos-ssh-access.png class=with-border><figcaption>Accessing a remote SSH server using a Kerberos ticket without password authentication.</figcaption></figure><ol><li><p>Alice sends the login request from the LinuxLaptop client to the SshServer server and presents the service/host-specific ticket that was granted to her earlier on.</p></li><li><p>The SshServer server decrypts the ticket with its own key, extracts details of who the request is from, and verifies that they are correct. This happens <em>without talking to the KDC</em> and is only possible because SshServer trusts the KDC via a pre-shared key.</p></li><li><p>The SSH service on SshServer decides if Alice has SSH access as requested and, if so, grants such access.</p></li></ol><p>Note these very important details:</p><ul><li><p><strong>The KDC is only involved in the ticket issuance process.</strong> Once the client has a service ticket, all interactions between the client and the server happen <em>without</em> talking to the KDC. This is essential to not make the KDC a bottleneck in the communication.</p></li><li><p><strong>Each host/service and the KDC have unique shared keys that are known by both the host/service and the KDC.</strong> These shared keys are created when registering the host or service principals and are copied to the corresponding machines as part of their initial setup. These keys live in machine-specific <code>/etc/krb5.keytab</code> files.</p></li><li><p><strong>Kerberos does authentication only, not authorization.</strong> The decision to grant Alice access to the SSH service in Think is made by the service itself, not Kerberos, after asserting that Alice is truly Alice.</p></li></ul><p>As you can imagine, the KDC must be protected with the utmost security measures. If an attacker can compromise the KDC&rsquo;s locally-stored database, they will get access to all shared keys so they can impersonate any user against any Kerberos-protected service in the network. That&rsquo;s why attackers try to breach into an Active Directory (AD) service as soon as they infiltrate a Microsoft network because&mldr; AD <em>is</em> a KDC.</p><h1 id=setting-up-the-kdc>Setting up the KDC</h1><p>Enough theory. Let&rsquo;s get our hands dirty and follow the necessary steps to set up a KDC.</p><p>The KDC&rsquo;s needs are really modest. Per the discussion above, the KDC isn&rsquo;t in the hot data path of any service so the number of requests it receives are limited. Those requests are not particularly complex to serve either: at most, there is some CPU time to process cryptographic material but no I/O involved, so for a small network, any machine will do.</p><p>In my particular case, I set up the KDC in my little pfSense box as it is guaranteed to be almost-always online. This is probably not the best of ideas security-wise, but&mldr; it&rsquo;s sufficient for my paranoia levels. Note that most of the steps below will work similarly on a FreeBSD box, but if you are attempting that, please go read <a href=https://docs.freebsd.org/en/books/handbook/security/#kerberos5>FreeBSD&rsquo;s official docs on the topic</a> instead. Those docs are one of the few decent guides on Kerberos out there.</p><figure><img src=/images/2024-11-03-pfsense-router.jpg><figcaption>The pfSense little box that I run the KDC on.</figcaption></figure><p>Here are the actors that will appear throughout the rest of this article. I&rsquo;m using the real names of my setup here because, once again, these are my lab notes:</p><ul><li><code>MEROH.NET</code>: The name of the Kerberos realm.</li><li><code>jmmv</code>: The user on the client machine wanting access to the NFSv4 share. The UID is irrelevant.</li><li><code>router.meroh.net</code>: The pfSense box running the KDC.</li><li><code>nas.meroh.net</code>: The Synology DS923+ NAS acting as the NFSv4 server.</li><li><code>think.meroh.net</code>: A FreeBSD machine that will act as a Kerberized SSH server for testing purposes and an NFSv4 client. (It&rsquo;s a ThinkStation, hence its name.)</li><li><code>x1nano.meroh.net</code>: A Linux machine that will act as an NFSv4 client. While in reality this is running Fedora, I&rsquo;ll use this hostname interchangeably for Fedora and Debian.</li></ul><p>Knowing all actors, we can set up the KDC. The first step is to create the <code>krb5.conf</code> for the KDC which tells the system which realm the machine belongs to. You&rsquo;ll have to open up SSH access to the machine via the web interface to perform these steps.</p><p>Here is the minimum content you need:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>[libdefaults]
</span></span><span class=line><span class=cl>    default_realm = MEROH.NET
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[realms]
</span></span><span class=line><span class=cl>MEROH.NET = {
</span></span><span class=line><span class=cl>    kdc = router.meroh.net
</span></span><span class=line><span class=cl>    admin_server = router.meroh.net
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[domain_realm]
</span></span><span class=line><span class=cl>    .meroh.net = MEROH.NET
</span></span></code></pre></div><p>With that, you should be able to start the <code>kdc</code> service, which is responsible for the KDC. All documentation you find out there will tell you to also start <code>kadmind</code>, but if you don&rsquo;t plan to do administer the KDC from another machine (why would you?), then you don&rsquo;t need this service.</p><p>pfSense&rsquo;s configuration is weird because of the read-only nature of its root partition, so to do this, you have to edit the <code>/cf/conf/config.xml</code> file stored in NVRAM and add this line right before the closing <code>&lt;/system></code> tag:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;shellcmd&gt;</span>service kdc start<span class=nt>&lt;/shellcmd&gt;</span>
</span></span></code></pre></div><p>If you were to set this up on a FreeBSD host instead of pfSense, you would modify <code>/etc/rc.conf</code> instead and add:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nv>kdc_enable</span><span class=o>=</span>YES
</span></span></code></pre></div><p>Then, from the root shell on either case:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>kdc# service kdc start
</span></span><span class=line><span class=cl>kdc# █
</span></span></code></pre></div><p>It is now a good time to ensure that every machine involved in the realm has a DNS record and that reverse DNS lookups work. Failure to do this will cause problems later on when attempting to mount the NFSv4 shares, and clearing those errors won&rsquo;t be trivial because of caching at various levels.</p><h1 id=creating-principals>Creating principals</h1><p>Once the KDC is running, we must create principals for the hosts, the NFSv4 service, and the users that will be part of the realm. The client host and service principals aren&rsquo;t always necessary though: SSH doesn&rsquo;t require them, but NFSv4 does.</p><p>To create the principals, we need access the KDC&rsquo;s administrative console. Given that the KDC isn&rsquo;t configured yet, we can only gain such access by running <code>kadmin -l</code> on the KDC machine directly (the pfSense shell), which bypasses the networked <code>kadmind</code> service that we did not start.</p><p>Start <code>kadmin -l</code> and initialize the realm:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>kdc# kadmin -l
</span></span><span class=line><span class=cl>kadmin&gt; init MEROH.NET
</span></span><span class=line><span class=cl>... answer questions with defaults ...
</span></span><span class=line><span class=cl>kadmin&gt; █
</span></span></code></pre></div><p>Next, create principals for the <em>users</em> that will be part of the realm:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>kadmin&gt; add jmmv
</span></span><span class=line><span class=cl>... answer questions with defaults ...
</span></span><span class=line><span class=cl>... but enter the desired user password ...
</span></span><span class=line><span class=cl>kadmin&gt; █
</span></span></code></pre></div><p>Then, create principals for the <em>hosts</em> (server and clients, but not the KDC) and the NFSv4 <em>service</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>kadmin&gt; add --random-key host/think.meroh.net
</span></span><span class=line><span class=cl>... answer questions with defaults ...
</span></span><span class=line><span class=cl>kadmin&gt; add --random-key host/x1nano.meroh.net
</span></span><span class=line><span class=cl>... answer questions with defaults ...
</span></span><span class=line><span class=cl>kadmin&gt; add --random-key host/nas.meroh.net
</span></span><span class=line><span class=cl>... answer questions with defaults ...
</span></span><span class=line><span class=cl>kadmin&gt; add --random-key nfs/nas.meroh.net
</span></span><span class=line><span class=cl>... answer questions with defaults ...
</span></span><span class=line><span class=cl>kadmin&gt; █
</span></span></code></pre></div><p>And finally, extract the host and service credentials into the machine-specific keytab files. Note that, for the servers, we extract both the host and any service principals they need, but for the client, we just extract the host principal. We do not export any user principals:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>kadmin&gt; ext_keytab --keytab=think.keytab host/think.meroh.net
</span></span><span class=line><span class=cl>kadmin&gt; ext_keytab --keytab=x1nano.keytab host/x1nano.meroh.net
</span></span><span class=line><span class=cl>kadmin&gt; ext_keytab --keytab=nas.keytab host/nas.meroh.net nfs/nas.meroh.net
</span></span><span class=line><span class=cl>kadmin&gt; █
</span></span></code></pre></div><p>You now need to copy each extracted keytab file to the corresponding machine and name it <code>/etc/krb5.keytab</code>. (We&rsquo;ll do this later on the Synology NAS via its web interface.) This file is what contains the shared key between the KDC and the host and is what allows the host to verify the authenticity of KDC tickets without having to contact the KDC. Make sure to protect it with <code>chmod 400 /etc/krb5.keytab</code> so that nobody other than root can read it.</p><p>If <code>scp</code> is unsuitable or hard to use from the KDC to the client machines (as is my case because I restrict SSH access to the KDC to one specific machine), you can use the <code>base64</code> command to print out a textual representation of the keytab and use the local clipboard to carry it to a shell session on the destination machine.</p><h1 id=initial-client-setup>Initial client setup</h1><p>At this point, the realm should be functional but we need to make the clients become part of the realm. We also need to install all necessary tools, like <code>kinit</code>, which aren&rsquo;t present by default on some systems:</p><ul><li>On Debian:<ul><li>Run <code>apt install krb5-user nfs-common</code>.</li><li>Follow the prompts that the <code>krb5-user</code> installer shows to configure the realm and the address of the KDC. This will auto-create <code>/etc/krb5.conf</code> with the right contents so you don&rsquo;t have to do anything else.</li></ul></li><li>On Fedora:<ul><li>Run <code>dnf install krb5-workstation</code>.</li><li>Edit the system-provided <code>/etc/krb5.conf</code> file to register the realm and its settings. Use the file content shown above for the KDC as the template, or simply replace all placeholders for <code>example.org</code> and <code>EXAMPLE.ORG</code> with the name of your DNS domain and realm.</li></ul></li><li>On FreeBSD:<ul><li>Create the <code>/etc/krb5.conf</code> file from scratch in the same way we did for the KDC.</li></ul></li></ul><p>All set! But&mldr; do you trust that you did the right thing everywhere? We could go straight into NFSv4, but due to the many pitfalls in its setup, I&rsquo;d suggest you verify your configuration using a simpler service like SSH.</p><p>To do this, modify the SSH server&rsquo;s (aka <code>think</code>&rsquo;s configuration) <code>/etc/ssh/sshd_config</code> file and add <code>GSSAPIAuthentication yes</code> so that it can leverage Kerberos for authentication. Restart the SSH service and give it a go: run <code>kinit</code> on the client (<code>x1nano</code>) and then see how <code>ssh think</code> works without typing a password anymore.</p><p>But&mldr; <code>GSSAPIAuthentication</code>? What&rsquo;s up with the cryptic name?</p><p>GSS-API stands for <em>Generic Security Services API</em> and is the interface that programs use to communicate with the Kerberos implementation on the machine. GSS-API is not always enabled by default for a service, and the way you enable it is service-dependent. As you saw above, all we had to do for SSH was modify the <code>sshd_config</code> file&mldr; but for other services, you may need to take extra steps on the server and/or the client.</p><p>And, guess what, NFSv4 is weird on this topic. Not only we need service-specific principals for NFS, but we also need the <code>gssd</code> <em>daemon</em> to be running on the server <em>and</em> the client machines. This is because NFSv4 is typically implemented inside the kernel, but not Kerberos, so the kernel needs a mechanism to &ldquo;call into&rdquo; Kerberos. And the kernel needs to do this to map kernel-level UIDs (a Unix kernel doesn&rsquo;t know anything about <em>usernames</em>) to Kerberos principals and vice-versa&mdash;and that&rsquo;s precisely what <code>gssd</code> offers. So:</p><ul><li>On the Synology NAS:<ul><li>Do nothing. The system handles <code>gssd</code> by itself.</li></ul></li><li>On Linux:<ul><li>You shouldn&rsquo;t have to do anything if you correctly created the prerequisite <code>/etc/krb5.keytab</code> early enough, but make sure the service is running with <code>systemctl status rpc-gssd.service</code> (and know that this command only shows useful diagnostic logs when run as root).</li><li>Run <code>systemctl start rpc-gssd.service</code> if the service isn&rsquo;t running.</li></ul></li><li>On FreeBSD:<ul><li>Add <code>gssd_enable=YES</code> to <code>/etc/rc.conf</code>.</li><li>Run <code>service gssd start</code>.</li></ul></li></ul><h1 id=exporting-nfsv4-services>Exporting NFSv4 services</h1><p>It&rsquo;s time to deal with NFSv4, so let&rsquo;s start by configuring the server on the NAS.</p><p>The Synology Disk Station Manager (DSM) interface&mdash;the web UI for the NAS&mdash;is&mldr; interesting. As you might expect, it is a web-based interface but&mldr; it pretends to be a desktop environment in the browser, which I find overkill and unnecessary. But it&rsquo;s rather cool in its own way.</p><figure><img src=/images/2024-11-03-synology-dsm-nfs-file-services.png class=with-border><figcaption>Navigating the Synology DSM menus to configure the NFS file service with Kerberos.</figcaption></figure><p>The first step is to enable the NFS service. Roughly follow these steps, which are illustrated in the picture just above:</p><ul><li>Open the <strong>File Services</strong> tab of the <strong>Control Panel</strong>.</li><li>In the <strong>NFS</strong> tab, set NFSv4 as the <strong>Minimum NFS protocol</strong>.</li><li>Click on <strong>Advanced Settings</strong> and, in the panel that opens, enter the Kerberos realm under the <strong>NFSv4 domain</strong> option.</li><li>Click on <strong>Kerberos Settings</strong> and, in the panel that opens, select <strong>Import</strong> and then upload the keytab file that we generated earlier on for the NAS. This should populate the <code>host</code> and <code>nfs</code> principals in the list.</li><li>Finish and save all settings.</li></ul><p>That should be all to enable NFSv4 file serving.</p><figure><img src=/images/2024-11-03-synology-dsm-nfs-shared-folder.png class=with-border><figcaption>Navigating the Synology DSM menus to configure the properties of a single shared folder over NFS.</figcaption></figure><p>Then, we need to expose shared folders over NFSv4, and we have to do this for every folder we want to share. Assuming you want to share the <code>homes</code> folder as shown in the picture just above:</p><ul><li>Open the <strong>Shared Folder</strong> tab of the <strong>Control Panel</strong>.</li><li>Select the folder you want to share (in our case, <code>homes</code>), and click <strong>Edit</strong>.</li><li>In the <strong>NFS Permissions</strong> tab, click either <strong>Create</strong> or <strong>Edit</strong> to enter the permissions for every host client that should have access to the share.</li><li>Fill the NFS rule details. In particular, enter the hostname of the client machine, enable the <strong>Allow connections from non-privileged ports</strong> option, and select the <strong>Security</strong> level you desire.</li></ul><p>In my case, I want <code>krb5p</code> and <code>krb5p</code> only so that&rsquo;s the only option I enable. But your risk profile and performance needs may be different, so experiment and see what works best for you.</p><h1 id=mounting-nfsv4-from-linux>Mounting NFSv4 from Linux</h1><p>Now that the server is ready and we have dealt with the GSS-API prerequisites, we can start mounting NFSv4 on the clients.</p><p>On Linux, things are pretty simple. We can mount the file system with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>x1nano# sudo mount nas:/volume1/homes /shared
</span></span><span class=line><span class=cl>x1nano# █
</span></span></code></pre></div><p>Or persist the entry in <code>/etc/fstab</code> if we want to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>nas:/volume1/homes /shared nfs sec=krb5p 0 0
</span></span></code></pre></div><p>And then we should be able to list its contents <em>assuming we&rsquo;ve got a valid TGT for the current user</em> (run <code>kinit</code> if it doesn&rsquo;t work):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>x1nano$ ls -l /shared
</span></span><span class=line><span class=cl>total 0K
</span></span><span class=line><span class=cl>drwxrwxrwx 1 nobody users 0 Sep 27 21:11 admin
</span></span><span class=line><span class=cl>drwxrwxrwx 1 jmmv   users 0 Nov  2 20:41 jmmv
</span></span><span class=line><span class=cl>drwxrwxrwx 1 nobody users 0 Oct  8 16:59 manager
</span></span><span class=line><span class=cl>x1nano$ █
</span></span></code></pre></div><p>Easy peasy, right? But wait&mldr; why do all directories have <code>777</code> permissions?</p><p>This is rather unfortunate and I&rsquo;m not sure why the Synology does this. Logging onto the DS923+ via SSH, I inspected the shared directory and realized that it has various ACLs in place to control access to the directories, but somehow, the traditional Unix permissions are all <code>777</code> indeed. Not great.</p><p>I used <code>chmod</code> to fix the permissions for all directories to <code>755</code> and things seem to be OK, but that doesn&rsquo;t give me a lot of comfort because I do not know if the DSM will ever undo my changes or if I might have broken something.</p><p>There might be one more problem though, which I did not encounter on Debian clients but that showed up later in Fedora and FreeBSD clients:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>x1nano$ ls -l /shared
</span></span><span class=line><span class=cl>total 0K
</span></span><span class=line><span class=cl>drwxr-xr-x 1 nobody nogroup 0 Sep 27 21:11 admin
</span></span><span class=line><span class=cl>drwxr-xr-x 1 nobody nogroup 0 Nov  2 20:41 jmmv
</span></span><span class=line><span class=cl>drwxr-xr-x 1 nobody nogroup 0 Oct  8 16:59 manager
</span></span><span class=line><span class=cl>x1nano$ █
</span></span></code></pre></div><p>Note how all entries are owned by <code>nobody:nogroup</code> which is&mldr; not correct. Yet the right permissions are in effect: accessing the <code>jmmv</code> directory is only possible by the <code>jmmv</code> user as expected. Which means that the user mapping between Kerberos principals and local users is working correctly on the server&mldr; but not on the client, where <code>stat</code> isn&rsquo;t returning the right information.</p><p>I do not yet know why this issue happens, especially because I see no material differences between my Fedora and Debian configurations.</p><h1 id=mounting-nfsv4-from-freebsd>Mounting NFSv4 from FreeBSD</h1><p>We now have the Linux clients running just fine so it is time to pivot to FreeBSD. If we try a similar &ldquo;trivial&rdquo; mount command, we get an error:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>think# mount -t nfs nas:/volume1/homes /shared
</span></span><span class=line><span class=cl>mount_nfs: nmount: /shared: Permission denied
</span></span><span class=line><span class=cl>think# █
</span></span></code></pre></div><p>The error is pretty&mldr; unspecific. It took me quite a bit of trial and error to realize that I <em>had</em> to specify <code>-t nfsv4</code> for it to attempt a NFSv4 connection and not NFSv3 (unlike Linux, whose <code>mount</code> command attempts the highest possible version first and then falls back to older versions):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>think# mount -t nfs -o nfsv4 nas:/volume1/homes /shared
</span></span><span class=line><span class=cl>mount_nfs: nmount: /shared, wrong security flavor
</span></span><span class=line><span class=cl>think# █
</span></span></code></pre></div><p>OK, progress. Now this complains that the security flavor we request is wrong. Maybe we just need to be explicit and also pass <code>sec=krb5p</code> as an argument:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>think# mount -t nfs -o nfsv4,sec=krb5p nas:/volume1/homes /shared
</span></span><span class=line><span class=cl>mount_nfs: nmount: /shared, wrong security flavor
</span></span><span class=line><span class=cl>think# █
</span></span></code></pre></div><p>Wait, what? The mount operation still fails? This was more puzzling and also took a fair bit of research to figure out because logs on the client and on the server were just insufficient to see the problem.</p><p>The reason for the failure is that we are trying to mount the share as root but&mldr; we don&rsquo;t have a principal for this user so root cannot obtain an NFSv4 service ticket to contact the NAS. So&mldr; do we need to create a principal for <code>root</code>? No! We do not need to provide user credentials when mounting an NFSv4 share (unlike what you might be used to with Windows shares).</p><p>What Kerberized NFSv4 needs during the mount operation is a host ticket: the NFSv4 server checks if the client <em>machine</em> is allowed to access the server and, if so, exposes the file system to it. This is done using the client&rsquo;s host principal. Once the file system is mounted, however, all operations against the share carry the ticket of the <em>user</em> requesting the operation.</p><p>Knowing this, we need to &ldquo;help&rdquo; FreeBSD and tell it that it must use the host&rsquo;s principal when mounting the share. Why this isn&rsquo;t the default, I don&rsquo;t know, particularly because non-root users are not allowed to mount file systems in the default configuration. Anyhow. The <code>gssname=host</code> option rescues us:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>think# mount -t nfs -o nfsv4,sec=krb5p,gssname=host nas:/volume1/homes /shared
</span></span><span class=line><span class=cl>think# █
</span></span></code></pre></div><p>Which finally allows the mount operation to succeed. We should persist all this knowledge into an <code>/etc/fstab</code> entry like this one:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>nas:/volume1/homes /shared nfs rw,nfsv4,gssname=host,sec=krb5p 0 0
</span></span></code></pre></div><h1 id=verifying-encryption>Verifying encryption</h1><p>Color me skeptical, but everything I described above seems convoluted and fragile, so I did not trust that my setup was sound. Consequently, I wanted to verify that the traffic on the network was actually encrypted.</p><p>To verify this, I installed Wireshark and ran a traffic capture against the NAS with <code>host nas</code> as the filter. Then, from the client, I created a text file on the shared folder and then read it. Inspecting the captured packets confirmed that the traffic is indeed flowing in encrypted form. I could not find the raw file content anywhere in the whole trace (but I could when using anything other than <code>krb5p</code>).</p><figure><img src=/images/2024-11-03-kerberized-nfs-wireshark.png class=with-border><figcaption>Content of an NFS reply packet with Kerberos-based encryption. The packet contents are not plain text.</figcaption></figure><p>And, as a final test, I tried to mount the network share <em>without</em> <code>krb5p</code> and confirmed that this was not possible:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl># mount -t nfs -o nfsv4,gssname=host,sec=krb5i nas:/volume1/homes /shared
</span></span><span class=line><span class=cl>mount_nfs: nmount: /shared, wrong security flavor
</span></span><span class=line><span class=cl># █
</span></span></code></pre></div><p>All good! I think&mldr;</p><h1 id=open-questions>Open questions</h1><p>That&rsquo;s about it. But I still have a bunch of unanswered questions from this setup:</p><ul><li><p>Kerberos claims to be an authentication system only, not an authorization system. However, the protocol I described above separates the TGT from the TGS, and this separation makes it sound like Kerberos could also implement authorization policies. Why doesn&rsquo;t it do these?</p></li><li><p>The fact that Fedora and FreeBSD show <code>nobody</code> for file ownership even when they seems to do the right thing regarding when talking to the NFSv4 server sound like a bug either in the code or in my configuration. Which is it?</p></li><li><p>Having to type <code>kinit</code> after logging into the machine is annoying. I remember that, back at Google when we used Kerberos and NFS&mdash;those are long gone days&mdash;the right tickets would be granted after logging in or unlocking a workstation. This must have been done with the Kerberos PAM modules&mldr; but I haven&rsquo;t gotten them to do this yet and I&rsquo;m not sure why.</p></li><li><p>The fact that the shared directories created by the Synology NAS have 777 permissions seems wrong. Why is it doing that? And does anything break if you manually tighten these permissions?</p></li><li><p>And the most important question of all: <strong>is this all worth it?</strong> I&rsquo;m tempted to just use password-protected Samba shares and call it a day. I still don&rsquo;t trust that the setup is correct, and I still encounter occasional problems here and there.</p></li></ul><p>If you happen to have answers to any of the above or have further thoughts, please drop a note in the comments section. And if you want to see how the DS923+ compares to my home-built FreeBSD NAS with ZFS, subscribe for a future post on that!</p><p>Credit and disclaimers: the <a href=https://sy.to/hekgh>DS923+</a> and <a href=https://sy.to/drkom>the 3 drives</a> it contains that I used throughout this article were provided to me for free by Synology for evaluation purposes in exchange for blogging about the NAS. The content in this article is <em>not</em> endorsed has <em>not</em> been reviewed by them.</p></article></div></div><div class="container post-links"><div class=row><div class="col mr-auto text-left"><span><a href=https://jmmv.dev/2024/10/bazelcon-2024-recap.html>&#171; Previous</a></span></div><div class="col text-center"><span><a href=/archive.html>All posts</a></span></div><div class="col ml-auto text-right"><span><a href=https://jmmv.dev/2024/12/synology-ds923-vs-freebsd.html>Next &#187;</a></span></div></div></div><div class="container post-votes"><div class=row><div class="col-lg-4 my-2"><div class=row><div class=col><a onclick=voteThumbsUp() class="btn btn-block btn-outline-success" id=thumbs-up-btn>👍
(<span id=thumbs-up-count>0</span>)</a></div><div class=col><a onclick=voteThumbsDown() class="btn btn-block btn-outline-danger" id=thumbs-down-btn>👎
(<span id=thumbs-down-count>0</span>)</a></div></div></div><div class="col-lg-8 my-2 d-none d-sm-block"><div class=row><div class="col-md-4 text-center"><a href="https://www.reddit.com/submit?title=Demystifying+secure+NFS&amp;url=https%3A%2F%2Fjmmv.dev%2F2024%2F11%2Fdemystifying-secure-nfs.html" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/reddit.png alt=Reddit width=24 height=24></a></div><div class="col-md-4 text-center"><a href="https://news.ycombinator.com/submitlink?t=Demystifying+secure+NFS&amp;u=https%3A%2F%2Fjmmv.dev%2F2024%2F11%2Fdemystifying-secure-nfs.html" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/ycombinator.png alt="Hacker News" width=24 height=24></a></div><div class="col-md-4 text-center"><a href="https://twitter.com/intent/tweet?status=Demystifying+secure+NFS+%E2%80%94+https%3A%2F%2Fjmmv.dev%2F2024%2F11%2Fdemystifying-secure-nfs.html+%E2%80%94+cc+%40jmmv" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/Twitter_Social_Icon_Circle_Color.png alt=Twitter width=24 height=24></a></div></div></div></div><div class="row my-4" id=postCommentRow><div class=col><div class=media><img class=mr-3 src=/octicons/pencil.svg width=32px height=32px><div class="media-body container"><form method=post id=newPost><div class=row><div class="col my-1"><textarea class=form-control rows=1 id=postCommentContent onclick=showPostComment() placeholder="Leave a comment"></textarea></div></div><div class="row newPostControls" style=display:none><div class="col my-1 form-group"><label for=postCommentAuthor>Your name (optional):</label>
<input type=text class=form-control id=postCommentAuthor></div></div><div class="row newPostControls" style=display:none><div class="col my-1 form-group"><label for=postCommentEmail>Your email (optional):</label>
<input type=text class=form-control type=email id=postCommentEmail>
<small class="form-text text-muted">Invisible to all readers; if provided, you will receive notifications when replied to (not implemented yet)</small></div></div><div class=row id=postCommentError style=display:none><div class="col mt-1 alert-danger"><p></p></div></div><div class="row newPostControls" style=display:none><button class="col-md-3 my-1 btn btn-primary" type=submit id=submitCommentButton>Post</button>
<small class="col-md-9 my-1 text-muted">Comments are subject to moderation. This feature is experimental and is powered by <a href=/software/endtracker.html>EndTRACKER</a>. If you experience any issues, please <a href=/about.html#contact>contact me off-band</a>.</small></div></form></div></div></div></div><script>function hidePostComment(){var t,e=document.getElementById("postCommentContent");e.rows=1,e.value="",t=document.getElementsByClassName("newPostControls"),Array.prototype.forEach.call(t,function(e){e.style.display="none"})}function showPostComment(){var e,t=document.getElementById("postCommentContent");t.rows=5,e=document.getElementsByClassName("newPostControls"),Array.prototype.forEach.call(e,function(e){e.style.display=""})}const form=document.querySelector("#newPost");form.onsubmit=function(e){e.preventDefault();let t=document.getElementById("postCommentAuthor").value,n=document.getElementById("postCommentEmail").value,s=document.getElementById("postCommentContent").value;postComment(t,n,s,hidePostComment)}</script></div></div><div class="col-md-3 sidebar d-none d-md-block"><div class=row><div class="col text-center p-2"><p><a href=/about.html class=clear-link><img src=/images/avatars/20181124-snow.jpg class="rounded-circle shadow my-2" style=width:100px><br><b>Julio Merino</b><br>A blog on operating systems, programming languages, testing, build systems, my own software
projects and even personal productivity. Specifics include FreeBSD, Linux, Rust, Bazel and
EndBASIC.</a></p><div class=row><div class=col><div class=form-group><form action=https://endtracker.azurewebsites.net/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/subscribers/add method=post><input type=text name=email placeholder="Enter your email" class="form-control input-sm text-center my-1">
<button type=submit class="btn btn-primary btn-block my-1">Subscribe</button></form></div></div></div><div class="row px-2"><div class="col-sm-5 text-left"><small><span class=subscriber-count>0</span> subscribers</small></div><div class="col-sm-7 text-right"><p><a rel=me href=https://mastodon.online/@jmmv><img src=/images/badges/mastodon-logo.svg width=32px height=32px alt="Follow @jmmv on Mastodon">
</a><a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&amp;screen_name=jmmv"><img src=/images/badges/Twitter_logo_blue.svg width=32px height=32px alt="Follow @jmmv on Twitter">
</a><a href=/feed.xml><img src=/images/badges/feed-icon-28x28.png alt="RSS feed"></a></p></div></div></div></div><div class=row><div class=col><h2>Featured software</h2><ul><li class=overflow-ellipsis><a href=https://www.endbasic.dev/ target=_blank>EndBASIC: Online BASIC+DOS env</a></li><li class=overflow-ellipsis><a href=https://endtracker.azurewebsites.net/ target=_blank>EndTRACKER: Services for static sites</a></li></ul></div></div><div class=row><div class=col><h2>Featured posts</h2><ul><li class=overflow-ellipsis><a href=/2023/06/fast-machines-slow-machines.html>Fast machines, slow machines</a></li><li class=overflow-ellipsis><a href=/2022/12/endbasic-0.10.html>EndBASIC 0.10: Core language, evolved</a></li><li class=overflow-ellipsis><a href=/2022/10/bye-microsoft-hi-snowflake.html>Farewell, Microsoft; hello, Snowflake!</a></li><li class=overflow-ellipsis><a href=/2022/05/rust-is-hard-but-does-it-matter.html>Rust is hard, yes, but does it matter?</a></li><li class=overflow-ellipsis><a href=/2022/04/rust-traits-and-dependency-injection.html>Rust traits and dependency injection</a></li><li class=overflow-ellipsis><a href=/2022/03/a-year-on-windows-intro.html>A year on Windows: Introduction</a></li><li class=overflow-ellipsis><a href=/2021/04/always-be-quitting.html>Always be quitting</a></li><li class=overflow-ellipsis><a href=/2021/02/google-monorepos-and-caching.html>How does Google keep build times low?</a></li><li class=overflow-ellipsis><a href=/2020/12/google-no-clean-builds.html>How does Google avoid clean builds?</a></li><li class=overflow-ellipsis><a href=/2020/12/unit-testing-a-console-app.html>Unit-testing a console app (a text editor)</a></li><li class=overflow-ellipsis><a href=/essays.html#featured>More...</a></li></ul></div></div></div></div></div><footer class=container-fluid><div class=row><div class="col-4 order-2 text-right"><p class=float-right><a href=#>Back to top</a></p></div><div class="col-8 order-1 mr-auto"><p>Copyright 2004&ndash;2025
Julio Merino</p></div></div></footer><script type=module>
  import { addAnchorsToHeaders, addElementClasses, BatchClient } from "\/js\/main.0de73782e9e0fbcb4184fb5793949b3b0d0ada16455df89320415b4dcc052f88.js";

  var batchClient = new BatchClient(SITE_ID);
  batchClient.doAll({
    put_request: true, get_comments: true, get_subscriber_count: true, get_votes: true });

  window.voteThumbsUp = function() { batchClient.voteThumbsUp(); }
  window.voteThumbsDown = function() { batchClient.voteThumbsDown(); }

  window.postComment = function(...args) {
    batchClient.postComment(...args);
  };

  addAnchorsToHeaders();
  addElementClasses();
</script></body></html>