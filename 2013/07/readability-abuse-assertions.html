<!DOCTYPE html>
<html>
  <head>
    

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head
      content must come *after* these tags -->

<meta name="description"
      content="Assertions are statements to ensure that a particular condition or state holds true at a certain point in the execution of a program.  These checks are usual...">
<meta name="author" content="Julio Merino">

<meta content="http://julio.meroh.net/2013/07/readability-abuse-assertions.html" property="og:url">

<link rel="canonical" href="http://julio.meroh.net/2013/07/readability-abuse-assertions.html">
<link rel="alternate" type="application/rss+xml" title="Julio Merino" href="http://julio.meroh.net/feed.xml" />

<link rel="stylesheet" href="/css/main.css">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="/js/html5shiv-3.7.2.min.js"></script>
  <script src="/js/respond-1.4.2.min.js"></script>
<![endif]-->

    <title>Readability: Abuse assertions - Julio Merino</title>
    <meta content="Readability: Abuse assertions - Julio Merino" property="og:title">
  </head>

  <body>
    <header class="site-header">

<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed"
              data-toggle="collapse" data-target="#navbar"
              aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Julio Merino</a>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
          
            
              
                <li><a class="page-link"
                href="/about/"
                >About</a></li>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
              
                <li><a class="page-link"
                href="/essays/"
                >Essays</a></li>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
              
                <li><a class="page-link"
                href="/software/"
                >Software</a></li>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
              
                <li><a class="page-link"
                href="/work/"
                >Work</a></li>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
      </ul>

      <form class="navbar-form navbar-right" method="get" role="search"
            action="http://www.google.com/search">
          <div class="form-group">
            <input type="text" name="query" class="form-control"
                   placeholder="Search">
            <input type="hidden" name="sitesearch" value="http://julio.meroh.net">
          </div>
          <button type="submit" value="Search" class="btn btn-default">
            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
          </button>
      </form>
    </div>
  </div>
</nav>

</header>


    <div class="page-header">
      <div class="container">
        <h1>Readability: Abuse assertions</h1>

        <p><!-- From http://alanwsmith.com/jekyll-liquid-date-formatting-examples -->

July

1st,
  
2013
at
16:00 UTC
        
        </p>

        
      </div>
    </div>

    <div class="container">
      <article>
        <p>Assertions are statements to ensure that a particular condition or state holds true at a certain point in the execution of a program.  These checks are usually only performed in debug builds, which means that you must ensure that the expressions in the assertions are side-effect free.</p> <p>Because assertions are only validated in debug builds, you can abuse them to make your code more readable without impacting performance and <a href="/2013/06/readability-avoid-comments.html">without having to write a comment</a>.  Every time you write a line in which you assume a particular machine state that is not clearly implied by the code immediately preceding the new line, write an assertion.</p> <p>Let's look at a real world example derived from Kyua's code.  Consider the following extremely-simplified function which implements the <tt>help</tt> command:</p> <pre>def help_command(args):<br />    if len(args) == 0:<br />        show_general_help()<br />    else:<br />        show_command_help(args[0])</pre> <p>With this code alone, try to answer these questions: <i>"What happens if <tt>args</tt>, which apparently is a subset of the arguments to the program, has more than 1 item?  Are the additional arguments ignored and thus we have a bug in the code, or has the <tt>args</tt> vector been pre-sanitized by the caller to not have extra arguments?"</i> Well, you can't answer this question because there is nothing in the code to tell you what the case is.</p> <p>If I now show you the caller to the function, you can get an idea of what the expectation is:</p> <pre>def main(args):<br />    commands = {}<br />    commands['help'] = cli.Command(min_args=0, <b>max_args=1</b>,<br />                                   hook=help_command)<br />    ...<br />    cli.dispatch(commands, args)</pre> <p>Aha!  There happens to be an auxiliary library that processes the command line and dispatches calls to the various subcommands based on a declarative interface.  This declarative interface specifies what the maximum number of arguments to the command can be, so our function above for <tt>help_command</tt> was correct: it was handling all possible lengths of the input <tt>args</tt> vector.</p> <p>But that's just too much work to figure out a relative simple piece of code.  A piece of code needs to be self-explanatory with as little external context as possible.  We can do this with assertions.</p> <p>The first thing you can do is state the precondition to the function as an assertion:</p> <pre>def help_command(args):<br />    <b>assert len(args) &lt;= 1</b><br />    if len(args) == 0:<br />        show_general_help()<br />    else:<br />        show_command_help(args[0])</pre> <p>This does the trick: now, without any external context, you can tell that the <tt>args</tt> vector is supposed to be empty or have a single element, and the code below clearly handles both cases.</p> <p>However, I argue that this is still suboptimal.  What is the complementary condition of <tt>len(args) == 0</tt>?  Easy: <tt>len(args) &gt; 0</tt>.  Then, if that's the case, how can the <tt>else</tt> path be looking at the first argument only and not the rest?  Didn't someone overlook the rest of the arguments, possibly implying that the input data is not fully validated?  This would be a legitimate question if the function was much longer than it is and reading it all was hard.  Therefore, we would do this instead:</p> <pre>def help_command(args):<br />    if len(args) == 0:<br />        show_general_help()<br />    else:<br />        <b>assert len(args) == 1</b><br />        show_command_help(args[0])</pre> <p>Or this:</p> <pre>def help_command(args):<br />    if len(args) == 0:<br />        show_general_help()<br />    <b>elif len(args) == 1:</b><br />        show_command_help(args[0])<br />    <b>else:</b><br />        <b>assert False, 'args not properly sanitized by caller'</b></pre> <p>Both of these alternatives clearly enumerate all branches of a conditional, which makes the function easier to reason about.  We will get to this in a future post.</p> <p>Before concluding, let's outline some cases in which you should really be writing assertions:</p> <ul><li>Preconditions and postconditions.</li><li>Assumptions about state that has been validated elsewhere in the code, possibly far away from the current code.</li><li>Complementary conditions in conditionals where not all possible values of a type are being inspected.</li><li>Unreachable code paths.</li></ul>

      </article>

      <div class="post-links">
        <p>
          

          
          <a href="http://julipedia.meroh.net/2013/07/readability-abuse-assertions.html">Posted on
          The Julipedia</a>
          &middot;
          

          

          <a href="/feed.xml">Subscribe
          via RSS</a>
          &middot;
          <a href="/blog/">Go to posts index</a>
        </p>

        <form class="form-inline"
            action="https://feedburner.google.com/fb/a/mailverify"
            method="post"
            target="popupwindow"
            onsubmit="window.open('https://feedburner.google.com/fb/a/mailverify?uri=jmmv', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true">
          <div class="form-group form-group-sm">
            <input type="text" style="width: 400px" name="email"
                    placeholder="Enter your email to subscribe to new posts"
                    class="form-control input-sm"/>
          </div>
          <button type="submit" value="Subscribe"
                  class="btn btn-default btn-sm">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
          </button>
          &nbsp;&nbsp;&nbsp;Delivered by
          <input type="hidden" value="jmmv" name="uri"/>
          <input type="hidden" name="loc" value="en_US"/>
          <a href="https://feedburner.google.com" target="_blank">FeedBurner</a>
        </form>
      </div>

      
      <div id="disqus_thread">
        <script>
          var disqus_config = function () {
            this.page.url = "http://julio.meroh.net/2013/07/readability-abuse-assertions.html";
            this.page.identifier = "/2013/07/readability-abuse-assertions";
          };
          (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//jmmv.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
        <noscript>Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments
          powered by Disqus.</a>
        </noscript>
      </div>
      
    </div>

    <div class="container">
  <footer>
    <p class="pull-right"><a href="#">Back to top</a></p>
    <p>Copyright 2016 Julio Merino</p>
  </footer>
</div>

<script src="/js/jquery-1.11.2.min.js">
</script>
<script
  src="/css/bootstrap.min.js">
</script>

<script src="/js/auto-toc-1.0.0.dist.js">
</script>

<script>
$("p:contains('NOTE: ')").addClass("callout callout-info");
$("p:contains('IMPORTANT: ')").addClass("callout callout-info");
$("p:contains('WARNING: ')").addClass("callout callout-warning");
$("p:contains('DANGER: ')").addClass("callout callout-danger");
</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
  m.parentNode.insertBefore(a,m)})(window,document,'script',
  '//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63557333-1', 'auto');
  ga('send', 'pageview');
</script>


  </body>
</html>
