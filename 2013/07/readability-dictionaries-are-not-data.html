<!DOCTYPE html>
<html>
  <head>
    

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head
      content must come *after* these tags -->

<meta name="description"
      content="Yes: a dictionary is a data type.  No: a dictionary is not a way to implement abstract data types; doing so is lazy programming and is asking for trouble lat...">
<meta name="author" content="Julio Merino">

<meta content="http://julio.meroh.net/2013/07/readability-dictionaries-are-not-data.html" property="og:url">

<link rel="canonical" href="http://julio.meroh.net/2013/07/readability-dictionaries-are-not-data.html">
<link rel="alternate" type="application/rss+xml" title="Julio Merino" href="http://julio.meroh.net/feed.xml" />

<link rel="stylesheet" href="/css/main.css">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="/js/html5shiv-3.7.2.min.js"></script>
  <script src="/js/respond-1.4.2.min.js"></script>
<![endif]-->

    <title>Readability: Dictionaries are not data types - Julio Merino</title>
    <meta content="Readability: Dictionaries are not data types - Julio Merino" property="og:title">
  </head>

  <body>
    <header class="site-header">

<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed"
              data-toggle="collapse" data-target="#navbar"
              aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Julio Merino</a>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
          
            
              
                <li><a class="page-link"
                href="/about/"
                >About</a></li>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
              
                <li><a class="page-link"
                href="/essays/"
                >Essays</a></li>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
              
                <li><a class="page-link"
                href="/software/"
                >Software</a></li>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
              
                <li><a class="page-link"
                href="/work/"
                >Work</a></li>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
      </ul>

      <form class="navbar-form navbar-right" method="get" role="search"
            action="http://www.google.com/search">
          <div class="form-group">
            <input type="text" name="query" class="form-control"
                   placeholder="Search">
            <input type="hidden" name="sitesearch" value="http://julio.meroh.net">
          </div>
          <button type="submit" value="Search" class="btn btn-default">
            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
          </button>
      </form>
    </div>
  </div>
</nav>

</header>


    <div class="page-header">
      <div class="container">
        <h1>Readability: Dictionaries are not data types</h1>

        <p><!-- From http://alanwsmith.com/jekyll-liquid-date-formatting-examples -->

July

4th,
  
2013
at
12:00 
        
        </p>

        
      </div>
    </div>

    <div class="container">
      <article>
        <p>Yes: a dictionary is a data type.  No: a dictionary is not a way to implement abstract data types; doing so is lazy programming and is asking for trouble later on.</p> <p>What do I mean by this?  In Python and other similar dynamic languages, dictionaries are a mapping of keys to values that have no typing restrictions: the dictionary is heterogeneous, and a single dictionary can contain elements of different types both as its keys and its values.  To make things worse, the syntax of the language makes it incredibly easy to create and populate dictionaries (unlike, say, in C++).  Combine these two facts together and the temptation to abuse a dictionary to implement a structured data type is high.</p> <p>Let's look at a fictitious function to check if a given process is within its current resource limits:</p> <pre>def process_within_limits(pid, limits, usages):<br />    """Checks if a process is within its limits.<br /><br />    Args:<br />        pid: int.  The process identifier.<br />        limits: dict(int, dict(str, int)).  Mapping of process<br />            identifiers to the limits for the corresponding<br />            process.  <b>The limits of a process are a mapping of<br />            resource names to the numerical limit.  The valid<br />            names currently are 'cpu' and 'ram'.</b><br />        usages: dict(int, dict(str, int)).  Same as limits but<br />            for the current instantaneous measurements of the<br />            process resource consumption.<br /><br />    Returns:<br />        bool.  True if the process is within its limits.<br />    """<br />    if pid not in limits:<br />        raise ValueError('Missing process limit')<br />    limit = limits[pid]<br /><br />    if pid not in usages:<br />        raise ValueError('Missing process usage')<br />    usage = usages[pid]<br /><br />    <b>assert 'cpu' in usage and 'cpu' in limit<br />    cpu_in_quota = usage['cpu'] &lt;= limit['cpu']<br />    assert 'ram' in usage and 'ram' in limit<br />    ram_in_quota = usage['ram'] &lt;= limit['ram']</b><br />    return cpu_in_quota and ram_in_quota</pre> <p>This code is nesting two dictionaries in the <tt>limits</tt> and <tt>usages</tt> arguments, and is using each level in a different semantical manner.  In the first level we have a mapping of process identifiers to either the process' limits or current usage counts;  in other words, a perfectly valid use case for a dictionary.  In the second level, however, we have a collection of resource names mapped to values; needless to say, this is bad practice (with very few exceptions).</p> <p>The way to improve this code is by defining an actual data type so that the various attributes are properly represented by member fields.  In Python, we can use the standard <tt>collections.namedtuple</tt> class to simplify this:</p> <pre><b>import collections</b><br /><br /><b># Resource limit or usage values for a process.<br />#<br /># Attributes:<br />#     cpu: float.  Resource value for the CPU usage.<br />#     ram: int.  Resource value for the RAM usage, in bytes.<br />Resources = collections.namedtuple('Resources', 'cpu ram')</b><br /><br />def process_within_limits(pid, limits, usages):<br />    """Checks if a process is within its limits.<br /><br />    Args:<br />        pid: int.  The process identifier.<br />        limits: <b>dict(int, Resources)</b>.  Mapping of process<br />            identifiers to the limits for the corresponding<br />            process.<br />        usages: <b>dict(int, Resources)</b>.  Mapping of process<br />            identifiers to the current instantaneous resource<br />            usage values.<br /><br />    Returns:<br />        bool.  True if the process is within its limits.<br />    """<br />    if pid not in limits:<br />        raise ValueError('Missing process limit')<br />    limit = limits[pid]<br /><br />    if pid not in usages:<br />        raise ValueError('Missing process usage')<br />    usage = usages[pid]<br /><br />    <b>cpu_in_quota = usage.cpu &lt;= limit.cpu</b><br />    <b>ram_in_quota = usage.ram &lt;= limit.ram</b><br />    return cpu_in_quota and ram_in_quota</pre> <p>This is already quite an improvement.  There are two things that I want to highlight here:</p> <ul><li>The explanation of the function arguments no longer describes what the contents of the resources dictionary should be.  Doing so is now unnecessary because we have an actual type with documentation to do so.</li><li>Access to the member fields is done via a field instead of dynamically via a map query.  This allows the validation of the accesses at build type (not in the case of Python, of course) and also the enforcement of types and/or data invariants if any.</li></ul> <p>There is one more twist to all this.  By having extracted the dictionary as a data type, we can now clearly see that some functionality belongs in the data type itself for encapsulation purposes: invariant checking, operator overload, auxiliary methods...  In this specific example, just imagine if you ever wanted to add a new resource dimension to the <tt>Resources</tt> class: you wouldn't like to have to hunt down all callers to ensure they know about the new field!  So we move the necessary functionality into the type:</p> <pre>import collections<br /><br /><b>class Resources(collections.namedtuple('Resources',<br />                                       'cpu ram')):<br />    """Resource limit or usage values for a process.<br /><br />    Attributes:<br />        cpu: float.  Resource value for the CPU usage.<br />        ram: int.  Resource value for the RAM usage, in bytes.<br />    """<br /><br />    def __le__(self, other):<br />        return self.cpu &lt;= other.cpu and self.ram &lt;= other.ram</b><br /><br />def process_within_limits(pid, limits, usages):<br />    """Checks if a process is within its limits.<br /><br />    Args:<br />        pid: int.  The process identifier.<br />        limits: dict(int, Resources).  Mapping of process<br />            identifiers to the limits for the corresponding<br />            process.<br />        usages: dict(int, Resources).  Mapping of process<br />            identifiers to the current instantaneous resource<br />            usage values.<br /><br />    Returns:<br />        bool.  True if the process is within its limits.<br />    """<br />    if pid not in limits:<br />        raise ValueError('Missing process limit')<br />    limit = limits[pid]<br /><br />    if pid not in usages:<br />        raise ValueError('Missing process usage')<br />    usage = usages[pid]<br /><br />    <b>return usage &lt;= limit</b></pre> <p>Let me conclude by saying that this is all inspired by actual production code I've had to deal with... so the example and its simplicity are not that contrived.</p>

      </article>

      <div class="post-links">
        <p>
          

          

          <a href="/feed.xml">Subscribe
          via RSS</a>
          &middot;
          <a href="/blog/">Go to posts index</a>
        </p>

        <form class="form-inline"
            action="https://feedburner.google.com/fb/a/mailverify"
            method="post"
            target="popupwindow"
            onsubmit="window.open('https://feedburner.google.com/fb/a/mailverify?uri=jmmv', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true">
          <div class="form-group form-group-sm">
            <input type="text" style="width: 400px" name="email"
                    placeholder="Enter your email to subscribe to new posts"
                    class="form-control input-sm"/>
          </div>
          <button type="submit" value="Subscribe"
                  class="btn btn-default btn-sm">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
          </button>
          &nbsp;&nbsp;&nbsp;Delivered by
          <input type="hidden" value="jmmv" name="uri"/>
          <input type="hidden" name="loc" value="en_US"/>
          <a href="https://feedburner.google.com" target="_blank">FeedBurner</a>
        </form>
      </div>

      
      <div id="disqus_thread">
        <script>
          var disqus_config = function () {
            this.page.url = "http://julio.meroh.net/2013/07/readability-dictionaries-are-not-data.html";
            this.page.identifier = "/2013/07/readability-dictionaries-are-not-data";
          };
          (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//jmmv.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
        <noscript>Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments
          powered by Disqus.</a>
        </noscript>
      </div>
      
      <p>Comments from the original Blogger-hosted post:</p>
      <script src="https://apis.google.com/js/plusone.js"></script>
      <div class="g-comments"
           data-href="http://julipedia.meroh.net/2013/07/readability-dictionaries-are-not-data.html"
           data-first_party_property="BLOGGER"
           data-view_type="FILTERED_POSTMOD">
      </div>
      
      
    </div>

    <div class="container">
  <footer>
    <p class="pull-right"><a href="#">Back to top</a></p>
    <p>Copyright 2016 Julio Merino</p>
  </footer>
</div>

<script src="/js/jquery-1.11.2.min.js">
</script>
<script
  src="/css/bootstrap.min.js">
</script>

<script src="/js/auto-toc-1.0.0.dist.js">
</script>

<script>
$("p:contains('NOTE: ')").addClass("callout callout-info");
$("p:contains('IMPORTANT: ')").addClass("callout callout-info");
$("p:contains('WARNING: ')").addClass("callout callout-warning");
$("p:contains('DANGER: ')").addClass("callout callout-danger");
</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
  m.parentNode.insertBefore(a,m)})(window,document,'script',
  '//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63557333-1', 'auto');
  ga('send', 'pageview');
</script>


  </body>
</html>
