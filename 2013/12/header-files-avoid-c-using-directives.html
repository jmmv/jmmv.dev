<!DOCTYPE html>
<html>
  <head>
    

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head
      content must come *after* these tags -->

<meta name="description"
      content="Following up on the previous C++ post, here comes one more thing to consider when writing header files in this language.">
<meta name="author" content="Julio Merino">

<meta content="http://julio.meroh.net/2013/12/header-files-avoid-c-using-directives.html" property="og:url">

<link rel="canonical" href="http://julio.meroh.net/2013/12/header-files-avoid-c-using-directives.html">
<link rel="alternate" type="application/rss+xml" title="Julio Merino" href="http://julio.meroh.net/feed.xml" />

<link rel="stylesheet" href="/css/main.css">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="/js/html5shiv-3.7.2.min.js"></script>
  <script src="/js/respond-1.4.2.min.js"></script>
<![endif]-->

    <title>Header files: Avoid C++ 'using' directives - Julio Merino</title>
    <meta content="Header files: Avoid C++ 'using' directives - Julio Merino" property="og:title">
  </head>

  <body>
    <header class="site-header">

<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed"
              data-toggle="collapse" data-target="#navbar"
              aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Julio Merino</a>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
          
            
              
                <li><a class="page-link"
                href="/about/"
                >About</a></li>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
              
                <li><a class="page-link"
                href="/essays/"
                >Essays</a></li>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
              
                <li><a class="page-link"
                href="/software/"
                >Software</a></li>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
              
                <li><a class="page-link"
                href="/work/"
                >Work</a></li>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
      </ul>

      <form class="navbar-form navbar-right" method="get" role="search"
            action="http://www.google.com/search">
          <div class="form-group">
            <input type="text" name="query" class="form-control"
                   placeholder="Search">
            <input type="hidden" name="sitesearch" value="http://julio.meroh.net">
          </div>
          <button type="submit" value="Search" class="btn btn-default">
            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
          </button>
      </form>
    </div>
  </div>
</nav>

</header>


    <div class="page-header">
      <div class="container">
        <h1>Header files: Avoid C++ 'using' directives</h1>

        <p><!-- From http://alanwsmith.com/jekyll-liquid-date-formatting-examples -->

December

5th,
  
2013
at
17:00 UTC
        
        </p>

        
      </div>
    </div>

    <div class="container">
      <article>
        <p>Following up on the previous C++ post, here comes one more thing to consider when writing header files in this language.</p> <p><b><tt>using</tt> and <tt>using namespace</tt></b></p> <p>The C++ <tt>using</tt> directive and its more generic <tt>using namespace</tt> counterpart, allow the programmer to bring a given symbol or all the symbols in a namespace, respectively, into the calling scope.  This feature exists to simplify typing and, to some extent, to make the code more readable.  (It may have come into existence to simplify the porting of old, non-ISO C++ code to modern C++, but that's just a guess.)</p> <p>The most common use of these that I have seen is to slap a <tt>using namespace std;</tt> at the beginning of a source file so that all of the symbols in the standard library are available without having to prefix each one of them with <tt>std::</tt>.  So far so good.</p> <p>Another not-so-common practice is to rarely use this directive and, when using it, place it in the innermost scope where it is needed.  In particular, this can make a function much easier to digest:</p> <pre>int complex_computation(... inputs ...) {<br />    using my_long_namespace::and_another_one::compute_engine;<br /><br />    compute_engine ce(compute_engine::DO_MAGIC);<br />    const compute_engine::result r = ce.run(... inputs ...);<br />    return r.to_integer();<br />}</pre> <p>Imagine how this function would look like if you had to prefix every instance of <tt>compute_engine</tt> with <tt>my_long_namespace::and_another_one::</tt>!</p> <p><b>The rule</b></p> <p>To recap, <tt>using</tt> directives in implementation, <tt>cpp</tt> files, is perfectly fine.</p> <p>Now, what's wrong &mdash; really, really wrong &mdash; is to place a <tt>using</tt> directive <i>in a header file</i>.  These directives exist to be used at the source file level where the programmer has full control of all included headers and their possible conflicts.  If header files decide to import names within a namespace into, say, the global scope, it is highly likely that two header files collide.  Not to mention that doing so renders namespaces useless!</p> <p>So: keep all declarations in a header file well-contained into a namespace and do not ever expose those to the global scope with a <tt>using</tt> directive.  Even more: do not ever do this for namespaces you do not control, like <tt>std</tt>.</p> <p><b>The exception</b></p> <p>But I think there is a little exception, as usual.</p> <p>Sometimes, standard libraries from different vendors differ in what they expose via the C++-style headers for standard C functionality.  Take <tt>vsnprintf(3)</tt> as an example.  This function is declared in the <tt>stdio.h</tt> file in C and in the <tt>cstdio</tt> file in C++.  Using the latter should mean that the function is made available only in the <tt>std</tt> namespace, not globally... but that's not always the case.  Some standard libraries will expose <tt>vsnprintf(3)</tt> as a global symbol even when using <tt>cstdio</tt>.</p> <p>The question is: how do you use this function in your code?  Because, depending on the compiler, you will either have to prefix its call with <tt>std::</tt> or not.  You have two alternatives:</p> <table><tr><td><pre>// Option 1.<br /><br />#include &lt;cstdio&gt;<br />#if !defined(HAVE_STD_VSNPRINTF)<br />namespace std {<br />using ::vsnprintf;<br />}<br />#endif<br /><br />...<br /><br />    // Assume it is in std::<br />    std::vsnprintf(...);</pre></td><td><pre>// Option 2.<br /><br />#include &lt;cstdio&gt;<br />#if defined(HAVE_STD_VSNPRINTF)<br />using std::vsnprintf;<br />#endif<br /><br /><br /><br />...<br /><br />    // Assume it is in ::<br />    ::vsnprintf(...);</pre></td></tr></table> <p>These rely on you being able to define <tt>HAVE_STD_VSNPRINTF</tt> accordingly, which you can do with a manually-crafted <tt>autoconf</tt> test or with more complex magic that relies on compiler-defined constants.</p> <p>What happens when you have to use this function in many different header files, though?  Do you repeat this compatibility hack in all of the files you care about, or do you try to code reuse by putting it in a header file?  Obviously, the latter is better.  But if you do the latter, you really should go for option 1 because option 2 would violate the rule above pretty badly.</p> <p>Can you think of other exceptions?</p>

      </article>

      <div class="post-links">
        <p>
          

          

          <a href="/feed.xml">Subscribe
          via RSS</a>
          &middot;
          <a href="/blog/">Go to posts index</a>
        </p>

        <form class="form-inline"
            action="https://feedburner.google.com/fb/a/mailverify"
            method="post"
            target="popupwindow"
            onsubmit="window.open('https://feedburner.google.com/fb/a/mailverify?uri=jmmv', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true">
          <div class="form-group form-group-sm">
            <input type="text" style="width: 400px" name="email"
                    placeholder="Enter your email to subscribe to new posts"
                    class="form-control input-sm"/>
          </div>
          <button type="submit" value="Subscribe"
                  class="btn btn-default btn-sm">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
          </button>
          &nbsp;&nbsp;&nbsp;Delivered by
          <input type="hidden" value="jmmv" name="uri"/>
          <input type="hidden" name="loc" value="en_US"/>
          <a href="https://feedburner.google.com" target="_blank">FeedBurner</a>
        </form>
      </div>

      
      <div id="disqus_thread">
        <script>
          var disqus_config = function () {
            this.page.url = "http://julio.meroh.net/2013/12/header-files-avoid-c-using-directives.html";
            this.page.identifier = "/2013/12/header-files-avoid-c-using-directives";
          };
          (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//jmmv.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
        <noscript>Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments
          powered by Disqus.</a>
        </noscript>
      </div>
      
      <p>Comments from the original Blogger-hosted post:</p>
      <script src="https://apis.google.com/js/plusone.js"></script>
      <div class="g-comments"
           data-href="http://julipedia.meroh.net/2013/12/header-files-avoid-c-using-directives.html"
           data-first_party_property="BLOGGER"
           data-view_type="FILTERED_POSTMOD">
      </div>
      
      
    </div>

    <div class="container">
  <footer>
    <p class="pull-right"><a href="#">Back to top</a></p>
    <p>Copyright 2016 Julio Merino</p>
  </footer>
</div>

<script src="/js/jquery-1.11.2.min.js">
</script>
<script
  src="/css/bootstrap.min.js">
</script>

<script src="/js/auto-toc-1.0.0.dist.js">
</script>

<script>
$("p:contains('NOTE: ')").addClass("callout callout-info");
$("p:contains('IMPORTANT: ')").addClass("callout callout-info");
$("p:contains('WARNING: ')").addClass("callout callout-warning");
$("p:contains('DANGER: ')").addClass("callout callout-danger");
</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
  m.parentNode.insertBefore(a,m)})(window,document,'script',
  '//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63557333-1', 'auto');
  ga('send', 'pageview');
</script>


  </body>
</html>
