<!DOCTYPE html>
<html>
  <head>
    

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head
      content must come *after* these tags -->

<meta name="description"
      content="Let's start the series with something simple: the basic structure of header files and why and how to protect against multiple inclusion.">
<meta name="author" content="Julio Merino">

<meta content="http://julio.meroh.net/2013/11/header-files-multiple-inclusion.html" property="og:url">

<link rel="canonical" href="http://julio.meroh.net/2013/11/header-files-multiple-inclusion.html">
<link rel="alternate" type="application/rss+xml" title="Julio Merino" href="http://julio.meroh.net/feed.xml" />

<link rel="stylesheet" href="/css/main.css">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="/js/html5shiv-3.7.2.min.js"></script>
  <script src="/js/respond-1.4.2.min.js"></script>
<![endif]-->

    <title>Header files: Multiple-inclusion protection - Julio Merino</title>
    <meta content="Header files: Multiple-inclusion protection - Julio Merino" property="og:title">
  </head>

  <body>
    <header class="site-header">

<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed"
              data-toggle="collapse" data-target="#navbar"
              aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Julio Merino</a>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
          
            
              
                <li><a class="page-link"
                href="/about/"
                >About</a></li>
              
            
          
        
          
            
              
                <li><a class="page-link"
                href="/essays/"
                >Essays</a></li>
              
            
          
        
          
            
              
                <li><a class="page-link"
                href="/software/"
                >Software</a></li>
              
            
          
        
          
            
              
                <li><a class="page-link"
                href="/work/"
                >Work</a></li>
              
            
          
        
      </ul>

      <form class="navbar-form navbar-right" method="get" role="search"
            action="http://www.google.com/search">
          <div class="form-group">
            <input type="text" name="query" class="form-control"
                   placeholder="Search">
            <input type="hidden" name="sitesearch" value="http://julio.meroh.net">
          </div>
          <button type="submit" value="Search" class="btn btn-default">
            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
          </button>
      </form>
    </div>
  </div>
</nav>

</header>


    <div class="page-header">
      <div class="container">
        <h1>Header files: Multiple-inclusion protection</h1>

        <p>Thu, 21 Nov 2013 17:00:00 +0000</p>

        
      </div>
    </div>

    <div class="container">
      <article>
        <p>Let's start the series with something simple: the basic structure of header files and why and how to protect against multiple inclusion.</p> <p><b>The rule</b></p> <p>The basic use of header files is to provide symbol declarations for functions and globals.  Because multiple declarations of a given symbol in a single translation unit are a syntax error, you have to defensively structure your header files to not redefine anything in case they are included multiple times.</p> <p>Keep in mind that you just cannot prevent header files from being included more than once unless you were to forbid header files themselves from including other header files... and doing that would be suboptimal at best as we shall see in a future post on self-containment.</p> <p>Just follow this pattern and encapsulate the whole contents of the <i>whole</i> header file within a guard:</p> <pre>#if !defined(PROJECT_MODULE_H)<br />#define PROJECT_MODULE_H<br /><br />... all header file contents go here ...<br /><br />#endif  /* !defined(PROJECT_MODULE_H) */</pre> <p>Easy, but there are two important details to keep in mind:</p> <p>The first is <b>to properly scope the guard names</b>.  These names must be unique within your project and within any project that may ever include them.  Therefore, it is good practice to always prefix your guard names with the name of your project and follow them by the name of the module.</p> <p>The second is <b>to not be clever</b>.  Compilers <i>expect</i> the structure above in order to apply optimizations against multiple inclusions of a single file.  If you break the pattern, you can unknowingly incur higher build times.  For example, <a href="http://gcc.gnu.org/onlinedocs/cppinternals/Guard-Macros.html">see GCC's documentation on this topic</a> for details.</p> <p><b>The exception</b></p> <p>As with any rule there is an exception: not all header files can safely be included more than once.  If a header file defines a static symbol or helper function, you have to ensure that it is not pulled in from more than one place.</p> <p>Yes, the compiler would detect this on its own but, for readability purposes, your header file should explicitly state this fact.  Use this other pattern instead:</p> <pre>#if defined(PROJECT_MODULE_H)<br />#error "Must only be included once and only from .c files"<br />#endif<br />#define PROJECT_MODULE_H<br /><br />... all header file contents go here ...</pre> <p>But when can this happen?  Very rarely, really.  A specific case of the above would be a header file providing helper functions for testing, both their definitions and their implementation.  Theoretically, you could split the two into a traditional header file and a source file, compile them separately and link them together with each test program you write.  However, doing so may complicate your build unnecessarily.  (Ab)using a single header file can make things easier to handle.  <a href="https://code.google.com/p/kyua/source/browse/utils/sqlite/test_utils.hpp?spec=svnc8d23d1736823ac35f56a15f87fe453c12469205&r=9b5b6a1e82594e30d04e684bdf8612ad417c9209">See this test_utils.hpp example.</a></p>

      </article>

      <div class="post-links">
        <p>
          

          

          <a href="/feed.xml">Subscribe
          via RSS</a>
          &middot;
          <a href="/blog/">Go to posts index</a>
        </p>

        <form class="form-inline"
            action="https://feedburner.google.com/fb/a/mailverify"
            method="post"
            target="popupwindow"
            onsubmit="window.open('https://feedburner.google.com/fb/a/mailverify?uri=jmmv', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true">
          <div class="form-group form-group-sm">
            <input type="text" style="width: 400px" name="email"
                    placeholder="Enter your email to subscribe to new posts"
                    class="form-control input-sm"/>
          </div>
          <button type="submit" value="Subscribe"
                  class="btn btn-default btn-sm">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
          </button>
          &nbsp;&nbsp;&nbsp;Delivered by
          <input type="hidden" value="jmmv" name="uri"/>
          <input type="hidden" name="loc" value="en_US"/>
          <a href="https://feedburner.google.com" target="_blank">FeedBurner</a>
        </form>
      </div>

      
      <div id="disqus_thread">
        <script>
          var disqus_config = function () {
            this.page.url = "http://julio.meroh.net/2013/11/header-files-multiple-inclusion.html";
            this.page.identifier = "/2013/11/header-files-multiple-inclusion";
          };
          (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//jmmv.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
        <noscript>Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments
          powered by Disqus.</a>
        </noscript>
      </div>
      
      <p>Comments from the original Blogger-hosted post:</p>
      <script src="https://apis.google.com/js/plusone.js"></script>
      <div class="g-comments"
           data-href="http://julipedia.meroh.net/2013/11/header-files-multiple-inclusion.html"
           data-first_party_property="BLOGGER"
           data-view_type="FILTERED_POSTMOD">
      </div>
      
      
    </div>

    <div class="container">
  <footer>
    <p class="pull-right"><a href="#">Back to top</a></p>
    <p>Copyright 2016 Julio Merino</p>
  </footer>
</div>

<script src="/js/jquery-1.11.2.min.js">
</script>
<script
  src="/css/bootstrap.min.js">
</script>

<script src="/js/auto-toc-1.0.0.dist.js">
</script>

<script>
$("p:contains('NOTE: ')").addClass("callout callout-info");
$("p:contains('IMPORTANT: ')").addClass("callout callout-info");
$("p:contains('WARNING: ')").addClass("callout callout-warning");
$("p:contains('DANGER: ')").addClass("callout callout-danger");
</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
  m.parentNode.insertBefore(a,m)})(window,document,'script',
  '//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63557333-1', 'auto');
  ga('send', 'pageview');
</script>


  </body>
</html>
