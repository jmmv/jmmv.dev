<!DOCTYPE html>
<html>
  <head>
    

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head
      content must come *after* these tags -->

<meta name="description"
      content="The scenario of the day: a binary you deployed to production two months ago has been running fine and dandy since then... until today, when the report of a s...">
<meta name="author" content="Julio Merino">

<meta content="http://julio.meroh.net/2013/10/production-software-identifying-your.html" property="og:url">

<link rel="canonical" href="http://julio.meroh.net/2013/10/production-software-identifying-your.html">
<link rel="alternate" type="application/rss+xml" title="Julio Merino" href="http://julio.meroh.net/feed.xml" />

<link rel="stylesheet" href="/css/main.css">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="/js/html5shiv-3.7.2.min.js"></script>
  <script src="/js/respond-1.4.2.min.js"></script>
<![endif]-->

    <title>Production software: Identifying your builds - Julio Merino</title>
    <meta content="Production software: Identifying your builds - Julio Merino" property="og:title">
  </head>

  <body>
    <header class="site-header">

<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed"
              data-toggle="collapse" data-target="#navbar"
              aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Julio Merino</a>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
          
            
              
                <li><a class="page-link"
                href="/about/"
                >About</a></li>
              
            
          
        
          
            
              
                <li><a class="page-link"
                href="/essays/"
                >Essays</a></li>
              
            
          
        
          
            
              
                <li><a class="page-link"
                href="/software/"
                >Software</a></li>
              
            
          
        
          
            
              
                <li><a class="page-link"
                href="/work/"
                >Work</a></li>
              
            
          
        
      </ul>

      <form class="navbar-form navbar-right" method="get" role="search"
            action="http://www.google.com/search">
          <div class="form-group">
            <input type="text" name="query" class="form-control"
                   placeholder="Search">
            <input type="hidden" name="sitesearch" value="http://julio.meroh.net">
          </div>
          <button type="submit" value="Search" class="btn btn-default">
            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
          </button>
      </form>
    </div>
  </div>
</nav>

</header>


    <div class="page-header">
      <div class="container">
        <h1>Production software: Identifying your builds</h1>

        <p>Mon, 28 Oct 2013 16:00:00 +0000</p>

        
      </div>
    </div>

    <div class="container">
      <article>
        <p>The scenario of the day: a binary you deployed to production two months ago has been running fine and dandy since then... until today, when the report of a strange and concerning crash arrived.  Nothing really unusual: these things happen all the time and need to be dealt with.</p> <p>But you, as the proud developer of the software, attempt to reproduce the problem on your own system with the most recent sources and... cannot do so: the issue escapes all your tests (again, not unusual).  Is the problem really gone or have recent changes to the source hidden the problem by modifying the triggering conditions?  Either way you have to verify it because the second case is usually quite scary.</p> <p>A way to go about this is to attempt to roll the code back to the revision used to build that particular binary, attempt to reproduce the problem again with that build and, with some luck, you may be able to.  But hang on.... do you know exactly what revision to roll back to?  Do you know if you should be rolling back anything else?</p> <p><b>The binary</b></p> <p>These questions highlight that you need a mechanism to map, univocally, your production system to the source code used to build it.  An obvious way of doing so is by bundling the <i>revision number</i> (from your version control system) against which the binary was built into the binary itself.  Having this number inside the binary itself ensures you never lose the mapping and provides you easy access to the information you need.  (Bonus points if you dump those details <a href="/2013/10/production-software-logging_24.html">into the log</a> as part of the program startup process so that they are available right inside any crash report.)</p> <p><b>The environment</b></p> <p>Alright.  So you have recorded the revision number used to build your binary; great.  Is that enough?  What about all those shared libraries your program depends on?  What about any external programs you may be invoking?  What about <i>the compiler</i>?  All these external dependencies can cause your program to misbehave or can hide the issue being looked at if they change.</p> <p>The answers to these questions are tricky and the way you go about answering them really depends on the structure of your production environment.</p> <p>One way you could achieve this is by recording the full list of installed packages, <i>both at the time the binary was built</i> (so you capture details like the compiler) <i>and at the time the binary was run</i>.  Note that compilation and execution will usually happen in different systems, so recording these two lists is important.  If you have these lists at hand, you will be able to roll back any offending components to the right version and have higher chances of successfully reproducing the issue.</p> <p>Unfortunately, while this may work reasonably well in the majority of Linux distributions, it may not in BSD systems.  The reason is that most packaging systems for Linux build packages once and only once for any specific package version.  In BSD packaging systems (e.g. ports and pkgsrc), however, it is common to rebuild all packages from scratch for various reasons, and doing so will not change the packages' version numbers; those numbers only change when a developer explicitly modifies the package.  While, in general, such rebuilds will be similar enough, they may not be as details on the host build system may influence them significantly.</p> <p><b>TL;DR</b></p> <p>This is all tricky as you can see.  However, if you don't have the means to record all the relevant details, start easy!  Just record the revision number of the source tree used the build the binary in a durable place and ignore the rest.  This alone will save you a lot of time.</p>

      </article>

      <div class="post-links">
        <p>
          

          

          <a href="/feed.xml">Subscribe
          via RSS</a>
          &middot;
          <a href="/blog/">Go to posts index</a>
        </p>

        <form class="form-inline"
            action="https://feedburner.google.com/fb/a/mailverify"
            method="post"
            target="popupwindow"
            onsubmit="window.open('https://feedburner.google.com/fb/a/mailverify?uri=jmmv', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true">
          <div class="form-group form-group-sm">
            <input type="text" style="width: 400px" name="email"
                    placeholder="Enter your email to subscribe to new posts"
                    class="form-control input-sm"/>
          </div>
          <button type="submit" value="Subscribe"
                  class="btn btn-default btn-sm">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
          </button>
          &nbsp;&nbsp;&nbsp;Delivered by
          <input type="hidden" value="jmmv" name="uri"/>
          <input type="hidden" name="loc" value="en_US"/>
          <a href="https://feedburner.google.com" target="_blank">FeedBurner</a>
        </form>
      </div>

      
      <div id="disqus_thread">
        <script>
          var disqus_config = function () {
            this.page.url = "http://julio.meroh.net/2013/10/production-software-identifying-your.html";
            this.page.identifier = "/2013/10/production-software-identifying-your";
          };
          (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//jmmv.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
        <noscript>Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments
          powered by Disqus.</a>
        </noscript>
      </div>
      
      <p>Comments from the original Blogger-hosted post:</p>
      <script src="https://apis.google.com/js/plusone.js"></script>
      <div class="g-comments"
           data-href="http://julipedia.meroh.net/2013/10/production-software-identifying-your.html"
           data-first_party_property="BLOGGER"
           data-view_type="FILTERED_POSTMOD">
      </div>
      
      
    </div>

    <div class="container">
  <footer>
    <p class="pull-right"><a href="#">Back to top</a></p>
    <p>Copyright 2018 Julio Merino</p>
  </footer>
</div>

<script src="/js/jquery-1.11.2.min.js">
</script>
<script
  src="/css/bootstrap.min.js">
</script>

<script src="/js/auto-toc-1.0.0.dist.js">
</script>

<script>
$("p:contains('NOTE: ')").addClass("callout callout-info");
$("p:contains('IMPORTANT: ')").addClass("callout callout-info");
$("p:contains('WARNING: ')").addClass("callout callout-warning");
$("p:contains('DANGER: ')").addClass("callout callout-danger");
</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
  m.parentNode.insertBefore(a,m)})(window,document,'script',
  '//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63557333-1', 'auto');
  ga('send', 'pageview');
</script>


  </body>
</html>
