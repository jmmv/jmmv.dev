<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml xmlns:fb=http://ogp.me/ns/fb#><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta property="og:site_name" content="Julio Merino (jmmv.dev)"><meta property="twitter:site" content="@jmmv"><title>Rust traits and dependency injection - Julio Merino (jmmv.dev)</title><meta property="og:title" content="Rust traits and dependency injection - Julio Merino (jmmv.dev)"><meta property="twitter:title" content="Rust traits and dependency injection - Julio Merino (jmmv.dev)"><meta name=description content="Dependency injection is one of my favorite design patterns to develop highly-testable and modular code. Unfortunately, applying this pattern by taking Rust traits as arguments to public functions has unintended consequences on the visibility of private symbols. If you are not careful, most of your crate-internal APIs might need to become public just because you needed to parameterize a function with a trait. Let&amp;rsquo;s look at why this happens and what we can do about it."><meta property="og:description" content="Dependency injection is one of my favorite design patterns to develop highly-testable and modular code. Unfortunately, applying this pattern by taking Rust traits as arguments to public functions has unintended consequences on the visibility of private symbols. If you are not careful, most of your crate-internal APIs might need to become public just because you needed to parameterize a function with a trait. Let&amp;rsquo;s look at why this happens and what we can do about it."><meta property="twitter:description" content="Dependency injection is one of my favorite design patterns to develop highly-testable and modular code. Unfortunately, applying this pattern by taking Rust traits as arguments to public functions has …"><meta name=author content="Julio Merino"><meta property="twitter:creator" content="@jmmv"><meta name=generator content="Hugo 0.111.3"><meta property="og:url" content="https://jmmv.dev/2022/04/rust-traits-and-dependency-injection.html"><meta property="og:type" content="blog"><meta property="twitter:card" content="summary"><link rel=canonical href=https://jmmv.dev/2022/04/rust-traits-and-dependency-injection.html><link rel=alternate type=application/rss+xml title="Julio Merino (jmmv.dev)" href=/feed.xml><link rel=stylesheet href=/sass/main.min.52b548e9c069c09e7522318b2cf209296e28a38aa2739ce528e6f9a488ce0797.css><link rel=stylesheet href=/css/chroma.css><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicons/favicon-96x96.png sizes=96x96><meta property="og:image" content="/images/favicons/favicon-1200x1200.png"><meta property="twitter:image" content="https://jmmv.dev/images/favicons/favicon-1200x1200.png"><script>const SITE_ID="e8da9f62-b7ac-4fe9-bf20-7c527199a376",BASE_URL="https://jmmv.dev/"</script></head><body><header class=site-header><nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary"><a class=navbar-brand href=/><img src=/images/favicons/favicon-30x30.png width=30 height=30 class="d-inline-block align-top" alt>
&nbsp;Julio Merino</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/about.html>About</a></li><li class=nav-item><a class=nav-link href=/essays.html>Essays</a></li><li class=nav-item><a class=nav-link href=/resume.html>Resume</a></li><li class=nav-item><a class=nav-link href=/software.html>Software</a></li></ul><ul class="navbar-nav mr-4"><li class=nav-item><a class=nav-link href=/archive.html>Archive</a></li><li class=nav-item><a class=nav-link href=/series.html>Series</a></li><li class=nav-item><a class=nav-link href=/tags.html>Tags</a></li></ul><form class=form-inline method=get role=search action=https://www.google.com/search><div class=input-group><input type=search name=query class=form-control placeholder=Search aria-label=Search><div class=input-group-append><button type=submit value=Search class="btn btn-light">
<img src=/octicons/search.svg></button></div></div><input type=hidden name=sitesearch value=https://jmmv.dev/></form></div></nav></header><div class=page-header><div class=container><h1>Rust traits and dependency injection</h1><p>April 22, 2022 &#183;
About 8 minutes
&#183;
Tags:
<a href=/tags/featured>featured</a>, <a href=/tags/rust>rust</a></p></div></div><div class="container post-body"><div class=row><div class=col-md-9><div class=row><div class=col><article><p><a href=https://en.wikipedia.org/wiki/Dependency_injection>Dependency injection</a> is one of my favorite design patterns to develop highly-testable and modular code. To apply this pattern, all you have to do is follow two simple guidelines:</p><ol><li><p><strong>Separate object construction from usage.</strong> In practical terms: stop creating objects inside constructors and take those objects as input arguments.</p></li><li><p><strong>Use interfaces instead of concrete types as constructor parameters.</strong> In this way, the receiver remains agnostic to the implementation of those types and thus it becomes possible to supply different implementations.</p></li></ol><p>Dependency injection is key to testability indeed, but it is also a good design principle<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> because it keeps system pieces loosely coupled. The best part is that dependency injection is a simple concept: there is no need for fancy frameworks.</p><p>As for how to define the generic interfaces, the techniques depend on your language of choice. In C++, you would define pure abstract classes; in Java, Go and C#, you would define interfaces; and in Rust, you would use traits.</p><p>This post is about Rust though, so let&rsquo;s talk about using traits for dependency injection, how they have a nasty side-effect, and what we can do about it.</p><h1 id=an-example>An example</h1><p>When the dependency injection pattern is applied correctly, a library crate exposes:</p><ol><li>traits to represent heavyweight objects;</li><li>a collection of objects that implement those traits; and</li><li>functions that consume those objects via the generic traits.</li></ol><p>Then, consumers of the library instantiate the specific objects they need, wire them together to create a dependency graph, and feed those into the generic business logic functions exposed by the library.</p><p>Is that clear? Yeah&mldr; I guess not. Let&rsquo;s take a look at a concrete example so that we can have reference code for the explanations below. For that, I&rsquo;ll use the code of <a href=/2022/04/introducing-db-logger.html>the <code>db_logger</code> crate I recently published</a>.</p><p>The <code>db_logger</code> crate provides a <code>log</code> facade implementation that records log messages into a database. The database in which messages are stored depends on your choice between PostgreSQL and SQLite (for now), and this selection is made via dependency injection.</p><p>You would think that Cargo features would be sufficient to choose a database backend, but Cargo features are a poor tool for this kind of configuration. Cargo features are well-suited to control which dependencies are <em>built</em> and not&mdash;and <a href=https://github.com/jmmv/db_logger/blob/bc3adfbf4b335af84f0178f8b0331f6a6d2323c5/Cargo.toml#L13><code>db_logger</code> indeed supplies <code>postgres</code> and <code>sqlite</code> features</a> for this reason&mdash;but you, the user, still have to choose which database to talk to via code. Configuring each backend requires different settings and you may even want to select a backend at runtime.</p><p>To support runtime configuration, we start by defining a trait to represent the generic features we need our database connection to expose. In this way, the logging (business) logic can record log entries and remain unaware of which specific database it is talking to. Then, we add a function to initialize the logger based on an abstract connection object and we are done:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[async_trait]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=sd>/// Operations that an arbitrary database connection can perform.
</span></span></span><span class=line><span class=cl><span class=sd></span><span class=k>pub</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=n>Db</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>put_log_entries</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>es</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=n>LogEntry</span><span class=o>&lt;</span><span class=nb>&#39;_</span><span class=p>,</span><span class=w> </span><span class=nb>&#39;_</span><span class=o>&gt;&gt;</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=p>()</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=sd>/// Initializes the logging subsystem to record entries in `db`.
</span></span></span><span class=line><span class=cl><span class=sd></span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>init</span><span class=p>(</span><span class=n>db</span>: <span class=nc>Arc</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=n>Db</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>Send</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>Sync</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>&#39;static</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>With this interface at hand, consumers of <code>db_logger</code> can pick which database to connect to by using alternate objects that implement the <code>Db</code> trait&mdash;of which there are two now: <code>PostgresDb</code> and <code>SqliteDb</code>.</p><p>On the consumer side (say, from <code>src/main.rs</code>), we can do something like this when we want to talk to PostgreSQL:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>db</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Arc</span>::<span class=n>from</span><span class=p>(</span><span class=n>db_logger</span>::<span class=n>PostgresDb</span>::<span class=n>connect_lazy</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>host</span><span class=p>,</span><span class=w> </span><span class=n>port</span><span class=p>,</span><span class=w> </span><span class=n>database</span><span class=p>,</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>db_logger</span>::<span class=n>init</span><span class=p>(</span><span class=n>db</span><span class=p>);</span><span class=w>  </span><span class=c1>// Doesn&#39;t care about which specific `db`.
</span></span></span></code></pre></div><p>Or something like this when we want to talk to SQLite:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>db</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Arc</span>::<span class=n>from</span><span class=p>(</span><span class=n>db_logger</span>::<span class=n>SqliteDb</span>::<span class=n>connect</span><span class=p>(</span><span class=n>uri</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>db_logger</span>::<span class=n>init</span><span class=p>(</span><span class=n>db</span><span class=p>);</span><span class=w>  </span><span class=c1>// Doesn&#39;t care about which specific `db`.
</span></span></span></code></pre></div><p>Note that, thanks to this design, not only downstream consumers are better off: the business logic unit tests can use this abstraction as well to remain stable and extremely fast. In particular, the logging logic&rsquo;s <a href=https://github.com/jmmv/db_logger/blob/bc3adfbf4b335af84f0178f8b0331f6a6d2323c5/src/logger.rs#L347>unit tests inject a connection to an in-memory SQLite database</a>, which makes them super-fast and avoids flakiness due to misconfiguration or networking issues.</p><p>Sounds great, right? Well, it does, but notice how the <code>Db</code> trait above references the <code>LogEntry</code> type in its <code>put_log_entries()</code> function. That type, which users of the <code>db_logger</code> crate should have no knowledge of, must now be public too because <code>Db</code> is public. And this is a big transitive problem.</p><h1 id=the-problem>The problem</h1><p>To key issue with using traits in Rust for dependency injection is that any type referenced in a function signature must be at least as visible as the function itself. Which means that if a trait is public (like the <code>Db</code> trait above), any type referenced by any of the trait&rsquo;s functions (like the <code>LogEntry</code> struct above), will have to be public as well.</p><p>Too broad visibility is problematic for at least two reasons:</p><ul><li><p><strong>Broken encapsulation.</strong> Users of a library (crate) shouldn&rsquo;t see APIs that are internal to the library. Otherwise, they can easily take dependencies on implementation details, which can break behavior and will make your life as a maintainer harder in the future.</p></li><li><p><strong>Insufficient dead code detection.</strong> Once a type is marked public, the compiler cannot claim that it is unused even if nothing else uses the type within the crate. This is viral: an unused type may be referenced by unused functions, which in turn may reference other unused types, etc. Link-time optimizations can make this (almost) a non-issue at runtime, but any dead code is a liability during development because it gets in the way of maintenance.</p></li></ul><p>This problem is not exclusive to library crates. Binary crates suffer as well if you follow the recommendations of placing most code into a private library and having <code>src/main.rs</code> be a simple facade over the library. Plus <em>any</em> crate can suffer if it has integration tests because those can only interact with your public interface.</p><p>So, what can we do about this to keep our architecture sane?</p><h1 id=bad-solution-do-it-all-functions>Bad solution: &ldquo;do-it-all functions&rdquo;</h1><p>A first solution is to try and hide the problematic traits behind what I&rsquo;ll call &ldquo;do-it-all functions&rdquo; for lack of a better name.</p><p>This is what I first did in a couple of projects last year. In those project, I used to have a <code>serve_rest_api()</code> public function that took the database connection and then started a REST server backed by it. To hide the traits, I renamed this function to <code>serve_rest_api_internal()</code> and then added a new <code>serve_rest_api()</code> function that took configuration parameters to decide which objects to instantiate, thus subsuming most of the logic that previously existed in <code>src/main.rs</code>.</p><p>Needless to say, this is ugly because we lose <a href=https://en.wikipedia.org/wiki/Composability>composability</a>, and this looks bad because we are shoehorning the responsibilities of the main program into the library&mdash;all to appease some visibility issues. Not a good trade-off from an API design perspective.</p><p>To make matters worse, this approach didn&rsquo;t quite work for <code>db_logger</code>. In the case of this library, you can imagine having exposed <code>init_postgres()</code> and <code>init_sqlite()</code> public functions (again, bad for composability) that created the database objects within them. I tried doing that, but I ran into some nightmare-ish problems in my integration tests because I had to handle lifetimes and async tasks across async runtime boundaries (<code>Drop</code> being sync is&mldr; troublesome).</p><p>As a result of this trouble, I ended up having to dump this &ldquo;solution&rdquo; and spend a couple of head-scratching mornings finding an alternative&mdash;which is a good thing because these &ldquo;do-it-all functions&rdquo; really sucked from a design perspective.</p><h1 id=good-solution-newtype>Good solution: newtype</h1><p>I don&rsquo;t know why it took me so long to reach the conclusion of using the <a href=https://rust-unofficial.github.io/patterns/patterns/behavioural/newtype.html>newtype idiom</a> to hide the traits. I guess I was too bogged down in trying to make the specific solution above work, and that prevented me from seeing an alternative approach. In retrospect, it sounds trivial, but here it goes.</p><p>The idea to solve the visibility issues is to introduce a new concrete type that wraps the trait as its single member. Then, this concrete type is the one that&rsquo;s made public and the trait (and all of its dependencies) can remain private.</p><p>For our <code>db_logger</code> case study, all we have to do is introduce a new type, like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[derive(Clone)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>struct</span> <span class=nc>Connection</span><span class=p>(</span><span class=n>Arc</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=n>Db</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>Send</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>Sync</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>&#39;static</span><span class=o>&gt;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>Note how <code>Connection</code> is just wrapping the <code>Db</code> trait, but now, the trait is an implementation detail of the struct and does not have to be public. Note also how this hides the complexity of the <code>Db</code> instance representation: the <code>Arc</code> and all of the trait bounds are now hidden within the struct and don&rsquo;t pollute the public API.</p><p>With this, we can update our concrete implementations of <code>Db</code> with some factory methods:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=sd>/// Factory to connect to a PostgreSQL database.
</span></span></span><span class=line><span class=cl><span class=sd></span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>connect_lazy</span><span class=p>(</span><span class=n>opts</span>: <span class=nc>ConnectionOptions</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>Connection</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Connection</span><span class=p>(</span><span class=n>Arc</span>::<span class=n>from</span><span class=p>(</span><span class=n>PostgresDb</span>::<span class=n>connect_lazy</span><span class=p>(</span><span class=n>opts</span><span class=p>,</span><span class=w> </span><span class=nb>None</span><span class=p>)))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=sd>/// Factory to connect to a SQLite database.
</span></span></span><span class=line><span class=cl><span class=sd></span><span class=k>pub</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>connect</span><span class=p>(</span><span class=n>opts</span>: <span class=nc>ConnectionOptions</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=n>Connection</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SqliteDb</span>::<span class=n>connect</span><span class=p>(</span><span class=n>opts</span><span class=p>).</span><span class=k>await</span><span class=p>.</span><span class=n>map</span><span class=p>(</span><span class=o>|</span><span class=n>db</span><span class=o>|</span><span class=w> </span><span class=n>Connection</span><span class=p>(</span><span class=n>Arc</span>::<span class=n>from</span><span class=p>(</span><span class=n>db</span><span class=p>)))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>And, finally, our caller code can do one of these to set up the logger with ease:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>conn</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>use_real_db</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>postgres</span>::<span class=n>connect_lazy</span><span class=p>(</span><span class=o>..</span><span class=p>.)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sqlite</span>::<span class=n>connect</span><span class=p>(</span><span class=o>..</span><span class=p>.)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>db_logger</span>::<span class=n>init</span><span class=p>(</span><span class=n>conn</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>Voila. By hiding the trait into a struct with the newtype idiom, the trait and all of its internal dependent types can be private again. And, as expected, the compiler can now spot unused code.</p><p><strong>Update (2022-04-23):</strong> Some people have brought up via other channels that using static dispatch might be a better approach to avoid the runtime overheads imposed by the solution above. Maybe. I hadn&rsquo;t thought about that when writing this post or the referenced code. Would be interesting to explore that avenue.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Dependency injection can also be a horrible way to make your code harder to work with when applied blindly. Some people have taken the meaning of &ldquo;don&rsquo;t construct objects inside other objects&rdquo; to the limit and have hidden even classes that represent plain data types behind interfaces. Don&rsquo;t be that person. Only define interfaces for objects that interact with the real world (file systems, databases, networks, graphics, etc.) or that implement functionality that is so complex that it makes other parts of the system hard to test.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article></div></div><div class="container post-links"><div class=row><div class="col mr-auto text-left"><span><a href=https://jmmv.dev/2022/04/qb64-super-dark-blue.html>&#171; Previous</a></span></div><div class="col text-center"><span><a href=/archive.html>All posts</a></span></div><div class="col ml-auto text-right"><span><a href=https://jmmv.dev/2022/04/do-rust-devs-hate-go-devs.html>Next &#187;</a></span></div></div></div><div class="container post-votes"><div class=row><div class="col-lg-4 my-2"><div class=row><div class=col><a onclick=voteThumbsUp() class="btn btn-block btn-outline-success" id=thumbs-up-btn>👍
(<span id=thumbs-up-count>0</span>)</a></div><div class=col><a onclick=voteThumbsDown() class="btn btn-block btn-outline-danger" id=thumbs-down-btn>👎
(<span id=thumbs-down-count>0</span>)</a></div></div></div><div class="col-lg-8 my-2 d-none d-sm-block"><div class=row><div class="col-md-4 text-center"><a href=https://www.reddit.com/r/rust/comments/u9vys8/rust_traits_and_dependency_injection/ class="btn btn-block btn-outline-primary">Go to
<img src=/images/badges/reddit.png alt=Reddit width=24 height=24></a></div><div class="col-md-4 text-center"><a href="https://news.ycombinator.com/submitlink?t=Rust+traits+and+dependency+injection&amp;u=https%3A%2F%2Fjmmv.dev%2F2022%2F04%2Frust-traits-and-dependency-injection.html" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/ycombinator.png alt="Hacker News" width=24 height=24></a></div><div class="col-md-4 text-center"><a href="https://twitter.com/intent/tweet?status=Rust+traits+and+dependency+injection+%E2%80%94+https%3A%2F%2Fjmmv.dev%2F2022%2F04%2Frust-traits-and-dependency-injection.html+%E2%80%94+cc+%40jmmv" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/Twitter_Social_Icon_Circle_Color.png alt=Twitter width=24 height=24></a></div></div></div></div><div class="row my-4" id=postCommentRow><div class=col><div class=media><img class=mr-3 src=/octicons/pencil.svg width=32px height=32px><div class="media-body container"><form method=post id=newPost><div class=row><div class="col my-1"><textarea class=form-control rows=1 id=postCommentContent onclick=showPostComment() placeholder="Leave a comment"></textarea></div></div><div class="row newPostControls" style=display:none><div class="col my-1 form-group"><label for=postCommentAuthor>Your name (optional):</label>
<input type=text class=form-control id=postCommentAuthor></div></div><div class="row newPostControls" style=display:none><div class="col my-1 form-group"><label for=postCommentEmail>Your email (optional):</label>
<input type=text class=form-control type=email id=postCommentEmail>
<small class="form-text text-muted">Invisible to all readers; if provided, you will receive notifications when replied to (not implemented yet)</small></div></div><div class=row id=postCommentError style=display:none><div class="col mt-1 alert-danger"><p></p></div></div><div class="row newPostControls" style=display:none><button class="col-md-3 my-1 btn btn-primary" type=submit id=submitCommentButton>Post</button>
<small class="col-md-9 my-1 text-muted">Comments are subject to moderation. This feature is experimental and is powered by <a href=/software/endtracker.html>EndTRACKER</a>. If you experience any issues, please <a href=/about.html#contact>contact me off-band</a>.</small></div></form></div></div></div></div><script>function hidePostComment(){var t,e=document.getElementById("postCommentContent");e.rows=1,e.value="",t=document.getElementsByClassName("newPostControls"),Array.prototype.forEach.call(t,function(e){e.style.display="none"})}function showPostComment(){var e,t=document.getElementById("postCommentContent");t.rows=5,e=document.getElementsByClassName("newPostControls"),Array.prototype.forEach.call(e,function(e){e.style.display=""})}const form=document.querySelector("#newPost");form.onsubmit=function(e){e.preventDefault();let t=document.getElementById("postCommentAuthor").value,n=document.getElementById("postCommentEmail").value,s=document.getElementById("postCommentContent").value;postComment(t,n,s,hidePostComment)}</script></div><div class="container post-subscribe d-block d-md-none"><div class="row text-center"><p>A blog on operating systems, programming languages, testing, build systems, my own software
projects and even personal productivity. Specifics include FreeBSD, Linux, Rust, Bazel and
EndBASIC.</p></div><div class=row><div class="col-sm-3 py-2"><div class=row><div class="col px-2 text-center"><a rel=me href=https://mastodon.online/@jmmv><img src=/images/badges/mastodon-logo.svg width=32px height=32px alt="Follow @jmmv on Mastodon"></a></div><div class="col px-2 text-center"><a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&amp;screen_name=jmmv"><img src=/images/badges/Twitter_logo_blue.svg width=32px height=32px alt="Follow @jmmv on Twitter"></a></div><div class="col px-2 text-center"><a href=/feed.xml><img src=/images/badges/feed-icon-28x28.png alt="RSS feed"></a></div></div></div><div class="col-sm-9 py-2 text-center"><form action=https://endtracker.azurewebsites.net/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/subscribers/add method=post><div class=form-group><div class=row><input type=text name=email placeholder="Enter your email" class="form-control input-sm col-8 text-center">
<button type=submit class="btn btn-primary col-4">Subscribe</button></div></div><small><span class=subscriber-count>0</span> subscribers</small></form></div></div></div></div><div class="col-md-3 sidebar d-none d-md-block"><div class=row><div class="col text-center p-2"><p><a href=/about.html class=clear-link><img src=/images/avatars/20181124-snow.jpg class="rounded-circle shadow my-2" style=width:100px><br><b>Julio Merino</b><br>A blog on operating systems, programming languages, testing, build systems, my own software
projects and even personal productivity. Specifics include FreeBSD, Linux, Rust, Bazel and
EndBASIC.</a></p><div class=row><div class="col-sm-4 text-center"><p><a rel=me href=https://mastodon.online/@jmmv><img src=/images/badges/mastodon-logo.svg width=32px height=32px alt="Follow @jmmv on Mastodon"></a></p></div><div class="col-sm-4 text-center"><p><a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&amp;screen_name=jmmv"><img src=/images/badges/Twitter_logo_blue.svg width=32px height=32px alt="Follow @jmmv on Twitter"></a></p></div><div class="col-sm-4 text-center"><p><a href=/feed.xml><img src=/images/badges/feed-icon-28x28.png alt="RSS feed"></a></p></div></div><form action=https://endtracker.azurewebsites.net/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/subscribers/add method=post><div class=form-group><input type=text name=email placeholder="Enter your email" class="form-control input-sm text-center">
<button type=submit class="btn btn-primary btn-block">Subscribe</button></div><small><span class=subscriber-count>0</span> subscribers</small></form></div></div><div class=row><div class=col><h2>Featured software</h2><ul><li class=overflow-ellipsis><a href=https://www.endbasic.dev/ target=_blank>EndBASIC: Online BASIC+DOS env</a></li><li class=overflow-ellipsis><a href=https://endtracker.azurewebsites.net/ target=_blank>EndTRACKER: Services for static sites</a></li></ul></div></div><div class=row><div class=col><h2>Featured posts</h2><ul><li class=overflow-ellipsis><a href=/2023/06/fast-machines-slow-machines.html>Fast machines, slow machines</a></li><li class=overflow-ellipsis><a href=/2022/12/endbasic-0.10.html>EndBASIC 0.10: Core language, evolved</a></li><li class=overflow-ellipsis><a href=/2022/10/bye-microsoft-hi-snowflake.html>Farewell, Microsoft; hello, Snowflake!</a></li><li class=overflow-ellipsis><a href=/2022/05/rust-is-hard-but-does-it-matter.html>Rust is hard, yes, but does it matter?</a></li><li class=overflow-ellipsis><a href=/2022/04/rust-traits-and-dependency-injection.html>Rust traits and dependency injection</a></li><li class=overflow-ellipsis><a href=/2022/03/a-year-on-windows-intro.html>A year on Windows: Introduction</a></li><li class=overflow-ellipsis><a href=/2021/04/always-be-quitting.html>Always be quitting</a></li><li class=overflow-ellipsis><a href=/2021/02/google-monorepos-and-caching.html>How does Google keep build times low?</a></li><li class=overflow-ellipsis><a href=/2020/12/google-no-clean-builds.html>How does Google avoid clean builds?</a></li><li class=overflow-ellipsis><a href=/2020/12/unit-testing-a-console-app.html>Unit-testing a console app (a text editor)</a></li><li class=overflow-ellipsis><a href=/essays.html#featured>More...</a></li></ul></div></div></div></div></div><footer class=container><div class=row><div class="col-4 order-2 texr-right"><p class=float-right><a href=#>Back to top</a></p></div><div class="col-8 order-1 mr-auto"><p>Copyright 2004&ndash;2023 Julio Merino</p></div></div></footer><script type=module>
  import { addAnchorsToHeaders, addElementClasses, BatchClient } from "\/js\/main.d30f168b11d80082408f4a983af9a626c6e57d58f7846b2174bac40d43be33e3.js";

  var batchClient = new BatchClient(SITE_ID);
  batchClient.doAll({
    put_request: true, get_comments: true, get_subscriber_count: true, get_votes: true });

  window.voteThumbsUp = function() { batchClient.voteThumbsUp(); }
  window.voteThumbsDown = function() { batchClient.voteThumbsDown(); }

  window.postComment = function(...args) {
    batchClient.postComment(...args);
  };

  addAnchorsToHeaders();
  addElementClasses();
</script><noscript><img src=https://hugo-dynamic.jmmv.dev/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/pages/aHR0cHM6Ly9qbW12LmRldi8yMDIyLzA0L3J1c3QtdHJhaXRzLWFuZC1kZXBlbmRlbmN5LWluamVjdGlvbi5odG1s/stamp.gif style=display:none></noscript></body></html>