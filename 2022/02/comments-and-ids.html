<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml xmlns:fb=http://ogp.me/ns/fb#><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta property="og:site_name" content="Julio Merino (jmmv.dev)"><meta property="twitter:site" content="@jmmv"><title>Comments are back and other news - Julio Merino (jmmv.dev)</title><meta property="og:title" content="Comments are back and other news - Julio Merino (jmmv.dev)"><meta property="twitter:title" content="Comments are back and other news - Julio Merino (jmmv.dev)"><meta name=description content="Just a couple of weeks ago, I described my home-grown analytics service for this site. Today, I&amp;rsquo;m here to describe a couple of related updates: namely, the support for comments and the complete removal of client-side fingerprinting."><meta property="og:description" content="Just a couple of weeks ago, I described my home-grown analytics service for this site. Today, I&amp;rsquo;m here to describe a couple of related updates: namely, the support for comments and the complete removal of client-side fingerprinting."><meta property="twitter:description" content="Just a couple of weeks ago, I described my home-grown analytics service for this site. Today, I&amp;rsquo;m here to describe a couple of related updates: namely, the support for comments and the complete …"><meta name=author content="Julio Merino"><meta property="twitter:creator" content="@jmmv"><meta name=generator content="Hugo 0.111.3"><meta property="og:url" content="https://jmmv.dev/2022/02/comments-and-ids.html"><meta property="og:type" content="blog"><meta property="twitter:card" content="summary"><link rel=canonical href=https://jmmv.dev/2022/02/comments-and-ids.html><link rel=alternate type=application/rss+xml title="Julio Merino (jmmv.dev)" href=/feed.xml><link rel=stylesheet href=/sass/main.min.cb91349cd93211a37e7d5dc131c35a170fc795721c03373cd05571327eea206b.css><link rel=stylesheet href=/css/chroma.css><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicons/favicon-96x96.png sizes=96x96><meta property="og:image" content="/images/favicons/favicon-1200x1200.png"><meta property="twitter:image" content="https://jmmv.dev/images/favicons/favicon-1200x1200.png"><script>const SITE_ID="e8da9f62-b7ac-4fe9-bf20-7c527199a376",BASE_URL="https://jmmv.dev/"</script></head><body><header class=site-header><nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary"><a class=navbar-brand href=/><img src=/images/favicons/favicon-30x30.png width=30 height=30 class="d-inline-block align-top" alt>
&nbsp;jmmv.dev</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/about.html>About</a></li><li class=nav-item><a class=nav-link href=/blog.html>Blog</a></li><li class=nav-item><a class=nav-link href=/resume.html>Resume</a></li><li class=nav-item><a class=nav-link href=/software.html>Software</a></li></ul><ul class="navbar-nav mr-4"><li class=nav-item><a class=nav-link href=/archive.html>Archive</a></li><li class=nav-item><a class=nav-link href=/series.html>Series</a></li><li class=nav-item><a class=nav-link href=/tags.html>Tags</a></li></ul><form class=form-inline method=get role=search action=https://www.google.com/search><div class=input-group><input type=search name=query class=form-control placeholder=Search aria-label=Search><div class=input-group-append><button type=submit value=Search class="btn btn-light">
<img src=/octicons/search.svg></button></div></div><input type=hidden name=sitesearch value=https://jmmv.dev/></form></div></nav></header><div class=page-header><div class=container><h1>Comments are back and other news</h1><p>February 16, 2022 &#183;
About 4 minutes
&#183;
Tags:
<a href=/tags/blog>blog</a>, <a href=/tags/endtracker>endtracker</a></p></div></div><div class="container post-body"><div class=row><div class=col-md-9><div class=row><div class=col><article><p>Just a couple of weeks ago, <a href=/2022/02/diy-web-analytics.html>I described my home-grown analytics service</a> for this site. I was expecting negativity around the post given that people hear the word &ldquo;tracking&rdquo; and freak out, but I was actually surprised to see an overwhelmingly positive reaction.</p><p>Today, I&rsquo;m here to describe a couple of updates to this service: namely, the support for comments and the complete removal of client-side fingerprinting.</p><div class="container action-highlight p-4 my-4 d-md-none"><div class="row text-center"><p>A blog on operating systems, programming languages, testing, build systems, my own software
projects and even personal productivity. Specifics include FreeBSD, Linux, Rust, Bazel and
EndBASIC.</p></div><div class=row><div class=col><div class=form-group><form action=https://endtracker.azurewebsites.net/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/subscribers/add method=post><input type=text name=email placeholder="Enter your email" class="form-control input-sm text-center my-1">
<button type=submit class="btn btn-primary btn-block my-1">Subscribe</button></form></div></div></div><div class="row px-2"><div class="col col-sm-5 text-left"><small><span class=subscriber-count>0</span> subscribers</small></div><div class="col col-sm-7 text-right"><p><a rel=me href=https://mastodon.online/@jmmv><img src=/images/badges/mastodon-logo.svg width=32px height=32px alt="Follow @jmmv on Mastodon"></a>
<a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&amp;screen_name=jmmv"><img src=/images/badges/Twitter_logo_blue.svg width=32px height=32px alt="Follow @jmmv on Twitter"></a>
<a href=/feed.xml><img src=/images/badges/feed-icon-28x28.png alt="RSS feed"></a></p></div></div></div><h1 id=comments>Comments</h1><p>Since the creation of this blog in 2004, my intent has been to support post comments.</p><p>Looking back at my email archives, I can see that the posts were reasonably lively back in the day. Unfortunately, comment activity died off after a while and I think this happened for two reasons:</p><ul><li><p>The first is my dubious switch to different commenting technologies over time. Two critical mistakes were the adoption of Google+ comments around 2013 (back when the blog was hosted in Blogger) and the adoption of Disqus around 2016 when the blog moved to a static site.</p></li><li><p>The second is that people don&rsquo;t seem to enjoy discussing their ideas on the posts themselves any more. These days, discussions happen in sites like Hacker News or Reddit&mdash;only if the posts make it there at all.</p></li></ul><p>But I would like to have comments back and, given that I spent the time to build my service as a generic platform for static sites, I took a stab at implementing my own commenting feature.</p><p>As happened with the EndBASIC cloud service, implementing the feature itself was easy, but the follow-up steps to make it &ldquo;production ready&rdquo; were tedious. In particular, adding some form of abuse protection was as hard, if not more, than the comments feature itself. More on this below.</p><p>Go ahead; take this as an invitation to test the posting feature at the bottom of this post 😀. I&rsquo;m sure there are still rough edges (the JavaScript is still shitty) and things won&rsquo;t always work&mldr; so please let me know off band if that happens.</p><h1 id=fingerprinting-no-more>Fingerprinting no more</h1><p>The initial version of the analytics tracker implemented client-side fingerprinting via unique UUIDs stored in a cookie (if allowed). Later on, in an attempt to remove cookies altogether, I switched to using FingerprintJS to obtain stable IDs over time&mdash;which &ldquo;worked&rdquo; but was definitely a worse solution privacy-wise. This had to be rethought.</p><p>With this new release, client-side fingerprinting is now completely gone, as are cookies in all cases. However, the service still needs to identify clients with some reasonable precision over a short period of time for two reasons: to distinguish page views from the number of daily visitors and to implement abuse protection mechanisms in the voting and commenting features.</p><p>The way this works now is that the server will compute a pseudo-unique identifier for a client based on its IP and user agent. The identifier is then combined with the site&rsquo;s ID to make the identifier untraceable across sites, and is also combined with a secret salt to make the identifier unpredictable to anyone that looks at the code or at old data (which right now is only myself by the way). There is no need for the service to keep track of the IP any longer after computing this weaker ID and the country of origin.</p><h1 id=abuse-protection>Abuse protection</h1><p>My main concern with all of this is spam. A commenting feature without authentication is an open invitation to spammers to post garbage.</p><p>In an attempt to mitigate this, I have implemented some rudimentary abuse protection features in the server. These work by looking at the recent behavior of a client and determining whether it is allowed to post or not. The policies are weak right now but the infrastructure is in place, so hopefully it will be easy enough to tweak it over time.</p><p>Note, however, that if the server misidentifies you as a bot&mldr; there is no way around it. In those cases, there should be a feature to prove that you are not a bot (a la reCAPTCHA)&mldr; but I didn&rsquo;t fancy building it right now.</p><p>We&rsquo;ll see how far this simple approach lets me go. Or not.</p><h1 id=whats-next>What&rsquo;s next?</h1><p>An immediate first thing to do would be to try to recover any old comments I still have access to (in Disqus, email archives and, if I can find it, my Google+ export) and import them into the new system.</p><p>After that, it&rsquo;d be great to integrate the service with email, which would open the gate to two extra features: post reply notifications and email subscriptions handling (to ditch Follow.it). I haven&rsquo;t researched how to send email from a cloud service because it sounds &ldquo;hard&rdquo;, so these will have to wait.</p><p>For now, though, I want to focus on writing a few new posts and going back to hacking EndBASIC.</p></article></div></div><div class="container post-links"><div class=row><div class="col mr-auto text-left"><span><a href=https://jmmv.dev/2022/02/diy-web-analytics.html>&#171; Previous</a></span></div><div class="col text-center"><span><a href=/archive.html>All posts</a></span></div><div class="col ml-auto text-right"><span><a href=https://jmmv.dev/2022/02/my-story-with-windows.html>Next &#187;</a></span></div></div></div><div class="container post-votes"><div class=row><div class="col-lg-4 my-2"><div class=row><div class=col><a onclick=voteThumbsUp() class="btn btn-block btn-outline-success" id=thumbs-up-btn>👍
(<span id=thumbs-up-count>0</span>)</a></div><div class=col><a onclick=voteThumbsDown() class="btn btn-block btn-outline-danger" id=thumbs-down-btn>👎
(<span id=thumbs-down-count>0</span>)</a></div></div></div><div class="col-lg-8 my-2 d-none d-sm-block"><div class=row><div class="col-md-4 text-center"><a href="https://www.reddit.com/submit?title=Comments+are+back+and+other+news&amp;url=https%3A%2F%2Fjmmv.dev%2F2022%2F02%2Fcomments-and-ids.html" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/reddit.png alt=Reddit width=24 height=24></a></div><div class="col-md-4 text-center"><a href="https://news.ycombinator.com/submitlink?t=Comments+are+back+and+other+news&amp;u=https%3A%2F%2Fjmmv.dev%2F2022%2F02%2Fcomments-and-ids.html" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/ycombinator.png alt="Hacker News" width=24 height=24></a></div><div class="col-md-4 text-center"><a href="https://twitter.com/intent/tweet?status=Comments+are+back+and+other+news+%E2%80%94+https%3A%2F%2Fjmmv.dev%2F2022%2F02%2Fcomments-and-ids.html+%E2%80%94+cc+%40jmmv" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/Twitter_Social_Icon_Circle_Color.png alt=Twitter width=24 height=24></a></div></div></div></div><div class="row my-4" id=postCommentRow><div class=col><div class=media><img class=mr-3 src=/octicons/pencil.svg width=32px height=32px><div class="media-body container"><form method=post id=newPost><div class=row><div class="col my-1"><textarea class=form-control rows=1 id=postCommentContent onclick=showPostComment() placeholder="Leave a comment"></textarea></div></div><div class="row newPostControls" style=display:none><div class="col my-1 form-group"><label for=postCommentAuthor>Your name (optional):</label>
<input type=text class=form-control id=postCommentAuthor></div></div><div class="row newPostControls" style=display:none><div class="col my-1 form-group"><label for=postCommentEmail>Your email (optional):</label>
<input type=text class=form-control type=email id=postCommentEmail>
<small class="form-text text-muted">Invisible to all readers; if provided, you will receive notifications when replied to (not implemented yet)</small></div></div><div class=row id=postCommentError style=display:none><div class="col mt-1 alert-danger"><p></p></div></div><div class="row newPostControls" style=display:none><button class="col-md-3 my-1 btn btn-primary" type=submit id=submitCommentButton>Post</button>
<small class="col-md-9 my-1 text-muted">Comments are subject to moderation. This feature is experimental and is powered by <a href=/software/endtracker.html>EndTRACKER</a>. If you experience any issues, please <a href=/about.html#contact>contact me off-band</a>.</small></div></form></div></div></div></div><script>function hidePostComment(){var t,e=document.getElementById("postCommentContent");e.rows=1,e.value="",t=document.getElementsByClassName("newPostControls"),Array.prototype.forEach.call(t,function(e){e.style.display="none"})}function showPostComment(){var e,t=document.getElementById("postCommentContent");t.rows=5,e=document.getElementsByClassName("newPostControls"),Array.prototype.forEach.call(e,function(e){e.style.display=""})}const form=document.querySelector("#newPost");form.onsubmit=function(e){e.preventDefault();let t=document.getElementById("postCommentAuthor").value,n=document.getElementById("postCommentEmail").value,s=document.getElementById("postCommentContent").value;postComment(t,n,s,hidePostComment)}</script></div></div><div class="col-md-3 sidebar d-none d-md-block"><div class=row><div class="col text-center p-2"><p><a href=/about.html class=clear-link><img src=/images/avatars/20181124-snow.jpg class="rounded-circle shadow my-2" style=width:100px><br><b>Julio Merino</b><br>A blog on operating systems, programming languages, testing, build systems, my own software
projects and even personal productivity. Specifics include FreeBSD, Linux, Rust, Bazel and
EndBASIC.</a></p><div class=row><div class=col><div class=form-group><form action=https://endtracker.azurewebsites.net/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/subscribers/add method=post><input type=text name=email placeholder="Enter your email" class="form-control input-sm text-center my-1">
<button type=submit class="btn btn-primary btn-block my-1">Subscribe</button></form></div></div></div><div class="row px-2"><div class="col-sm-5 text-left"><small><span class=subscriber-count>0</span> subscribers</small></div><div class="col-sm-7 text-right"><p><a rel=me href=https://mastodon.online/@jmmv><img src=/images/badges/mastodon-logo.svg width=32px height=32px alt="Follow @jmmv on Mastodon"></a>
<a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&amp;screen_name=jmmv"><img src=/images/badges/Twitter_logo_blue.svg width=32px height=32px alt="Follow @jmmv on Twitter"></a>
<a href=/feed.xml><img src=/images/badges/feed-icon-28x28.png alt="RSS feed"></a></p></div></div></div></div><div class=row><div class=col><h2>Featured software</h2><ul><li class=overflow-ellipsis><a href=https://www.endbasic.dev/ target=_blank>EndBASIC: Online BASIC+DOS env</a></li><li class=overflow-ellipsis><a href=https://endtracker.azurewebsites.net/ target=_blank>EndTRACKER: Services for static sites</a></li></ul></div></div><div class=row><div class=col><h2>Featured posts</h2><ul><li class=overflow-ellipsis><a href=/2023/06/fast-machines-slow-machines.html>Fast machines, slow machines</a></li><li class=overflow-ellipsis><a href=/2022/12/endbasic-0.10.html>EndBASIC 0.10: Core language, evolved</a></li><li class=overflow-ellipsis><a href=/2022/10/bye-microsoft-hi-snowflake.html>Farewell, Microsoft; hello, Snowflake!</a></li><li class=overflow-ellipsis><a href=/2022/05/rust-is-hard-but-does-it-matter.html>Rust is hard, yes, but does it matter?</a></li><li class=overflow-ellipsis><a href=/2022/04/rust-traits-and-dependency-injection.html>Rust traits and dependency injection</a></li><li class=overflow-ellipsis><a href=/2022/03/a-year-on-windows-intro.html>A year on Windows: Introduction</a></li><li class=overflow-ellipsis><a href=/2021/04/always-be-quitting.html>Always be quitting</a></li><li class=overflow-ellipsis><a href=/2021/02/google-monorepos-and-caching.html>How does Google keep build times low?</a></li><li class=overflow-ellipsis><a href=/2020/12/google-no-clean-builds.html>How does Google avoid clean builds?</a></li><li class=overflow-ellipsis><a href=/2020/12/unit-testing-a-console-app.html>Unit-testing a console app (a text editor)</a></li><li class=overflow-ellipsis><a href=/essays.html#featured>More...</a></li></ul></div></div></div></div></div><footer class=container-fluid><div class=row><div class="col-4 order-2 text-right"><p class=float-right><a href=#>Back to top</a></p></div><div class="col-8 order-1 mr-auto"><p>Copyright 2004&ndash;2023 Julio Merino</p></div></div></footer><script type=module>
  import { addAnchorsToHeaders, addElementClasses, BatchClient } from "\/js\/main.d30f168b11d80082408f4a983af9a626c6e57d58f7846b2174bac40d43be33e3.js";

  var batchClient = new BatchClient(SITE_ID);
  batchClient.doAll({
    put_request: true, get_comments: true, get_subscriber_count: true, get_votes: true });

  window.voteThumbsUp = function() { batchClient.voteThumbsUp(); }
  window.voteThumbsDown = function() { batchClient.voteThumbsDown(); }

  window.postComment = function(...args) {
    batchClient.postComment(...args);
  };

  addAnchorsToHeaders();
  addElementClasses();
</script><noscript><img src="https://hugo-dynamic.jmmv.dev/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/pages/aHR0cHM6Ly9qbW12LmRldi8yMDIyLzAyL2NvbW1lbnRzLWFuZC1pZHMuaHRtbA==/stamp.gif" style=display:none></noscript></body></html>