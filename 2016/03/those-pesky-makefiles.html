<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml xmlns:fb=http://ogp.me/ns/fb#><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta property="og:site_name" content="Julio Merino (jmmv.dev)"><meta property="twitter:site" content="@jmmv"><title>Those pesky Makefiles - Julio Merino (jmmv.dev)</title><meta property="og:title" content="Those pesky Makefiles - Julio Merino (jmmv.dev)"><meta property="twitter:title" content="Those pesky Makefiles - Julio Merino (jmmv.dev)"><meta name=description content="As a software developer, you have probably disregarded the build system of your project&amp;mdash;those pesky Makefiles&amp;mdash;as unimportant. You have probably &amp;ldquo;chosen&amp;rdquo; to use the de-facto build tool make(1). And you have probably hacked your way around until things &amp;ldquo;seemingly worked&amp;rdquo;.
But hang on a second. Those build files are way more important than you may think and deserve a wee bit more attention.
"><meta property="og:description" content="As a software developer, you have probably disregarded the build system of your project&amp;mdash;those pesky Makefiles&amp;mdash;as unimportant. You have probably &amp;ldquo;chosen&amp;rdquo; to use the de-facto build tool make(1). And you have probably hacked your way around until things &amp;ldquo;seemingly worked&amp;rdquo;.
But hang on a second. Those build files are way more important than you may think and deserve a wee bit more attention.
"><meta property="twitter:description" content="As a software developer, you have probably disregarded the build system of your project&amp;mdash;those pesky Makefiles&amp;mdash;as unimportant. You have probably &amp;ldquo;chosen&amp;rdquo; to use the de-facto …"><meta name=author content="Julio Merino"><meta property="twitter:creator" content="@jmmv"><meta name=generator content="Hugo 0.111.3"><meta property="og:url" content="https://jmmv.dev/2016/03/those-pesky-makefiles.html"><meta property="og:type" content="blog"><meta property="twitter:card" content="summary"><link rel=canonical href=https://jmmv.dev/2016/03/those-pesky-makefiles.html><link rel=alternate type=application/rss+xml title="Julio Merino (jmmv.dev)" href=/feed.xml><link rel=stylesheet href=/sass/main.min.161663676cac4bf21abc8967ec3267c26026aa58e9f392c5f3427e0ef089fe6b.css><link rel=stylesheet href=/css/chroma.css><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicons/favicon-96x96.png sizes=96x96><meta property="og:image" content="/images/favicons/favicon-1200x1200.png"><meta property="twitter:image" content="https://jmmv.dev/images/favicons/favicon-1200x1200.png"><script>const SITE_ID="e8da9f62-b7ac-4fe9-bf20-7c527199a376",BASE_URL="https://jmmv.dev/"</script></head><body><header class=site-header><nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary"><a class=navbar-brand href=/><img src=/images/favicons/favicon-30x30.png width=30 height=30 class="d-inline-block align-top" alt>
&nbsp;Julio Merino</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/about.html>About</a></li><li class=nav-item><a class=nav-link href=/essays.html>Essays</a></li><li class=nav-item><a class=nav-link href=/resume.html>Resume</a></li><li class=nav-item><a class=nav-link href=/software.html>Software</a></li></ul><ul class="navbar-nav mr-4"><li class=nav-item><a class=nav-link href=/archive.html>Archive</a></li><li class=nav-item><a class=nav-link href=/series.html>Series</a></li><li class=nav-item><a class=nav-link href=/tags.html>Tags</a></li></ul><form class=form-inline method=get role=search action=https://www.google.com/search><div class=input-group><input type=search name=query class=form-control placeholder=Search aria-label=Search><div class=input-group-append><button type=submit value=Search class="btn btn-light">
<img src=/octicons/search.svg></button></div></div><input type=hidden name=sitesearch value=https://jmmv.dev/></form></div></nav></header><div class=page-header><div class=container><h1>Those pesky Makefiles</h1><p>March 2, 2016 &#183;
About 7 minutes
&#183;
Tags:
<a href=/tags/software>software</a></p><p class=post-meta-p>This article was
<a href=https://medium.com/@jmmv/those-pesky-makefiles-4784d4dc4888>originally published
on Medium</a>
and is replicated here <a href=/2016/01/medium-experiment-wrapup.html>for
archival purposes</a>.</p></div></div><div class="container post-body"><div class=row><div class=col-md-9><div class=row><div class=col><article><p>As a software developer, you have probably disregarded the build system of your project&mdash;those pesky <code>Makefile</code>s&mdash;as unimportant. You have probably &ldquo;chosen&rdquo; to use the de-facto build tool <code>make(1)</code>. And you have probably hacked your way around until things &ldquo;seemingly worked&rdquo;.</p><p>But hang on a second. Those build files are way more important than you may think and deserve a wee bit more attention.</p><h1 id=what-if-you-lost-them>What if&mldr; you lost them?</h1><p>Let&rsquo;s start with an exercise, one that I heard many years ago when <a href=http://news.microsoft.com/2004/02/12/statement-from-microsoft-regarding-illegal-posting-of-windows-2000-source-code/>parts of the Windows 2000 source code were leaked</a>. <strong>What if you received massive amounts of source code without the build files?</strong> Could you be able use that code again? &ldquo;Of course&rdquo; you <em>could</em>, but it would take an extraordinary effort to make the pieces work again as originally intended. It would be even harder to recover the intended state if the original build system allowed any kind of customization&mdash;think building for different production or test environments&mdash;or had, say, cross-building functionality. And you could even be introducing new run-time bugs by getting the build wrong!</p><p>The reason this came to mind is because I spent all of last month fighting build rules to make <a href=http://bazel.io/>Bazel</a> build itself on a newly-supported environment. A month of fiddling with build rules and small portability fixes; a month without writing any substantial code.</p><p>Well, in reality I &ldquo;only&rdquo; spent a whole week ploughing hacks to make this happen&mldr; but then I spent the other three weeks cleaning up the hacks so that I could check them in. It was one thing to prove that the end goal was attainable, and it was a very different one to actually reach that goal in a reasonable manner. Extending build rules that work under multiple scenarios and that target different platforms is hard, especially while keeping existing functionality stable.</p><p>Another reason this came to mind is that, recently, I have been toying with writing a Go Appengine app. Running the trivial &ldquo;Hello World&rdquo; sample is easy: type some code in <code>.go</code> files, run <code>goapp serve</code>, and boom: the app (re)compiles in the background and is served on the web. Good? No.</p><p>Unfortunately, as soon as you start writing &ldquo;the real stuff&rdquo;, you end up requiring features not provided by the simplistic and basic toolchain. You may need to fetch dependencies depending on the developer&rsquo;s needs; you may need to build auxiliary tools to set up the production environment; you may need to run those tools with specific flags for your project and for the developer machine; you may need to interact with the VCS system to install hooks and get those working; etc. All these require some form of plumbing, which I chose to do via <code>make(1)</code> and a hand-tuned <code>configure</code> script&mdash;purely out of routine, not because these are great tools&mdash;and they have grown more than originally expected.</p><h1 id=writing-build-files-is-hard>Writing build files is&mldr; hard</h1><p>Build systems are complex beasts and the average developer should not have to&mdash;or, in fact, does not want to&mdash;care about them. Regardless, most developers <em>have to</em> end up writing build rules for the software they write (who else would?) and they do so without understanding the fundamentals of the tools nor the implications of their code.</p><p>Take, for example, <code>configure.ac</code> scripts. GNU Autoconf has <a href=http://www.gnu.org/software/autoconf/manual/index.html>excellent documentation</a>&mdash;and reading through it is a humbling exercise, <em>especially</em> if you are ever so tempted to write your own &ldquo;simplified&rdquo; configuration tool. (Spoiler: <em>don&rsquo;t</em>.)</p><p>Anyway: the vast majority of (open source) projects end up requiring a <code>configure.ac</code> script&mldr; but the developers, understandably, won&rsquo;t go through the hassle of learning all the details of Autoconf because writing a configuration script is not their goal: it&rsquo;s just boilerplate. The end result is that the developers copy/paste other people&rsquo;s scripts and/or snippets from shabby sources. Repeat this copy/paste process over a handful of projects and you end up with a Frankenstein-like configuration script that can barely stand on its own. Yet, it <em>seems</em> to work on the developer&rsquo;s machine, and therefore gets shipped to the world&mldr; only to cause pain down the road.</p><p>The same applies to any script used to maintain the project. Think of the auxiliary scripts that invoke continuous tests under Travis, the scripts to sanitize your source tree, the scripts to package your software, or even your installation script. Because these are not part of the project&rsquo;s &ldquo;core functionality&rdquo;, they are often thought as unimportant and are just hacked away. Just keep in mind that those scripts <em>will</em> fail due to their poor quality, and it&rsquo;s no fun at all when they do so at, say, release time.</p><h1 id=stick-to-conventions>Stick to conventions</h1><p>So how do you minimize the danger of hurting yourself? <em>Do not reinvent the wheel.</em> <strong>Stick to existing tools and conventions.</strong></p><p>If you think your project is special enough to warrant a hand-tuned build system, think again. Writing your own build system is a recipe for disaster: first, because you are throwing away <em>the collective</em> wisdom of the people that wrote the existing tools; and, second, because you immediately make your package unbuildable out-of-the-box by any existing packaging system.</p><p>Let&rsquo;s see some examples on the lots of conventions that exist: support for environment variables (<code>CC</code>, <code>CFLAGS</code>, <code>CPPFLAGS</code>, et. al.) and how they are later passed to the compiler, the linker, and the preprocessor; specific build targets that should exist (<code>all</code>, <code>install</code>, <code>check</code>, and the myriad required by the widespread <a href=https://www.gnu.org/prep/standards/standards.html#Makefile-Conventions>GNU Coding Standards</a>); the tools that you should end up invoking (e.g. <code>install</code> instead of plain <code>cp</code> to put your files in the destination location); the hierarchy of the installed files and the ability to tune the layout depending on the platform; support for build directories separate from the source tree; support for cross-compilation; support for dynamic detection of compiler and system features; and a long etc.</p><p>Note that the examples above only scratch the surface: I focused exclusively on what your standard software package for a Unix system would need, and nothing else. Take an interpreted language instead of C or C++ and, suddenly, the conventions are all different.</p><p>The problem here is that users of your package <em>expect</em> all these things to &ldquo;just work&rdquo; based on established conventions. If you change those conventions intentionally or just out of knowledge, your package will not behave as the user expects. And if that&rsquo;s the case, can you guess what the user will think? <em>Your software is broken.</em></p><h1 id=which-conventions>Which conventions?</h1><p>OK, so we need to follow conventions. Which ones? As always, it depends. It depends on the project you are writing, it depends on your target environment, and it depends on who your users will be.</p><p>There are dozens of build systems and each has gained a specific niche so you need to stick to your niche&rsquo;s preferred set of tools. To name a few: if you are writing a low-level system package, or your package uses C/C++, use the GNU Autotools; if you are writing a Python package, stick to <code>distutils</code> or <code>setuptools</code> and PyPI; if you are writing a KDE component, use CMake; if you are writing an Android app, choose Android Studio and Gradle; if you want to go fancier and the Java requirement is not a concern, consider Bazel (really, it&rsquo;s cool!).</p><p>You may or may not like the conventions of the tools used in the area you are working on, but you are better off by following the conventions than going against them: you&rsquo;ll waste fewer time and your users will be happier. E.g. personally, I do not like how the standard way of using the Autotools is by shipping massive generated scripts, or the &ldquo;strange&rdquo; behavior of Python&rsquo;s <code>setup.py</code> scripts&mldr; but I just use these in my software because they are what people&mdash;and, more importantly, packagers&mdash;expect.</p><p>This doesn&rsquo;t mean the tools we have today are good; in fact, many aren&rsquo;t. But if you spend a few minutes to learn about the shortcomings of your tools and how to make better use of them, the results will be palatable. Give the same care you give code to the build files of <em>your</em> project.</p><p>To conclude, follow onto the excellent-but-extremely-long article titled <a href=https://medium.com/@sdboyer/so-you-want-to-write-a-package-manager-4ae9c17d9527>So you want to write a package manager</a>. It does not talk about build systems per se, but it sheds light on the many complexities of managing a source tree and its dependencies, and how those should be hidden away from the developers.</p></article></div></div><div class="container post-links"><div class=row><div class="col mr-auto text-left"><span><a href=https://jmmv.dev/2016/02/sshfs-performance-analysis-for-builds.html>&#171; Previous</a></span></div><div class="col text-center"><span><a href=/archive.html>All posts</a></span></div><div class="col ml-auto text-right"><span><a href=https://jmmv.dev/2016/03/golang-review.html>Next &#187;</a></span></div></div></div><div class="container post-votes"><div class=row><div class="col-lg-4 my-2"><div class=row><div class=col><a onclick=voteThumbsUp() class="btn btn-block btn-outline-success" id=thumbs-up-btn>👍
(<span id=thumbs-up-count>0</span>)</a></div><div class=col><a onclick=voteThumbsDown() class="btn btn-block btn-outline-danger" id=thumbs-down-btn>👎
(<span id=thumbs-down-count>0</span>)</a></div></div></div><div class="col-lg-8 my-2 d-none d-sm-block"><div class=row><div class="col-md-4 text-center"><a href="https://www.reddit.com/submit?title=Those+pesky+Makefiles&amp;url=https%3A%2F%2Fjmmv.dev%2F2016%2F03%2Fthose-pesky-makefiles.html" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/reddit.png alt=Reddit width=24 height=24></a></div><div class="col-md-4 text-center"><a href="https://news.ycombinator.com/submitlink?t=Those+pesky+Makefiles&amp;u=https%3A%2F%2Fjmmv.dev%2F2016%2F03%2Fthose-pesky-makefiles.html" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/ycombinator.png alt="Hacker News" width=24 height=24></a></div><div class="col-md-4 text-center"><a href="https://twitter.com/intent/tweet?status=Those+pesky+Makefiles+%E2%80%94+https%3A%2F%2Fjmmv.dev%2F2016%2F03%2Fthose-pesky-makefiles.html+%E2%80%94+cc+%40jmmv" class="btn btn-block btn-outline-primary">Share on
<img src=/images/badges/Twitter_Social_Icon_Circle_Color.png alt=Twitter width=24 height=24></a></div></div></div></div><div class="row my-4" id=postCommentRow><div class=col><div class=media><img class=mr-3 src=/octicons/pencil.svg width=32px height=32px><div class="media-body container"><form method=post id=newPost><div class=row><div class="col my-1"><textarea class=form-control rows=1 id=postCommentContent onclick=showPostComment() placeholder="Leave a comment"></textarea></div></div><div class="row newPostControls" style=display:none><div class="col my-1 form-group"><label for=postCommentAuthor>Your name (optional):</label>
<input type=text class=form-control id=postCommentAuthor></div></div><div class="row newPostControls" style=display:none><div class="col my-1 form-group"><label for=postCommentEmail>Your email (optional):</label>
<input type=text class=form-control type=email id=postCommentEmail>
<small class="form-text text-muted">Invisible to all readers; if provided, you will receive notifications when replied to (not implemented yet)</small></div></div><div class=row id=postCommentError style=display:none><div class="col mt-1 alert-danger"><p></p></div></div><div class="row newPostControls" style=display:none><button class="col-md-3 my-1 btn btn-primary" type=submit id=submitCommentButton>Post</button>
<small class="col-md-9 my-1 text-muted">Comments are subject to moderation. This feature is experimental and is powered by <a href=/software/endtracker.html>EndTRACKER</a>. If you experience any issues, please <a href=/about.html#contact>contact me off-band</a>.</small></div></form></div></div></div></div><script>function hidePostComment(){var t,e=document.getElementById("postCommentContent");e.rows=1,e.value="",t=document.getElementsByClassName("newPostControls"),Array.prototype.forEach.call(t,function(e){e.style.display="none"})}function showPostComment(){var e,t=document.getElementById("postCommentContent");t.rows=5,e=document.getElementsByClassName("newPostControls"),Array.prototype.forEach.call(e,function(e){e.style.display=""})}const form=document.querySelector("#newPost");form.onsubmit=function(e){e.preventDefault();let t=document.getElementById("postCommentAuthor").value,n=document.getElementById("postCommentEmail").value,s=document.getElementById("postCommentContent").value;postComment(t,n,s,hidePostComment)}</script></div></div><div class="col-md-3 sidebar d-none d-md-block"><div class=row><div class="col text-center p-2"><p><a href=/about.html class=clear-link><img src=/images/avatars/20181124-snow.jpg class="rounded-circle shadow my-2" style=width:100px><br><b>Julio Merino</b><br>A blog on operating systems, programming languages, testing, build systems, my own software
projects and even personal productivity. Specifics include FreeBSD, Linux, Rust, Bazel and
EndBASIC.</a></p><div class=row><div class=col><div class=form-group><form action=https://endtracker.azurewebsites.net/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/subscribers/add method=post><input type=text name=email placeholder="Enter your email" class="form-control input-sm text-center my-1">
<button type=submit class="btn btn-primary btn-block my-1">Subscribe</button></form></div></div></div><div class="row px-2"><div class="col-sm-5 text-left"><small><span class=subscriber-count>0</span> subscribers</small></div><div class="col-sm-7 text-right"><p><a rel=me href=https://mastodon.online/@jmmv><img src=/images/badges/mastodon-logo.svg width=32px height=32px alt="Follow @jmmv on Mastodon"></a>
<a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&amp;screen_name=jmmv"><img src=/images/badges/Twitter_logo_blue.svg width=32px height=32px alt="Follow @jmmv on Twitter"></a>
<a href=/feed.xml><img src=/images/badges/feed-icon-28x28.png alt="RSS feed"></a></p></div></div></div></div><div class=row><div class=col><h2>Featured software</h2><ul><li class=overflow-ellipsis><a href=https://www.endbasic.dev/ target=_blank>EndBASIC: Online BASIC+DOS env</a></li><li class=overflow-ellipsis><a href=https://endtracker.azurewebsites.net/ target=_blank>EndTRACKER: Services for static sites</a></li></ul></div></div><div class=row><div class=col><h2>Featured posts</h2><ul><li class=overflow-ellipsis><a href=/2023/06/fast-machines-slow-machines.html>Fast machines, slow machines</a></li><li class=overflow-ellipsis><a href=/2022/12/endbasic-0.10.html>EndBASIC 0.10: Core language, evolved</a></li><li class=overflow-ellipsis><a href=/2022/10/bye-microsoft-hi-snowflake.html>Farewell, Microsoft; hello, Snowflake!</a></li><li class=overflow-ellipsis><a href=/2022/05/rust-is-hard-but-does-it-matter.html>Rust is hard, yes, but does it matter?</a></li><li class=overflow-ellipsis><a href=/2022/04/rust-traits-and-dependency-injection.html>Rust traits and dependency injection</a></li><li class=overflow-ellipsis><a href=/2022/03/a-year-on-windows-intro.html>A year on Windows: Introduction</a></li><li class=overflow-ellipsis><a href=/2021/04/always-be-quitting.html>Always be quitting</a></li><li class=overflow-ellipsis><a href=/2021/02/google-monorepos-and-caching.html>How does Google keep build times low?</a></li><li class=overflow-ellipsis><a href=/2020/12/google-no-clean-builds.html>How does Google avoid clean builds?</a></li><li class=overflow-ellipsis><a href=/2020/12/unit-testing-a-console-app.html>Unit-testing a console app (a text editor)</a></li><li class=overflow-ellipsis><a href=/essays.html#featured>More...</a></li></ul></div></div></div></div></div><footer class=container><div class=row><div class="col-4 order-2 texr-right"><p class=float-right><a href=#>Back to top</a></p></div><div class="col-8 order-1 mr-auto"><p>Copyright 2004&ndash;2023 Julio Merino</p></div></div></footer><script type=module>
  import { addAnchorsToHeaders, addElementClasses, BatchClient } from "\/js\/main.d30f168b11d80082408f4a983af9a626c6e57d58f7846b2174bac40d43be33e3.js";

  var batchClient = new BatchClient(SITE_ID);
  batchClient.doAll({
    put_request: true, get_comments: true, get_subscriber_count: true, get_votes: true });

  window.voteThumbsUp = function() { batchClient.voteThumbsUp(); }
  window.voteThumbsDown = function() { batchClient.voteThumbsDown(); }

  window.postComment = function(...args) {
    batchClient.postComment(...args);
  };

  addAnchorsToHeaders();
  addElementClasses();
</script><noscript><img src=https://hugo-dynamic.jmmv.dev/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/pages/aHR0cHM6Ly9qbW12LmRldi8yMDE2LzAzL3Rob3NlLXBlc2t5LW1ha2VmaWxlcy5odG1s/stamp.gif style=display:none></noscript></body></html>