<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml xmlns:fb=http://ogp.me/ns/fb#><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta property="og:site_name" content="Julio Merino (jmmv.dev)"><meta property="twitter:site" content="@jmmv"><title>Unix - Julio Merino (jmmv.dev)</title>
<meta property="og:title" content="Unix - Julio Merino (jmmv.dev)"><meta property="twitter:title" content="Unix - Julio Merino (jmmv.dev)"><meta name=description content><meta property="og:description" content><meta property="twitter:description" content><meta name=author content="Julio Merino"><meta property="twitter:creator" content="@jmmv"><meta name=generator content="Hugo 0.145.0"><meta property="og:url" content="https://jmmv.dev/tags/unix/index.html"><meta property="og:type" content="blog"><meta property="twitter:card" content="summary"><link rel=canonical href=https://jmmv.dev/tags/unix/index.html><link rel=alternate type=application/rss+xml title="Julio Merino (jmmv.dev)" href=/feed.xml><link rel=stylesheet href=/sass/main.min.cb91349cd93211a37e7d5dc131c35a170fc795721c03373cd05571327eea206b.css><link rel=stylesheet href=/css/chroma.css><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicons/favicon-96x96.png sizes=96x96><meta property="og:image" content="/images/favicons/favicon-1200x1200.png"><meta property="twitter:image" content="https://jmmv.dev/images/favicons/favicon-1200x1200.png"><script>const SITE_ID="e8da9f62-b7ac-4fe9-bf20-7c527199a376",BASE_URL="https://jmmv.dev/"</script></head><body><header class=site-header><nav class="navbar navbar-expand-md fixed-top navbar-dark bg-primary"><a class=navbar-brand href=/><img src=/images/favicons/favicon-30x30.png width=30 height=30 class="d-inline-block align-top" alt>
&nbsp;jmmv.dev
</a><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/about.html>About</a></li><li class=nav-item><a class=nav-link href=/blog.html>Blog</a></li><li class=nav-item><a class=nav-link href=/resume.html>Resume</a></li><li class=nav-item><a class=nav-link href=/software.html>Software</a></li></ul><ul class="navbar-nav mr-4"><li class=nav-item><a class=nav-link href=/archive.html>Archive</a></li><li class=nav-item><a class=nav-link href=/series.html>Series</a></li><li class=nav-item><a class=nav-link href=/tags.html>Tags</a></li></ul><form class=form-inline method=get role=search action=https://www.google.com/search><div class=input-group><input type=search name=query class=form-control placeholder=Search aria-label=Search><div class=input-group-append><button type=submit value=Search class="btn btn-light">
<img src=/octicons/search.svg></button></div></div><input type=hidden name=sitesearch value=https://jmmv.dev/></form></div></nav></header><div class=page-header><div class=container><h1>Posts: Unix</h1><p>Showing 24 posts</p></div></div><div class=container><div class=row><div class=col-md-9><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2025/02/hardware-autoconfiguration.html>Hardware discovery: ACPI & Device Tree</a></h2><p><p>If you grew up in the PC scene during the 1980s or early 1990s, you know how painful it was to get hardware to work. And if you did not witness that (lucky you) here is how it went: every piece of hardware in your PC&mdash;say a sound card or a network card&mdash;had physical switches or jumpers in it. These switches configured the card&rsquo;s I/O address space, interrupts, and DMA ports, and you had to be careful to select values that did not overlap with other cards.</p><p>But that wasn&rsquo;t all. Once you had configured the physical switches, you had to tell the operating system and/or software <em>which</em> specific cards you had and how you had configured them. Remember <code>SET BLASTER=A220 I5 D1 H5</code>? This DOS environment variable told programs which specific Sound Blaster you had installed and which I/O settings you had selected via its jumpers.</p><p>Not really fun. It was common to have hardware conflicts that yielded random lock-ups, and thus <a href=https://wiki.osdev.org/ISA>ISA &ldquo;Plug and Play&rdquo;</a>, or PnP for short, was born in the early 1990s&mdash;a protocol for the legacy ISA bus to enumerate its devices and to configure their settings via software. Fast-forward to today&rsquo;s scene where we just attach devices to external USB connectors and things &ldquo;magically work&rdquo;.</p><p>But how? How does the kernel know which physical devices exist and how does it know which of the many device drivers it contains can handle each device? Enter the world of hardware discovery.</p></p><p class=text-muted>February 28, 2025
&#183;
Tags:
<a href=/tags/blogsystem5>blogsystem5</a>, <a href=/tags/hardware>hardware</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2025/02/hardware-autoconfiguration.html>Continue reading (about
16 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2025/02/ioctls-rust.html>ioctls from Rust</a></h2><p><p>In Unix-like systems, &ldquo;everything is a file and a file is defined as a byte stream you can <code>open</code>, <code>read</code> from, <code>write</code> to, and ultimately <code>close</code>&rdquo;&mldr; right? <em>Right?</em> Well, not quite. It&rsquo;s better to say <em>file descriptors</em> provide access to almost every system that the kernel provides, but not that they can all be manipulated with the same quartet of system calls, nor that they all behave as byte streams.</p><p>Because you see: network connections are manipulated via file descriptors indeed, but you don&rsquo;t <code>open</code> them: you <code>bind</code>, <code>listen</code>/<code>accept</code> and/or <code>connect</code> to them. And then you don&rsquo;t <code>read</code> from and <code>write</code> to network connections: you somehow <code>send</code> to and <code>recv</code> from them. Device drivers are similar: yes, hardware devices are represented as &ldquo;virtual files&rdquo; in the <code>/dev</code> hierarchy and many support <code>read</code> and <code>write</code>&mldr; but these two system calls are not sufficient to access the breath of functionality that the hardware drivers provide. No, you need <code>ioctl</code>.</p><p><code>ioctl</code> is the poster child of the system call that breaks Unix&rsquo;s &ldquo;everything is a file&rdquo; paradigm. <code>ioctl</code> is the API that allows out-of-band communication with the kernel side of an open file descriptor. To see cool examples, <a href=/2025/01/netbsd-graphics-wo-x11.html>refer back to my previous article</a> where I demonstrated how to drive graphics from the console without X11: in that post, we had to <code>open</code> the console device, but then we had to use <code>ioctl</code> to obtain the properties of the framebuffer, and then we had to <code>mmap</code> the device&rsquo;s content for direct access: no <code>read</code>s nor <code>write</code>s involved.</p><p>All the code I showed you in that earlier post was written in C to keep the graphics article to-the-point, but the code I&rsquo;m really working on is part of EndBASIC, and thus it is all Rust. And the thing is, <code>ioctl</code>s are not easy to issue from Rust. In fact, after 7 years of Rust-ing, it&rsquo;s the first time I&rsquo;ve had to reach for <code>unsafe</code> code blocks, and there was no good documentation on how to deal with <code>ioctl</code>. So this posts aims to fix that by presenting what ways there are to call <code>ioctl</code>s from Rust&mldr; and, of course, diving a bit deeper into what <code>ioctl</code>s actually <em>are</em>.</p></p><p class=text-muted>February 13, 2025
&#183;
Tags:
<a href=/tags/blogsystem5>blogsystem5</a>, <a href=/tags/rust>rust</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2025/02/ioctls-rust.html>Continue reading (about
14 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2025/01/make-help.html>Self-documenting Makefiles</a></h2><p><p>Make, as arcane as a build tool can be, may still be a good first fit for certain scenarios. &ldquo;Heresy!&rdquo;, you say, as you hear a so-called &ldquo;Bazel expert&rdquo; utter these words.</p><p>The specific problem I&rsquo;m facing is that I need to glue together <a href=/2024/12/netbsd-build-system.html>the NetBSD build system</a>, <a href=/2013/11/patch-management-with-quilt.html>a quilt patch set</a>, EndBASIC&rsquo;s Cargo-based Rust build, and a couple of QEMU invocations to produce a Frankenstein disk image for a Raspberry Pi. And the thing is: Make allows doing this sort of stitching with relative ease. Sure, Make is not the best option because the overall build performance is &ldquo;meh&rdquo; and because incremental builds are almost-impossible to get right&mldr; but adopting Bazel for this project would be an almost-infinite time sink.</p><p>Anyway. When using Make in this manner, you often end up with what&rsquo;s essentially a &ldquo;command dispatcher&rdquo; and, over time, the number of commands grows and it&rsquo;s hard to make sense of which one to use for what. Sure, you can write a <code>README.md</code> with instructions, but I guarantee you that the text will get out of sync faster than you can read this article. There is a better way, though.</p></p><p class=text-muted>January 10, 2025
&#183;
Tags:
<a href=/tags/blogsystem5>blogsystem5</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2025/01/make-help.html>Continue reading (about
7 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2024/11/demystifying-secure-nfs.html>Demystifying secure NFS</a></h2><p><p>I recently got a <a href=https://sy.to/hekgh>Synology DS923+</a> for evaluation purposes which led me to setting up NFSv4 with Kerberos. I had done this about a year ago with FreeBSD as the host, and going through this process once again reminded me of how painful it is to secure an NFS connection.</p><p>You see, Samba is much easier to set up, but because NFS is the native file sharing protocol of Unix systems, I felt compelled to use it instead. However, if you opt for NFSv3 (the &ldquo;easy default&rdquo;), you are left with a system that has zero security: traffic travels unencrypted and unsigned, and the server trusts the client when the client asserts who is who. Madness for today&rsquo;s standards. Yet, when you look around, people say &ldquo;oh, but NFSv3 is fine if you trust the network!&rdquo; But seriously, who trusts the network in this day and age?</p><p>You have to turn to NFSv4 <em>and</em> combine it with Kerberos for a secure file sharing option. And let me tell you: the experience of setting these up and getting things to work is horrible, and the documentation out there is terrible. Most documents are operating-system specific so they only tell you what works when a specific server and a specific client talk to each other. Other documents just <em>assume</em>, and thus omit, various important details of the configuration.</p><p>So. This article is my recollection of &ldquo;lab notes&rdquo; on how to set this whole thing up along with the necessary background to understand NFSv4 and Kerberos. My specific setup involes the Synology DS923+ as the NFSv4 server; Fedora, Debian, and FreeBSD clients; and the supporting KDC on a pfSense (or FreeBSD) box.</p></p><p class=text-muted>November 3, 2024
&#183;
Tags:
<a href=/tags/blogsystem5>blogsystem5</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2024/11/demystifying-secure-nfs.html>Continue reading (about
24 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2024/10/x86-64-programming-models.html>The costs of the i386 to x86-64 upgrade</a></h2><p><p>If you read my previous article on <a href=/2024/09/dos-memory-models.html>DOS memory models</a>, you may have dismissed everything I wrote as &ldquo;legacy cruft from the 1990s that nobody cares about any longer&rdquo;. After all, computers have evolved from sporting 8-bit processors to 64-bit processors and, on the way, the amount of memory that these computers can leverage has grown orders of magnitude: the 8086, a 16-bit machine with a 20-bit address space, could only use 1MB of memory while today&rsquo;s 64-bit machines can theoretically access 16EB.</p><p>All of this growth has been in service of ever-growing programs. But&mldr; even if programs are now more sophisticated than they were before, do they all <em>really</em> require access to a 64-bit address space? Has the growth from 8 to 64 bits been a net positive in performance terms?</p><p>Let&rsquo;s try to answer those questions to find some very surprising answers. But first, some theory.</p></p><p class=text-muted>October 7, 2024
&#183;
Tags:
<a href=/tags/blogsystem5>blogsystem5</a>, <a href=/tags/hardware>hardware</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2024/10/x86-64-programming-models.html>Continue reading (about
18 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2024/09/windows-nt-vs-unix-design.html>Windows NT vs. Unix: A design comparison</a></h2><p><p>Over the years, I&rsquo;ve repeatedly heard that Windows NT is a very advanced operating system and, being a Unix person myself, it has bothered me to not know <em>why</em>. I&rsquo;ve been meaning to answer this question for years and I can do so now, which means I want to present you my findings.</p><p>My desire to know about NT&rsquo;s internals started in 2006 when I applied to the Google Summer of Code program to develop Boost.Process. I needed such a library for ATF, but I also saw the project as a chance to learn something about the Win32 API. This journey then continued in 2020 with me <a href=/2020/10/bye-google-hi-microsoft.html>choosing to join Microsoft</a> after a long stint at Google and me buying the <a href="https://www.amazon.com/Windows-Internals-Part-architecture-management/dp/0735684189?crid=2F7UR8S48RP6O&amp;dib=eyJ2IjoiMSJ9.p9cBb_-Q8GjuK0z0kDLKG6xoExPM_2QWt_jn0PlqVBSWYNyqRp2Cd7MHXFeQ4EiRACaX_Y_9xzECC0YpECzSl5kCBD3u1KUPduAgmnO732G9aqw1aLdQszw8LIXBOE1cYvOf3KYQmQ5vdFV6i4eFOttVvIa2XerkHVGiPd1OzTk32tEOchCbnUqpzW3QqCG7AjEmmKHFGuo5T2_UQDUERaSVRa26oAZHYuePCzDrwbY.bcHnZQWFYjmL64ZRnMieVsUH5JVx-T-WY88kj8V-uno&amp;dib_tag=se&amp;keywords=windows+internals&amp;qid=1725808358&amp;sprefix=windows+internals%2Caps%2C155&amp;sr=8-1&amp;linkCode=ll1&amp;tag=blogsystem5-20&amp;linkId=08d00ee830fe99b6e648add99e1b64c5&amp;language=en_US&amp;ref_=as_li_ss_tl">Windows Internals</a> 5th edition book in 2021 (which I never fully read due to its incredible detail and length). None of these made me learn what I wanted though: the ways in which NT fundamentally differs from Unix, if at all.</p></p><p class=text-muted>September 9, 2024
&#183;
Tags:
<a href=/tags/blogsystem5>blogsystem5</a>, <a href=/tags/unix>unix</a>, <a href=/tags/windows>windows</a><br><a class=text-reset href=/2024/09/windows-nt-vs-unix-design.html>Continue reading (about
23 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2024/08/glibc-versions-runtime.html>Picking glibc versions at runtime</a></h2><p><p>In a recent work discussion, I came across an argument that didn&rsquo;t sound quite right. The claim was that we needed to set up containers in our developer machines in order to run tests against a modern glibc. The justifications were that using <code>LD_LIBRARY_PATH</code> to load a different glibc didn&rsquo;t work and statically linking glibc wasn&rsquo;t possible either.</p><p>But&mldr; running a program against a version of glibc that&rsquo;s different from the one installed on the system seems like a pretty standard requirement, doesn&rsquo;t it? Consider this: how do the developers of glibc test their changes? glibc has existed for much longer than containers have. And before containers existed, they surely weren&rsquo;t testing glibc changes by installing modified versions of the library over the system-wide one and YOLOing it.</p></p><p class=text-muted>August 11, 2024
&#183;
Tags:
<a href=/tags/blogsystem5>blogsystem5</a>, <a href=/tags/programming>programming</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2024/08/glibc-versions-runtime.html>Continue reading (about
11 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2023/11/ssh-agent-forwarding-and-tmux-done.html>SSH agent forwarding and tmux done right</a></h2><p><p>The <a href=https://man.openbsd.org/ssh-agent>SSH agent</a> is a little daemon that holds your private keys in memory. This is particularly handy when your keys are protected by a passphrase: you can unlock and add your keys to the agent once and, from then on, any SSH client such as <code>ssh(1)</code> can interact with the keys without asking you for the passphrase again.</p><p>The SSH agent becomes even handier when you primarily work on a remote workstation over SSH. Under these circumstances, you will often need the remote workstation to establish SSH connections to <em>other</em> remote machines (e.g. to contact GitHub). In those situations, you can: copy your private keys to the remote workstation; generate different private keys on the remote workstation; or forward your SSH agent so that the remote workstation can leverage the keys from your client machine without them ever traveling over the network.</p></p><p class=text-muted>November 17, 2023
&#183;
Tags:
<a href=/tags/blogsystem5>blogsystem5</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2023/11/ssh-agent-forwarding-and-tmux-done.html>Continue reading (about
9 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2021/08/useless-use-of-gnu.html>Useless use of GNU</a></h2><p>The GNU project is the source of the Unix userland utilities used on most Linux distributions. Its compatibility with standards and other Unix systems, or lack thereof, directly impacts the overall portability of any piece of software developed from GNU/Linux installations. Unfortunately, the GNU userland does not closely adhere to standards, and its widespread usage causes little incompatibilities to creep into any software created on GNU/Linux systems. Read on for why this is a problem and the pitfalls you will encounter.</p><p class=text-muted>August 25, 2021
&#183;
Tags:
<a href=/tags/opinion>opinion</a>, <a href=/tags/programming>programming</a>, <a href=/tags/shell>shell</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2021/08/useless-use-of-gnu.html>Continue reading (about
12 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2020/11/cmdline-args-unix-vs-windows.html>Argument processing in Unix and Windows</a></h2><p>Let&rsquo;s continue our dive into the very interesting topic of how Unix (or Linux or what have you) and Windows differ regarding argument processing. And by that I mean: how a program (the caller) communicates the set of arguments to pass to another program (the callee) at execution time, how the callee receives such arguments, and what are the consequences of each design.</p><p class=text-muted>November 2, 2020
&#183;
Tags:
<a href=/tags/unix>unix</a>, <a href=/tags/windows>windows</a><br><a class=text-reset href=/2020/11/cmdline-args-unix-vs-windows.html>Continue reading (about
12 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2020/10/powershell-cmdlet-params.html>Flags parsing in PowerShell (vs. Unix)</a></h2><p>The way PowerShell handles flags in scripts (aka cmdlets) differs completely from what Unix shells do. These differences allow PowerShell to gain insight on how scripts have to be executed, which in turn can deliver a better interactive user experience. Read on for a comparison while wearing Unix-tinted glasses.</p><p class=text-muted>October 28, 2020
&#183;
Tags:
<a href=/tags/powershell>powershell</a>, <a href=/tags/unix>unix</a>, <a href=/tags/windows>windows</a><br><a class=text-reset href=/2020/10/powershell-cmdlet-params.html>Continue reading (about
7 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2020/08/database-directories.html>A tour of directories as system-wide databases</a></h2><p>In the previous post, we saw how .d directories permit programmatic edits to system-wide configuration with ease. But this same concept can be applied to other kinds of tracking. Let&rsquo;s dive into a few examples ranging from desktop menu entries to the package manager&rsquo;s database itself.</p><p class=text-muted>August 21, 2020
&#183;
Tags:
<a href=/tags/debian>debian</a>, <a href=/tags/menu2wm>menu2wm</a>, <a href=/tags/netbsd>netbsd</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2020/08/database-directories.html>Continue reading (about
12 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/star.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2020/08/config-files-vs-directories.html>Configuration files and .d directories</a></h2><p>Have you ever wondered why an increasing number of programs are configured by placing small files in .d directories instead of by just editing a single file? Have you ever wondered why these .d directories seem to proliferate in Linux installations? Read on to understand what these are and why they are useful.</p><p class=text-muted>August 17, 2020
&#183;
Tags:
<a href=/tags/debian>debian</a>, <a href=/tags/featured>featured</a>, <a href=/tags/netbsd>netbsd</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2020/08/config-files-vs-directories.html>Continue reading (about
9 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2019/11/wait-for-process-group-darwin.html>Waiting for process groups, macOS edition</a></h2><p><p>In the previous posts, we saw why <a href=/2019/11/wait-for-process-group.html>waiting for a process group is complicated</a> and we covered a specific, bullet-proof mechanism to <a href=/2019/11/wait-for-process-group-linux.html>accomplish this on Linux</a>. Now is the time to investigate this same topic on macOS. Remember that the problem we are trying to solve (<a href=https://github.com/bazelbuild/bazel/issues/10245>#10245</a>) is the following: given a process group, wait for all of its processes to fully terminate.</p><p>macOS has a bunch of fancy features that <a href=/2019/03/macos-threads-qos-and-bazel.html>other systems do not have</a>, but process control is not among them. We do not have features like Linux&rsquo;s child subreaper or PID namespaces to keep track of process groups. Therefore, we&rsquo;ll have to roll our own. And the only way to do this is to scan the process table looking for processes with the desired process group identifier (PGID) and waiting until they are gone.</p></p><p class=text-muted>November 15, 2019
&#183;
Tags:
<a href=/tags/bazel>bazel</a>, <a href=/tags/darwin>darwin</a>, <a href=/tags/macos>macos</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2019/11/wait-for-process-group-darwin.html>Continue reading (about
8 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2019/11/wait-for-process-group-linux.html>Waiting for process groups, Linux edition</a></h2><p><p>In the <a href=/2019/11/wait-for-process-group.html>previous post</a>, we saw why waiting for a process group to terminate is important (at least in the context of Bazel), and we also saw why this is a difficult thing to do in a portable manner. So today, let&rsquo;s dive into how to do this properly on a Linux system.</p><p>On Linux, we have two routes: using the <strong>child subreaper</strong> feature or using <strong>PID namespaces</strong>. We&rsquo;ll focus on the former because that&rsquo;s what we&rsquo;ll use to fix (<a href=https://github.com/bazelbuild/bazel/issues/10245>#10245</a>) the process wrapper<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, and because they are sufficient to fully address our problem.</p></p><p class=text-muted>November 14, 2019
&#183;
Tags:
<a href=/tags/bazel>bazel</a>, <a href=/tags/linux>linux</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2019/11/wait-for-process-group-linux.html>Continue reading (about
4 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2019/11/wait-for-process-group.html>Waiting for process groups, introduction</a></h2><p><p><strong>Process groups</strong> are a feature of Unix systems to group related processes under a common identifier, known as the <strong>PGID</strong>. Using the PGID, one can look for these related process and send signals in unison to them. This is typically used by shell interpreters to manage processes.</p><p>For example, let&rsquo;s launch a shell command that puts two <code>sleep</code> invocations in the background (those with the 10- and 20-second delays) and then sleeps the direct child (with a 5-second delay)&mdash;while also putting the whole invocation in the background so that we can inspect what&rsquo;s going on:</p></p><p class=text-muted>November 12, 2019
&#183;
Tags:
<a href=/tags/bazel>bazel</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2019/11/wait-for-process-group.html>Continue reading (about
6 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2019/11/bazel-process-wrapper.html>Bazel's process-wrapper helper tool</a></h2><p><p>As strange as it may sound, a very important job of any build tool is to orchestrate the execution of lots of other programs&mdash;and <a href=https://bazel.build/>Bazel</a> is no exception.</p><p>Once Bazel has finished <em>loading</em> and <em>analyzing</em> the build graph, Bazel enters the <em>execution phase</em>. In this phase, the primary thing that Bazel does is walk the graph looking for actions to execute. Then, for each action, Bazel invokes its commands&mdash;things like compiler and linker invocations&mdash;as subprocesses. Under the default configuration<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, all of these commands run on your machine.</p></p><p class=text-muted>November 8, 2019
&#183;
Tags:
<a href=/tags/bazel>bazel</a>, <a href=/tags/internals>internals</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2019/11/bazel-process-wrapper.html>Continue reading (about
6 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2019/09/safe-chdir-to-previous.html>Safely restoring the previous working directory</a></h2><p><p>The <strong>current working directory</strong>, or CWD for short, is a process-wide property. It is good practice to treat the CWD as read-only because it is essentially global state: if you change the CWD of your process at any point, any relative paths you might have stored in memory<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> will stop working. I learned this first many years ago when using the Boost.Filesystem library: I could not find a function to change the CWD and that was very much intentional for this reason.</p></p><p class=text-muted>September 21, 2019
&#183;
Tags:
<a href=/tags/programming>programming</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2019/09/safe-chdir-to-previous.html>Continue reading (about
3 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/star.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2016/09/env-considered-harmful.html>#! /usr/bin/env considered harmful</a></h2><p><p>Many programming guides recommend to begin scripts with the <code>#! /usr/bin/env</code> <a href=https://en.wikipedia.org/wiki/Shebang_(Unix)>shebang</a> in order to to automatically locate the necessary interpreter. For example, for a Python script you would use <code>#! /usr/bin/env python</code>, and then the saying goes, the script would &ldquo;just work&rdquo; on any machine with Python installed.</p><p>The reason for this recommendation is that <code>/usr/bin/env python</code> will search the <code>PATH</code> for a program called <code>python</code> and execute the first one found&mldr; and that usually works fine <em>on one&rsquo;s own machine</em>.</p></p><p class=text-muted>September 14, 2016
&#183;
Tags:
<a href=/tags/featured>featured</a>, <a href=/tags/portability>portability</a>, <a href=/tags/programming>programming</a>, <a href=/tags/scripts>scripts</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2016/09/env-considered-harmful.html>Continue reading (about
5 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2010/01/set-e-and-set-x.html>set -e and set -x</a></h2><p><p>If you write shell scripts, you definitely need to know about two nice features that can be enabled through the <code>set</code> builtin:</p><ul><li><p><code>set -e</code>: Enables checking of all commands. If a command exits with an error and the caller does not check such error, the script aborts immediately. Enabling this will make your scripts more robust. But don&rsquo;t wait until your script is &ldquo;complete&rdquo; to set the flag as an afterthought, because it will be a nightmare to fix the scrip to work with this feature enabled. Just write <code>set -e</code> as the very first line of your code; well&mldr; after the shell bang.</p></p><p class=text-muted>January 24, 2010
&#183;
Tags:
<a href=/tags/unix>unix</a><br><a class=text-reset href=/2010/01/set-e-and-set-x.html>Continue reading (about
1 minute)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2006/12/doesnt-ls-d-f-do-what-you-expect.html>Doesn't 'ls f*' do what you expect?</a></h2><p>If you have ever ran <tt>ls</tt> on a directory whose contents don't fit on screen, you may have tried to list only a part of it by passing a wildcard to the command. For example, if you were only interested in all directory entries starting with an <tt>f</tt>, you might have tried <tt>ls f*</tt>. But did that do what you expected? Most likely not if any of those matching entries was a directory. In that case, you might have thought that <tt>ls</tt> was actually recursing into those directories.<br><br>Let's consider a directory with two entries: a file and a directory. It may look like:<pre>$ ls -l<br>total 12K<br>drwxr-xr-x 2 jmmv jmmv 4096 Dec 19 15:18 foodir<br>-rw-r--r-- 1 jmmv jmmv    0 Dec 19 15:18 foofile</pre>The <tt>ls</tt> command above was executed inside our directory, without arguments, hence it listed the current directory's contents. However, if we pass a wildcard we get more results than expected:<pre>$ ls -l *<br>-rw-r--r-- 1 jmmv jmmv    0 Dec 19 15:18 foofile<br><br>foodir:<br>total 4K<br>-rw-r--r-- 1 jmmv jmmv 0 Dec 19 15:19 anotherfile</pre>What happened in the previous command is that <i>the shell expanded the wildcard</i>; that is, <tt>ls</tt> never saw the special character itself. In fact, the above was internally converted to <tt>ls -l foofile foodir</tt> and this is what was actually passed to the <tt>ls</tt> utility during its execution. With this in mind, it is easy to see why you got the contents of the sample directory too: you explicitly (although somewhat "hidden") asked <tt>ls</tt> to show them.<br><br>How to avoid that? Use <tt>ls</tt>'s <tt>-d</tt> option, which tells it to list the directory entries themselves, not their contents:<pre>$ ls -l -d *<br>drwxr-xr-x 2 jmmv jmmv 4096 Dec 19 15:19 foodir<br>-rw-r--r-- 1 jmmv jmmv    0 Dec 19 15:18 foofile</pre><b>Update (21st Dec)</b>: Fixed the first command shown as noted by Hubert Feyrer.</p><p class=text-muted>December 19, 2006
&#183;
Tags:
<a href=/tags/unix>unix</a><br><a class=text-reset href=/2006/12/doesnt-ls-d-f-do-what-you-expect.html>Continue reading (about
2 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/star.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2005/10/lightweight-web-serving-with-thttpd.html>Lightweight Web Serving With thttpd</a></h2><p><p><em>This article first appeared on this date in O&rsquo;Reilly&rsquo;s ONLamp.com online publication. The content was deleted sometime in 2019 but I was lucky enough to <a href=https://web.archive.org/web/20150910024728/http://www.linuxdevcenter.com/pub/a/bsd/2005/10/13/thttpd.html>find a copy</a> in the WayBack Machine. I reformatted the text to fit the style of this site and fixed broken links, but otherwise the content is a verbatim reproduction of what was originally published.</em></p><hr><p>The <a href=http://httpd.apache.org/>Apache HTTP Server</a> is the most popular web server due to its functionality, stability, and maturity. However, this does not make it suitable for all uses: slow machines and embedded systems may have serious problems running it because of its size. Here is where lightweight HTTP servers come into play, as their low-memory footprints deliver decent results without having to swap data back to disk.</p></p><p class=text-muted>October 13, 2005
&#183;
Tags:
<a href=/tags/featured>featured</a>, <a href=/tags/onlamp>onlamp</a>, <a href=/tags/unix>unix</a>, <a href=/tags/web>web</a><br><a class=text-reset href=/2005/10/lightweight-web-serving-with-thttpd.html>Continue reading (about
11 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/star.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2005/04/making-packager-friendly-software-2.html>Making Packager-Friendly Software (part 2)</a></h2><p><p><em>This article first appeared on this date in O&rsquo;Reilly&rsquo;s ONLamp.com online publication. The content was deleted sometime in 2019 but I was lucky enough to <a href=https://web.archive.org/web/20150910045605/http://www.linuxdevcenter.com/pub/a/onlamp/2005/04/28/packaging2.html>find a copy</a> in the WayBack Machine. I reformatted the text to fit the style of this site and fixed broken links, but otherwise the content is a verbatim reproduction of what was originally published.</em></p><hr><p>My previous article, <a href=/2005/03/making-packager-friendly-software-1.html>Making Packager-Friendly Software (part 1)</a>, explains why software packaging is sometimes problematic due to real problems in the mainstream sources. It also discusses many issues that affect the distribution files and the configuration scripts (the most visible items when trying out a new program). This part explores the problems found in the build infrastructure and the code itself.</p></p><p class=text-muted>April 28, 2005
&#183;
Tags:
<a href=/tags/featured>featured</a>, <a href=/tags/netbsd>netbsd</a>, <a href=/tags/onlamp>onlamp</a>, <a href=/tags/programming>programming</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2005/04/making-packager-friendly-software-2.html>Continue reading (about
15 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/star.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2005/03/making-packager-friendly-software-1.html>Making Packager-Friendly Software (part 1)</a></h2><p><p><em>This article first appeared on this date in O&rsquo;Reilly&rsquo;s ONLamp.com online publication. The content was deleted sometime in 2019 but I was lucky enough to <a href=https://web.archive.org/web/20150910045646/http://www.linuxdevcenter.com/pub/a/onlamp/2005/03/31/packaging.html>find a copy</a> in the WayBack Machine. I reformatted the text to fit the style of this site and fixed broken links, but otherwise the content is a verbatim reproduction of what was originally published.</em></p><hr><p>A package maintainer, or packager, is a person who creates packages for software projects. He eventually finds common problems in these projects, resulting in a complex packaging process and a final package that is a nightmare to maintain. These little flaws exist because in most cases the original developers are not packagers, so they are not aware of them. In other words, if you do not know something is wrong, you cannot fix it.</p></p><p class=text-muted>March 31, 2005
&#183;
Tags:
<a href=/tags/featured>featured</a>, <a href=/tags/netbsd>netbsd</a>, <a href=/tags/onlamp>onlamp</a>, <a href=/tags/programming>programming</a>, <a href=/tags/unix>unix</a><br><a class=text-reset href=/2005/03/making-packager-friendly-software-1.html>Continue reading (about
20 minutes)</a></p></div></div></div><div class="col-md-3 sidebar d-none d-md-block"><div class=row><div class="col text-center p-2"><p><a href=/about.html class=clear-link><img src=/images/avatars/20181124-snow.jpg class="rounded-circle shadow my-2" style=width:100px><br><b>Julio Merino</b><br>A blog on operating systems, programming languages, testing, build systems, my own software
projects and even personal productivity. Specifics include FreeBSD, Linux, Rust, Bazel and
EndBASIC.</a></p><div class=row><div class=col><div class=form-group><form action=https://endtracker.azurewebsites.net/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/subscribers/add method=post><input type=text name=email placeholder="Enter your email" class="form-control input-sm text-center my-1">
<button type=submit class="btn btn-primary btn-block my-1">Subscribe</button></form></div></div></div><div class="row px-2"><div class="col-sm-5 text-left"><small><span class=subscriber-count>0</span> subscribers</small></div><div class="col-sm-7 text-right"><p><a rel=me href=https://mastodon.online/@jmmv><img src=/images/badges/mastodon-logo.svg width=32px height=32px alt="Follow @jmmv on Mastodon">
</a><a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&amp;screen_name=jmmv"><img src=/images/badges/Twitter_logo_blue.svg width=32px height=32px alt="Follow @jmmv on Twitter">
</a><a href=/feed.xml><img src=/images/badges/feed-icon-28x28.png alt="RSS feed"></a></p></div></div></div></div><div class=row><div class=col><h2>Featured software</h2><ul><li class=overflow-ellipsis><a href=https://www.endbasic.dev/ target=_blank>EndBASIC: Online BASIC+DOS env</a></li><li class=overflow-ellipsis><a href=https://endtracker.azurewebsites.net/ target=_blank>EndTRACKER: Services for static sites</a></li></ul></div></div><div class=row><div class=col><h2>Featured posts</h2><ul><li class=overflow-ellipsis><a href=/2023/06/fast-machines-slow-machines.html>Fast machines, slow machines</a></li><li class=overflow-ellipsis><a href=/2022/12/endbasic-0.10.html>EndBASIC 0.10: Core language, evolved</a></li><li class=overflow-ellipsis><a href=/2022/10/bye-microsoft-hi-snowflake.html>Farewell, Microsoft; hello, Snowflake!</a></li><li class=overflow-ellipsis><a href=/2022/05/rust-is-hard-but-does-it-matter.html>Rust is hard, yes, but does it matter?</a></li><li class=overflow-ellipsis><a href=/2022/04/rust-traits-and-dependency-injection.html>Rust traits and dependency injection</a></li><li class=overflow-ellipsis><a href=/2022/03/a-year-on-windows-intro.html>A year on Windows: Introduction</a></li><li class=overflow-ellipsis><a href=/2021/04/always-be-quitting.html>Always be quitting</a></li><li class=overflow-ellipsis><a href=/2021/02/google-monorepos-and-caching.html>How does Google keep build times low?</a></li><li class=overflow-ellipsis><a href=/2020/12/google-no-clean-builds.html>How does Google avoid clean builds?</a></li><li class=overflow-ellipsis><a href=/2020/12/unit-testing-a-console-app.html>Unit-testing a console app (a text editor)</a></li><li class=overflow-ellipsis><a href=/essays.html#featured>More...</a></li></ul></div></div></div></div></div><footer class=container-fluid><div class=row><div class="col-4 order-2 text-right"><p class=float-right><a href=#>Back to top</a></p></div><div class="col-8 order-1 mr-auto"><p>Copyright 2004&ndash;2025
Julio Merino</p></div></div></footer><script type=module>
  import { addAnchorsToHeaders, addElementClasses, BatchClient } from "\/js\/main.0de73782e9e0fbcb4184fb5793949b3b0d0ada16455df89320415b4dcc052f88.js";

  var batchClient = new BatchClient(SITE_ID);
  batchClient.doAll({
    put_request: true, get_comments: true, get_subscriber_count: true, get_votes: true });

  window.voteThumbsUp = function() { batchClient.voteThumbsUp(); }
  window.voteThumbsDown = function() { batchClient.voteThumbsDown(); }

  window.postComment = function(...args) {
    batchClient.postComment(...args);
  };

  addAnchorsToHeaders();
  addElementClasses();
</script><noscript><img src="https://hugo-dynamic.jmmv.dev/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/pages/aHR0cHM6Ly9qbW12LmRldi90YWdzL3VuaXgvaW5kZXguaHRtbA==/stamp.gif" style=display:none></noscript></body></html>