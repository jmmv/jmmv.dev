<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Volumes on Julio Merino (jmmv.dev)</title><link>https://jmmv.dev/tags/volumes/index.html</link><description>Recent content in Volumes on Julio Merino (jmmv.dev)</description><generator>Hugo</generator><language>en-us</language><managingEditor>julio@meroh.net (Julio Merino)</managingEditor><webMaster>julio@meroh.net (Julio Merino)</webMaster><lastBuildDate>Tue, 10 Apr 2007 12:36:00 -0400</lastBuildDate><atom:link href="https://jmmv.dev/tags/volumes/index/feed.xml" rel="self" type="application/rss+xml"/><item><title>Mounting volumes on Mac OS X's startup</title><link>https://jmmv.dev/2007/04/mounting-volumes-on-mac-os-xs-startup.html</link><pubDate>Tue, 10 Apr 2007 12:36:00 -0400</pubDate><author>julio@meroh.net (Julio Merino)</author><guid>https://jmmv.dev/2007/04/mounting-volumes-on-mac-os-xs-startup.html</guid><description>As I mentioned yesterday, I have a couple of disk images in my Mac OS X machine that hold NetBSD's and pkgsrc's source code. I also have some virtual machines in Parallels that need to use these project's files.&lt;br />&lt;br />In order to keep disk usage to the minimum, I share the project's disk images with the virtual machines by means of NFS. (See &lt;a href="http://mactechnotes.blogspot.com/2005/09/mac-os-x-as-nfs-server.html">Mac OS X as an NFS Server&lt;/a> for more details.) But in doing so, a problem appears: the NFS daemon is started as part of the system's boot process, long before I can manually mount the disk images. As a result, the NFS daemon — more specifically, &lt;tt>mountd&lt;/tt> — cannot see the exported directories and assumes that their corresponding export entries are invalid. This effectively means that, after mounting the images, I have to manually send a HUP signal to &lt;tt>mountd&lt;/tt> to refresh its export list.&lt;br />&lt;br />A little research will tell you that it is trivial to mount disk volumes on login by dragging their icon to the &lt;i>Login items&lt;/i> section of the &lt;i>Accounts&lt;/i> preference panel:&lt;br />&lt;br />&lt;a href="http://4.bp.blogspot.com/_xLbGV919cEE/Rhu_LnSUW4I/AAAAAAAAAAk/tasOA5x7tFY/s1600-h/login-images.png">&lt;img style="margin: 0px auto 10px; display: block; text-align: center; cursor: pointer;" src="https://jmmv.dev/images/2007-04-10-login-images.png" />&lt;/a>&lt;br />&lt;i>But&lt;/i>... that doesn't solve the problem. If you do that, the images will be mounted when you &lt;i>log in&lt;/i>, and that happens long after the system has spawned the NFS daemons.&lt;br />&lt;br />Ideally, one should be able to list the disk images in &lt;tt>/etc/fstab&lt;/tt>, just as is done with any other file system, but that does not work (or I don't know the appropriate syntax). So how do you resolve the problem? Or better said, how did I resolve it (because I doubt it's the only solution)?&lt;br />&lt;br />It turns out it was not trivial: you need to manually write a new startup script that mounts the images for you on system startup. In order to do that, start by creating the &lt;tt>/Library/StartupItems/DiskImages&lt;/tt> directory; this will hold the startup script as well as the necessary meta-data to tell the system what to do with it.&lt;br />&lt;br />Then create the real script within that directory and name it &lt;tt>DiskImages&lt;/tt>:&lt;pre>#! /bin/sh&lt;br />&lt;br />#&lt;br /># DiskImages startup script&lt;br />#&lt;br />&lt;br />. /etc/rc.common&lt;br />&lt;br />basePath="/Library/StartupItems/DiskImages"&lt;br />&lt;br />StartService() {&lt;br /> hdiutil attach -nobrowse &lt;br /> /Users/jmmv/Projects/NetBSD.dmg&lt;br /> hdiutil attach -nobrowse &lt;br /> /Users/jmmv/Projects/pkgsrc.dmg&lt;br />}&lt;br />&lt;br />StopService() {&lt;br /> true&lt;br />}&lt;br />&lt;br />RestartService() {&lt;br /> true&lt;br />}&lt;br />&lt;br />RunService "$1"&lt;/pre>Don't forget to grant the executable permission to that script with &lt;tt>chmod +x DiskImages&lt;/tt>.&lt;br />&lt;br />At last, create the &lt;tt>StartupParameters.plist&lt;/tt> file, also in that directory, and put the following in it:&lt;pre>{&lt;br /> Description = "Automatic attachment of disk images";&lt;br /> OrderPreference = "First";&lt;br /> Uses = ("Disks");&lt;br />}&lt;/pre>And that's it! Reboot and those exported directories contained within images will be properly recognized by the NFS daemon.&lt;br />&lt;br />I'm wondering if there is a better way to resolve the issue, but so far this seems to work. Now... mmm... a UI to create and manage this script could be sweet.</description></item></channel></rss>