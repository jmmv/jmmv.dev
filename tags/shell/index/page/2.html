<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml xmlns:fb=http://ogp.me/ns/fb#><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta property="og:site_name" content="Julio Merino (jmmv.dev)"><meta property="twitter:site" content="@jmmv"><title>Shell - Julio Merino (jmmv.dev)</title>
<meta property="og:title" content="Shell - Julio Merino (jmmv.dev)"><meta property="twitter:title" content="Shell - Julio Merino (jmmv.dev)"><meta name=description content><meta property="og:description" content><meta property="twitter:description" content><meta name=author content="Julio Merino"><meta property="twitter:creator" content="@jmmv"><meta name=generator content="Hugo 0.136.5"><meta property="og:url" content="https://jmmv.dev/tags/shell/index.html"><meta property="og:type" content="blog"><meta property="twitter:card" content="summary"><link rel=canonical href=https://jmmv.dev/tags/shell/index.html><link rel=alternate type=application/rss+xml title="Julio Merino (jmmv.dev)" href=/feed.xml><link rel=stylesheet href=/sass/main.min.cb91349cd93211a37e7d5dc131c35a170fc795721c03373cd05571327eea206b.css><link rel=stylesheet href=/css/chroma.css><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicons/favicon-96x96.png sizes=96x96><meta property="og:image" content="/images/favicons/favicon-1200x1200.png"><meta property="twitter:image" content="https://jmmv.dev/images/favicons/favicon-1200x1200.png"><script>const SITE_ID="e8da9f62-b7ac-4fe9-bf20-7c527199a376",BASE_URL="https://jmmv.dev/"</script></head><body><header class=site-header><nav class="navbar navbar-expand-md fixed-top navbar-dark bg-primary"><a class=navbar-brand href=/><img src=/images/favicons/favicon-30x30.png width=30 height=30 class="d-inline-block align-top" alt>
&nbsp;jmmv.dev
</a><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/about.html>About</a></li><li class=nav-item><a class=nav-link href=/blog.html>Blog</a></li><li class=nav-item><a class=nav-link href=/resume.html>Resume</a></li><li class=nav-item><a class=nav-link href=/software.html>Software</a></li></ul><ul class="navbar-nav mr-4"><li class=nav-item><a class=nav-link href=/archive.html>Archive</a></li><li class=nav-item><a class=nav-link href=/series.html>Series</a></li><li class=nav-item><a class=nav-link href=/tags.html>Tags</a></li></ul><form class=form-inline method=get role=search action=https://www.google.com/search><div class=input-group><input type=search name=query class=form-control placeholder=Search aria-label=Search><div class=input-group-append><button type=submit value=Search class="btn btn-light">
<img src=/octicons/search.svg></button></div></div><input type=hidden name=sitesearch value=https://jmmv.dev/></form></div></nav></header><div class=page-header><div class=container><h1>Posts: Shell</h1><p>Showing 11 posts</p></div></div><div class=container><div class=row><div class=col-md-9><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2023/11/why-do-i-know-shell-and-how-can-you.html>Why do I know shell, and how can you?</a></h2><p>&ldquo;Why do you know so much shell?&rdquo; is a question I&rsquo;m getting a lot at work lately. So yeah, why? And how can you learn it too? There is no secret here: I know the shell well because I was &ldquo;forced&rdquo; to write tools in it for a while and, because of that, I made a conscious effort to learn the language and get better at it.
You see, most people that write shell don&rsquo;t want to deal with it. They stitch together whatever works into a script and call it a day, making a bunch of spaghetti even if it goes against the coding best practices they already know. And when they encounter some odd syntax they don&rsquo;t recognize, their reaction is to say &ldquo;this has to be rewritten in Python!&rdquo; instead of taking a breath and trying to really understand what&rsquo;s going on. It doesn&rsquo;t help that plenty of senior engineers scoff at shell scripts.
And it is true: the shell is arcane and has many flaws as a programming language. I don&rsquo;t want to convince you to start writing new tools in it. But the shell is also an incredible rapid prototyping language, and you can use it to solve business problems really quickly and with surprisingly little code. If you pause for a second to learn it, you&rsquo;ll realize that you can bend tradition and write maintainable shell code too. Hear out how I got into writing so much shell and how you can get better at it too.</p><p class=text-muted>November 10, 2023
&#183;
Tags:
&lt;a href="/tags/blogsystem5">blogsystem5&lt;/a>, &lt;a href="/tags/personal-story">personal-story&lt;/a>, &lt;a href="/tags/shell">shell&lt;/a><br><a class=text-reset href=/2023/11/why-do-i-know-shell-and-how-can-you.html>Continue reading (about
7 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2023/11/end-to-end-tool-testing-with-bazel.html>End-to-end tool testing with Bazel and shtk</a></h2><p>If you use Bazel, your project is of moderate size. And because your project is of moderate size, it almost-certainly builds one or more binaries, at least one of which is a CLI tool. But let&rsquo;s face it: you don&rsquo;t have end-to-end testing for those tools, do you?
I&rsquo;m sure you have split the binary&rsquo;s main function into its own file so that the rest of the tool can be put in a library, and I&rsquo;m extra-sure that you have unit tests for such library. But&mldr; those tests do little to verify the functionality and quality of the tool as experienced by the end user. Consider: What exactly does the tool print to the console on success? Does it show errors nicely when they happen, or does it dump internal stack traces? How does it handle unknown flags or bad arguments? Is the built-in help message nicely rendered when your terminal is really wide? What if the terminal is narrow?
You must write end-to-end tests for your tools but, usually, that isn’t easy to do. Until today. Combining shtk with Bazel via the new rules_shtk ruleset makes it trivial to write tests that verify the behavior of your CLI tools&mdash;no matter what language they are written in&mdash;and in this article I’m going to show you how.</p><p class=text-muted>November 4, 2023
&#183;
Tags:
&lt;a href="/tags/bazel">bazel&lt;/a>, &lt;a href="/tags/blogsystem5">blogsystem5&lt;/a>, &lt;a href="/tags/shell">shell&lt;/a>, &lt;a href="/tags/shtk">shtk&lt;/a>, &lt;a href="/tags/testing">testing&lt;/a><br><a class=text-reset href=/2023/11/end-to-end-tool-testing-with-bazel.html>Continue reading (about
7 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2023/10/unit-testing-with-shtk.html>Unit-testing shell scripts and tools with shtk</a></h2><p>While working on this static blog a few days ago, I made a change to its templates that warranted an automated test. I could have written a trivial shell script to do it, but instead I reached out for shtk&rsquo;s unit-testing module. I tweeted about it right away to just say that you can, in fact, write tests in shell because lots of developers are skeptical about any script longer than 10 lines of code.
Interestingly, this reply came through: a pointer to a contemporary, under-development library for writing tests in Bash. Which made me think: &ldquo;Hey, I had already done that years ago&mldr; but nobody knows about it. Gotta fix that with a blog post!&rdquo; But first, I had to bring shtk back from its ashes because I had not touched it for more than 6 years and it wasn&rsquo;t read for show and tell. So I did something that I wanted to do back in the day but never did: I put together a website for shtk to host its reference manual and I fixed a few obvious rough edges.
With those tweaks out of the way, we come to this article. In here, I want to show you how writing decent tests in shell is entirely possible and how shtk&rsquo;s testing platform provides unique features to do integration testing of CLI apps written in any language.</p><p class=text-muted>October 11, 2023
&#183;
Tags:
&lt;a href="/tags/shell">shell&lt;/a>, &lt;a href="/tags/shtk">shtk&lt;/a>, &lt;a href="/tags/testing">testing&lt;/a><br><a class=text-reset href=/2023/10/unit-testing-with-shtk.html>Continue reading (about
12 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2021/08/useless-use-of-gnu.html>Useless use of GNU</a></h2><p>The GNU project is the source of the Unix userland utilities used on most Linux distributions. Its compatibility with standards and other Unix systems, or lack thereof, directly impacts the overall portability of any piece of software developed from GNU/Linux installations. Unfortunately, the GNU userland does not closely adhere to standards, and its widespread usage causes little incompatibilities to creep into any software created on GNU/Linux systems. Read on for why this is a problem and the pitfalls you will encounter.</p><p class=text-muted>August 25, 2021
&#183;
Tags:
&lt;a href="/tags/opinion">opinion&lt;/a>, &lt;a href="/tags/programming">programming&lt;/a>, &lt;a href="/tags/shell">shell&lt;/a>, &lt;a href="/tags/unix">unix&lt;/a><br><a class=text-reset href=/2021/08/useless-use-of-gnu.html>Continue reading (about
12 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2020/03/test-bracket.html>test, [, and [[</a></h2><p>A little essay on the amusement or horror that may bring to learn that both test and [ are binaries on your typical Unix system, and that [[ is subject to completely different rules.</p><p class=text-muted>March 25, 2020
&#183;
Tags:
&lt;a href="/tags/shell">shell&lt;/a><br><a class=text-reset href=/2020/03/test-bracket.html>Continue reading (about
5 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2019/11/macos-bash-baggage.html>The /bin/bash baggage of macOS</a></h2><p>As you may know, macOS ships with an ancient version of the Bash shell interpreter, 3.2.57. Let&rsquo;s see why that is and why this is a problem.</p><p class=text-muted>November 20, 2019
&#183;
Tags:
&lt;a href="/tags/macos">macos&lt;/a>, &lt;a href="/tags/shell">shell&lt;/a><br><a class=text-reset href=/2019/11/macos-bash-baggage.html>Continue reading (about
4 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2018/03/shell-readability-local.html>Shell readability: local</a></h2><p>As most programming languages with support for functions, the shell offers locally-scoped variables. Unfortunately, local variables are not the default. You must explicitly declare variables as local and you should be very strict about doing this to prevent subtle but hard-to-diagnose bugs.
That&rsquo;s it! What else is there to say about this trivial keyword? As it turns out, more than you might think.</p><p class=text-muted>March 13, 2018
&#183;
Tags:
&lt;a href="/tags/readability">readability&lt;/a>, &lt;a href="/tags/shell">shell&lt;/a><br><a class=text-reset href=/2018/03/shell-readability-local.html>Continue reading (about
5 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/star.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2018/03/shell-readability-strict-mode.html>Shell readability: strict mode</a></h2><p>Some programming languages have a feature known as strict mode: a setting that makes the language interpreter disallow certain obviously-broken code that would otherwise work. The simplest examples are JavaScript and Perl but, as it turns out, the shell also has something akin to this feature. The &ldquo;strict mode&rdquo; name, however, is unofficial, so you won&rsquo;t find many references to it online.
You can enable the shell&rsquo;s strict mode by doing one of the following:</p><p class=text-muted>March 9, 2018
&#183;
Tags:
&lt;a href="/tags/featured">featured&lt;/a>, &lt;a href="/tags/readability">readability&lt;/a>, &lt;a href="/tags/shell">shell&lt;/a><br><a class=text-reset href=/2018/03/shell-readability-strict-mode.html>Continue reading (about
6 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2018/03/shell-readability-function-parameters.html>Shell readability: function parameters</a></h2><p>The shell supports defining functions, which, as we learned in the previous post, you should embrace and use. Unfortunately, they are fairly primitive and their use can, paradoxically, introduce other readability problems.
One specific problem is that function parameters are numbered, not named, so the risk of cryptic code is high. Let&rsquo;s see why this is a problem.</p><p class=text-muted>March 2, 2018
&#183;
Tags:
&lt;a href="/tags/readability">readability&lt;/a>, &lt;a href="/tags/shell">shell&lt;/a>, &lt;a href="/tags/shtk">shtk&lt;/a><br><a class=text-reset href=/2018/03/shell-readability-function-parameters.html>Continue reading (about
3 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2018/02/shell-readability-main.html>Shell readability: main</a></h2><p>Our team develops Bazel, a Java-based tool. We do have, however, a significant amount of shell scripting. The percentage is small at only 3.6% of our codebase&mldr; but given the size of our project, that&rsquo;s about 130,000 lines—a lot, really.
Pretty much nobody likes writing these integration tests in shell. Leaving aside that our infrastructure is clunky, the real problem is that the team at large is not familiar with writing shell per se. Few people are these days actually.</p><p class=text-muted>February 26, 2018
&#183;
Tags:
&lt;a href="/tags/readability">readability&lt;/a>, &lt;a href="/tags/shell">shell&lt;/a>, &lt;a href="/tags/shtk">shtk&lt;/a><br><a class=text-reset href=/2018/02/shell-readability-main.html>Continue reading (about
2 minutes)</a></p></div></div><div class="media my-4"><img class=mr-3 src=/octicons/note.svg width=32px height=32px><div class=media-body><h2 class=mt-0><a href=/2012/08/introducing-shtk.html>Introducing shtk</a></h2><p>Have you ever wanted to have a collection of ready-to-use modules for shell scripts? I have, particularly because I keep reimplementing the same functions over and over and over and over again whenever I write non-trivial shell scripts, and I'm tired of doing so.
That's why I have just abstracted all the common code in the aforementioned tools and put it into a new package called the "Shell Toolkit", or shtk for short. Yeah, this name sounds very pretentious but, really, I don't intend this to be anything big. The only thing I want to do is simplify my life when implementing shell scripts, and hope that other people might find the modules useful. So far, I have taken the generic (and common!) code from sysbuild and sysupgrade, reconciled a few tiny divergences, and moved it into this new shtk package.
In reality, writing something like shtk is sin-borderline. I really should not be using shell scripting for the kind of tools I am implementing (they deserve better data structures and better error checking than what shell provides, for example). However, shell scripting is incredible convenient to get reasonably-good implementations of such tools with minimal effort, and is the only scripting language available in NetBSD's base system. (Yes, yes, there is Lua, but my limited knowledge of Lua would not let me write these tools in any decent manner nor in any reasonable time.)
So, what's in shtk? There are a few functions to deal with command lines (error/warning reporting and such things), some trivial stuff to deal with lists, a bunch of code to interact with cvs and, what I like the most, a module to implement configuration files with some kind of key/value validation.
At the moment, shtk can only be found in pkgsrc under pkgsrc/devel/shtk&nbsp;and I don't currently have any plans to make it more widely available. If there are enough people interested in that with real needs, I could reconsider, but the maintenance effort would be non-trivial.
To showcase the features of shtk, I have updated the sysbuild and sysupgrade packages to depend on this new toolkit while at the same time dropping all this duplicate supporting code. It's a good thing that I wrote exhaustive tests for all possible code paths, because the migration from the built-in modules to shtk was riddled with subtleties that would have impacted end users otherwise.
Now... time to really consider taking the task of rewriting pkg_comp in a more&nbsp;maintainable&nbsp;style so that I can add the features I have wished for for many years (like OS X support).</p><p class=text-muted>August 15, 2012
&#183;
Tags:
&lt;a href="/tags/announce">announce&lt;/a>, &lt;a href="/tags/netbsd">netbsd&lt;/a>, &lt;a href="/tags/shell">shell&lt;/a>, &lt;a href="/tags/shtk">shtk&lt;/a>, &lt;a href="/tags/sysbuild">sysbuild&lt;/a>, &lt;a href="/tags/sysupgrade">sysupgrade&lt;/a><br><a class=text-reset href=/2012/08/introducing-shtk.html>Continue reading (about
3 minutes)</a></p></div></div></div><div class="col-md-3 sidebar d-none d-md-block"><div class=row><div class="col text-center p-2"><p><a href=/about.html class=clear-link><img src=/images/avatars/20181124-snow.jpg class="rounded-circle shadow my-2" style=width:100px><br><b>Julio Merino</b><br>A blog on operating systems, programming languages, testing, build systems, my own software
projects and even personal productivity. Specifics include FreeBSD, Linux, Rust, Bazel and
EndBASIC.</a></p><div class=row><div class=col><div class=form-group><form action=https://endtracker.azurewebsites.net/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/subscribers/add method=post><input type=text name=email placeholder="Enter your email" class="form-control input-sm text-center my-1">
<button type=submit class="btn btn-primary btn-block my-1">Subscribe</button></form></div></div></div><div class="row px-2"><div class="col-sm-5 text-left"><small><span class=subscriber-count>0</span> subscribers</small></div><div class="col-sm-7 text-right"><p><a rel=me href=https://mastodon.online/@jmmv><img src=/images/badges/mastodon-logo.svg width=32px height=32px alt="Follow @jmmv on Mastodon">
</a><a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjmmv.dev%2F&amp;screen_name=jmmv"><img src=/images/badges/Twitter_logo_blue.svg width=32px height=32px alt="Follow @jmmv on Twitter">
</a><a href=/feed.xml><img src=/images/badges/feed-icon-28x28.png alt="RSS feed"></a></p></div></div></div></div><div class=row><div class=col><h2>Featured software</h2><ul><li class=overflow-ellipsis><a href=https://www.endbasic.dev/ target=_blank>EndBASIC: Online BASIC+DOS env</a></li><li class=overflow-ellipsis><a href=https://endtracker.azurewebsites.net/ target=_blank>EndTRACKER: Services for static sites</a></li></ul></div></div><div class=row><div class=col><h2>Featured posts</h2><ul><li class=overflow-ellipsis><a href=/2023/06/fast-machines-slow-machines.html>Fast machines, slow machines</a></li><li class=overflow-ellipsis><a href=/2022/12/endbasic-0.10.html>EndBASIC 0.10: Core language, evolved</a></li><li class=overflow-ellipsis><a href=/2022/10/bye-microsoft-hi-snowflake.html>Farewell, Microsoft; hello, Snowflake!</a></li><li class=overflow-ellipsis><a href=/2022/05/rust-is-hard-but-does-it-matter.html>Rust is hard, yes, but does it matter?</a></li><li class=overflow-ellipsis><a href=/2022/04/rust-traits-and-dependency-injection.html>Rust traits and dependency injection</a></li><li class=overflow-ellipsis><a href=/2022/03/a-year-on-windows-intro.html>A year on Windows: Introduction</a></li><li class=overflow-ellipsis><a href=/2021/04/always-be-quitting.html>Always be quitting</a></li><li class=overflow-ellipsis><a href=/2021/02/google-monorepos-and-caching.html>How does Google keep build times low?</a></li><li class=overflow-ellipsis><a href=/2020/12/google-no-clean-builds.html>How does Google avoid clean builds?</a></li><li class=overflow-ellipsis><a href=/2020/12/unit-testing-a-console-app.html>Unit-testing a console app (a text editor)</a></li><li class=overflow-ellipsis><a href=/essays.html#featured>More...</a></li></ul></div></div></div></div></div><footer class=container-fluid><div class=row><div class="col-4 order-2 text-right"><p class=float-right><a href=#>Back to top</a></p></div><div class="col-8 order-1 mr-auto"><p>Copyright 2004&ndash;2023 Julio Merino</p></div></div></footer><script type=module>
  import { addAnchorsToHeaders, addElementClasses, BatchClient } from "\/js\/main.0de73782e9e0fbcb4184fb5793949b3b0d0ada16455df89320415b4dcc052f88.js";

  var batchClient = new BatchClient(SITE_ID);
  batchClient.doAll({
    put_request: true, get_comments: true, get_subscriber_count: true, get_votes: true });

  window.voteThumbsUp = function() { batchClient.voteThumbsUp(); }
  window.voteThumbsDown = function() { batchClient.voteThumbsDown(); }

  window.postComment = function(...args) {
    batchClient.postComment(...args);
  };

  addAnchorsToHeaders();
  addElementClasses();
</script><noscript><img src="https://hugo-dynamic.jmmv.dev/api/sites/e8da9f62-b7ac-4fe9-bf20-7c527199a376/pages/aHR0cHM6Ly9qbW12LmRldi90YWdzL3NoZWxsL2luZGV4Lmh0bWw=/stamp.gif" style=display:none></noscript></body></html>