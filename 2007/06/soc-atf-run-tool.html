<!DOCTYPE html>
<html>
  <head>
    

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head
      content must come *after* these tags -->

<meta name="description"
      content="One of the key goals of atf is to let the end user — not only the developer — to easily run the tests after their corresponding application is installed.  (I...">
<meta name="author" content="Julio Merino">

<meta content="http://julio.meroh.net/2007/06/soc-atf-run-tool.html" property="og:url">

<link rel="canonical" href="http://julio.meroh.net/2007/06/soc-atf-run-tool.html">
<link rel="alternate" type="application/rss+xml" title="Julio Merino" href="http://julio.meroh.net/feed.xml" />

<link rel="stylesheet" href="/css/main.css">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="/js/html5shiv-3.7.2.min.js"></script>
  <script src="/js/respond-1.4.2.min.js"></script>
<![endif]-->

    <title>SoC: The atf-run tool - Julio Merino</title>
    <meta content="SoC: The atf-run tool - Julio Merino" property="og:title">
  </head>

  <body>
    <header class="site-header">

<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed"
              data-toggle="collapse" data-target="#navbar"
              aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Julio Merino</a>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
          
            
              
                <li><a class="page-link"
                href="/about/"
                >About</a></li>
              
            
          
        
          
            
              
                <li><a class="page-link"
                href="/essays/"
                >Essays</a></li>
              
            
          
        
          
            
              
                <li><a class="page-link"
                href="/software/"
                >Software</a></li>
              
            
          
        
          
            
              
                <li><a class="page-link"
                href="/work/"
                >Work</a></li>
              
            
          
        
      </ul>

      <form class="navbar-form navbar-right" method="get" role="search"
            action="http://www.google.com/search">
          <div class="form-group">
            <input type="text" name="query" class="form-control"
                   placeholder="Search">
            <input type="hidden" name="sitesearch" value="http://julio.meroh.net">
          </div>
          <button type="submit" value="Search" class="btn btn-default">
            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
          </button>
      </form>
    </div>
  </div>
</nav>

</header>


    <div class="page-header">
      <div class="container">
        <h1>SoC: The atf-run tool</h1>

        <p>Sat, 30 Jun 2007 16:25:00 +0000</p>

        
      </div>
    </div>

    <div class="container">
      <article>
        One of the key goals of <a href="http://netbsd-soc.sourceforge.net/projects/atf/">atf</a> is to let the <i>end user</i> — not <span style="font-style: italic;">only</span> the <i>developer</i> — to easily run the tests after their corresponding application is installed.  (In our case, application = NetBSD, but remember that atf also aims to be independent from NetBSD.) This also means, among other things, that the user must not need to have any development tool installed (the <tt>comp.tgz</tt> set) to run the tests, which rules out using make(1)... how glad I'm of that! :-)<br /><br />Based on this idea, each application using atf will install its tests alongside its binaries, being the currently location <tt>/usr/tests/&lt;application&gt;</tt>.  These tests will be accompanied by a control file — an <tt>Atffile</tt> — that lists which tests have to be run and in which order.  (In the future this may also include configuration or some other settings.)  Later on, the user will be able to launch the <b>atf-run</b> tool inside any of these directories to automatically run all the provided tests, and the tool will generate a pretty report while the tests are run.<br /><br />Given that atf is an application, it has to be tested.  After some work today, it is finally possible for atf to test itself! :-)  Of course, it also comes with several bootstrap tests, written using GNU Autotest, to ensure that atf's core functionality works before one can run the tests written using atf itself.  Otherwise one could get unexpected passes due to bugs in the atf code.<br /><br />This is what atf installs:<pre>$ find /tmp/local/tests<br />/tmp/local/tests<br />/tmp/local/tests/atf<br />/tmp/local/tests/atf/Atffile<br />/tmp/local/tests/atf/units<br />/tmp/local/tests/atf/units/Atffile<br />/tmp/local/tests/atf/units/t_file_handle<br />/tmp/local/tests/atf/units/t_filesystem<br />/tmp/local/tests/atf/units/t_pipe<br />/tmp/local/tests/atf/units/t_pistream<br />/tmp/local/tests/atf/units/t_postream<br />/tmp/local/tests/atf/units/t_systembuf<br />$</pre>All the <tt>t_*</tt> files are <i>test programs</i> written using the features provided by libatf.  As you can see, each directory provides an <tt>Atffile</tt> which lists the tests to run and the directories to descend into.<br /><br />The atf-run tool already works (*cough* it's code is ugly, really ugly) and returns an appropriate error code depending on the outcomes of the tests.  However, the report it generates is completely un-understandable.  This will be the next thing to attack: I want to be able to generate plain-text reports to be seen as the text progresses, but also to generate pretty HTML files.  To do the latter, the plan is to use some intermediate format such as XML and have another tool to do the formatting.

      </article>

      <div class="post-links">
        <p>
          

          

          <a href="/feed.xml">Subscribe
          via RSS</a>
          &middot;
          <a href="/blog/">Go to posts index</a>
        </p>

        <form class="form-inline"
            action="https://feedburner.google.com/fb/a/mailverify"
            method="post"
            target="popupwindow"
            onsubmit="window.open('https://feedburner.google.com/fb/a/mailverify?uri=jmmv', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true">
          <div class="form-group form-group-sm">
            <input type="text" style="width: 400px" name="email"
                    placeholder="Enter your email to subscribe to new posts"
                    class="form-control input-sm"/>
          </div>
          <button type="submit" value="Subscribe"
                  class="btn btn-default btn-sm">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
          </button>
          &nbsp;&nbsp;&nbsp;Delivered by
          <input type="hidden" value="jmmv" name="uri"/>
          <input type="hidden" name="loc" value="en_US"/>
          <a href="https://feedburner.google.com" target="_blank">FeedBurner</a>
        </form>
      </div>

      
      <div id="disqus_thread">
        <script>
          var disqus_config = function () {
            this.page.url = "http://julio.meroh.net/2007/06/soc-atf-run-tool.html";
            this.page.identifier = "/2007/06/soc-atf-run-tool";
          };
          (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//jmmv.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
        <noscript>Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments
          powered by Disqus.</a>
        </noscript>
      </div>
      
      <p>Comments from the original Blogger-hosted post:</p>
      <script src="https://apis.google.com/js/plusone.js"></script>
      <div class="g-comments"
           data-href="http://julipedia.meroh.net/2007/06/soc-atf-run-tool.html"
           data-first_party_property="BLOGGER"
           data-view_type="FILTERED_POSTMOD">
      </div>
      
      
    </div>

    <div class="container">
  <footer>
    <p class="pull-right"><a href="#">Back to top</a></p>
    <p>Copyright 2018 Julio Merino</p>
  </footer>
</div>

<script src="/js/jquery-1.11.2.min.js">
</script>
<script
  src="/css/bootstrap.min.js">
</script>

<script src="/js/auto-toc-1.0.0.dist.js">
</script>

<script>
$("p:contains('NOTE: ')").addClass("callout callout-info");
$("p:contains('IMPORTANT: ')").addClass("callout callout-info");
$("p:contains('WARNING: ')").addClass("callout callout-warning");
$("p:contains('DANGER: ')").addClass("callout callout-danger");
</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
  m.parentNode.insertBefore(a,m)})(window,document,'script',
  '//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63557333-1', 'auto');
  ga('send', 'pageview');
</script>


  </body>
</html>
